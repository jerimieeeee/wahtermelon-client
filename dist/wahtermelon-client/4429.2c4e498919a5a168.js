"use strict";(self.webpackChunkwahtermelon_client=self.webpackChunkwahtermelon_client||[]).push([[4429],{4429:(k,F,s)=>{s.r(F),s.d(F,{EnvironmentalModule:()=>S});var _=s(177),w=s(1317),n=s(9417),c=s(7468),l=s(614),d=s(5383),e=s(4438),h=s(3318),f=s(5794),g=s(1757),m=s(60);const u=()=>({standalone:!0});function v(a,o){if(1&a&&(e.j41(0,"option",33),e.EFF(1),e.k0s()),2&a){const t=o.$implicit,i=e.XpG(2);e.HbH(i.checkExist(t)?"bg-green-700 text-white":""),e.Y8G("value",t),e.R7$(),e.JRh(t)}}function b(a,o){if(1&a&&(e.j41(0,"option",33),e.EFF(1),e.k0s()),2&a){const t=o.$implicit;e.Y8G("value",t.code),e.R7$(),e.JRh(t.desc)}}function E(a,o){if(1&a&&(e.j41(0,"option",36),e.EFF(1),e.k0s()),2&a){const t=o.$implicit;e.Y8G("ngValue",t.value),e.R7$(),e.JRh(t.desc)}}function j(a,o){if(1&a&&(e.j41(0,"div")(1,"label",34),e.EFF(2),e.j41(3,"span",14),e.EFF(4,"*"),e.k0s()(),e.j41(5,"select",35)(6,"option",36),e.EFF(7,"-"),e.k0s(),e.DNE(8,E,2,2,"option",37),e.k0s()()),2&a){const t=o.$implicit,i=e.XpG(2);e.R7$(),e.Y8G("for",t.var_name),e.R7$(),e.SpI("",t.title," "),e.R7$(3),e.Y8G("name",t.var_name)("id",t.var_name)("formControlName",t.var_name),e.R7$(),e.Y8G("ngValue",null),e.R7$(2),e.Y8G("ngForOf",i.ans_yn)}}function R(a,o){if(1&a&&(e.j41(0,"option",33),e.EFF(1),e.k0s()),2&a){const t=o.$implicit;e.Y8G("value",t.code),e.R7$(),e.JRh(t.desc)}}function Y(a,o){if(1&a&&(e.j41(0,"fieldset",38)(1,"legend"),e.EFF(2),e.k0s(),e.j41(3,"div")(4,"label",34),e.EFF(5,"Date of validation"),e.k0s(),e.nrm(6,"input",39),e.k0s(),e.j41(7,"div")(8,"label",34),e.EFF(9,"Result"),e.k0s(),e.j41(10,"select",35)(11,"option",33),e.EFF(12,"-"),e.k0s(),e.j41(13,"option",40),e.EFF(14,"Positive"),e.k0s(),e.j41(15,"option",41),e.EFF(16,"Negative"),e.k0s()()()()),2&a){const t=o.$implicit;e.R7$(2),e.JRh(t.title),e.R7$(2),e.Y8G("for",t.date_var),e.R7$(2),e.Y8G("name",t.date_var)("id",t.date_var)("formControlName",t.date_var),e.R7$(2),e.Y8G("for",t.result_var),e.R7$(2),e.Y8G("name",t.result_var)("id",t.result_var)("formControlName",t.result_var),e.R7$(),e.Y8G("value",null)}}function x(a,o){if(1&a&&(e.j41(0,"div"),e.nrm(1,"input",44),e.j41(2,"label",45),e.EFF(3),e.k0s()()),2&a){const t=o.$implicit;e.R7$(),e.Y8G("formControlName",t.var_name),e.BMQ("id",t.var_name),e.R7$(),e.BMQ("for",t.var_name),e.R7$(),e.JRh(t.title)}}function C(a,o){1&a&&(e.j41(0,"div",26)(1,"label",46),e.EFF(2,"Remarks"),e.k0s(),e.nrm(3,"input",47),e.k0s())}function D(a,o){if(1&a&&(e.j41(0,"fieldset",42)(1,"legend"),e.EFF(2),e.k0s(),e.j41(3,"div",8),e.DNE(4,x,4,4,"div",21),e.k0s(),e.DNE(5,C,4,0,"div",43),e.k0s()),2&a){const t=o.$implicit,i=o.index,r=e.XpG(2);e.R7$(2),e.JRh(t.title),e.R7$(2),e.Y8G("ngForOf",t.content),e.R7$(),e.Y8G("ngIf",r.environmentalForm.value.wm_others_flag&&1===i)}}function G(a,o){if(1&a&&e.nrm(0,"fa-icon",48),2&a){const t=e.XpG(2);e.Y8G("icon",t.faSave)}}function $(a,o){if(1&a&&e.nrm(0,"fa-icon",49),2&a){const t=e.XpG(2);e.Y8G("icon",t.faCircleNotch)}}function J(a,o){if(1&a){const t=e.RV6();e.j41(0,"div",7)(1,"div",8)(2,"div")(3,"label",9),e.EFF(4,"Selected Year"),e.k0s(),e.j41(5,"select",10),e.bIt("change",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.loadSelectedYear())}),e.mxI("ngModelChange",function(r){e.eBV(t);const p=e.XpG();return e.DH7(p.selected_year,r)||(p.selected_year=r),e.Njj(r)}),e.DNE(6,v,2,4,"option",11),e.k0s()()(),e.j41(7,"form",12)(8,"div")(9,"label",13),e.EFF(10,"Registration Date "),e.j41(11,"span",14),e.EFF(12,"*"),e.k0s()(),e.nrm(13,"input",15),e.k0s(),e.j41(14,"div")(15,"label",16),e.EFF(16,"Number of families "),e.j41(17,"span",14),e.EFF(18,"*"),e.k0s()(),e.nrm(19,"input",17),e.k0s(),e.j41(20,"div")(21,"label",18),e.EFF(22,"Type of water "),e.j41(23,"span",14),e.EFF(24,"*"),e.k0s()(),e.j41(25,"select",19),e.DNE(26,b,2,2,"option",20),e.k0s()(),e.DNE(27,j,9,7,"div",21),e.j41(28,"div")(29,"label",22),e.EFF(30,"Type of Toilet Facility "),e.j41(31,"span",14),e.EFF(32,"*"),e.k0s()(),e.j41(33,"select",23),e.DNE(34,R,2,2,"option",20),e.k0s()(),e.j41(35,"div"),e.EFF(36,"\xa0"),e.k0s(),e.DNE(37,Y,17,10,"fieldset",24)(38,D,6,3,"fieldset",25),e.j41(39,"div",26)(40,"label",27),e.EFF(41,"Remarks"),e.k0s(),e.nrm(42,"input",28),e.k0s(),e.j41(43,"div",29)(44,"button",30),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onSubmit())}),e.DNE(45,G,1,1,"fa-icon",31)(46,$,1,1,"fa-icon",32),e.EFF(47),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(5),e.R50("ngModel",t.selected_year),e.Y8G("ngModelOptions",e.lJ4(13,u)),e.R7$(),e.Y8G("ngForOf",t.years),e.R7$(),e.Y8G("formGroup",t.environmentalForm),e.R7$(19),e.Y8G("ngForOf",t.env_water_types),e.R7$(),e.Y8G("ngForOf",t.sanition_flags),e.R7$(7),e.Y8G("ngForOf",t.env_toilet_facilities),e.R7$(3),e.Y8G("ngForOf",t.test_lists),e.R7$(),e.Y8G("ngForOf",t.sw_wm_management_lists),e.R7$(6),e.Y8G("disabled",t.environmentalForm.invalid||t.is_saving),e.R7$(),e.Y8G("ngIf",!t.is_saving),e.R7$(),e.Y8G("ngIf",t.is_saving),e.R7$(),e.SpI(" ",t.is_saving?t.environmentalForm.value.id?"Updating":"Saving":t.environmentalForm.value.id?"Update":"Save"," ")}}function N(a,o){if(1&a&&(e.j41(0,"div",50)(1,"div",51),e.nrm(2,"fa-icon",49),e.k0s(),e.j41(3,"div",52),e.EFF(4," Loading health and sanitation... "),e.k0s()()),2&a){const t=e.XpG();e.R7$(2),e.Y8G("icon",t.faCircleNotch)}}const T=[{path:"",component:(()=>{class a{onSubmit(){this.is_saving=!0;let t=(0,_.Yq)(this.environmentalForm.value.registration_date,"yyyy","en","Asia/Manila");this.environmentalForm.patchValue({effectivity_year:t}),this.http.post("households/environmental/records",this.environmentalForm.value).subscribe({next:()=>{this.toastr.success("Successfully recorded!","Environmental"),this.loadEnvironmental(),this.is_saving=!1},error:i=>this.http.showError(i.error.message,"Environmental")})}loadEnvironmental(){this.show_form=!1,this.http.get("households/environmental/records",{params:{household_folder_id:this.household_folder_id}}).subscribe({next:i=>{console.log(i),this.environmental_list=i.data,this.loadSelectedYear()},error:i=>{this.http.showError(i.error.message,"Household Profile"),this.show_form=!0}})}loadSelectedYear(){let t=this.checkExist();this.selected_profile=t,this.selected_profile&&Object.keys(this.selected_profile).length>0?(this.environmentalForm.patchValue({...this.selected_profile}),this.environmentalForm.patchValue({validation_date:this.environmentalForm.value.validation_date?this.dateHelper.dateFormat(this.environmentalForm.value.validation_date):null,arsenic_date:this.environmentalForm.value.arsenic_date?this.dateHelper.dateFormat(this.environmentalForm.value.arsenic_date):null})):this.emptyForm(),this.show_form=!0}checkExist(t){return t?!!this.environmental_list.find(r=>Number(r.effectivity_year)===Number(t)):this.environmental_list.find(i=>Number(i.effectivity_year)===Number(this.selected_year))}createForm(){this.show_form=!1,this.selected_year=Number(this.year),this.emptyForm(),this.loadEnvironmental()}emptyForm(){this.environmentalForm=this.formBuilder.group({id:[null],household_folder_id:[this.household_folder_id,n.k0.required],number_of_families:[null,n.k0.required],registration_date:[null,n.k0.required],effectivity_year:[null],water_type_code:[null,n.k0.required],safety_managed_flag:[null,n.k0.required],sanitation_managed_flag:[null,n.k0.required],satisfaction_management_flag:[null,n.k0.required],complete_sanitation_flag:[null,n.k0.required],located_premises_flag:[null,n.k0.required],availability_flag:[null,n.k0.required],microbiological_result:[null],validation_date:[null],arsenic_result:[null],arsenic_date:[null],open_defecation_flag:[null,n.k0.required],toilet_facility_code:[null,n.k0.required],toilet_shared_flag:[null,n.k0.required],sw_disposed_flag:[!1],sw_collected_flag:[!1],wm_waste_segration_flag:[!1],wm_backyad_composting_flag:[!1],wm_recycling_flag:[!1],wm_collected_flag:[!1],wm_others_flag:[!1],wm_others_remarks:[null],remarks:[null],end_sanitation_flag:[0]})}loadLibraries(){this.show_form=!1;const t=this.http.get("libraries/environmental-result"),i=this.http.get("libraries/environmental-sewage"),r=this.http.get("libraries/environmental-toilet-facility"),p=this.http.get("libraries/environmental-waste-management"),y=this.http.get("libraries/environmental-water-type");(0,c.p)([t,i,r,p,y]).subscribe({next:([I,V,X,A,B])=>{this.env_results=I.data,this.env_sewages=V.data,this.env_toilet_facilities=X.data,this.env_waste_managements=A.data,this.env_water_types=B.data,this.createForm()}})}constructor(t,i,r,p){this.http=t,this.toastr=i,this.formBuilder=r,this.dateHelper=p,this.faSave=l.hSh,this.faCircleNotch=d.s4k,this.environmentalForm=function M(){return new n.gE({id:new n.MJ(null),household_folder_id:new n.MJ(null),number_of_families:new n.MJ(null),registration_date:new n.MJ(null),effectivity_year:new n.MJ(null),water_type_code:new n.MJ(null),safety_managed_flag:new n.MJ(!1),sanitation_managed_flag:new n.MJ(!1),satisfaction_management_flag:new n.MJ(!1),complete_sanitation_flag:new n.MJ(!1),located_premises_flag:new n.MJ(!1),availability_flag:new n.MJ(!1),microbiological_result:new n.MJ(null),validation_date:new n.MJ(null),arsenic_result:new n.MJ(null),arsenic_date:new n.MJ(null),open_defecation_flag:new n.MJ(!1),toilet_shared_flag:new n.MJ(!1),toilet_facility_code:new n.MJ(null),sw_disposed_flag:new n.MJ(!1),sw_collected_flag:new n.MJ(!1),wm_waste_segration_flag:new n.MJ(!1),wm_backyad_composting_flag:new n.MJ(!1),wm_recycling_flag:new n.MJ(!1),wm_collected_flag:new n.MJ(!1),wm_others_flag:new n.MJ(!1),wm_others_remarks:new n.MJ(null),remarks:new n.MJ(null),end_sanitation_flag:new n.MJ(!1)})}(),this.year=(0,_.Yq)(new Date,"yyyy","en"),this.years=[],this.show_form=!1,this.is_saving=!1,this.ans_yn=[{desc:"Yes",value:1},{desc:"No",value:0}],this.sanition_flags=[{title:"Using safety managed drinking water services",var_name:"safety_managed_flag"},{title:"Using managed sanitation services",var_name:"sanitation_managed_flag"},{title:"Satisfaction solid waste management",var_name:"satisfaction_management_flag"},{title:"Complete sanitation facilities",var_name:"complete_sanitation_flag"},{title:"Located within premises",var_name:"located_premises_flag"},{title:"Available at least 12 hours per day",var_name:"availability_flag"},{title:"Open Defecation",var_name:"open_defecation_flag"},{title:"Toilet not shared",var_name:"toilet_shared_flag"}],this.test_lists=[{title:"Microbiological Validation",date_var:"validation_date",result_var:"microbiological_result"},{title:"Physico-chemical test for Arsenic",date_var:"arsenic_date",result_var:"arsenic_result"}],this.sw_wm_management_lists=[{title:"Disposal/Treatment of Excreta/Sewage",content:[{title:"Sewage/excreta is safely disposed in situ",var_name:"sw_disposed_flag"},{title:"Sewage/excreta is collected, transported and disposed off site",var_name:"sw_collected_flag"}]},{title:"Waste Management",content:[{title:"Waste Segregation",var_name:"wm_waste_segration_flag"},{title:"Backyard Composting",var_name:"wm_backyad_composting_flag"},{title:"Recycling/Reuse",var_name:"wm_recycling_flag"},{title:"Collected by City/Municipality Collection and Disposal System",var_name:"wm_collected_flag"},{title:"Others (Burning / Burying, Specify)",var_name:"wm_others_flag"}]}];for(let y=Number(this.year);y>2017;y--)this.years.push(y)}ngOnInit(){this.household_folder_id=this.http.getUrlParams().patient_id,this.loadLibraries()}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(h.k),e.rXU(f.tw),e.rXU(n.ok),e.rXU(g.F))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-environmental"]],standalone:!1,decls:8,vars:2,consts:[[1,"my-10","flex","justify-center","w-full"],[1,"w-full","bg-white","border","border-solid","border-slate-100","rounded-xl","shadow-md"],[1,"border","border-solid","border-slate-100","rounded-t-xl","font-semibold","justify-between"],[1,"flex","border","border-solid","border-slate-100","rounded-t-xl","p-3","font-semibold","justify-between"],[1,"text-blue-500","text-lg","pt-2","pl-5"],["class","overflow-x-auto relative grid grid-cols-3 gap-4 m-10",4,"ngIf"],["class","grid grid-cols-1 my-24",4,"ngIf"],[1,"overflow-x-auto","relative","grid","grid-cols-3","gap-4","m-10"],[1,"col-span-3","grid","grid-cols-3","gap-4"],["for","selected_year"],["name","selected_year","id","selected_year",1,"input",3,"change","ngModelChange","ngModel","ngModelOptions"],[3,"value","class",4,"ngFor","ngForOf"],[1,"col-span-3","grid","grid-cols-3","gap-4",3,"formGroup"],["for","registration_date"],[1,"text-red-500"],["type","date","name","registration_date","id","registration_date","formControlName","registration_date",1,"input"],["for","number_of_families"],["type","number","name","number_of_families","id","number_of_families","formControlName","number_of_families",1,"input"],["for","water_type_code"],["name","water_type_code","id","water_type_code","formControlName","water_type_code",1,"input"],[3,"value",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["for","toilet_facility_code"],["name","toilet_facility_code","id","toilet_facility_code","formControlName","toilet_facility_code",1,"input"],["class","col-span-3 grid grid-cols-3 gap-4 border border-blue-300 p-5 mx-10",4,"ngFor","ngForOf"],["class","select-none col-span-3 grid grid-cols-3 gap-4 border border-blue-300 p-5 mx-10",4,"ngFor","ngForOf"],[1,"col-span-3"],["for","remarks"],["type","text","name","remarks","id","remarks","formControlName","remarks",1,"input"],[1,"col-span-3","flex","justify-center"],["type","submit",1,"btn-save",3,"click","disabled"],[3,"icon",4,"ngIf"],["animation","spin",3,"icon",4,"ngIf"],[3,"value"],[3,"for"],[1,"input",3,"name","id","formControlName"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-span-3","grid","grid-cols-3","gap-4","border","border-blue-300","p-5","mx-10"],["type","date",1,"input",3,"name","id","formControlName"],["value","POSITIVE"],["value","NEGATIVE"],[1,"select-none","col-span-3","grid","grid-cols-3","gap-4","border","border-blue-300","p-5","mx-10"],["class","col-span-3",4,"ngIf"],["type","checkbox",1,"input-checkbox",3,"formControlName"],[1,"pl-2"],["for","wm_others_remarks"],["type","text","name","wm_others_remarks","id","wm_others_remarks","formControlName","wm_others_remarks",1,"input"],[3,"icon"],["animation","spin",3,"icon"],[1,"grid","grid-cols-1","my-24"],[1,"flex","justify-center","text-blue-500"],[1,"flex","justify-center"]],template:function(i,r){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e.EFF(5," Environmental Health and Sanitation "),e.k0s()(),e.DNE(6,J,48,14,"div",5)(7,N,5,1,"div",6),e.k0s()()()),2&i&&(e.R7$(6),e.Y8G("ngIf",r.show_form),e.R7$(),e.Y8G("ngIf",!r.show_form))},dependencies:[_.Sq,_.bT,n.qT,n.xH,n.y7,n.me,n.Q0,n.Zm,n.wz,n.BC,n.cb,n.vS,n.j4,n.JD,m.aY],encapsulation:2})}}return a})()}];let O=(()=>{class a{static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[w.iI.forChild(T),w.iI]})}}return a})(),S=(()=>{class a{static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[_.MD,O,n.YN,n.X1,m.dX]})}}return a})()},1757:(k,F,s)=>{s.d(F,{F:()=>n});var _=s(177),w=s(4438);let n=(()=>{class c{dateFormat(l){try{return(0,_.Yq)(l,"yyyy-MM-dd","en","Asia/Manila")}catch{return"Date is not valid"}}timeFormatAmPm(l){try{return(0,_.Yq)(l,"hh:mma","en","Asia/Manila")}catch{return"Date is not valid"}}timeFormat(l){try{return(0,_.Yq)(l,"HH:mm:ss","en","Asia/Manila")}catch{return"Date is not valid"}}getLabelValue(l,d){const e=new Date(l.value.start_date),h=new Date(l.value.end_date),f=e.getFullYear(),g=h.getFullYear();if((!l.value.start_date||!l.value.end_date)&&l.value.month&&l.value.year){const u=l.value.month-1,v=l.value.year,b=new Date(v,u,1),E=new Date(v,u+1,0);l.value.start_date=b,l.value.end_date=E}let m={labelType:null,labelDate:(0,_.Yq)(l.value.start_date,"MMM dd, yyyy","en","Asia/Manila")+" to "+(0,_.Yq)(l.value.end_date,"MMM dd, yyyy","en","Asia/Manila"),labelYear:f===g?f:f+" to "+g,labelPopulation:this.getPop(d,g)};if(1===e.getDate()&&this.isLastDayOfMonth(h)&&f===g){const u=e.getMonth()+1,v=h.getMonth()+1;if(m.labelYear=f,u===v)m.labelType="M1",m.labelDate=(0,_.Yq)(e,"MMMM","en","Asia/Manila");else switch(u+"-"+v){case"1-3":m.labelType="Q1",m.labelDate="1st Quarter";break;case"4-6":m.labelType="Q1",m.labelDate="2nd Quarter";break;case"7-9":m.labelType="Q1",m.labelDate="3rd Quarter";break;case"10-12":m.labelType="Q1",m.labelDate="4th Quarter";break;case"1-12":m.labelType="A1",m.labelDate="January to December"}}return m}isLastDayOfMonth(l){return 1===new Date(l.getFullYear(),l.getMonth(),l.getDate()+1).getDate()}getPop(l,d){return l.projected_population[0]&&+l.projected_population[0].year===d?l.projected_population[0].total_population??"-":"-"}static{this.\u0275fac=function(d){return new(d||c)}}static{this.\u0275prov=w.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})()}}]);