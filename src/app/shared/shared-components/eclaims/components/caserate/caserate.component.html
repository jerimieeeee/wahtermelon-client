<div class="grid grid-cols-3 gap-4 mt-4">
  <div class="shadow-md rounded-md col-span-1">
    <div class="bg-blue-500 text-white rounded-t-md p-3 flex justify-between">
      <span>Caserate List</span>
    </div>

    <div class="rounded-b-md grid grid-cols-1">
      <div class="grid grid-cols-6 border-t border-slate-200" *ngFor="let caserate of caserate_list; let i = index">
          <div class="col-span-5 m-2 text-sm">
            <strong>{{ caserate.caserate_code }}</strong> <br />
            {{ caserate.caserate_date | date:'MM/dd/yyyy'}} <br />
            {{ caserate.description }} <br />
          </div>
          <div class="col-span-1 text-orange-500 m-2">
            <button type="button" (click)="selectCaserate(i)">
              <fa-icon [icon]="faEdit"></fa-icon>
            </button>
          </div>
      </div>
    </div>
  </div>

  <div class="shadow-md rounded-md col-span-2">
    <div class="bg-blue-500 text-white rounded-t-md p-3 flex justify-between">
      <span>Caserate</span>
      <button class="bg-gray-100 text-blue-500 px-3 rounded-md" (click)="toggleModal('search-caserate')">
        <fa-icon [icon]="faSearch" class="text-sm font-semibold"></fa-icon>
        search
      </button>
    </div>

    <div class="rounded-b-md border-x border-b border-slate-200 flex">
      <form class="w-full m-5" [formGroup]="caserateForm" (ngSubmit)="onSubmit()">
        <div *ngIf="show_form" class="grid grid-cols-1 gap-2 w-full">
          <div>
              <label for="caserate_date">Caserate date</label>
              <input type="date" name="caserate_date" id="caserate_date" formControlName="caserate_date" class="input" />
          </div>

          <div>
              <label for="admit_dx">Admission Diagnosis</label>
              <input type="text" name="admit_dx" id="admit_dx" formControlName="admit_dx" class="input" />
          </div>

          <div>
            <label for="discharge_dx">Discharge Diagnosis</label>
            <input type="text" name="discharge_dx" id="discharge_dx" formControlName="discharge_dx" class="input" />
          </div>

          <div>
            <label for="icd10_code">ICD10 Code</label>
            <ng-select class="select-chips" placeholder="search"
              [items]="fdx$ | async"
              [multiple]="true"
              [loading]="fdxLoading"
              typeToSearchText="search..."
              [typeahead]="searchInput$"
              formControlName="icd10_code"
              bindValue="icd10_code"
              bindLabel="icd10_desc"
              [multiple]="false"
              notFoundText="No records found">

              <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
                <div class="whitespace-normal">
                  <h5 class="text-gray-700" [ngOptionHighlight]="search"><strong>{{ item.icd10_code }}:</strong> {{ item.icd10_desc }}</h5>
                </div>
              </ng-template>


              <ng-template ng-label-tmp let-item="item" let-clear="clear">
                <div>
                  {{ item.icd10_code }}: {{ item.icd10_desc }}
                </div>
              </ng-template>
            </ng-select>
          </div>

          <div>
            <label for="caserate_code">Case Rate Code</label>
            <input type="text" name="caserate_code" id="caserate_code" formControlName="caserate_code" class="input" />
          </div>

          <div>
            <label for="code">RVS Code</label>
            <input type="text" name="code" id="code" formControlName="code" class="input" />
          </div>

          <div>
            <label for="description">Description</label>
            <input type="text" name="description" id="description" formControlName="description" class="input" />
          </div>


          <div>
            <label for="hci_fee">HCI Fee</label>
            <input type="number" name="hci_fee" id="hci_fee" formControlName="hci_fee" class="input" />
          </div>

          <div>
            <label for="prof_fee">Prof Fee</label>
            <input type="number" name="prof_fee" id="prof_fee" formControlName="prof_fee" class="input" />
          </div>

          <div>
            <label for="caserate_fee">Case Rate Fee</label>
            <input type="number" name="caserate_fee" id="caserate_fee" formControlName="caserate_fee" class="input" />
          </div>

          <div>
            <label for="caserate_attendant">Caserate attendant</label>
            <select name="caserate_attendant" id="caserate_attendant" formControlName="caserate_attendant" class="input">
              <option *ngFor="let att of attendant" [value]="att.id">{{ att.last_name }}, {{ att.first_name }}</option>
            </select>
          </div>

          <div class="my-5">
            <div class="flex justify-center">
              <button [disabled]="is_saving" type="submit" class="btn-save font-semibold px-10">
                <fa-icon [icon]="is_saving ? faCircleNotch : faSave" [spin]="is_saving" class="pr-2"></fa-icon>
                {{ caserateForm.value.id ? (is_saving ? 'Updating' : 'Update') : (is_saving ? 'Saving' : 'Save') }}
              </button>
            </div>
          </div>
        </div>

        <div *ngIf="!show_form" class="grid grid-cols-1 my-20">
          <div class="flex justify-center text-blue-500">
            <fa-icon [icon]="faCircleNotch" spin="true"></fa-icon>
          </div>
          <div class="flex justify-center">
            Fetching caserate details...
          </div>
        </div>
      </form>
    </div>
  </div>


</div>

<app-search-caserate *ngIf="modals['search-caserate']"
  (toggleModal)="toggleModal($event)"
  [program_name]="program_name"
></app-search-caserate>
