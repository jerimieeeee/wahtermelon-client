(self.webpackChunkwahtermelon_client=self.webpackChunkwahtermelon_client||[]).push([[4237],{4237:(Ie,V,k)=>{"use strict";k.r(V),k.d(V,{DashboardModule:()=>Gt});var C=k(177),w=k(60),v=k(3895),e=k(3953),_=k(5383),X=k(1413),I=k(980),P=k(3318),F=k(1196),R=k(41);function E(c){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(u){return typeof u}:function(u){return u&&"function"==typeof Symbol&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u})(c)}function b(c,u){if(!(c instanceof u))throw new TypeError("Cannot call a class as a function")}function m(c,u){for(var r=0;r<u.length;r++){var a=u[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(c,a.key,a)}}function g(c,u,r){return u&&m(c.prototype,u),r&&m(c,r),Object.defineProperty(c,"prototype",{writable:!1}),c}function x(){return x=Object.assign||function(c){for(var u=1;u<arguments.length;u++){var r=arguments[u];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(c[a]=r[a])}return c},x.apply(this,arguments)}function j(c,u){if("function"!=typeof u&&null!==u)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(u&&u.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),Object.defineProperty(c,"prototype",{writable:!1}),u&&M(c,u)}function $(c){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)})(c)}function M(c,u){return(M=Object.setPrototypeOf||function(a,s){return a.__proto__=s,a})(c,u)}function D(c){var u=function W(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var s,a=$(c);if(u){var h=$(this).constructor;s=Reflect.construct(a,arguments,h)}else s=a.apply(this,arguments);return function J(c,u){if(u&&("object"==typeof u||"function"==typeof u))return u;if(void 0!==u)throw new TypeError("Derived constructors may only return object or undefined");return function Q(c){if(void 0===c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c}(c)}(this,s)}}var K=function(){function c(){b(this,c)}return g(c,[{key:"listenForWhisper",value:function(r,a){return this.listen(".client-"+r,a)}},{key:"notification",value:function(r){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",r)}},{key:"stopListeningForWhisper",value:function(r,a){return this.stopListening(".client-"+r,a)}}]),c}(),Ae=function(){function c(u){b(this,c),this.namespace=u}return g(c,[{key:"format",value:function(r){return[".","\\"].includes(r.charAt(0))?r.substring(1):(this.namespace&&(r=this.namespace+"."+r),r.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(r){this.namespace=r}}]),c}(),te=function(c){j(r,c);var u=D(r);function r(a,s,h){var p;return b(this,r),(p=u.call(this)).name=s,p.pusher=a,p.options=h,p.eventFormatter=new Ae(p.options.namespace),p.subscribe(),p}return g(r,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(s,h){return this.on(this.eventFormatter.format(s),h),this}},{key:"listenToAll",value:function(s){var h=this;return this.subscription.bind_global(function(p,A){if(!p.startsWith("pusher:")){var B=h.options.namespace.replace(/\./g,"\\"),Y=p.startsWith(B)?p.substring(B.length+1):"."+p;s(Y,A)}}),this}},{key:"stopListening",value:function(s,h){return h?this.subscription.unbind(this.eventFormatter.format(s),h):this.subscription.unbind(this.eventFormatter.format(s)),this}},{key:"stopListeningToAll",value:function(s){return s?this.subscription.unbind_global(s):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(s){return this.on("pusher:subscription_succeeded",function(){s()}),this}},{key:"error",value:function(s){return this.on("pusher:subscription_error",function(h){s(h)}),this}},{key:"on",value:function(s,h){return this.subscription.bind(s,h),this}}]),r}(K),ae=function(c){j(r,c);var u=D(r);function r(){return b(this,r),u.apply(this,arguments)}return g(r,[{key:"whisper",value:function(s,h){return this.pusher.channels.channels[this.name].trigger("client-".concat(s),h),this}}]),r}(te),Ze=function(c){j(r,c);var u=D(r);function r(){return b(this,r),u.apply(this,arguments)}return g(r,[{key:"whisper",value:function(s,h){return this.pusher.channels.channels[this.name].trigger("client-".concat(s),h),this}}]),r}(te),fe=function(c){j(r,c);var u=D(r);function r(){return b(this,r),u.apply(this,arguments)}return g(r,[{key:"here",value:function(s){return this.on("pusher:subscription_succeeded",function(h){s(Object.keys(h.members).map(function(p){return h.members[p]}))}),this}},{key:"joining",value:function(s){return this.on("pusher:member_added",function(h){s(h.info)}),this}},{key:"whisper",value:function(s,h){return this.pusher.channels.channels[this.name].trigger("client-".concat(s),h),this}},{key:"leaving",value:function(s){return this.on("pusher:member_removed",function(h){s(h.info)}),this}}]),r}(te),Le=function(c){j(r,c);var u=D(r);function r(a,s,h){var p;return b(this,r),(p=u.call(this)).events={},p.listeners={},p.name=s,p.socket=a,p.options=h,p.eventFormatter=new Ae(p.options.namespace),p.subscribe(),p}return g(r,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(s,h){return this.on(this.eventFormatter.format(s),h),this}},{key:"stopListening",value:function(s,h){return this.unbindEvent(this.eventFormatter.format(s),h),this}},{key:"subscribed",value:function(s){return this.on("connect",function(h){s(h)}),this}},{key:"error",value:function(s){return this}},{key:"on",value:function(s,h){var p=this;return this.listeners[s]=this.listeners[s]||[],this.events[s]||(this.events[s]=function(A,B){p.name===A&&p.listeners[s]&&p.listeners[s].forEach(function(Y){return Y(B)})},this.socket.on(s,this.events[s])),this.listeners[s].push(h),this}},{key:"unbind",value:function(){var s=this;Object.keys(this.events).forEach(function(h){s.unbindEvent(h)})}},{key:"unbindEvent",value:function(s,h){this.listeners[s]=this.listeners[s]||[],h&&(this.listeners[s]=this.listeners[s].filter(function(p){return p!==h})),(!h||0===this.listeners[s].length)&&(this.events[s]&&(this.socket.removeListener(s,this.events[s]),delete this.events[s]),delete this.listeners[s])}}]),r}(K),Oe=function(c){j(r,c);var u=D(r);function r(){return b(this,r),u.apply(this,arguments)}return g(r,[{key:"whisper",value:function(s,h){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(s),data:h}),this}}]),r}(Le),et=function(c){j(r,c);var u=D(r);function r(){return b(this,r),u.apply(this,arguments)}return g(r,[{key:"here",value:function(s){return this.on("presence:subscribed",function(h){s(h.map(function(p){return p.user_info}))}),this}},{key:"joining",value:function(s){return this.on("presence:joining",function(h){return s(h.user_info)}),this}},{key:"whisper",value:function(s,h){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(s),data:h}),this}},{key:"leaving",value:function(s){return this.on("presence:leaving",function(h){return s(h.user_info)}),this}}]),r}(Oe),ge=function(c){j(r,c);var u=D(r);function r(){return b(this,r),u.apply(this,arguments)}return g(r,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(s,h){return this}},{key:"listenToAll",value:function(s){return this}},{key:"stopListening",value:function(s,h){return this}},{key:"subscribed",value:function(s){return this}},{key:"error",value:function(s){return this}},{key:"on",value:function(s,h){return this}}]),r}(K),Ne=function(c){j(r,c);var u=D(r);function r(){return b(this,r),u.apply(this,arguments)}return g(r,[{key:"whisper",value:function(s,h){return this}}]),r}(ge),tt=function(c){j(r,c);var u=D(r);function r(){return b(this,r),u.apply(this,arguments)}return g(r,[{key:"here",value:function(s){return this}},{key:"joining",value:function(s){return this}},{key:"whisper",value:function(s,h){return this}},{key:"leaving",value:function(s){return this}}]),r}(ge),me=function(){function c(u){b(this,c),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(u),this.connect()}return g(c,[{key:"setOptions",value:function(r){this.options=x(this._defaultOptions,r);var a=this.csrfToken();return a&&(this.options.auth.headers["X-CSRF-TOKEN"]=a,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=a),(a=this.options.bearerToken)&&(this.options.auth.headers.Authorization="Bearer "+a,this.options.userAuthentication.headers.Authorization="Bearer "+a),r}},{key:"csrfToken",value:function(){var r;return typeof window<"u"&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&"function"==typeof document.querySelector&&(r=document.querySelector('meta[name="csrf-token"]'))?r.getAttribute("content"):null}}]),c}(),De=function(c){j(r,c);var u=D(r);function r(){var a;return b(this,r),(a=u.apply(this,arguments)).channels={},a}return g(r,[{key:"connect",value:function(){this.pusher=typeof this.options.client<"u"?this.options.client:this.options.Pusher?new this.options.Pusher(this.options.key,this.options):new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(s,h,p){return this.channel(s).listen(h,p)}},{key:"channel",value:function(s){return this.channels[s]||(this.channels[s]=new te(this.pusher,s,this.options)),this.channels[s]}},{key:"privateChannel",value:function(s){return this.channels["private-"+s]||(this.channels["private-"+s]=new ae(this.pusher,"private-"+s,this.options)),this.channels["private-"+s]}},{key:"encryptedPrivateChannel",value:function(s){return this.channels["private-encrypted-"+s]||(this.channels["private-encrypted-"+s]=new Ze(this.pusher,"private-encrypted-"+s,this.options)),this.channels["private-encrypted-"+s]}},{key:"presenceChannel",value:function(s){return this.channels["presence-"+s]||(this.channels["presence-"+s]=new fe(this.pusher,"presence-"+s,this.options)),this.channels["presence-"+s]}},{key:"leave",value:function(s){var h=this;[s,"private-"+s,"private-encrypted-"+s,"presence-"+s].forEach(function(A,B){h.leaveChannel(A)})}},{key:"leaveChannel",value:function(s){this.channels[s]&&(this.channels[s].unsubscribe(),delete this.channels[s])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}]),r}(me),nt=function(c){j(r,c);var u=D(r);function r(){var a;return b(this,r),(a=u.apply(this,arguments)).channels={},a}return g(r,[{key:"connect",value:function(){var s=this,h=this.getSocketIO();return this.socket=h(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(s.channels).forEach(function(p){p.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(typeof this.options.client<"u")return this.options.client;if(typeof io<"u")return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(s,h,p){return this.channel(s).listen(h,p)}},{key:"channel",value:function(s){return this.channels[s]||(this.channels[s]=new Le(this.socket,s,this.options)),this.channels[s]}},{key:"privateChannel",value:function(s){return this.channels["private-"+s]||(this.channels["private-"+s]=new Oe(this.socket,"private-"+s,this.options)),this.channels["private-"+s]}},{key:"presenceChannel",value:function(s){return this.channels["presence-"+s]||(this.channels["presence-"+s]=new et(this.socket,"presence-"+s,this.options)),this.channels["presence-"+s]}},{key:"leave",value:function(s){var h=this;[s,"private-"+s,"presence-"+s].forEach(function(A){h.leaveChannel(A)})}},{key:"leaveChannel",value:function(s){this.channels[s]&&(this.channels[s].unsubscribe(),delete this.channels[s])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}]),r}(me),ne=function(c){j(r,c);var u=D(r);function r(){var a;return b(this,r),(a=u.apply(this,arguments)).channels={},a}return g(r,[{key:"connect",value:function(){}},{key:"listen",value:function(s,h,p){return new ge}},{key:"channel",value:function(s){return new ge}},{key:"privateChannel",value:function(s){return new Ne}},{key:"encryptedPrivateChannel",value:function(s){return new Ne}},{key:"presenceChannel",value:function(s){return new tt}},{key:"leave",value:function(s){}},{key:"leaveChannel",value:function(s){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}]),r}(me),it=function(){function c(u){b(this,c),this.options=u,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return g(c,[{key:"channel",value:function(r){return this.connector.channel(r)}},{key:"connect",value:function(){if("reverb"==this.options.broadcaster)this.connector=new De(x(x({},this.options),{cluster:""}));else if("pusher"==this.options.broadcaster)this.connector=new De(this.options);else if("socket.io"==this.options.broadcaster)this.connector=new nt(this.options);else if("null"==this.options.broadcaster)this.connector=new ne(this.options);else{if("function"!=typeof this.options.broadcaster)throw new Error("Broadcaster ".concat(E(this.options.broadcaster)," ").concat(this.options.broadcaster," is not supported."));this.connector=new this.options.broadcaster(this.options)}}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(r){return this.connector.presenceChannel(r)}},{key:"leave",value:function(r){this.connector.leave(r)}},{key:"leaveChannel",value:function(r){this.connector.leaveChannel(r)}},{key:"leaveAllChannels",value:function(){for(var r in this.connector.channels)this.leaveChannel(r)}},{key:"listen",value:function(r,a,s){return this.connector.listen(r,a,s)}},{key:"private",value:function(r){return this.connector.privateChannel(r)}},{key:"encryptedPrivate",value:function(r){return this.connector.encryptedPrivateChannel(r)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){"function"==typeof Vue&&Vue.http&&this.registerVueRequestInterceptor(),"function"==typeof axios&&this.registerAxiosRequestInterceptor(),"function"==typeof jQuery&&this.registerjQueryAjaxSetup(),"object"===(typeof Turbo>"u"?"undefined":E(Turbo))&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var r=this;Vue.http.interceptors.push(function(a,s){r.socketId()&&a.headers.set("X-Socket-ID",r.socketId()),s()})}},{key:"registerAxiosRequestInterceptor",value:function(){var r=this;axios.interceptors.request.use(function(a){return r.socketId()&&(a.headers["X-Socket-Id"]=r.socketId()),a})}},{key:"registerjQueryAjaxSetup",value:function(){var r=this;typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter(function(a,s,h){r.socketId()&&h.setRequestHeader("X-Socket-Id",r.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var r=this;document.addEventListener("turbo:before-fetch-request",function(a){a.detail.fetchOptions.headers["X-Socket-Id"]=r.socketId()})}}]),c}(),rt=k(8916),U=k.n(rt),q=k(2490);let st=(()=>{class c{constructor(r){this.cookieService=r,this.cookie_value=this.cookieService.get("access_token"),this.pusher=U(),this.echo=new it({broadcaster:"pusher",key:"app-key",cluster:"mt1",wsHost:"sockets.wah.ph",wsPort:443,wssPort:443,forceTLS:!0,disableStats:!0,enabledTransports:["ws","wss"],authEndpoint:"https://edu-api.wah.ph/broadcasting/auth",auth:{headers:{Authorization:`Bearer ${this.cookie_value}`}}})}subscribeToChannel(r,a,s,h,p){this.echo[r](a+"."+s).listen("."+h,A=>{p(A)})}listenToUserChannel(r){console.log(r),this.echo.private(`App.Models.User.${r}`).listen("UserUpdated",a=>{console.log("User updated event received:",a)})}listenToTestChannel(r){this.echo.channel("todays-patient"+r).listen(".todays.patient",a=>{console.log("User updated event received:",a)})}static#e=this.\u0275fac=function(a){return new(a||c)(e.KVO(q.O))};static#t=this.\u0275prov=e.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();var H=k(9417);function Z(c,u){if(1&c&&(e.j41(0,"option",10),e.EFF(1),e.k0s()),2&c){const r=u.$implicit;e.Y8G("value",r.id),e.R7$(),e.E5c("",r.last_name,", ",r.first_name," ",r.middle_name,"")}}function $e(c,u){if(1&c&&e.nrm(0,"fa-icon",34),2&c){const r=e.XpG(3);e.Y8G("icon",r.faPersonPregnant)}}function ot(c,u){if(1&c&&e.nrm(0,"fa-icon",35),2&c){const r=e.XpG(3);e.Y8G("icon",r.faPersonCane)}}function ue(c,u){if(1&c&&e.nrm(0,"fa-icon",36),2&c){const r=e.XpG(3);e.Y8G("icon",r.faWheelchair)}}function Me(c,u){if(1&c&&e.nrm(0,"fa-icon",35),2&c){const r=e.XpG(3);e.Y8G("icon",r.faDog)}}function at(c,u){if(1&c&&e.nrm(0,"fa-icon",37),2&c){const r=e.XpG(3);e.Y8G("icon",r.faBaby)}}function Ge(c,u){if(1&c&&e.nrm(0,"fa-icon",38),2&c){const r=e.XpG(3);e.Y8G("icon",r.faLungs)}}function Ue(c,u){if(1&c&&e.nrm(0,"fa-icon",35),2&c){const r=e.XpG(3);e.Y8G("icon",r.faTooth)}}function lt(c,u){if(1&c&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&c){const r=e.XpG().$implicit;e.R7$(),e.Lme(" Dr. ",r.physician.first_name," ",r.physician.last_name," ")}}function He(c,u){1&c&&(e.j41(0,"span"),e.EFF(1," - "),e.k0s())}function ct(c,u){if(1&c){const r=e.RV6();e.j41(0,"div",13)(1,"div",14),e.bIt("click",function(){const s=e.eBV(r).$implicit,h=e.XpG(2);return e.Njj(h.openItr(null==s?null:s.patient.id,"itr"))}),e.j41(2,"a",15)(3,"div",16)(4,"span",17),e.EFF(5),e.k0s()()(),e.j41(6,"div",18)(7,"span",19),e.EFF(8),e.k0s(),e.j41(9,"span",20),e.EFF(10," -"),e.k0s()()(),e.j41(11,"div",21),e.DNE(12,$e,1,1,"fa-icon",22)(13,ot,1,1,"fa-icon",23)(14,ue,1,1,"fa-icon",24)(15,Me,1,1,"fa-icon",23)(16,at,1,1,"fa-icon",25)(17,Ge,1,1,"fa-icon",26)(18,Ue,1,1,"fa-icon",23),e.k0s(),e.j41(19,"div",27)(20,"div",28),e.bIt("click",function(){const s=e.eBV(r).$implicit,h=e.XpG(2);return e.Njj(h.openItr(null==s?null:s.patient.id,null==s?null:s.pt_group,null==s?null:s.id))}),e.j41(21,"button",29)(22,"span",30),e.EFF(23),e.k0s(),e.j41(24,"span",31),e.EFF(25),e.k0s()()(),e.j41(26,"div",32),e.DNE(27,lt,2,2,"span",9)(28,He,2,0,"span",9),e.k0s(),e.j41(29,"div",33),e.EFF(30),e.k0s()()()}if(2&c){const r=u.$implicit,a=e.XpG(2);e.R7$(5),e.JRh(a.getInitials(null==r||null==r.patient?null:r.patient.first_name,null==r||null==r.patient?null:r.patient.last_name)),e.R7$(3),e.LHq(" ",null==r||null==r.patient?null:r.patient.last_name,", ",null==r||null==r.patient?null:r.patient.first_name," ","NA"===(null==r||null==r.patient?null:r.patient.middle_name)?"":null==r||null==r.patient?null:r.patient.middle_name," ","NA"===(null==r||null==r.patient?null:r.patient.suffix_name)?"":null==r||null==r.patient?null:r.patient.suffix_name," "),e.R7$(4),e.Y8G("ngIf",r.is_pregnant||"mc"===r.pt_group),e.R7$(),e.Y8G("ngIf",a.getAge(r)),e.R7$(),e.Y8G("ngIf","NA"!==r.patient.pwd_type_code),e.R7$(),e.Y8G("ngIf","ab"===r.pt_group),e.R7$(),e.Y8G("ngIf","cc"===r.pt_group),e.R7$(),e.Y8G("ngIf","tb"===r.pt_group),e.R7$(),e.Y8G("ngIf","dn"===r.pt_group),e.R7$(5),e.JRh(a.checkVisit(null==r?null:r.pt_group)),e.R7$(2),e.JRh(null==r?null:r.pt_group),e.R7$(2),e.Y8G("ngIf",r.physician),e.R7$(),e.Y8G("ngIf",!r.physician),e.R7$(2),e.SpI(" ",a.getDataDiff(null==r?null:r.consult_date)," ")}}function ut(c,u){if(1&c&&(e.j41(0,"div",11),e.DNE(1,ct,31,17,"div",12),e.k0s()),2&c){const r=e.XpG();e.R7$(),e.Y8G("ngForOf",r.today_consults)}}function ht(c,u){1&c&&(e.j41(0,"div",39)(1,"div",40),e.EFF(2," No record to show "),e.k0s()())}function dt(c,u){if(1&c){const r=e.RV6();e.j41(0,"div")(1,"nav",45)(2,"button",46),e.bIt("click",function(){e.eBV(r);const s=e.XpG(2);return e.Njj(s.getTodaysConsult(1))}),e.nrm(3,"fa-icon",47),e.k0s(),e.j41(4,"button",48),e.bIt("click",function(){e.eBV(r);const s=e.XpG(2);return e.Njj(s.getTodaysConsult(s.current_page-1))}),e.nrm(5,"fa-icon",47),e.EFF(6,"Previous "),e.k0s(),e.j41(7,"button",48),e.bIt("click",function(){e.eBV(r);const s=e.XpG(2);return e.Njj(s.getTodaysConsult(s.current_page+1))}),e.EFF(8," Next"),e.nrm(9,"fa-icon",49),e.k0s(),e.j41(10,"button",50),e.bIt("click",function(){e.eBV(r);const s=e.XpG(2);return e.Njj(s.getTodaysConsult(s.last_page))}),e.nrm(11,"fa-icon",49),e.k0s()()()}if(2&c){const r=e.XpG(2);e.R7$(2),e.Y8G("disabled",1===r.current_page),e.R7$(),e.Y8G("icon",r.faAnglesLeft),e.R7$(),e.Y8G("disabled",1===r.current_page),e.R7$(),e.Y8G("icon",r.faChevronLeft),e.R7$(2),e.Y8G("disabled",r.current_page===r.last_page),e.R7$(2),e.Y8G("icon",r.faChevronRight),e.R7$(),e.Y8G("disabled",r.current_page===r.last_page),e.R7$(),e.Y8G("icon",r.faAnglesRight)}}function _e(c,u){if(1&c&&(e.j41(0,"div")(1,"div",41)(2,"div",42)(3,"div")(4,"p",43),e.EFF(5," Showing "),e.j41(6,"span",44),e.EFF(7),e.k0s(),e.EFF(8," to "),e.j41(9,"span",44),e.EFF(10),e.k0s(),e.EFF(11," of "),e.j41(12,"span",44),e.EFF(13),e.k0s(),e.EFF(14," results "),e.k0s()(),e.DNE(15,dt,12,8,"div",9),e.k0s()()()),2&c){const r=e.XpG();e.R7$(7),e.JRh(r.from),e.R7$(3),e.JRh(r.to),e.R7$(3),e.JRh(r.total),e.R7$(2),e.Y8G("ngIf",r.total>=6)}}let pt=(()=>{class c{getTodaysConsult(r){if(this.isLoading)return;let a={params:{}};return a.params.page=r||this.current_page,"all"!==this.selected_physician?a.params.physician_id=this.selected_physician:delete a.params.physician_id,a.params.per_page=this.per_page,a.params.consult_done=0,a.params.todays_patient=1,this.isLoading=!0,new Promise((s,h)=>{this.http.get("consultation/records",a).pipe((0,I.j)(()=>this.isLoading=!1)).subscribe({next:p=>{this.today_consults=p.data,this.show_form=!0,this.current_page=p.meta.current_page,this.last_page=p.meta.last_page,this.from=p.meta.from,this.to=p.meta.to,this.total=p.meta.total,s()},error:p=>console.log(p)})})}subscribeRefresh(){this.todays_interval=setInterval(()=>{this.getTodaysConsult()},3e4)}loadPhysicians(){return new Promise((r,a)=>{this.http.get("users",{params:{per_page:"all",designation_code:"MD"}}).subscribe({next:s=>{this.physicians=s.data;let h=this.http.getUserFromJSON();this.selected_physician="MD"===h.designation_code?h.id:"all",r()},error:s=>{console.log(s),a(s)}})})}getAge(r){if(r.patient.birthdate){let a=this.ageService.calcuateAge(r.patient.birthdate);return"year"===a.type&&a.age>=60}}openItr(r,a,s){this.router.navigate("itr"===a?["/patient/"+a,{id:r}]:["/patient/"+a,{id:r,consult_id:s}])}getDataDiff(r){let a=new Date,s=new Date(r);var h=a.getTime()-s.getTime(),p=Math.floor(h/864e5),A=Math.floor(h/36e5)-24*p,B=Math.floor(h/6e4)-(24*p*60+60*A);return(p?p+" days":"")+" "+(A?A+" hours":"")+" "+(B?B+" minutes":"")}checkVisit(r){return this.nameHelper.getVisitType(r)}getInitials(r,a){return r.charAt(0)+a.charAt(0)}constructor(r,a,s,h,p){this.http=r,this.router=a,this.nameHelper=s,this.ageService=h,this.laravelEchoService=p,this.unsubscribe$=new X.B,this.faQuestionCircle=_.wRm,this.faChevronDown=_.Jt$,this.faFolderOpen=_.Uj9,this.faHeart=_.qcK,this.faFlask=_.rIc,this.faNotesMedical=_.UPF,this.faExclamationCircle=_.tUE,this.faChevronRight=_.XkK,this.faChevronLeft=_.Wzs,this.faAnglesLeft=_.rNr,this.faAnglesRight=_.up_,this.faPersonPregnant=_.Q9O,this.faPersonCane=_.W8p,this.faWheelchair=_.GKc,this.faBaby=_.OIP,this.faDog=_.c_V,this.faLungs=_.n55,this.faTooth=_.uT2,this.selected_physician="all",this.per_page=10,this.current_page=1,this.show_form=!1,this.debounceDelay=1500,this.isLoading=!1,this.current_user=this.http.getUserFromJSON(),this.isListening=!1}listenToChannel(){if(this.isListening)return;this.isListening=!0;const r=()=>this.loadPhysicians().then(()=>this.getTodaysConsult()).catch(a=>{throw console.error("Error loading physicians or consultations:",a),a});r(),this.laravelEchoService.subscribeToChannel("channel","todays-patient",this.current_user.facility_code,"todays.patient",a=>{console.log("User updated event received:",a),a&&r()})}ngOnInit(){this.listenToChannel()}ngOnDestroy(){clearInterval(this.todays_interval),this.unsubscribe$.next(),this.unsubscribe$.complete()}static#e=this.\u0275fac=function(a){return new(a||c)(e.rXU(P.k),e.rXU(v.Ix),e.rXU(F.j),e.rXU(R.V),e.rXU(st))};static#t=this.\u0275cmp=e.VBU({type:c,selectors:[["app-todays-consult"]],inputs:{date_today:"date_today"},decls:12,vars:6,consts:[[1,"mb-10","rounded-xl","text-gray-600","h-100","border","border-slate-100","shadow-md","select-none"],[1,"md:flex","md:justify-between","md:items-center","pb-2","bg-orange-400","text-white","rounded-t-md","p-2"],[1,"font-semibold","pl-3"],[1,"flex","items-center"],[1,"input","px-2","mr-3","disabled:bg-gray-300","w-72","text-gray-800",3,"change","ngModelChange","ngModel"],["value","all"],["class","pr-",3,"value",4,"ngFor","ngForOf"],["class","p-3",4,"ngIf"],["class","pt-3",4,"ngIf"],[4,"ngIf"],[1,"pr-",3,"value"],[1,"p-3"],["class","flex justify-between items-center mb-3  pb-3 border-b border-gray-200",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","mb-3","pb-3","border-b","border-gray-200"],[1,"flex","cursor-pointer","w-2/5","hover:opacity-75",3,"click"],[1,"justify-center","mx-auto"],[1,"inline-flex","overflow-hidden","relative","justify-center","items-center","w-16","h-16","bg-gray-100","rounded-full","dark:bg-gray-600"],[1,"font-medium","text-gray-600","text-sm","xl:text-lg"],[1,"flex","justify-center","text-blue-500","md:block","leading-tight","mx-2","my-1","w-full","hover:bg-blue-500","hover:text-white","p-1","rounded-md"],[1,"w-full","block","font-medium","my-0","py-0","text-sm"],[1,"w-full","block","text-xs"],[1,"w-16","text-2xl","text-gray-600","space-x-1"],["class","text-rose-300",3,"icon",4,"ngIf"],[3,"icon",4,"ngIf"],["class","text-sky-500",3,"icon",4,"ngIf"],["class","text-blue-500",3,"icon",4,"ngIf"],["class","text-green-500",3,"icon",4,"ngIf"],[1,"grid","grid-cols-12","text-left","w-3/5"],[1,"col-span-6","text-gray-700","hover:bg-green-500","hover:text-white","hover:cursor-pointer","p-3","rounded-md","text-[.85em]",3,"click"],["type","button",1,"flex","justify-between"],[1,"hidden","lg:inline-block"],[1,"lg:hidden","uppercase","text-xs"],[1,"col-span-3","px-3","text-sm"],[1,"col-span-3","px-3","text-[.8em]"],[1,"text-rose-300",3,"icon"],[3,"icon"],[1,"text-sky-500",3,"icon"],[1,"text-blue-500",3,"icon"],[1,"text-green-500",3,"icon"],[1,"pt-3"],[1,"text-center","items-center","mb-3","italic"],[1,"bg-white","px-4","py-3","flex","items-center","justify-between","border-t","border-gray-200","sm:px-6"],[1,"hidden","sm:flex-1","sm:flex","sm:items-center","sm:justify-between"],[1,"text-sm","text-gray-700"],[1,"font-medium"],["aria-label","Pagination",1,"relative","z-0","inline-flex","shadow-sm","-space-x-px"],[1,"relative","inline-flex","items-center","px-2","py-2","rounded-l-md","border","border-gray-300","enabled:bg-white","disabled:bg-gray-300","text-sm","font-medium","text-gray-500","hover:bg-gray-50",3,"click","disabled"],[1,"block","h-15","w-15","text-gray-500","pr-1",3,"icon"],[1,"relative","inline-flex","items-center","px-4","py-2","border","border-gray-300","enabled:bg-white","disabled:bg-gray-300","bg-white","text-sm","font-medium","text-gray-700","hover:bg-gray-50",3,"click","disabled"],[1,"h-5","w-5","text-gray-500",3,"icon"],[1,"relative","inline-flex","items-center","px-2","py-2","rounded-r-md","border","border-gray-300","enabled:bg-white","disabled:bg-gray-300","text-sm","font-medium","text-gray-500","hover:bg-gray-50",3,"click","disabled"]],template:function(a,s){1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"span",2),e.EFF(3),e.k0s(),e.j41(4,"div",3)(5,"select",4),e.bIt("change",function(){return s.getTodaysConsult()}),e.mxI("ngModelChange",function(p){return e.DH7(s.selected_physician,p)||(s.selected_physician=p),p}),e.j41(6,"option",5),e.EFF(7,"All"),e.k0s(),e.DNE(8,Z,2,4,"option",6),e.k0s()()(),e.DNE(9,ut,2,1,"div",7)(10,ht,3,0,"div",8)(11,_e,16,4,"div",9),e.k0s()),2&a&&(e.R7$(3),e.SpI("Todays Consult (",s.date_today,")"),e.R7$(2),e.R50("ngModel",s.selected_physician),e.R7$(3),e.Y8G("ngForOf",s.physicians),e.R7$(),e.Y8G("ngIf",s.show_form),e.R7$(),e.Y8G("ngIf",0===(null==s.today_consults?null:s.today_consults.length)),e.R7$(),e.Y8G("ngIf",s.total>=1))},dependencies:[C.Sq,C.bT,w.aY,H.xH,H.y7,H.wz,H.BC,H.vS]})}return c})();function N(c,u){if(1&c){const r=e.RV6();e.j41(0,"div",15),e.bIt("click",function(){const s=e.eBV(r).$implicit,h=e.XpG(3);return e.Njj(h.openItr(s.value.patient_id,"itr"))}),e.EFF(1),e.k0s()}if(2&c){const r=u.$implicit;e.R7$(),e.SpI(" ",r.value.appointment_desc," ")}}function ft(c,u){if(1&c){const r=e.RV6();e.j41(0,"div",9)(1,"div",10)(2,"div",11)(3,"span",12),e.bIt("click",function(){const s=e.eBV(r).$implicit,h=e.XpG(2);return e.Njj(h.openItr(s.value[0].patient_id,"itr"))}),e.EFF(4),e.k0s()()(),e.j41(5,"div",13),e.DNE(6,N,2,1,"div",14),e.nI1(7,"keyvalue"),e.k0s()()}if(2&c){const r=u.$implicit;e.R7$(4),e.SpI(" ",r.key," "),e.R7$(2),e.Y8G("ngForOf",e.bMT(7,2,r.value))}}function gt(c,u){if(1&c&&(e.j41(0,"div",7),e.DNE(1,ft,8,4,"div",8),e.nI1(2,"keyvalue"),e.k0s()),2&c){const r=e.XpG();e.R7$(),e.Y8G("ngForOf",e.bMT(2,1,r.todays_appointment))}}function mt(c,u){1&c&&(e.j41(0,"div",16)(1,"div",17),e.EFF(2," No record to show "),e.k0s()())}function _t(c,u){if(1&c&&(e.j41(0,"div",18)(1,"div",17),e.nrm(2,"fa-icon",19),e.k0s()()),2&c){const r=e.XpG();e.R7$(2),e.Y8G("icon",r.faCircleNotch)}}function vt(c,u){if(1&c){const r=e.RV6();e.j41(0,"div")(1,"nav",24)(2,"button",25),e.bIt("click",function(){e.eBV(r);const s=e.XpG(2);return e.Njj(s.loadAppointments(1))}),e.nrm(3,"fa-icon",26),e.k0s(),e.j41(4,"button",27),e.bIt("click",function(){e.eBV(r);const s=e.XpG(2);return e.Njj(s.loadAppointments(s.current_page-1))}),e.nrm(5,"fa-icon",26),e.EFF(6,"Previous "),e.k0s(),e.j41(7,"button",27),e.bIt("click",function(){e.eBV(r);const s=e.XpG(2);return e.Njj(s.loadAppointments(s.current_page+1))}),e.EFF(8," Next"),e.nrm(9,"fa-icon",28),e.k0s(),e.j41(10,"button",29),e.bIt("click",function(){e.eBV(r);const s=e.XpG(2);return e.Njj(s.loadAppointments(s.last_page))}),e.nrm(11,"fa-icon",28),e.k0s()()()}if(2&c){const r=e.XpG(2);e.R7$(2),e.Y8G("disabled",1===r.current_page),e.R7$(),e.Y8G("icon",r.faAnglesLeft),e.R7$(),e.Y8G("disabled",1===r.current_page),e.R7$(),e.Y8G("icon",r.faChevronLeft),e.R7$(2),e.Y8G("disabled",r.current_page===r.last_page),e.R7$(2),e.Y8G("icon",r.faChevronRight),e.R7$(),e.Y8G("disabled",r.current_page===r.last_page),e.R7$(),e.Y8G("icon",r.faAnglesRight)}}function bt(c,u){if(1&c&&(e.j41(0,"div")(1,"div",20)(2,"div",21)(3,"div")(4,"p",22),e.EFF(5," Showing "),e.j41(6,"span",23),e.EFF(7),e.k0s(),e.EFF(8," to "),e.j41(9,"span",23),e.EFF(10),e.k0s(),e.EFF(11," of "),e.j41(12,"span",23),e.EFF(13),e.k0s(),e.EFF(14," results "),e.k0s()(),e.DNE(15,vt,12,8,"div",6),e.k0s()()()),2&c){const r=e.XpG();e.R7$(7),e.JRh(r.from),e.R7$(3),e.JRh(r.to),e.R7$(3),e.JRh(r.total),e.R7$(2),e.Y8G("ngIf",r.total>=6)}}let yt=(()=>{class c{openItr(r,a,s){this.router.navigate("itr"===a?["/patient/"+a,{id:r}]:["/patient/"+a,{id:r,consult_id:s}])}loadAppointments(r){if(this.show_form=!1,this.isLoading)return;let a={params:{}};a.params.page=r||this.current_page,a.params.facility_code=this.http.getUserFacility(),a.params.per_page=this.per_page,a.params.consult_done=0,this.isLoading=!0,this.http.get("appointment/schedule",a).pipe((0,I.j)(()=>this.isLoading=!1)).subscribe({next:s=>{this.todays_appointment=s[0].data,this.current_page=s[0].current_page,this.last_page=s[0].last_page,this.from=s[0].from,this.to=s[0].to,this.total=s[0].total,this.show_form=!0},error:s=>console.log(s)})}constructor(r,a){this.http=r,this.router=a,this.faCircleNotch=_.s4k,this.faAnglesLeft=_.rNr,this.faChevronLeft=_.Wzs,this.faChevronRight=_.XkK,this.faAnglesRight=_.up_,this.show_form=!1,this.per_page=5,this.current_page=1,this.isLoading=!1,this.appointment_length=0}ngOnInit(){this.loadAppointments()}static#e=this.\u0275fac=function(a){return new(a||c)(e.rXU(P.k),e.rXU(v.Ix))};static#t=this.\u0275cmp=e.VBU({type:c,selectors:[["app-todays-appointment"]],inputs:{date_today:"date_today"},decls:8,vars:5,consts:[[1,"mb-10","text-gray-600","h-100","border","border-slate-200","shadow-md","rounded-md"],[1,"md:flex","md:justify-between","md:items-center","pb-2","bg-blue-500","text-white","rounded-t-md"],[1,"font-semibold","pt-2","pl-5"],["class","p-3",4,"ngIf"],["class","-pt-3",4,"ngIf"],["class","pt-3",4,"ngIf"],[4,"ngIf"],[1,"p-3"],["class","flex justify-between border-b border-gray-100",4,"ngFor","ngForOf"],[1,"flex","justify-between","border-b","border-gray-100"],[1,"flex","w-3/5"],[1,"flex","justify-center","text-gray-700","md:block","leading-tight","align-top","my-1","w-full","p-1","rounded-md"],[1,"w-full","font-medium","my-0","text-sm","rounded-md","py-2","px-3","hover:cursor-pointer","hover:bg-blue-500","hover:text-white",3,"click"],[1,"grid","grid-cols-12","text-left","w-2/5"],["class","col-span-12 text-gray-700 hover:bg-green-500 hover:text-white hover:cursor-pointer p-3 rounded-md text-[.85em]",3,"click",4,"ngFor","ngForOf"],[1,"col-span-12","text-gray-700","hover:bg-green-500","hover:text-white","hover:cursor-pointer","p-3","rounded-md","text-[.85em]",3,"click"],[1,"-pt-3"],[1,"text-center","items-center","mb-3","italic"],[1,"pt-3"],["animation","spin",1,"text-blue-500",3,"icon"],[1,"bg-white","px-4","py-3","flex","items-center","justify-between","border-t","border-gray-200","sm:px-6","rounded-b-md"],[1,"hidden","sm:flex-1","sm:flex","sm:items-center","sm:justify-between"],[1,"text-sm","text-gray-700"],[1,"font-medium"],["aria-label","Pagination",1,"relative","z-0","inline-flex","shadow-sm","-space-x-px"],[1,"relative","inline-flex","items-center","px-2","py-2","rounded-l-md","border","border-gray-300","enabled:bg-white","disabled:bg-gray-300","text-sm","font-medium","text-gray-500","hover:bg-gray-50",3,"click","disabled"],[1,"block","h-15","w-15","text-gray-500","pr-1",3,"icon"],[1,"relative","inline-flex","items-center","px-4","py-2","border","border-gray-300","enabled:bg-white","disabled:bg-gray-300","bg-white","text-sm","font-medium","text-gray-700","hover:bg-gray-50",3,"click","disabled"],[1,"h-5","w-5","text-gray-500",3,"icon"],[1,"relative","inline-flex","items-center","px-2","py-2","rounded-r-md","border","border-gray-300","enabled:bg-white","disabled:bg-gray-300","text-sm","font-medium","text-gray-500","hover:bg-gray-50",3,"click","disabled"]],template:function(a,s){1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"span",2),e.EFF(3),e.k0s()(),e.DNE(4,gt,3,3,"div",3)(5,mt,3,0,"div",4)(6,_t,3,1,"div",5)(7,bt,16,4,"div",6),e.k0s()),2&a&&(e.R7$(3),e.SpI("Todays Appointment (",s.date_today,")"),e.R7$(),e.Y8G("ngIf",s.show_form),e.R7$(),e.Y8G("ngIf",s.show_form&&0===s.todays_appointment.length),e.R7$(),e.Y8G("ngIf",!s.show_form&&!s.todays_appointment),e.R7$(),e.Y8G("ngIf",s.total>=1))},dependencies:[C.Sq,C.bT,w.aY,C.lG]})}return c})();var ke=k(8793),ve=k(7673),kt=k(5964),wt=k(3294),xt=k(152),Be=k(8141),we=k(5558),ee=k(9437),Ct=k(6354),le=k(5794),xe=k(8761);const Xe=(c,u)=>u.icd10_code,Ye=c=>({"text-red-500":c});function ze(c,u){if(1&c&&(e.j41(0,"div",57)(1,"h5",58)(2,"strong"),e.EFF(3),e.k0s(),e.EFF(4),e.k0s()()),2&c){const r=u.item,a=u.searchTerm;e.R7$(),e.Y8G("ngOptionHighlight",a),e.R7$(2),e.SpI("",r.icd10_code,":"),e.R7$(),e.SpI(" ",r.icd10_desc,"")}}function qe(c,u){if(1&c&&(e.j41(0,"span",60),e.EFF(1),e.nrm(2,"br"),e.k0s()),2&c){const r=u.$implicit;e.R7$(),e.SpI(" ",r.icd10_code+" | "+r.lib_icd10.icd10_desc," ")}}function Tt(c,u){if(1&c&&(e.j41(0,"td",59),e.Z7z(1,qe,3,1,"span",60,Xe),e.k0s(),e.j41(3,"td",33)(4,"span",60),e.EFF(5),e.nI1(6,"date"),e.nrm(7,"br"),e.k0s()()),2&c){const r=e.XpG().$implicit;e.R7$(),e.Dyx(r.final_diagnosis.finaldx),e.R7$(4),e.SpI(" ",e.i5U(6,1,r.prev_date,"MM/dd/yyyy")," ")}}function St(c,u){if(1&c&&(e.j41(0,"tbody"),e.DNE(1,Tt,8,4),e.k0s()),2&c){const r=u.$implicit;e.R7$(),e.vxM((null==r.final_diagnosis?null:r.final_diagnosis.finaldx.length)>=1?1:-1)}}function Ft(c,u){if(1&c&&(e.j41(0,"div",61),e.EFF(1),e.k0s()),2&c){let r;const a=u.$implicit;e.R7$(),e.SpI(" ",null!==(r=a.lib_complaints.complaint_desc)&&void 0!==r?r:"-","\n")}}function be(c,u){if(1&c&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&c){const r=u.$implicit,a=u.last;e.R7$(),e.Lme("",r,"",a?"":", ","")}}function Rt(c,u){if(1&c&&(e.j41(0,"div")(1,"span",62),e.EFF(2),e.k0s(),e.DNE(3,be,2,2,"span",34),e.nrm(4,"br"),e.j41(5,"span"),e.EFF(6),e.k0s(),e.nrm(7,"br"),e.k0s()),2&c){const r=u.$implicit,a=e.XpG();e.R7$(2),e.SpI("",r.category_id,":"),e.R7$(),e.Y8G("ngForOf",a.pe_array[r.category_id]),e.R7$(3),e.SpI("Remarks: ",a.data.consult_notes.physical_exam_remarks[r.remarks_var],"")}}function Ve(c,u){if(1&c&&(e.j41(0,"div",63)(1,"h3",50)(2,"span",41),e.EFF(3," Diagnosis: "),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()()),2&c){let r;const a=u.$implicit;e.R7$(5),e.SpI(" ",null!==(r=a.diagnosis.class_name)&&void 0!==r?r:"-"," ")}}function Et(c,u){if(1&c&&(e.j41(0,"div",63)(1,"h3",50)(2,"span",41),e.EFF(3," Procedure: "),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s(),e.nrm(6,"br"),e.j41(7,"span",41),e.EFF(8," Operation Date: "),e.k0s(),e.j41(9,"span"),e.EFF(10),e.nI1(11,"date"),e.k0s()()()),2&c){let r,a;const s=u.$implicit;e.R7$(5),e.SpI(" ",null!==(r=s.operation)&&void 0!==r?r:"-"," "),e.R7$(5),e.SpI(" ",e.i5U(11,2,s.operation_date,null!==(a="MM/dd/yyyy")&&void 0!==a?a:"-")," ")}}function jt(c,u){if(1&c&&(e.j41(0,"div",64)(1,"span",65),e.EFF(2),e.k0s(),e.nrm(3,"br"),e.EFF(4),e.nrm(5,"br"),e.j41(6,"span",41),e.EFF(7," Dose Regimen: "),e.k0s(),e.EFF(8),e.nrm(9,"br"),e.j41(10,"span",41),e.EFF(11," Duration Intake: "),e.k0s(),e.EFF(12),e.nrm(13,"br"),e.j41(14,"span",41),e.EFF(15," Prescribed Quantity: "),e.k0s(),e.EFF(16),e.nrm(17,"br"),e.k0s()),2&c){let r,a,s,h;const p=u.$implicit;e.R7$(2),e.SpI("",null!==(r=null!==(r=null!==(r=null==p.konsulta_medicine?null:p.konsulta_medicine.desc)&&void 0!==r?r:null==p.medicine?null:p.medicine.gen_name)&&void 0!==r?r:p.added_medicine)&&void 0!==r?r:""," "),e.R7$(2),e.Lme(" ",null!==(a=null==p.medicine?null:p.medicine.form_desc)&&void 0!==a?a:" "," ",null!==(a=null==p.medicine?null:p.medicine.stre_desc)&&void 0!==a?a:" ",""),e.R7$(4),e.SpI(" ",null!==(s=null==p.dose_regimen?null:p.dose_regimen.desc)&&void 0!==s?s:" "," "),e.R7$(4),e.Lme(" ",p.duration_intake," ",null==p.duration_frequency?null:p.duration_frequency.desc," (s) "),e.R7$(4),e.Lme(" ",null!==(h=p.quantity)&&void 0!==h?h:" "," ",null!==(h=null==p.medicine?null:p.medicine.form_desc)&&void 0!==h?h:" "," ")}}let Pt=(()=>{class c{closeModal(){this.toggleModal.emit()}constructor(r,a,s){this.http=r,this.ageService=a,this.toastr=s,this.toggleModal=new e.bkB,this.faAnglesRight=_.up_,this.faAnglesLeft=_.rNr,this.faCircleXmark=_.bnw,this.faSearch=_.MjD,this.searchInput$=new X.B,this.minLengthTerm=3,this.fdxLoading=!1,this.show_form=!1,this.icd10=[],this.is_saving=!1,this.peCatArray=[{category_id:"ABDOMEN",remarks_var:"abdomen_remarks"},{category_id:"BARTHOLINS",remarks_var:"bartholins_remarks"},{category_id:"BREAST",remarks_var:"breast_remarks"},{category_id:"CHEST",remarks_var:"chest_remarks"},{category_id:"CONJUNCTIVA",remarks_var:"conjunctiva_remarks"},{category_id:"EXTREMITIES",remarks_var:"extremities_remarks"},{category_id:"GENITOURINARY",remarks_var:"genitourinary_remarks"},{category_id:"HEART",remarks_var:"heart_remarks"},{category_id:"HEENT",remarks_var:"heent_remarks"},{category_id:"NECK",remarks_var:"neck_remarks"},{category_id:"NEURO",remarks_var:"neuro_remarks"},{category_id:"PELVIC",remarks_var:"pelvic_remarks"},{category_id:"RECTAL",remarks_var:"rectal_remarks"},{category_id:"SKIN",remarks_var:"skin_remarks"},{category_id:"SPECULUM",remarks_var:"speculum_remarks"},{category_id:"THORAX",remarks_var:"thorax_remarks"}]}getAge(){if(this.data&&this.data.patient.birthdate){let r=this.ageService.calcuateAge(this.data.patient.birthdate);return this.patient_age=r,r.age}}loadFdx(r){this.fdx$=(0,ke.x)((0,ve.of)(r),this.searchInput$.pipe((0,kt.p)(a=>null!==a&&a.length>=this.minLengthTerm),(0,wt.F)(),(0,xt.B)(800),(0,Be.M)(()=>this.fdxLoading=!0),(0,we.n)(a=>this.getFdx(a).pipe((0,ee.W)(()=>(0,ve.of)([])),(0,Be.M)(()=>this.fdxLoading=!1)))))}getFdx(r=null){return this.http.get("libraries/icd10",{params:{"filter[search]":r}}).pipe((0,Ct.T)(a=>a.data))}loadSelected(){let r=[],a=[];this.final_dx&&Object.keys(this.final_dx).length>0?(Object.entries(this.final_dx).forEach(([s,h],p)=>{let A=h;r.push(A.icd10_code.toString()),a.push(A.lib_icd10)}),this.loadFdx(a),this.selectedFdx=r):this.loadFdx([])}onSubmit(){console.log(this.fdxremarks2,"reamrks"),this.is_saving=!0,this.selectedFdx&&Object.keys(this.selectedFdx).length>0?this.http.post("consultation/final-diagnosis",{notes_id:this.notes_id,final_diagnosis:this.selectedFdx}).subscribe({next:a=>{this.saveNotes()},error:a=>console.log(a)}):this.saveNotes()}saveNotes(){this.http.update("consultation/notes/",this.notes_id,{consult_id:this.consult_id,fdx_remarks:this.fdxremarks2}).subscribe({next:()=>{this.endVisit(),this.showToastr()},error:a=>console.log(a)})}endVisit(){this.http.update("consultation/records/",this.consult_id,{id:this.consult_id,consult_date:this.data.consult_date,patient_id:this.data.patient_id,pt_group:"cn",consult_done:"1"}).subscribe({next:()=>this.showToastr(),error:a=>console.log(a)})}showToastr(){this.is_saving=!1,this.toastr.success("Successfully updated!","Final Diagnosis")}iteratePE(){this.pe_array=[],Object.entries(this.data.consult_notes.physical_exam).forEach(([r,a])=>{this.pe_array[a.lib_physical_exam.category_id]?this.pe_array[a.lib_physical_exam.category_id].push(a.lib_physical_exam.pe_desc):this.pe_array[a.lib_physical_exam.category_id]=[a.lib_physical_exam.pe_desc]}),console.log(this.pe_array)}ngOnInit(){this.data=this.show_patient_data.data[0],this.previous=this.show_patient_data.previous_diagnosis,this.notes_id=this.data.consult_notes.id,this.loadFdx([]),this.iteratePE(),console.log(this.previous,"previous ito"),console.log(this.data,"present ito")}static#e=this.\u0275fac=function(a){return new(a||c)(e.rXU(P.k),e.rXU(R.V),e.rXU(le.tw))};static#t=this.\u0275cmp=e.VBU({type:c,selectors:[["app-final-dx"]],inputs:{show_patient_data:"show_patient_data",show_previous_dx:"show_previous_dx",pending_fdx:"pending_fdx",consult_id:"consult_id",consult_date:"consult_date"},outputs:{toggleModal:"toggleModal"},decls:178,vars:48,consts:[["id","defaultModal","tabindex","-1","aria-modal","true","role","dialog",1,"overflow-x-auto","fixed","top-0","right-0","left-0","md:inset-0","h-modal","md:h-full","justify-center","items-center","flex","mx-auto",2,"z-index","60"],[1,"relative","p-4","w-full"],[1,"relative","bg-white","rounded-lg","shadow"],[1,"flex","justify-between","items-start","py-3","px-5","rounded-t","border-b","bg-blue-500"],[1,"mt-2","text-lg","text-white"],[1,"flex","justify-end"],[1,"border","border-gray-400","rounded-md","bg-white"],["type","button",1,"text-white","w-9","h-9",3,"click"],[1,"-mr-4",3,"icon"],[1,"h-[600px]","overflow-y-auto","scrollbar-thin","scrollbar-thumb-gray-400","scrollbar-track-gray-100"],[1,"relative","shadow-md","sm:rounded-lg","m-4"],[1,"w-full","text-sm","text-left","text-gray-500"],[1,"flex","justify-center","text-base","text-black","pb-2","px-5","rounded-t","border-black","border-t","border-b","border-r","border-l"],[1,"px-2"],[1,"text-left","w-full"],[1,"flex","text-right","w-full"],[1,"flex","justify-between","items-start","mt-2","py-2","px-5","rounded-t","border-b","bg-red-500"],[1,"text-lg","text-white"],[1,"flex"],[1,"border","rounded-md","px-5","w-full","py-1"],[1,"chips-container"],["placeholder","search final diagnosis","typeToSearchText","search...","bindValue","icd10_code","bindLabel","icd10_desc","notFoundText","No records found",1,"select-chips",3,"ngModelChange","items","multiple","loading","typeahead","ngModel"],["ng-option-tmp",""],["type","text","placeholder","Final Diagnosis Remarks",1,"shadow-md","form-input","text-sm","p-2","px-2","my-5","w-full","rounded","border-0","-outline-offset-8",3,"ngModelChange","ngModel"],[1,"flex","justify-end","py-4","px-5","space-x-4","rounded-b","border-t","border-gray-200","items-center"],["type","button",1,"text-white","bg-blue-500","hover:ring-2","focus:outline-none","hover:ring-red-300","rounded","text-sm","font-medium","px-6","py-2.5","transition","duration-150","ease-in-out","transform","hover:scale-110",3,"click"],[1,"shadow-md","-outline-offset-8"],[1,"border-b","rounded-t","bg-blue-500","mt-2","py-2","px-5"],[1,"mt-2","text-kg","text-white","font-bold"],[1,"w-full","table-auto","text-sm","text-black"],[1,"text-s","text-black","bg-white","-webkit-sticky","border-b",2,"z-index","20","position","sticky","top","0"],[1,"w-full"],[1,"px-5","py-2","w-1/2","text-center"],[1,"w-1/2","text-center"],[4,"ngFor","ngForOf"],[1,"grid","grid-cols-2","justify-between"],[1,"grid","col-span-1","mt-5","py-2","px-5","rounded-t","border-b","bg-gray-50"],[1,"mt-2","text-lg","text-gray-500","font-bold"],[1,"shadow-md","grid","border","w-full","border-1","-outline-offset-8"],[1,"flex","text-gray-700","md:block","leading-tight","align-top","my-1","w-full","p-1","rounded-md"],[1,"text-base","text-black","py-3","px-5","rounded-t"],[1,"font-bold"],[3,"ngClass"],[1,"flex","flex-col","mt-5","py-2","px-5","rounded-t","border-b","bg-gray-50"],[1,"shadow-md","flex","flex-col","border","w-full","border-1"],["class","pl-2 flex font-bold text-base text-gray-700 md:block leading-tight align-top my-1 w-full p-1 rounded-md",4,"ngFor","ngForOf"],[1,"border-b","rounded-t","bg-purple-600","mt-2","py-2","px-5"],[1,"mt-2","text-lg","text-white","font-bold"],[1,"px-5","py-2","w-1/2","text-left","text-black"],["class","pl-2 flex text-gray-700 md:block leading-tight align-top my-1 w-full p-1 rounded-md",4,"ngFor","ngForOf"],[1,"text-base","text-black","py-3","px-3","rounded-t"],[1,"border-b","rounded-t","bg-orange-600","mt-2","py-2","px-5"],["class","text-black py-2 px-5",4,"ngFor","ngForOf"],[1,"flex","justify-between","py-4","px-5","space-x-4","rounded-b","border-t","border-gray-200","items-center"],["type","button",1,"text-white","bg-red-500","hover:ring-2","focus:outline-none","hover:ring-red-300","rounded","text-sm","font-medium","px-6","py-2.5","transition","duration-150","ease-in-out","transform","hover:scale-110",3,"click"],[1,"flex","items-center","space-x-4"],[1,"opacity-50","fixed","inset-0","z-50","bg-black"],[1,"whitespace-normal"],[1,"text-gray-700",3,"ngOptionHighlight"],["colspan","1",1,"px-5","py-2"],[1,"text-black","bg-white","-webkit-sticky","font-bold"],[1,"pl-2","flex","font-bold","text-base","text-gray-700","md:block","leading-tight","align-top","my-1","w-full","p-1","rounded-md"],[1,"font-semibold","mr-2"],[1,"pl-2","flex","text-gray-700","md:block","leading-tight","align-top","my-1","w-full","p-1","rounded-md"],[1,"text-black","py-2","px-5"],[1,"font-bold","text-sm"]],template:function(a,s){if(1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),e.EFF(5),e.k0s(),e.j41(6,"div",5),e.nrm(7,"div",6),e.j41(8,"button",7),e.bIt("click",function(){return s.closeModal()}),e.nrm(9,"fa-icon",8),e.k0s()()(),e.j41(10,"div",9)(11,"div",10)(12,"div",11)(13,"fieldset",12)(14,"legend",13),e.EFF(15,"Patient Information"),e.k0s(),e.j41(16,"div",14)(17,"label"),e.EFF(18),e.k0s(),e.nrm(19,"br"),e.j41(20,"label"),e.EFF(21),e.nI1(22,"date"),e.k0s(),e.nrm(23,"br"),e.j41(24,"label"),e.EFF(25),e.k0s()(),e.j41(26,"div",15)(27,"label"),e.EFF(28),e.k0s()()(),e.j41(29,"div",16)(30,"h3",17),e.EFF(31," Final Diagnosis "),e.k0s()(),e.j41(32,"div",18)(33,"div",19)(34,"div",20)(35,"ng-select",21),e.nI1(36,"async"),e.mxI("ngModelChange",function(p){return e.DH7(s.selectedFdx,p)||(s.selectedFdx=p),p}),e.DNE(37,ze,5,3,"ng-template",22),e.k0s()(),e.j41(38,"input",23),e.mxI("ngModelChange",function(p){return e.DH7(s.fdxremarks2,p)||(s.fdxremarks2=p),p}),e.k0s(),e.j41(39,"div",24)(40,"button",25),e.bIt("click",function(){return s.onSubmit()}),e.EFF(41," Save "),e.k0s()(),e.j41(42,"div",26)(43,"div",27)(44,"h3",28),e.EFF(45," Previous Diagnosis "),e.k0s()(),e.j41(46,"table",29)(47,"thead",30)(48,"tr",31)(49,"th",32),e.EFF(50," ICD 10 Code | Description "),e.k0s(),e.j41(51,"th",33),e.EFF(52," Date "),e.k0s()()(),e.DNE(53,St,2,1,"tbody",34),e.k0s()()()(),e.j41(54,"div",35)(55,"div",36)(56,"h3",37),e.EFF(57," Vitals Signs "),e.k0s(),e.j41(58,"div",38)(59,"div",39)(60,"fieldset",40)(61,"label")(62,"span",41),e.EFF(63," Weight: "),e.k0s(),e.EFF(64),e.k0s(),e.j41(65,"span"),e.EFF(66," kg"),e.k0s(),e.nrm(67,"br"),e.j41(68,"label")(69,"span",41),e.EFF(70," Height: "),e.k0s(),e.EFF(71),e.k0s(),e.j41(72,"span"),e.EFF(73," cm"),e.k0s(),e.nrm(74,"br"),e.j41(75,"label")(76,"span",41),e.EFF(77," BMI: "),e.k0s(),e.EFF(78),e.k0s(),e.nrm(79,"br"),e.j41(80,"label")(81,"span",41),e.EFF(82," Blood Pressure: "),e.k0s(),e.EFF(83),e.k0s(),e.nrm(84,"br"),e.j41(85,"label")(86,"span",41),e.EFF(87," Blood Oxygen (SPO2): "),e.k0s(),e.EFF(88),e.k0s(),e.nrm(89,"br"),e.j41(90,"label",42)(91,"span",41),e.EFF(92," Temperature: "),e.k0s(),e.EFF(93),e.k0s(),e.j41(94,"span"),e.EFF(95," \u2103"),e.k0s(),e.nrm(96,"br"),e.j41(97,"label")(98,"span",41),e.EFF(99," Heart Rate: "),e.k0s(),e.EFF(100),e.k0s(),e.nrm(101,"br"),e.j41(102,"label")(103,"span",41),e.EFF(104," Respiratory Rate: "),e.k0s(),e.EFF(105),e.k0s(),e.nrm(106,"br"),e.j41(107,"label")(108,"span",41),e.EFF(109," Pulse Rate: "),e.k0s(),e.EFF(110),e.k0s(),e.nrm(111,"br"),e.j41(112,"label")(113,"span",41),e.EFF(114," Visual Acuity (Right): "),e.k0s(),e.EFF(115),e.k0s(),e.nrm(116,"br"),e.j41(117,"label")(118,"span",41),e.EFF(119," Visual Acuity (Left): "),e.k0s(),e.EFF(120),e.k0s(),e.nrm(121,"br"),e.j41(122,"label")(123,"span",41),e.EFF(124," Waist: "),e.k0s(),e.EFF(125),e.k0s(),e.nrm(126,"br"),e.j41(127,"label")(128,"span",41),e.EFF(129," Hip: "),e.k0s(),e.EFF(130),e.k0s(),e.nrm(131,"br"),e.k0s()()()(),e.j41(132,"div",43)(133,"span",37),e.EFF(134," Chief Complaint "),e.k0s(),e.j41(135,"div",44),e.DNE(136,Ft,2,1,"div",45),e.j41(137,"h3",40),e.EFF(138),e.k0s()()()(),e.j41(139,"div",43)(140,"div",46)(141,"h3",47),e.EFF(142," History of Current Illness "),e.k0s()(),e.j41(143,"div")(144,"tr",31)(145,"th",48),e.EFF(146),e.k0s()()()(),e.j41(147,"div",35)(148,"div",36)(149,"h3",37),e.EFF(150," Physical Exam "),e.k0s(),e.j41(151,"div",38)(152,"div",39)(153,"fieldset",40),e.DNE(154,Rt,8,3,"div",34),e.k0s()()()(),e.j41(155,"div",43)(156,"span",37),e.EFF(157," Initial Diagnosis "),e.k0s(),e.j41(158,"div",44),e.DNE(159,Ve,6,1,"div",49),e.j41(160,"h3",50)(161,"span",41),e.EFF(162," Remarks: "),e.k0s(),e.EFF(163),e.k0s()(),e.j41(164,"span",37),e.EFF(165," Surgical History "),e.k0s(),e.j41(166,"div",44),e.DNE(167,Et,12,5,"div",49),e.k0s()()(),e.j41(168,"div",43)(169,"div",51)(170,"h3",47),e.EFF(171," Drugs Prescribed "),e.k0s()(),e.DNE(172,jt,18,8,"div",52),e.k0s()()()(),e.j41(173,"div",53)(174,"button",54),e.bIt("click",function(){return s.closeModal()}),e.EFF(175,"Close"),e.k0s(),e.nrm(176,"div",55),e.k0s()()()(),e.nrm(177,"div",56)),2&a){let h,p,A,B,Y,re,he,Te,Se,Fe,de,Re,Ee,ye,ce,se,je,oe,Pe;e.R7$(5),e.SpI(" Consult ID: ",s.consult_id," "),e.R7$(4),e.Y8G("icon",s.faCircleXmark),e.R7$(9),e.E5c("Name: ",s.data.patient.first_name," ",s.data.patient.middle_name," ",s.data.patient.last_name," "),e.R7$(3),e.Lme("Birthdate: ",e.i5U(22,41,s.data.patient.birthdate,"MM/dd/yyyy")," | ",s.getAge()," years old"),e.R7$(4),e.Lme("Address: ",s.data.patient.household_folder.address,", ",s.data.patient.household_folder.barangay.name," "),e.R7$(3),e.SpI("Consult Date: ",s.consult_date,""),e.R7$(7),e.Y8G("items",e.bMT(36,44,s.fdx$))("multiple",!0)("loading",s.fdxLoading)("typeahead",s.searchInput$),e.R50("ngModel",s.selectedFdx),e.R7$(3),e.R50("ngModel",s.fdxremarks2),e.R7$(15),e.Y8G("ngForOf",s.previous),e.R7$(11),e.SpI(" ",null!==(h=null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_weight)&&void 0!==h?h:"-"," "),e.R7$(7),e.SpI(" ",null!==(p=null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_height)&&void 0!==p?p:"-"," "),e.R7$(7),e.Lme(" ",null!==(A=null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_bmi)&&void 0!==A?A:"-"," (",null!==(A=null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_bmi_class)&&void 0!==A?A:"-",") "),e.R7$(5),e.Lme(" ",null!==(B=null==s.data.vitals_latest?null:s.data.vitals_latest.bp_systolic)&&void 0!==B?B:"-","/",null!==(B=null==s.data.vitals_latest?null:s.data.vitals_latest.bp_diastolic)&&void 0!==B?B:"-"," "),e.R7$(5),e.SpI(" ",null!==(Y=null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_spo2)&&void 0!==Y?Y:"-"," "),e.R7$(2),e.Y8G("ngClass",e.eq3(46,Ye,(null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_temp)>=38)),e.R7$(3),e.SpI(" ",null!==(re=null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_temp)&&void 0!==re?re:"-"," "),e.R7$(7),e.SpI(" ",null!==(he=null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_heart_rate)&&void 0!==he?he:"-"," "),e.R7$(5),e.SpI(" ",null!==(Te=null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_respiratory_rate)&&void 0!==Te?Te:"-"," "),e.R7$(5),e.SpI(" ",null!==(Se=null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_pulse_rate)&&void 0!==Se?Se:"-"," "),e.R7$(5),e.SpI(" ",null!==(Fe=null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_right_vision_acuity)&&void 0!==Fe?Fe:"-"," "),e.R7$(5),e.SpI(" ",null!==(de=null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_left_vision_acuity)&&void 0!==de?de:"-"," "),e.R7$(5),e.SpI(" ",null!==(Re=null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_waist)&&void 0!==Re?Re:"-"," "),e.R7$(5),e.SpI(" ",null!==(Ee=null==s.data||null==s.data.vitals_latest?null:s.data.vitals_latest.patient_hip)&&void 0!==Ee?Ee:"-"," "),e.R7$(6),e.Y8G("ngForOf",null!==(ye=null==s.data?null:s.data.consult_notes.complaints)&&void 0!==ye?ye:"-"),e.R7$(2),e.SpI(" Remarks: ",null!==(ce=null==s.data?null:s.data.consult_notes.complaint)&&void 0!==ce?ce:"-"," "),e.R7$(8),e.SpI(" ",null!==(se=null==s.data?null:s.data.consult_notes.history)&&void 0!==se?se:"-"," "),e.R7$(8),e.Y8G("ngForOf",s.peCatArray),e.R7$(5),e.Y8G("ngForOf",null!==(je=null==s.data?null:s.data.consult_notes.initialdx)&&void 0!==je?je:"-"),e.R7$(4),e.SpI(" ",null!==(oe=null==s.data?null:s.data.consult_notes.idx_remarks)&&void 0!==oe?oe:"-"," "),e.R7$(4),e.Y8G("ngForOf",null!==(Pe=null==s.data?null:s.data.surgical_history)&&void 0!==Pe?Pe:"-"),e.R7$(5),e.Y8G("ngForOf",null==s.data?null:s.data.prescription)}},dependencies:[C.YU,C.Sq,w.aY,H.me,H.BC,H.vS,xe.vr,xe.Uq,C.Jj,C.vh]})}return c})();function It(c,u){if(1&c&&(e.j41(0,"option",15),e.EFF(1),e.k0s()),2&c){const r=u.$implicit;e.Y8G("value",r.id),e.R7$(),e.E5c("",r.last_name,", ",r.first_name," ",r.middle_name,"")}}function At(c,u){if(1&c){const r=e.RV6();e.j41(0,"div",22)(1,"div",18)(2,"div",19)(3,"span",23),e.bIt("click",function(){const s=e.eBV(r).$implicit,h=e.XpG(2);return e.Njj(h.getData(s.patient_id,s.consult_date,s.consult_id))}),e.EFF(4),e.k0s()()(),e.j41(5,"div",24)(6,"div",25)(7,"span",26),e.EFF(8),e.k0s()()(),e.j41(9,"div",24)(10,"div",25)(11,"span",26),e.EFF(12),e.k0s()()(),e.j41(13,"div",24)(14,"div",25)(15,"span",26),e.EFF(16),e.k0s()()()()}if(2&c){const r=u.$implicit;e.R7$(4),e.SpI(" ",r.patient_name," "),e.R7$(4),e.SpI(" ",r.consult_date," "),e.R7$(4),e.SpI(" ",r.physician_name?r.physician_name:"-"," "),e.R7$(4),e.SpI(" ",r.enocder_name?r.enocder_name:"-"," ")}}function Lt(c,u){if(1&c&&(e.j41(0,"div",16)(1,"div",17)(2,"div",18)(3,"div",19)(4,"span",20),e.EFF(5," Name: "),e.k0s()()(),e.j41(6,"div",18)(7,"div",19)(8,"span",20),e.EFF(9," Consult date: "),e.k0s()()(),e.j41(10,"div",18)(11,"div",19)(12,"span",20),e.EFF(13," Referred to: "),e.k0s()()(),e.j41(14,"div",18)(15,"div",19)(16,"span",20),e.EFF(17," Logged by: "),e.k0s()()()(),e.DNE(18,At,17,4,"div",21),e.k0s()),2&c){const r=e.XpG();e.R7$(18),e.Y8G("ngForOf",r.pending_fdx)}}function Je(c,u){1&c&&(e.j41(0,"div",27)(1,"div",28),e.EFF(2," No record to show "),e.k0s()())}function ie(c,u){if(1&c&&(e.j41(0,"div",29)(1,"div",28),e.nrm(2,"fa-icon",30),e.k0s()()),2&c){const r=e.XpG();e.R7$(2),e.Y8G("icon",r.faCircleNotch)}}function Ot(c,u){if(1&c){const r=e.RV6();e.j41(0,"div")(1,"nav",35)(2,"button",36),e.bIt("click",function(){e.eBV(r);const s=e.XpG(2);return e.Njj(s.getPatient(s.Number(1)))}),e.nrm(3,"fa-icon",37),e.k0s(),e.j41(4,"button",38),e.bIt("click",function(){e.eBV(r);const s=e.XpG(2);return e.Njj(s.getPatient(s.Number(s.current_page-1)))}),e.nrm(5,"fa-icon",37),e.EFF(6,"Previous "),e.k0s(),e.j41(7,"button",38),e.bIt("click",function(){e.eBV(r);const s=e.XpG(2);return e.Njj(s.getPatient(s.Number(s.current_page+1)))}),e.EFF(8," Next"),e.nrm(9,"fa-icon",39),e.k0s(),e.j41(10,"button",40),e.bIt("click",function(){e.eBV(r);const s=e.XpG(2);return e.Njj(s.getPatient(s.Number(s.last_page)))}),e.nrm(11,"fa-icon",39),e.k0s()()()}if(2&c){const r=e.XpG(2);e.R7$(2),e.Y8G("disabled",1===r.current_page),e.R7$(),e.Y8G("icon",r.faAnglesLeft),e.R7$(),e.Y8G("disabled",1===r.current_page),e.R7$(),e.Y8G("icon",r.faChevronLeft),e.R7$(2),e.Y8G("disabled",r.current_page===r.last_page),e.R7$(2),e.Y8G("icon",r.faChevronRight),e.R7$(),e.Y8G("disabled",r.current_page===r.last_page),e.R7$(),e.Y8G("icon",r.faAnglesRight)}}function Nt(c,u){if(1&c&&(e.j41(0,"div")(1,"div",31)(2,"div",32)(3,"div")(4,"p",33),e.EFF(5," Showing "),e.j41(6,"span",34),e.EFF(7),e.k0s(),e.EFF(8," to "),e.j41(9,"span",34),e.EFF(10),e.k0s(),e.EFF(11," of "),e.j41(12,"span",34),e.EFF(13),e.k0s(),e.EFF(14," results "),e.k0s()(),e.DNE(15,Ot,12,8,"div",13),e.k0s()()()),2&c){const r=e.XpG();e.R7$(7),e.JRh(r.from),e.R7$(3),e.JRh(r.to),e.R7$(3),e.JRh(r.total),e.R7$(2),e.Y8G("ngIf",r.total>=6)}}function Dt(c,u){if(1&c){const r=e.RV6();e.j41(0,"app-final-dx",41),e.bIt("toggleModal",function(){e.eBV(r);const s=e.XpG();return e.Njj(s.toggleModal())}),e.k0s()}if(2&c){const r=e.XpG();e.Y8G("show_patient_data",r.show_patient_data)("pending_fdx",r.pending_fdx)("consult_id",r.consult_id)("consult_date",r.fdx_consult_date)}}let Ce=(()=>{class c{constructor(r){this.http=r,this.faCircleNotch=_.s4k,this.faAnglesLeft=_.rNr,this.faChevronLeft=_.Wzs,this.faChevronRight=_.XkK,this.faAnglesRight=_.up_,this.show_patient_data=[],this.show_form=!1,this.show_data=[],this.selected_physician="all",this.per_page=5,this.current_page=1,this.isLoading=!1,this.openList=!1,this.faSearch=_.MjD,this.Number=Number,this.faStethoscope=_.jrv}toggleModal(){this.show_data=[],this.openList=!this.openList,console.log(this.openList),this.openList||this.getPatient()}getPatient(r){this.isLoading=!0,this.show_form=!1;let a={params:{}};a.page=r||this.current_page,"all"!==this.selected_physician&&(a.params.physician_id=this.selected_physician),a.params.physician_id&&delete a.params.physician_id,this.patient_search&&(a.search=this.patient_search),this.http.get("reports-2018/pending-fdx/report",{params:a}).subscribe({next:s=>{this.pending_fdx=s.data,this.current_page=s.meta.current_page,this.last_page=s.meta.last_page,this.from=s.meta.from,this.to=s.meta.to,this.total=s.meta.total,this.isLoading=!1,this.show_form=!0},error:s=>console.log(s)})}getData(r,a,s){this.http.get("reports-2018/pending-fdx/get-consultation",{params:{patient_id:r,consult_id:s}}).subscribe({next:p=>{this.show_patient_data=p,this.show_previous_dx=p,this.current_page=p.current_page,this.last_page=p.last_page,this.openList=!0,this.fdx_consult_date=a,this.consult_id=s},error:p=>console.log(p)})}loadPhysicians(){return new Promise((r,a)=>{this.http.get("users",{params:{per_page:"all",designation_code:"MD"}}).subscribe({next:s=>{this.physicians=s.data;let h=this.http.getUserFromJSON();this.selected_physician="MD"===h.designation_code?h.id:"all",r()},error:s=>{console.log(s),a(s)}})})}ngOnInit(){this.loadPhysicians(),this.current_page=1,this.getPatient()}static#e=this.\u0275fac=function(a){return new(a||c)(e.rXU(P.k))};static#t=this.\u0275cmp=e.VBU({type:c,selectors:[["app-pending-fdx"]],inputs:{get_patient_data:"get_patient_data"},decls:17,vars:9,consts:[[1,"mb-10","text-gray-600","h-100","border","border-slate-200","shadow-md","rounded-md"],[1,"md:flex","md:justify-between","md:items-center","pb-2","bg-blue-500","text-white","rounded-t-md"],[1,"font-semibold","pt-2","pl-5"],[1,"border","bg-white","border-gray-400","rounded-md","flex","items-center","m-2"],["type","text","placeholder","Search Patient",1,"form-input","w-1/4","text-sm","border","text-gray-700","border-gray-400","flex-1",3,"ngModelChange","keyup.enter","ngModel"],["type","button",1,"text-blue-500","w-9","h-9","border-r","border-gray-400",3,"click"],[1,"-ml-1",3,"icon"],[1,"input","px-2","mr-3","disabled:bg-red-600","w-72","text-gray-800",3,"change","ngModelChange","ngModel"],["value","all"],["class","pr-",3,"value",4,"ngFor","ngForOf"],["class","p-3",4,"ngIf"],["class","-pt-3",4,"ngIf"],["class","pt-3",4,"ngIf"],[4,"ngIf"],[3,"show_patient_data","pending_fdx","consult_id","consult_date","toggleModal",4,"ngIf"],[1,"pr-",3,"value"],[1,"p-3"],[1,"flex","justify-between","border-b","border-gray-100","bg-gray-200"],[1,"flex","w-3/5"],[1,"flex","justify-center","text-gray-700","md:block","leading-tight","align-top","my-1","w-full","p-1","rounded-md"],[1,"w-full","font-semibold","my-0","text-base","rounded-md","py-2","px-3"],["class","flex justify-between border-b border-gray-100",4,"ngFor","ngForOf"],[1,"flex","justify-between","border-b","border-gray-100"],[1,"w-full","font-medium","my-0","text-sm","rounded-md","py-2","px-3","hover:cursor-pointer","hover:bg-blue-500","hover:text-white",3,"click"],[1,"grid","grid-cols-5","text-left","w-3/5"],[1,"col-span-12","text-gray-700","p-3","rounded-md","text-[.85em]"],[1,"w-full","font-medium","my-0","text-sm"],[1,"-pt-3"],[1,"text-center","items-center","mb-3","italic"],[1,"pt-3"],["animation","spin",1,"text-blue-500",3,"icon"],[1,"bg-white","px-4","py-3","flex","items-center","justify-between","border-t","border-gray-200","sm:px-6","rounded-b-md"],[1,"hidden","sm:flex-1","sm:flex","sm:items-center","sm:justify-between"],[1,"text-sm","text-gray-700"],[1,"font-medium"],["aria-label","Pagination",1,"relative","z-0","inline-flex","shadow-sm","-space-x-px"],[1,"relative","inline-flex","items-center","px-2","py-2","rounded-l-md","border","border-gray-300","enabled:bg-white","disabled:bg-gray-300","text-sm","font-medium","text-gray-500","hover:bg-gray-50",3,"click","disabled"],[1,"block","h-15","w-15","text-gray-500","pr-1",3,"icon"],[1,"relative","inline-flex","items-center","px-4","py-2","border","border-gray-300","enabled:bg-white","disabled:bg-gray-300","bg-white","text-sm","font-medium","text-gray-700","hover:bg-gray-50",3,"click","disabled"],[1,"h-5","w-5","text-gray-500",3,"icon"],[1,"relative","inline-flex","items-center","px-2","py-2","rounded-r-md","border","border-gray-300","enabled:bg-white","disabled:bg-gray-300","text-sm","font-medium","text-gray-500","hover:bg-gray-50",3,"click","disabled"],[3,"toggleModal","show_patient_data","pending_fdx","consult_id","consult_date"]],template:function(a,s){1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"span",2),e.EFF(3,"Pending Final Diagnosis"),e.k0s(),e.j41(4,"div",3)(5,"input",4),e.mxI("ngModelChange",function(p){return e.DH7(s.patient_search,p)||(s.patient_search=p),p}),e.bIt("keyup.enter",function(){return s.getPatient()}),e.k0s(),e.j41(6,"button",5),e.bIt("click",function(){return s.getPatient()}),e.nrm(7,"fa-icon",6),e.k0s(),e.j41(8,"select",7),e.bIt("change",function(){return s.getPatient()}),e.mxI("ngModelChange",function(p){return e.DH7(s.selected_physician,p)||(s.selected_physician=p),p}),e.j41(9,"option",8),e.EFF(10,"All"),e.k0s(),e.DNE(11,It,2,4,"option",9),e.k0s()()(),e.DNE(12,Lt,19,1,"div",10)(13,Je,3,0,"div",11)(14,ie,3,1,"div",12)(15,Nt,16,4,"div",13),e.k0s(),e.DNE(16,Dt,1,4,"app-final-dx",14)),2&a&&(e.R7$(5),e.R50("ngModel",s.patient_search),e.R7$(2),e.Y8G("icon",s.faSearch),e.R7$(),e.R50("ngModel",s.selected_physician),e.R7$(3),e.Y8G("ngForOf",s.physicians),e.R7$(),e.Y8G("ngIf",s.show_form),e.R7$(),e.Y8G("ngIf",s.show_form&&0===s.getPatient.length),e.R7$(),e.Y8G("ngIf",!s.show_form&&!s.getPatient),e.R7$(),e.Y8G("ngIf",s.total>=1),e.R7$(),e.Y8G("ngIf",s.openList))},dependencies:[C.Sq,C.bT,w.aY,H.xH,H.y7,H.me,H.wz,H.BC,H.vS,Pt]})}return c})();const $t=[{path:"",component:(()=>{class c{constructor(){this.date_today=(0,C.Yq)(new Date,"MM/dd/yyyy","en","Asia/Manila")}static#e=this.\u0275fac=function(a){return new(a||c)};static#t=this.\u0275cmp=e.VBU({type:c,selectors:[["app-dashboard"]],decls:5,vars:2,consts:[[1,"grid","grid-cols-11","mt-4","gap-4","w-full"],[1,"col-span-11","grid","grid-cols-1"],[3,"date_today"]],template:function(a,s){1&a&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"app-todays-consult",2)(3,"app-todays-appointment",2)(4,"app-pending-fdx"),e.k0s()()),2&a&&(e.R7$(2),e.Y8G("date_today",s.date_today),e.R7$(),e.Y8G("date_today",s.date_today))},dependencies:[pt,yt,Ce]})}return c})()}];let Mt=(()=>{class c{static#e=this.\u0275fac=function(a){return new(a||c)};static#t=this.\u0275mod=e.$C({type:c});static#n=this.\u0275inj=e.G2t({imports:[v.iI.forChild($t),v.iI]})}return c})(),Gt=(()=>{class c{static#e=this.\u0275fac=function(a){return new(a||c)};static#t=this.\u0275mod=e.$C({type:c});static#n=this.\u0275inj=e.G2t({imports:[C.MD,Mt,w.dX,H.YN,xe.MQ]})}return c})()},41:(Ie,V,k)=>{"use strict";k.d(V,{V:()=>w});var C=k(3953);let w=(()=>{class v{constructor(){}calcuateAge(_,X){let I,F,P=new Date(_);F=X?new Date(X):Date.now();let R=Math.abs(F-P.getTime()),E=+(Math.round(parseFloat(R/864e5/365.25+"e2"))+"e-2");if(E<1){let b=Math.floor(R/864e5/30);I=b<1?{age:Math.floor(R/864e5),type:"day"}:{age:b,type:"month"}}else I={age:E,type:"year"};return I}static#e=this.\u0275fac=function(X){return new(X||v)};static#t=this.\u0275prov=C.jDH({token:v,factory:v.\u0275fac,providedIn:"root"})}return v})()},1196:(Ie,V,k)=>{"use strict";k.d(V,{j:()=>w});var C=k(3953);let w=(()=>{class v{getVisitType(_){switch(_){case"ab":return"Animal Bite";case"at":return"Adolescent";case"cc":return"Child Care";case"cn":return"Consultation";case"cv":return"COVID-19";case"dn":return"Dental";case"fp":return"Family Planning";case"lp":return"Leprosy";case"mc":return"Maternal Care";case"mh":return"Mental Health";case"ml":return"Malaria";case"ncd":return"Non Communicable Disease";case"tb":return"TB Dots";case"gbv":return"Gender Based Violence"}}getURL(_){switch(_){case"CBC":return"laboratory/consult-laboratory-cbc";case"CRTN":return"laboratory/consult-laboratory-creatinine";case"CXRAY":return"laboratory/consult-laboratory-chestxray";case"ECG":return"laboratory/consult-laboratory-ecg";case"FBS":return"laboratory/consult-laboratory-fbs";case"RBS":return"laboratory/consult-laboratory-rbs";case"HBA":return"laboratory/consult-laboratory-hba1c";case"PSMR":return"laboratory/consult-laboratory-papsmear";case"PPD":return"laboratory/consult-laboratory-ppd";case"SPTM":return"laboratory/consult-laboratory-sputum";case"FCAL":return"laboratory/consult-laboratory-fecalysis";case"LPFL":return"laboratory/consult-laboratory-lipid-profile";case"URN":return"laboratory/consult-laboratory-urinalysis";case"OGTT":return"laboratory/consult-laboratory-oral-glucose";case"FOBT":return"laboratory/consult-laboratory-fecal-occult";case"GRMS":return"laboratory/consult-laboratory-gram-stain";case"MCRP":return"laboratory/consult-laboratory-microscopy";case"BCHM":return"laboratory/consult-laboratory-blood-chemistry";case"BPSY":return"laboratory/consult-laboratory-biopsy";case"USND":return"laboratory/consult-laboratory-ultrasound";case"SYPH":return"laboratory/consult-laboratory-syphilis";case"HEMA":return"laboratory/consult-laboratory-hematology";case"RDT":return"laboratory/consult-laboratory-dengue";case"MRDT":return"laboratory/consult-laboratory-malaria";case"WETS":return"laboratory/consult-laboratory-wet-smear";case"SRLG":return"laboratory/consult-laboratory-serology";case"KOH":return"laboratory/consult-laboratory-potassium";case"SSMR":return"laboratory/consult-laboratory-skin-slit";case"GXPT":return"laboratory/consult-laboratory-geneXpert";case"CCS":return"laboratory/consult-laboratory-cervical-cancer";default:return""}}constructor(){}static#e=this.\u0275fac=function(X){return new(X||v)};static#t=this.\u0275prov=C.jDH({token:v,factory:v.\u0275fac,providedIn:"root"})}return v})()},8916:Ie=>{window,Ie.exports=function(V){var k={};function C(w){if(k[w])return k[w].exports;var v=k[w]={i:w,l:!1,exports:{}};return V[w].call(v.exports,v,v.exports,C),v.l=!0,v.exports}return C.m=V,C.c=k,C.d=function(w,v,e){C.o(w,v)||Object.defineProperty(w,v,{enumerable:!0,get:e})},C.r=function(w){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(w,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(w,"__esModule",{value:!0})},C.t=function(w,v){if(1&v&&(w=C(w)),8&v||4&v&&"object"==typeof w&&w&&w.__esModule)return w;var e=Object.create(null);if(C.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:w}),2&v&&"string"!=typeof w)for(var _ in w)C.d(e,_,function(X){return w[X]}.bind(null,_));return e},C.n=function(w){var v=w&&w.__esModule?function(){return w.default}:function(){return w};return C.d(v,"a",v),v},C.o=function(w,v){return Object.prototype.hasOwnProperty.call(w,v)},C.p="",C(C.s=2)}([function(V,k,C){"use strict";var w=this&&this.__extends||function(){var b=function(m,g){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,j){x.__proto__=j}||function(x,j){for(var $ in j)j.hasOwnProperty($)&&(x[$]=j[$])})(m,g)};return function(m,g){function x(){this.constructor=m}b(m,g),m.prototype=null===g?Object.create(g):(x.prototype=g.prototype,new x)}}();Object.defineProperty(k,"__esModule",{value:!0});var v=256,e=function(){function b(m){void 0===m&&(m="="),this._paddingCharacter=m}return b.prototype.encodedLength=function(m){return this._paddingCharacter?(m+2)/3*4|0:(8*m+5)/6|0},b.prototype.encode=function(m){for(var g="",x=0;x<m.length-2;x+=3)g+=this._encodeByte((j=m[x]<<16|m[x+1]<<8|m[x+2])>>>18&63),g+=this._encodeByte(j>>>12&63),g+=this._encodeByte(j>>>6&63),g+=this._encodeByte(j>>>0&63);var j,$=m.length-x;return $>0&&(g+=this._encodeByte((j=m[x]<<16|(2===$?m[x+1]<<8:0))>>>18&63),g+=this._encodeByte(j>>>12&63),g+=2===$?this._encodeByte(j>>>6&63):this._paddingCharacter||"",g+=this._paddingCharacter||""),g},b.prototype.maxDecodedLength=function(m){return this._paddingCharacter?m/4*3|0:(6*m+7)/8|0},b.prototype.decodedLength=function(m){return this.maxDecodedLength(m.length-this._getPaddingLength(m))},b.prototype.decode=function(m){if(0===m.length)return new Uint8Array(0);for(var g=this._getPaddingLength(m),x=m.length-g,j=new Uint8Array(this.maxDecodedLength(x)),$=0,M=0,W=0,Q=0,J=0,D=0,K=0;M<x-4;M+=4)Q=this._decodeChar(m.charCodeAt(M+0)),J=this._decodeChar(m.charCodeAt(M+1)),D=this._decodeChar(m.charCodeAt(M+2)),K=this._decodeChar(m.charCodeAt(M+3)),j[$++]=Q<<2|J>>>4,j[$++]=J<<4|D>>>2,j[$++]=D<<6|K,W|=Q&v,W|=J&v,W|=D&v,W|=K&v;if(M<x-1&&(Q=this._decodeChar(m.charCodeAt(M)),J=this._decodeChar(m.charCodeAt(M+1)),j[$++]=Q<<2|J>>>4,W|=Q&v,W|=J&v),M<x-2&&(D=this._decodeChar(m.charCodeAt(M+2)),j[$++]=J<<4|D>>>2,W|=D&v),M<x-3&&(K=this._decodeChar(m.charCodeAt(M+3)),j[$++]=D<<6|K,W|=K&v),0!==W)throw new Error("Base64Coder: incorrect characters for decoding");return j},b.prototype._encodeByte=function(m){var g=m;return g+=65,g+=25-m>>>8&6,g+=51-m>>>8&-75,g+=61-m>>>8&-15,g+=62-m>>>8&3,String.fromCharCode(g)},b.prototype._decodeChar=function(m){var g=v;return g+=(42-m&m-44)>>>8&-v+m-43+62,g+=(46-m&m-48)>>>8&-v+m-47+63,g+=(47-m&m-58)>>>8&-v+m-48+52,(g+=(64-m&m-91)>>>8&-v+m-65+0)+((96-m&m-123)>>>8&-v+m-97+26)},b.prototype._getPaddingLength=function(m){var g=0;if(this._paddingCharacter){for(var x=m.length-1;x>=0&&m[x]===this._paddingCharacter;x--)g++;if(m.length<4||g>2)throw new Error("Base64Coder: incorrect padding")}return g},b}();k.Coder=e;var _=new e;k.encode=function X(b){return _.encode(b)},k.decode=function I(b){return _.decode(b)};var P=function(b){function m(){return null!==b&&b.apply(this,arguments)||this}return w(m,b),m.prototype._encodeByte=function(g){var x=g;return x+=65,x+=25-g>>>8&6,x+=51-g>>>8&-75,x+=61-g>>>8&-13,x+=62-g>>>8&49,String.fromCharCode(x)},m.prototype._decodeChar=function(g){var x=v;return x+=(44-g&g-46)>>>8&-v+g-45+62,x+=(94-g&g-96)>>>8&-v+g-95+63,x+=(47-g&g-58)>>>8&-v+g-48+52,(x+=(64-g&g-91)>>>8&-v+g-65+0)+((96-g&g-123)>>>8&-v+g-97+26)},m}(e);k.URLSafeCoder=P;var F=new P;k.encodeURLSafe=function R(b){return F.encode(b)},k.decodeURLSafe=function E(b){return F.decode(b)},k.encodedLength=function(b){return _.encodedLength(b)},k.maxDecodedLength=function(b){return _.maxDecodedLength(b)},k.decodedLength=function(b){return _.decodedLength(b)}},function(V,k,C){"use strict";Object.defineProperty(k,"__esModule",{value:!0});var w="utf8: invalid string",v="utf8: invalid source encoding";function _(I){for(var P=0,F=0;F<I.length;F++){var R=I.charCodeAt(F);if(R<128)P+=1;else if(R<2048)P+=2;else if(R<55296)P+=3;else{if(!(R<=57343))throw new Error(w);if(F>=I.length-1)throw new Error(w);F++,P+=4}}return P}k.encode=function e(I){for(var P=new Uint8Array(_(I)),F=0,R=0;R<I.length;R++){var E=I.charCodeAt(R);E<128?P[F++]=E:E<2048?(P[F++]=192|E>>6,P[F++]=128|63&E):E<55296?(P[F++]=224|E>>12,P[F++]=128|E>>6&63,P[F++]=128|63&E):(R++,E=(1023&E)<<10,E|=1023&I.charCodeAt(R),P[F++]=240|(E+=65536)>>18,P[F++]=128|E>>12&63,P[F++]=128|E>>6&63,P[F++]=128|63&E)}return P},k.encodedLength=_,k.decode=function X(I){for(var P=[],F=0;F<I.length;F++){var R=I[F];if(128&R){var E=void 0;if(R<224){if(F>=I.length)throw new Error(v);if(128!=(192&(b=I[++F])))throw new Error(v);R=(31&R)<<6|63&b,E=128}else if(R<240){if(F>=I.length-1)throw new Error(v);var b=I[++F],m=I[++F];if(128!=(192&b)||128!=(192&m))throw new Error(v);R=(15&R)<<12|(63&b)<<6|63&m,E=2048}else{if(!(R<248))throw new Error(v);if(F>=I.length-2)throw new Error(v);b=I[++F],m=I[++F];var g=I[++F];if(128!=(192&b)||128!=(192&m)||128!=(192&g))throw new Error(v);R=(15&R)<<18|(63&b)<<12|(63&m)<<6|63&g,E=65536}if(R<E||R>=55296&&R<=57343)throw new Error(v);if(R>=65536){if(R>1114111)throw new Error(v);R-=65536,P.push(String.fromCharCode(55296|R>>10)),R=56320|1023&R}}P.push(String.fromCharCode(R))}return P.join("")}},function(V,k,C){V.exports=C(3).default},function(V,k,C){"use strict";C.r(k);class w{constructor(t,n){this.lastId=0,this.prefix=t,this.name=n}create(t){this.lastId++;var n=this.lastId,o=this.prefix+n,l=this.name+"["+n+"]",d=!1,f=function(){d||(t.apply(null,arguments),d=!0)};return this[n]=f,{number:n,id:o,name:l,callback:f}}remove(t){delete this[t.number]}}var v=new w("_pusher_script_","Pusher.ScriptReceivers"),_={VERSION:"8.4.0-rc2",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"ajax",activityTimeout:12e4,pongTimeout:3e4,unavailableTimeout:1e4,userAuthentication:{endpoint:"/pusher/user-auth",transport:"ajax"},channelAuthorization:{endpoint:"/pusher/auth",transport:"ajax"},cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:""};var I=new w("_pusher_dependencies","Pusher.DependenciesReceivers"),P=new class X{constructor(t){this.options=t,this.receivers=t.receivers||v,this.loading={}}load(t,n,o){var l=this;if(l.loading[t]&&l.loading[t].length>0)l.loading[t].push(o);else{l.loading[t]=[o];var d=S.createScriptRequest(l.getPath(t,n)),f=l.receivers.create(function(y){if(l.receivers.remove(f),l.loading[t]){var T=l.loading[t];delete l.loading[t];for(var L=function(G){G||d.cleanup()},O=0;O<T.length;O++)T[O](y,L)}});d.send(f)}}getRoot(t){var o=S.getDocument().location.protocol;return(t&&t.useTLS||"https:"===o?this.options.cdn_https:this.options.cdn_http).replace(/\/*$/,"")+"/"+this.options.version}getPath(t,n){return this.getRoot(n)+"/"+t+this.options.suffix+".js"}}({cdn_http:_.cdn_http,cdn_https:_.cdn_https,version:_.VERSION,suffix:_.dependency_suffix,receivers:I});const F={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/channels/server_api/authenticating_users"},authorizationEndpoint:{path:"/docs/channels/server_api/authorizing-users/"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}};var E_buildLogSuffix=function(i){const n=F.urls[i];if(!n)return"";let o;return n.fullUrl?o=n.fullUrl:n.path&&(o=F.baseUrl+n.path),o?`See: ${o}`:""},b=function(i){return i.UserAuthentication="user-authentication",i.ChannelAuthorization="channel-authorization",i}(b||{});class m extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class g extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class x extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class j extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class $ extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class M extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class W extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class Q extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class J extends Error{constructor(t,n){super(n),this.status=t,Object.setPrototypeOf(this,new.target.prototype)}}var K=function(i,t,n,o,l){const d=S.createXHR();for(var f in d.open("POST",n.endpoint,!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.headers)d.setRequestHeader(f,n.headers[f]);if(null!=n.headersProvider){let y=n.headersProvider();for(var f in y)d.setRequestHeader(f,y[f])}return d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status){let y,T=!1;try{y=JSON.parse(d.responseText),T=!0}catch{l(new J(200,`JSON returned from ${o.toString()} endpoint was invalid, yet status code was 200. Data was: ${d.responseText}`),null)}T&&l(null,y)}else{let y="";switch(o){case b.UserAuthentication:y=E_buildLogSuffix("authenticationEndpoint");break;case b.ChannelAuthorization:y=`Clients must be authorized to join private or presence channels. ${E_buildLogSuffix("authorizationEndpoint")}`}l(new J(d.status,`Unable to retrieve auth string from ${o.toString()} endpoint - received status: ${d.status} from ${n.endpoint}. ${y}`),null)}},d.send(t),d};for(var te=String.fromCharCode,ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ze={},fe=0;fe<64;fe++)Ze[ae.charAt(fe)]=fe;var Oe=function(i){var t=i.charCodeAt(0);return t<128?i:t<2048?te(192|t>>>6)+te(128|63&t):te(224|t>>>12&15)+te(128|t>>>6&63)+te(128|63&t)},et=function(i){return i.replace(/[^\x00-\x7F]/g,Oe)},ge=function(i){var t=[0,2,1][i.length%3],n=i.charCodeAt(0)<<16|(i.length>1?i.charCodeAt(1):0)<<8|(i.length>2?i.charCodeAt(2):0);return[ae.charAt(n>>>18),ae.charAt(n>>>12&63),t>=2?"=":ae.charAt(n>>>6&63),t>=1?"=":ae.charAt(63&n)].join("")},Ne=window.btoa||function(i){return i.replace(/[\s\S]{1,3}/g,ge)};var me=class tt{constructor(t,n,o,l){this.clear=n,this.timer=t(()=>{this.timer&&(this.timer=l(this.timer))},o)}isRunning(){return null!==this.timer}ensureAborted(){this.timer&&(this.clear(this.timer),this.timer=null)}};function De(i){window.clearTimeout(i)}function nt(i){window.clearInterval(i)}class ne extends me{constructor(t,n){super(setTimeout,De,t,function(o){return n(),null})}}class it extends me{constructor(t,n){super(setInterval,nt,t,function(o){return n(),o})}}var rt={now:()=>Date.now?Date.now():(new Date).valueOf(),defer:i=>new ne(0,i),method(i,...t){var n=Array.prototype.slice.call(arguments,1);return function(o){return o[i].apply(o,n.concat(arguments))}}},U=rt;function q(i,...t){for(var n=0;n<t.length;n++){var o=t[n];for(var l in o)i[l]=o[l]&&o[l].constructor&&o[l].constructor===Object?q(i[l]||{},o[l]):o[l]}return i}function st(){for(var i=["Pusher"],t=0;t<arguments.length;t++)i.push("string"==typeof arguments[t]?arguments[t]:_e(arguments[t]));return i.join(" : ")}function H(i,t){var n=Array.prototype.indexOf;if(null===i)return-1;if(n&&i.indexOf===n)return i.indexOf(t);for(var o=0,l=i.length;o<l;o++)if(i[o]===t)return o;return-1}function Z(i,t){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t(i[n],n,i)}function $e(i){var t=[];return Z(i,function(n,o){t.push(o)}),t}function ue(i,t,n){for(var o=0;o<i.length;o++)t.call(n||window,i[o],o,i)}function Me(i,t){for(var n=[],o=0;o<i.length;o++)n.push(t(i[o],o,i,n));return n}function Ge(i,t){t=t||function(l){return!!l};for(var n=[],o=0;o<i.length;o++)t(i[o],o,i,n)&&n.push(i[o]);return n}function Ue(i,t){var n={};return Z(i,function(o,l){(t&&t(o,l,i,n)||o)&&(n[l]=o)}),n}function He(i,t){for(var n=0;n<i.length;n++)if(t(i[n],n,i))return!0;return!1}function ut(i){return function at(i,t){var n={};return Z(i,function(o,l){n[l]=t(o)}),n}(i,function(t){return"object"==typeof t&&(t=_e(t)),encodeURIComponent(function Ae(i){return Ne(et(i))}(t.toString()))})}function ht(i){return Me(function lt(i){var t=[];return Z(i,function(n,o){t.push([o,n])}),t}(ut(Ue(i,function(o){return void 0!==o}))),U.method("join","=")).join("&")}function _e(i){try{return JSON.stringify(i)}catch{return JSON.stringify(function dt(i){var t=[],n=[];return function o(l,d){var f,y,T;switch(typeof l){case"object":if(!l)return null;for(f=0;f<t.length;f+=1)if(t[f]===l)return{$ref:n[f]};if(t.push(l),n.push(d),"[object Array]"===Object.prototype.toString.apply(l))for(T=[],f=0;f<l.length;f+=1)T[f]=o(l[f],d+"["+f+"]");else for(y in T={},l)Object.prototype.hasOwnProperty.call(l,y)&&(T[y]=o(l[y],d+"["+JSON.stringify(y)+"]"));return T;case"number":case"string":case"boolean":return l}}(i,"$")}(i))}}var N=new class pt{constructor(){this.globalLog=t=>{window.console&&window.console.log&&window.console.log(t)}}debug(...t){this.log(this.globalLog,t)}warn(...t){this.log(this.globalLogWarn,t)}error(...t){this.log(this.globalLogError,t)}globalLogWarn(t){window.console&&window.console.warn?window.console.warn(t):this.globalLog(t)}globalLogError(t){window.console&&window.console.error?window.console.error(t):this.globalLogWarn(t)}log(t,...n){var o=st.apply(this,arguments);Ut.log?Ut.log(o):Ut.logToConsole&&t.bind(this)(o)}},gt=function(i,t,n,o,l){(void 0!==n.headers||null!=n.headersProvider)&&N.warn(`To send headers with the ${o.toString()} request, you must use AJAX, rather than JSONP.`);var d=i.nextAuthCallbackID.toString();i.nextAuthCallbackID++;var f=i.getDocument(),y=f.createElement("script");i.auth_callbacks[d]=function(O){l(null,O)},y.src=n.endpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+d+"']")+"&"+t;var L=f.getElementsByTagName("head")[0]||f.documentElement;L.insertBefore(y,L.firstChild)};class mt{constructor(t){this.src=t}send(t){var n=this,o="Error loading "+n.src;n.script=document.createElement("script"),n.script.id=t.id,n.script.src=n.src,n.script.type="text/javascript",n.script.charset="UTF-8",n.script.addEventListener?(n.script.onerror=function(){t.callback(o)},n.script.onload=function(){t.callback(null)}):n.script.onreadystatechange=function(){("loaded"===n.script.readyState||"complete"===n.script.readyState)&&t.callback(null)},void 0===n.script.async&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(n.errorScript=document.createElement("script"),n.errorScript.id=t.id+"_error",n.errorScript.text=t.name+"('"+o+"');",n.script.async=n.errorScript.async=!1):n.script.async=!0;var l=document.getElementsByTagName("head")[0];l.insertBefore(n.script,l.firstChild),n.errorScript&&l.insertBefore(n.errorScript,n.script.nextSibling)}cleanup(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null}}class _t{constructor(t,n){this.url=t,this.data=n}send(t){if(!this.request){var n=ht(this.data);this.request=S.createScriptRequest(this.url+"/"+t.number+"?"+n),this.request.send(t)}}cleanup(){this.request&&this.request.cleanup()}}var yt={name:"jsonp",getAgent:function(i,t){return function(n,o){var f=S.createJSONPRequest("http"+(t?"s":"")+"://"+(i.host||i.options.host)+i.options.path,n),y=S.ScriptReceivers.create(function(T,L){v.remove(y),f.cleanup(),L&&L.host&&(i.host=L.host),o&&o(T,L)});f.send(y)}}};function ke(i,t,n){return i+(t.useTLS?"s":"")+"://"+(t.useTLS?t.hostTLS:t.hostNonTLS)+n}function ve(i,t){return"/app/"+i+"?protocol="+_.PROTOCOL+"&client=js&version="+_.VERSION+(t?"&"+t:"")}var kt={getInitial:function(i,t){return ke("ws",t,(t.httpPath||"")+ve(i,"flash=false"))}},wt={getInitial:function(i,t){return ke("http",t,(t.httpPath||"/pusher")+ve(i))}},xt={getInitial:function(i,t){return ke("http",t,t.httpPath||"/pusher")},getPath:function(i,t){return ve(i)}};class Be{constructor(){this._callbacks={}}get(t){return this._callbacks[we(t)]}add(t,n,o){var l=we(t);this._callbacks[l]=this._callbacks[l]||[],this._callbacks[l].push({fn:n,context:o})}remove(t,n,o){if(t||n||o){var l=t?[we(t)]:$e(this._callbacks);n||o?this.removeCallback(l,n,o):this.removeAllCallbacks(l)}else this._callbacks={}}removeCallback(t,n,o){ue(t,function(l){this._callbacks[l]=Ge(this._callbacks[l]||[],function(d){return n&&n!==d.fn||o&&o!==d.context}),0===this._callbacks[l].length&&delete this._callbacks[l]},this)}removeAllCallbacks(t){ue(t,function(n){delete this._callbacks[n]},this)}}function we(i){return"_"+i}class ee{constructor(t){this.callbacks=new Be,this.global_callbacks=[],this.failThrough=t}bind(t,n,o){return this.callbacks.add(t,n,o),this}bind_global(t){return this.global_callbacks.push(t),this}unbind(t,n,o){return this.callbacks.remove(t,n,o),this}unbind_global(t){return t?(this.global_callbacks=Ge(this.global_callbacks||[],n=>n!==t),this):(this.global_callbacks=[],this)}unbind_all(){return this.unbind(),this.unbind_global(),this}emit(t,n,o){for(var l=0;l<this.global_callbacks.length;l++)this.global_callbacks[l](t,n);var d=this.callbacks.get(t),f=[];if(o?f.push(n,o):n&&f.push(n),d&&d.length>0)for(l=0;l<d.length;l++)d[l].fn.apply(d[l].context||window,f);else this.failThrough&&this.failThrough(t,n);return this}}class Ct extends ee{constructor(t,n,o,l,d){super(),this.initialize=S.transportConnectionInitializer,this.hooks=t,this.name=n,this.priority=o,this.key=l,this.options=d,this.state="new",this.timeline=d.timeline,this.activityTimeout=d.activityTimeout,this.id=this.timeline.generateUniqueID()}handlesActivityChecks(){return!!this.hooks.handlesActivityChecks}supportsPing(){return!!this.hooks.supportsPing}connect(){if(this.socket||"initialized"!==this.state)return!1;var t=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(t,this.options)}catch(n){return U.defer(()=>{this.onError(n),this.changeState("closed")}),!1}return this.bindListeners(),N.debug("Connecting",{transport:this.name,url:t}),this.changeState("connecting"),!0}close(){return!!this.socket&&(this.socket.close(),!0)}send(t){return"open"===this.state&&(U.defer(()=>{this.socket&&this.socket.send(t)}),!0)}ping(){"open"===this.state&&this.supportsPing()&&this.socket.ping()}onOpen(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0}onError(t){this.emit("error",{type:"WebSocketError",error:t}),this.timeline.error(this.buildTimelineMessage({error:t.toString()}))}onClose(t){t?this.changeState("closed",{code:t.code,reason:t.reason,wasClean:t.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0}onMessage(t){this.emit("message",t)}onActivity(){this.emit("activity")}bindListeners(){this.socket.onopen=()=>{this.onOpen()},this.socket.onerror=t=>{this.onError(t)},this.socket.onclose=t=>{this.onClose(t)},this.socket.onmessage=t=>{this.onMessage(t)},this.supportsPing()&&(this.socket.onactivity=()=>{this.onActivity()})}unbindListeners(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))}changeState(t,n){this.state=t,this.timeline.info(this.buildTimelineMessage({state:t,params:n})),this.emit(t,n)}buildTimelineMessage(t){return q({cid:this.id},t)}}class le{constructor(t){this.hooks=t}isSupported(t){return this.hooks.isSupported(t)}createConnection(t,n,o,l){return new Ct(this.hooks,t,n,o,l)}}var xe=new le({urls:kt,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return!!S.getWebSocketAPI()},isSupported:function(){return!!S.getWebSocketAPI()},getSocket:function(i){return S.createWebSocket(i)}}),Xe={urls:wt,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}},Ye=q({getSocket:function(i){return S.HTTPFactory.createStreamingSocket(i)}},Xe),ze=q({getSocket:function(i){return S.HTTPFactory.createPollingSocket(i)}},Xe),qe={isSupported:function(){return S.isXHRSupported()}},be={ws:xe,xhr_streaming:new le(q({},Ye,qe)),xhr_polling:new le(q({},ze,qe))},Rt=new le({file:"sockjs",urls:xt,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return void 0!==window.SockJS},getSocket:function(i,t){return new window.SockJS(i,null,{js_path:P.getPath("sockjs",{useTLS:t.useTLS}),ignore_null_origin:t.ignoreNullOrigin})},beforeOpen:function(i,t){i.send(JSON.stringify({path:t}))}}),Ve={isSupported:function(i){return S.isXDRSupported(i.useTLS)}},Et=new le(q({},Ye,Ve)),jt=new le(q({},ze,Ve));be.xdr_streaming=Et,be.xdr_polling=jt,be.sockjs=Rt;var Pt=be;var At=new class It extends ee{constructor(){super();var t=this;void 0!==window.addEventListener&&(window.addEventListener("online",function(){t.emit("online")},!1),window.addEventListener("offline",function(){t.emit("offline")},!1))}isOnline(){return void 0===window.navigator.onLine||window.navigator.onLine}};class Lt{constructor(t,n,o){this.manager=t,this.transport=n,this.minPingDelay=o.minPingDelay,this.maxPingDelay=o.maxPingDelay,this.pingDelay=void 0}createConnection(t,n,o,l){l=q({},l,{activityTimeout:this.pingDelay});var d=this.transport.createConnection(t,n,o,l),f=null,y=function(){d.unbind("open",y),d.bind("closed",T),f=U.now()},T=L=>{if(d.unbind("closed",T),1002===L.code||1003===L.code)this.manager.reportDeath();else if(!L.wasClean&&f){var O=U.now()-f;O<2*this.maxPingDelay&&(this.manager.reportDeath(),this.pingDelay=Math.max(O/2,this.minPingDelay))}};return d.bind("open",y),d}isSupported(t){return this.manager.isAlive()&&this.transport.isSupported(t)}}const Je={decodeMessage:function(i){try{var t=JSON.parse(i.data),n=t.data;if("string"==typeof n)try{n=JSON.parse(t.data)}catch{}var o={event:t.event,channel:t.channel,data:n};return t.user_id&&(o.user_id=t.user_id),o}catch(l){throw{type:"MessageParseError",error:l,data:i.data}}},encodeMessage:function(i){return JSON.stringify(i)},processHandshake:function(i){var t=Je.decodeMessage(i);if("pusher:connection_established"===t.event){if(!t.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:t.data.socket_id,activityTimeout:1e3*t.data.activity_timeout}}if("pusher:error"===t.event)return{action:this.getCloseAction(t.data),error:this.getCloseError(t.data)};throw"Invalid handshake"},getCloseAction:function(i){return i.code<4e3?i.code>=1002&&i.code<=1004?"backoff":null:4e3===i.code?"tls_only":i.code<4100?"refused":i.code<4200?"backoff":i.code<4300?"retry":"refused"},getCloseError:function(i){return 1e3!==i.code&&1001!==i.code?{type:"PusherError",data:{code:i.code,message:i.reason||i.message}}:null}};var ie=Je;class Ot extends ee{constructor(t,n){super(),this.id=t,this.transport=n,this.activityTimeout=n.activityTimeout,this.bindListeners()}handlesActivityChecks(){return this.transport.handlesActivityChecks()}send(t){return this.transport.send(t)}send_event(t,n,o){var l={event:t,data:n};return o&&(l.channel=o),N.debug("Event sent",l),this.send(ie.encodeMessage(l))}ping(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})}close(){this.transport.close()}bindListeners(){var t={message:o=>{var l;try{l=ie.decodeMessage(o)}catch(d){this.emit("error",{type:"MessageParseError",error:d,data:o.data})}if(void 0!==l){switch(N.debug("Event recd",l),l.event){case"pusher:error":this.emit("error",{type:"PusherError",data:l.data});break;case"pusher:ping":this.emit("ping");break;case"pusher:pong":this.emit("pong")}this.emit("message",l)}},activity:()=>{this.emit("activity")},error:o=>{this.emit("error",o)},closed:o=>{n(),o&&o.code&&this.handleCloseEvent(o),this.transport=null,this.emit("closed")}},n=()=>{Z(t,(o,l)=>{this.transport.unbind(l,o)})};Z(t,(o,l)=>{this.transport.bind(l,o)})}handleCloseEvent(t){var n=ie.getCloseAction(t),o=ie.getCloseError(t);o&&this.emit("error",o),n&&this.emit(n,{action:n,error:o})}}class Nt{constructor(t,n){this.transport=t,this.callback=n,this.bindListeners()}close(){this.unbindListeners(),this.transport.close()}bindListeners(){this.onMessage=t=>{var n;this.unbindListeners();try{n=ie.processHandshake(t)}catch(o){return this.finish("error",{error:o}),void this.transport.close()}"connected"===n.action?this.finish("connected",{connection:new Ot(n.id,this.transport),activityTimeout:n.activityTimeout}):(this.finish(n.action,{error:n.error}),this.transport.close())},this.onClosed=t=>{this.unbindListeners();var n=ie.getCloseAction(t)||"backoff",o=ie.getCloseError(t);this.finish(n,{error:o})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)}unbindListeners(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)}finish(t,n){this.callback(q({transport:this.transport,action:t},n))}}class Dt{constructor(t,n){this.timeline=t,this.options=n||{}}send(t,n){this.timeline.isEmpty()||this.timeline.send(S.TimelineTransport.getAgent(this,t),n)}}class Ce extends ee{constructor(t,n){super(function(o,l){N.debug("No callbacks on "+t+" for "+o)}),this.name=t,this.pusher=n,this.subscribed=!1,this.subscriptionPending=!1,this.subscriptionCancelled=!1}authorize(t,n){return n(null,{auth:""})}trigger(t,n){if(0!==t.indexOf("client-"))throw new m("Event '"+t+"' does not start with 'client-'");if(!this.subscribed){var o=E_buildLogSuffix("triggeringClientEvents");N.warn(`Client event triggered before channel 'subscription_succeeded' event . ${o}`)}return this.pusher.send_event(t,n,this.name)}disconnect(){this.subscribed=!1,this.subscriptionPending=!1}handleEvent(t){var n=t.event,o=t.data;"pusher_internal:subscription_succeeded"===n?this.handleSubscriptionSucceededEvent(t):"pusher_internal:subscription_count"===n?this.handleSubscriptionCountEvent(t):0!==n.indexOf("pusher_internal:")&&this.emit(n,o,{})}handleSubscriptionSucceededEvent(t){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",t.data)}handleSubscriptionCountEvent(t){t.data.subscription_count&&(this.subscriptionCount=t.data.subscription_count),this.emit("pusher:subscription_count",t.data)}subscribe(){this.subscribed||(this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,(t,n)=>{t?(this.subscriptionPending=!1,N.error(t.toString()),this.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:t.message},t instanceof J?{status:t.status}:{}))):this.pusher.send_event("pusher:subscribe",{auth:n.auth,channel_data:n.channel_data,channel:this.name})}))}unsubscribe(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})}cancelSubscription(){this.subscriptionCancelled=!0}reinstateSubscription(){this.subscriptionCancelled=!1}}class We extends Ce{authorize(t,n){return this.pusher.config.channelAuthorizer({channelName:this.name,socketId:t},n)}}class $t{constructor(){this.reset()}get(t){return Object.prototype.hasOwnProperty.call(this.members,t)?{id:t,info:this.members[t]}:null}each(t){Z(this.members,(n,o)=>{t(this.get(o))})}setMyID(t){this.myID=t}onSubscription(t){this.members=t.presence.hash,this.count=t.presence.count,this.me=this.get(this.myID)}addMember(t){return null===this.get(t.user_id)&&this.count++,this.members[t.user_id]=t.user_info,this.get(t.user_id)}removeMember(t){var n=this.get(t.user_id);return n&&(delete this.members[t.user_id],this.count--),n}reset(){this.members={},this.count=0,this.myID=null,this.me=null}}var Mt=function(i,t,n,o){return new(n||(n=Promise))(function(d,f){function y(O){try{L(o.next(O))}catch(G){f(G)}}function T(O){try{L(o.throw(O))}catch(G){f(G)}}function L(O){O.done?d(O.value):function l(d){return d instanceof n?d:new n(function(f){f(d)})}(O.value).then(y,T)}L((o=o.apply(i,t||[])).next())})};class Gt extends We{constructor(t,n){super(t,n),this.members=new $t}authorize(t,n){super.authorize(t,(o,l)=>Mt(this,void 0,void 0,function*(){if(!o)if(null!=l.channel_data){var d=JSON.parse(l.channel_data);this.members.setMyID(d.user_id)}else{if(yield this.pusher.user.signinDonePromise,null==this.pusher.user.user_data){let f=E_buildLogSuffix("authorizationEndpoint");return N.error(`Invalid auth response for channel '${this.name}', expected 'channel_data' field. ${f}, or the user should be signed in.`),void n("Invalid auth response")}this.members.setMyID(this.pusher.user.user_data.id)}n(o,l)}))}handleEvent(t){var n=t.event;if(0===n.indexOf("pusher_internal:"))this.handleInternalEvent(t);else{var o=t.data,l={};t.user_id&&(l.user_id=t.user_id),this.emit(n,o,l)}}handleInternalEvent(t){var o=t.data;switch(t.event){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(t);break;case"pusher_internal:subscription_count":this.handleSubscriptionCountEvent(t);break;case"pusher_internal:member_added":var l=this.members.addMember(o);this.emit("pusher:member_added",l);break;case"pusher_internal:member_removed":var d=this.members.removeMember(o);d&&this.emit("pusher:member_removed",d)}}handleSubscriptionSucceededEvent(t){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):(this.members.onSubscription(t.data),this.emit("pusher:subscription_succeeded",this.members))}disconnect(){this.members.reset(),super.disconnect()}}var c=C(1),u=C(0);class r extends We{constructor(t,n,o){super(t,n),this.key=null,this.nacl=o}authorize(t,n){super.authorize(t,(o,l)=>{if(o)return void n(o,l);let d=l.shared_secret;d?(this.key=Object(u.decode)(d),delete l.shared_secret,n(null,l)):n(new Error(`No shared_secret key in auth payload for encrypted channel: ${this.name}`),null)})}trigger(t,n){throw new M("Client events are not currently supported for encrypted channels")}handleEvent(t){var n=t.event,o=t.data;0!==n.indexOf("pusher_internal:")&&0!==n.indexOf("pusher:")?this.handleEncryptedEvent(n,o):super.handleEvent(t)}handleEncryptedEvent(t,n){if(!this.key)return void N.debug("Received encrypted event before key has been retrieved from the authEndpoint");if(!n.ciphertext||!n.nonce)return void N.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+n);let o=Object(u.decode)(n.ciphertext);if(o.length<this.nacl.secretbox.overheadLength)return void N.error(`Expected encrypted event ciphertext length to be ${this.nacl.secretbox.overheadLength}, got: ${o.length}`);let l=Object(u.decode)(n.nonce);if(l.length<this.nacl.secretbox.nonceLength)return void N.error(`Expected encrypted event nonce length to be ${this.nacl.secretbox.nonceLength}, got: ${l.length}`);let d=this.nacl.secretbox.open(o,l,this.key);if(null===d)return N.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),void this.authorize(this.pusher.connection.socket_id,(f,y)=>{f?N.error(`Failed to make a request to the authEndpoint: ${y}. Unable to fetch new key, so dropping encrypted event`):(d=this.nacl.secretbox.open(o,l,this.key),null!==d?this.emit(t,this.getDataToEmit(d)):N.error("Failed to decrypt event with new key. Dropping encrypted event"))});this.emit(t,this.getDataToEmit(d))}getDataToEmit(t){let n=Object(c.decode)(t);try{return JSON.parse(n)}catch{return n}}}class a extends ee{constructor(t,n){super(),this.state="initialized",this.connection=null,this.key=t,this.options=n,this.timeline=this.options.timeline,this.usingTLS=this.options.useTLS,this.errorCallbacks=this.buildErrorCallbacks(),this.connectionCallbacks=this.buildConnectionCallbacks(this.errorCallbacks),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var o=S.getNetwork();o.bind("online",()=>{this.timeline.info({netinfo:"online"}),("connecting"===this.state||"unavailable"===this.state)&&this.retryIn(0)}),o.bind("offline",()=>{this.timeline.info({netinfo:"offline"}),this.connection&&this.sendActivityCheck()}),this.updateStrategy()}switchCluster(t){this.key=t,this.updateStrategy(),this.retryIn(0)}connect(){if(!this.connection&&!this.runner){if(!this.strategy.isSupported())return void this.updateState("failed");this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}}send(t){return!!this.connection&&this.connection.send(t)}send_event(t,n,o){return!!this.connection&&this.connection.send_event(t,n,o)}disconnect(){this.disconnectInternally(),this.updateState("disconnected")}isUsingTLS(){return this.usingTLS}startConnecting(){var t=(n,o)=>{n?this.runner=this.strategy.connect(0,t):"error"===o.action?(this.emit("error",{type:"HandshakeError",error:o.error}),this.timeline.error({handshakeError:o.error})):(this.abortConnecting(),this.handshakeCallbacks[o.action](o))};this.runner=this.strategy.connect(0,t)}abortConnecting(){this.runner&&(this.runner.abort(),this.runner=null)}disconnectInternally(){this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection&&this.abandonConnection().close()}updateStrategy(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})}retryIn(t){this.timeline.info({action:"retry",delay:t}),t>0&&this.emit("connecting_in",Math.round(t/1e3)),this.retryTimer=new ne(t||0,()=>{this.disconnectInternally(),this.connect()})}clearRetryTimer(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)}setUnavailableTimer(){this.unavailableTimer=new ne(this.options.unavailableTimeout,()=>{this.updateState("unavailable")})}clearUnavailableTimer(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()}sendActivityCheck(){this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new ne(this.options.pongTimeout,()=>{this.timeline.error({pong_timed_out:this.options.pongTimeout}),this.retryIn(0)})}resetActivityCheck(){this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks()&&(this.activityTimer=new ne(this.activityTimeout,()=>{this.sendActivityCheck()}))}stopActivityCheck(){this.activityTimer&&this.activityTimer.ensureAborted()}buildConnectionCallbacks(t){return q({},t,{message:n=>{this.resetActivityCheck(),this.emit("message",n)},ping:()=>{this.send_event("pusher:pong",{})},activity:()=>{this.resetActivityCheck()},error:n=>{this.emit("error",n)},closed:()=>{this.abandonConnection(),this.shouldRetry()&&this.retryIn(1e3)}})}buildHandshakeCallbacks(t){return q({},t,{connected:n=>{this.activityTimeout=Math.min(this.options.activityTimeout,n.activityTimeout,n.connection.activityTimeout||1/0),this.clearUnavailableTimer(),this.setConnection(n.connection),this.socket_id=this.connection.id,this.updateState("connected",{socket_id:this.socket_id})}})}buildErrorCallbacks(){let t=n=>o=>{o.error&&this.emit("error",{type:"WebSocketError",error:o.error}),n(o)};return{tls_only:t(()=>{this.usingTLS=!0,this.updateStrategy(),this.retryIn(0)}),refused:t(()=>{this.disconnect()}),backoff:t(()=>{this.retryIn(1e3)}),retry:t(()=>{this.retryIn(0)})}}setConnection(t){for(var n in this.connection=t,this.connectionCallbacks)this.connection.bind(n,this.connectionCallbacks[n]);this.resetActivityCheck()}abandonConnection(){if(this.connection){for(var t in this.stopActivityCheck(),this.connectionCallbacks)this.connection.unbind(t,this.connectionCallbacks[t]);var n=this.connection;return this.connection=null,n}}updateState(t,n){var o=this.state;if(this.state=t,o!==t){var l=t;"connected"===l&&(l+=" with new socket ID "+n.socket_id),N.debug("State changed",o+" -> "+l),this.timeline.info({state:t,params:n}),this.emit("state_change",{previous:o,current:t}),this.emit(t,n)}}shouldRetry(){return"connecting"===this.state||"connected"===this.state}}class s{constructor(){this.channels={}}add(t,n){return this.channels[t]||(this.channels[t]=function h(i,t){if(0===i.indexOf("private-encrypted-")){if(t.config.nacl)return A.createEncryptedChannel(i,t,t.config.nacl);let n="Tried to subscribe to a private-encrypted- channel but no nacl implementation available",o=E_buildLogSuffix("encryptedChannelSupport");throw new M(`${n}. ${o}`)}if(0===i.indexOf("private-"))return A.createPrivateChannel(i,t);if(0===i.indexOf("presence-"))return A.createPresenceChannel(i,t);if(0===i.indexOf("#"))throw new g('Cannot create a channel with name "'+i+'".');return A.createChannel(i,t)}(t,n)),this.channels[t]}all(){return function ot(i){var t=[];return Z(i,function(n){t.push(n)}),t}(this.channels)}find(t){return this.channels[t]}remove(t){var n=this.channels[t];return delete this.channels[t],n}disconnect(){Z(this.channels,function(t){t.disconnect()})}}var A={createChannels:()=>new s,createConnectionManager:(i,t)=>new a(i,t),createChannel:(i,t)=>new Ce(i,t),createPrivateChannel:(i,t)=>new We(i,t),createPresenceChannel:(i,t)=>new Gt(i,t),createEncryptedChannel:(i,t,n)=>new r(i,t,n),createTimelineSender:(i,t)=>new Dt(i,t),createHandshake:(i,t)=>new Nt(i,t),createAssistantToTheTransportManager:(i,t,n)=>new Lt(i,t,n)};class B{constructor(t){this.options=t||{},this.livesLeft=this.options.lives||1/0}getAssistant(t){return A.createAssistantToTheTransportManager(this,t,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})}isAlive(){return this.livesLeft>0}reportDeath(){this.livesLeft-=1}}class Y{constructor(t,n){this.strategies=t,this.loop=!!n.loop,this.failFast=!!n.failFast,this.timeout=n.timeout,this.timeoutLimit=n.timeoutLimit}isSupported(){return He(this.strategies,U.method("isSupported"))}connect(t,n){var o=this.strategies,l=0,d=this.timeout,f=null,y=(T,L)=>{L?n(null,L):(l+=1,this.loop&&(l%=o.length),l<o.length?(d&&(d*=2,this.timeoutLimit&&(d=Math.min(d,this.timeoutLimit))),f=this.tryStrategy(o[l],t,{timeout:d,failFast:this.failFast},y)):n(!0))};return f=this.tryStrategy(o[l],t,{timeout:d,failFast:this.failFast},y),{abort:function(){f.abort()},forceMinPriority:function(T){t=T,f&&f.forceMinPriority(T)}}}tryStrategy(t,n,o,l){var d=null,f=null;return o.timeout>0&&(d=new ne(o.timeout,function(){f.abort(),l(!0)})),f=t.connect(n,function(y,T){y&&d&&d.isRunning()&&!o.failFast||(d&&d.ensureAborted(),l(y,T))}),{abort:function(){d&&d.ensureAborted(),f.abort()},forceMinPriority:function(y){f.forceMinPriority(y)}}}}class re{constructor(t){this.strategies=t}isSupported(){return He(this.strategies,U.method("isSupported"))}connect(t,n){return function he(i,t,n){var o=Me(i,function(l,d,f,y){return l.connect(t,n(d,y))});return{abort:function(){ue(o,Se)},forceMinPriority:function(l){ue(o,function(d){d.forceMinPriority(l)})}}}(this.strategies,t,function(o,l){return function(d,f){l[o].error=d,d?function Te(i){return function ct(i,t){for(var n=0;n<i.length;n++)if(!t(i[n],n,i))return!1;return!0}(i,function(t){return!!t.error})}(l)&&n(!0):(ue(l,function(y){y.forceMinPriority(f.transport.priority)}),n(null,f))}})}}function Se(i){!i.error&&!i.aborted&&(i.abort(),i.aborted=!0)}class Fe{constructor(t,n,o){this.strategy=t,this.transports=n,this.ttl=o.ttl||18e5,this.usingTLS=o.useTLS,this.timeline=o.timeline}isSupported(){return this.strategy.isSupported()}connect(t,n){var o=this.usingTLS,l=function Re(i){var t=S.getLocalStorage();if(t)try{var n=t[de(i)];if(n)return JSON.parse(n)}catch{ye(i)}return null}(o),d=l&&l.cacheSkipCount?l.cacheSkipCount:0,f=[this.strategy];if(l&&l.timestamp+this.ttl>=U.now()){var y=this.transports[l.transport];y&&(["ws","wss"].includes(l.transport)||d>3?(this.timeline.info({cached:!0,transport:l.transport,latency:l.latency}),f.push(new Y([y],{timeout:2*l.latency+1e3,failFast:!0}))):d++)}var T=U.now(),L=f.pop().connect(t,function O(G,Qe){G?(ye(o),f.length>0?(T=U.now(),L=f.pop().connect(t,O)):n(G)):(function Ee(i,t,n,o){var l=S.getLocalStorage();if(l)try{l[de(i)]=_e({timestamp:U.now(),transport:t,latency:n,cacheSkipCount:o})}catch{}}(o,Qe.transport.name,U.now()-T,d),n(null,Qe))});return{abort:function(){L.abort()},forceMinPriority:function(O){t=O,L&&L.forceMinPriority(O)}}}}function de(i){return"pusherTransport"+(i?"TLS":"NonTLS")}function ye(i){var t=S.getLocalStorage();if(t)try{delete t[de(i)]}catch{}}class ce{constructor(t,{delay:n}){this.strategy=t,this.options={delay:n}}isSupported(){return this.strategy.isSupported()}connect(t,n){var l,o=this.strategy,d=new ne(this.options.delay,function(){l=o.connect(t,n)});return{abort:function(){d.ensureAborted(),l&&l.abort()},forceMinPriority:function(f){t=f,l&&l.forceMinPriority(f)}}}}class se{constructor(t,n,o){this.test=t,this.trueBranch=n,this.falseBranch=o}isSupported(){return(this.test()?this.trueBranch:this.falseBranch).isSupported()}connect(t,n){return(this.test()?this.trueBranch:this.falseBranch).connect(t,n)}}class je{constructor(t){this.strategy=t}isSupported(){return this.strategy.isSupported()}connect(t,n){var o=this.strategy.connect(t,function(l,d){d&&o.abort(),n(l,d)});return o}}function oe(i){return function(){return i.isSupported()}}var un={getRequest:function(i){var t=new window.XDomainRequest;return t.ontimeout=function(){i.emit("error",new x),i.close()},t.onerror=function(n){i.emit("error",n),i.close()},t.onprogress=function(){t.responseText&&t.responseText.length>0&&i.onChunk(200,t.responseText)},t.onload=function(){t.responseText&&t.responseText.length>0&&i.onChunk(200,t.responseText),i.emit("finished",200),i.close()},t},abortRequest:function(i){i.ontimeout=i.onerror=i.onprogress=i.onload=null,i.abort()}};class dn extends ee{constructor(t,n,o){super(),this.hooks=t,this.method=n,this.url=o}start(t){this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=()=>{this.close()},S.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(t)}close(){this.unloader&&(S.removeUnloadListener(this.unloader),this.unloader=null),this.xhr&&(this.hooks.abortRequest(this.xhr),this.xhr=null)}onChunk(t,n){for(;;){var o=this.advanceBuffer(n);if(!o)break;this.emit("chunk",{status:t,data:o})}this.isBufferTooLong(n)&&this.emit("buffer_too_long")}advanceBuffer(t){var n=t.slice(this.position),o=n.indexOf("\n");return-1!==o?(this.position+=o+1,n.slice(0,o)):null}isBufferTooLong(t){return this.position===t.length&&t.length>262144}}var Xt=function(i){return i[i.CONNECTING=0]="CONNECTING",i[i.OPEN=1]="OPEN",i[i.CLOSED=3]="CLOSED",i}(Xt||{}),pe=Xt,pn=1;function Yt(i){var t=-1===i.indexOf("?")?"?":"&";return i+t+"t="+ +new Date+"&n="+pn++}function zt(i){return S.randomInt(i)}var bn=class fn{constructor(t,n){this.hooks=t,this.session=zt(1e3)+"/"+function vn(i){for(var t=[],n=0;n<i;n++)t.push(zt(32).toString(32));return t.join("")}(8),this.location=function gn(i){var t=/([^\?]*)\/*(\??.*)/.exec(i);return{base:t[1],queryString:t[2]}}(n),this.readyState=pe.CONNECTING,this.openStream()}send(t){return this.sendRaw(JSON.stringify([t]))}ping(){this.hooks.sendHeartbeat(this)}close(t,n){this.onClose(t,n,!0)}sendRaw(t){if(this.readyState!==pe.OPEN)return!1;try{return S.createSocketRequest("POST",Yt(function mn(i,t){return i.base+"/"+t+"/xhr_send"}(this.location,this.session))).start(t),!0}catch{return!1}}reconnect(){this.closeStream(),this.openStream()}onClose(t,n,o){this.closeStream(),this.readyState=pe.CLOSED,this.onclose&&this.onclose({code:t,reason:n,wasClean:o})}onChunk(t){var n;if(200===t.status)switch(this.readyState===pe.OPEN&&this.onActivity(),t.data.slice(0,1)){case"o":n=JSON.parse(t.data.slice(1)||"{}"),this.onOpen(n);break;case"a":n=JSON.parse(t.data.slice(1)||"[]");for(var l=0;l<n.length;l++)this.onEvent(n[l]);break;case"m":n=JSON.parse(t.data.slice(1)||"null"),this.onEvent(n);break;case"h":this.hooks.onHeartbeat(this);break;case"c":n=JSON.parse(t.data.slice(1)||"[]"),this.onClose(n[0],n[1],!0)}}onOpen(t){this.readyState===pe.CONNECTING?(t&&t.hostname&&(this.location.base=function _n(i,t){var n=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(i);return n[1]+t+n[3]}(this.location.base,t.hostname)),this.readyState=pe.OPEN,this.onopen&&this.onopen()):this.onClose(1006,"Server lost session",!0)}onEvent(t){this.readyState===pe.OPEN&&this.onmessage&&this.onmessage({data:t})}onActivity(){this.onactivity&&this.onactivity()}onError(t){this.onerror&&this.onerror(t)}openStream(){this.stream=S.createSocketRequest("POST",Yt(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",t=>{this.onChunk(t)}),this.stream.bind("finished",t=>{this.hooks.onFinished(this,t)}),this.stream.bind("buffer_too_long",()=>{this.reconnect()});try{this.stream.start()}catch(t){U.defer(()=>{this.onError(t),this.onClose(1006,"Could not start streaming",!1)})}}closeStream(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)}},kn={getReceiveURL:function(i,t){return i.base+"/"+t+"/xhr_streaming"+i.queryString},onHeartbeat:function(i){i.sendRaw("[]")},sendHeartbeat:function(i){i.sendRaw("[]")},onFinished:function(i,t){i.onClose(1006,"Connection interrupted ("+t+")",!1)}},xn={getReceiveURL:function(i,t){return i.base+"/"+t+"/xhr"+i.queryString},onHeartbeat:function(){},sendHeartbeat:function(i){i.sendRaw("[]")},onFinished:function(i,t){200===t?i.reconnect():i.onClose(1006,"Connection interrupted ("+t+")",!1)}},Tn={getRequest:function(i){var n=new(S.getXHRAPI());return n.onreadystatechange=n.onprogress=function(){switch(n.readyState){case 3:n.responseText&&n.responseText.length>0&&i.onChunk(n.status,n.responseText);break;case 4:n.responseText&&n.responseText.length>0&&i.onChunk(n.status,n.responseText),i.emit("finished",n.status),i.close()}},n},abortRequest:function(i){i.onreadystatechange=null,i.abort()}},S={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:v,DependenciesReceivers:I,getDefaultStrategy:function(i,t,n){var o={};function l(sn,ri,si,oi,ai){var on=n(i,sn,ri,si,oi,ai);return o[sn]=on,on}var Bt,d=Object.assign({},t,{hostNonTLS:i.wsHost+":"+i.wsPort,hostTLS:i.wsHost+":"+i.wssPort,httpPath:i.wsPath}),f=Object.assign({},d,{useTLS:!0}),y=Object.assign({},t,{hostNonTLS:i.httpHost+":"+i.httpPort,hostTLS:i.httpHost+":"+i.httpsPort,httpPath:i.httpPath}),T={loop:!0,timeout:15e3,timeoutLimit:6e4},L=new B({minPingDelay:1e4,maxPingDelay:i.activityTimeout}),O=new B({lives:2,minPingDelay:1e4,maxPingDelay:i.activityTimeout}),G=l("ws","ws",3,d,L),Qe=l("wss","ws",3,f,L),Zn=l("sockjs","sockjs",1,y),Qt=l("xhr_streaming","xhr_streaming",1,y,O),ei=l("xdr_streaming","xdr_streaming",1,y,O),Zt=l("xhr_polling","xhr_polling",1,y),ti=l("xdr_polling","xdr_polling",1,y),en=new Y([G],T),ni=new Y([Qe],T),ii=new Y([Zn],T),tn=new Y([new se(oe(Qt),Qt,ei)],T),nn=new Y([new se(oe(Zt),Zt,ti)],T),rn=new Y([new se(oe(tn),new re([tn,new ce(nn,{delay:4e3})]),nn)],T),Ht=new se(oe(rn),rn,ii);return Bt=new re(t.useTLS?[en,new ce(Ht,{delay:2e3})]:[en,new ce(ni,{delay:2e3}),new ce(Ht,{delay:5e3})]),new Fe(new je(new se(oe(G),Bt,Ht)),o,{ttl:18e5,timeline:t.timeline,useTLS:t.useTLS})},Transports:Pt,transportConnectionInitializer:function(){var i=this;i.timeline.info(i.buildTimelineMessage({transport:i.name+(i.options.useTLS?"s":"")})),i.hooks.isInitialized()?i.changeState("initialized"):i.hooks.file?(i.changeState("initializing"),P.load(i.hooks.file,{useTLS:i.options.useTLS},function(t,n){i.hooks.isInitialized()?(i.changeState("initialized"),n(!0)):(t&&i.onError(t),i.onClose(),n(!1))})):i.onClose()},HTTPFactory:{createStreamingSocket(i){return this.createSocket(kn,i)},createPollingSocket(i){return this.createSocket(xn,i)},createSocket:(i,t)=>new bn(i,t),createXHR(i,t){return this.createRequest(Tn,i,t)},createRequest:(i,t,n)=>new dn(i,t,n),createXDR:function(i,t){return this.createRequest(un,i,t)}},TimelineTransport:yt,getXHRAPI:()=>window.XMLHttpRequest,getWebSocketAPI:()=>window.WebSocket||window.MozWebSocket,setup(i){window.Pusher=i;var t=()=>{this.onDocumentBody(i.ready)};window.JSON?t():P.load("json2",{},t)},getDocument:()=>document,getProtocol(){return this.getDocument().location.protocol},getAuthorizers:()=>({ajax:K,jsonp:gt}),onDocumentBody(i){document.body?i():setTimeout(()=>{this.onDocumentBody(i)},0)},createJSONPRequest:(i,t)=>new _t(i,t),createScriptRequest:i=>new mt(i),getLocalStorage(){try{return window.localStorage}catch{return}},createXHR(){return this.getXHRAPI()?this.createXMLHttpRequest():this.createMicrosoftXHR()},createXMLHttpRequest(){return new(this.getXHRAPI())},createMicrosoftXHR:()=>new ActiveXObject("Microsoft.XMLHTTP"),getNetwork:()=>At,createWebSocket(i){return new(this.getWebSocketAPI())(i)},createSocketRequest(i,t){if(this.isXHRSupported())return this.HTTPFactory.createXHR(i,t);if(this.isXDRSupported(0===t.indexOf("https:")))return this.HTTPFactory.createXDR(i,t);throw"Cross-origin HTTP requests are not supported"},isXHRSupported(){var i=this.getXHRAPI();return!!i&&void 0!==(new i).withCredentials},isXDRSupported(i){var t=i?"https:":"http:",n=this.getProtocol();return!!window.XDomainRequest&&n===t},addUnloadListener(i){void 0!==window.addEventListener?window.addEventListener("unload",i,!1):void 0!==window.attachEvent&&window.attachEvent("onunload",i)},removeUnloadListener(i){void 0!==window.addEventListener?window.removeEventListener("unload",i,!1):void 0!==window.detachEvent&&window.detachEvent("onunload",i)},randomInt:i=>Math.floor((window.crypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]/Math.pow(2,32)*i)},Vt=function(i){return i[i.ERROR=3]="ERROR",i[i.INFO=6]="INFO",i[i.DEBUG=7]="DEBUG",i}(Vt||{}),Ke=Vt;class En{constructor(t,n,o){this.key=t,this.session=n,this.events=[],this.options=o||{},this.sent=0,this.uniqueID=0}log(t,n){t<=this.options.level&&(this.events.push(q({},n,{timestamp:U.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())}error(t){this.log(Ke.ERROR,t)}info(t){this.log(Ke.INFO,t)}debug(t){this.log(Ke.DEBUG,t)}isEmpty(){return 0===this.events.length}send(t,n){var o=q({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],t(o,(l,d)=>{l||this.sent++,n&&n(l,d)}),!0}generateUniqueID(){return this.uniqueID++,this.uniqueID}}class jn{constructor(t,n,o,l){this.name=t,this.priority=n,this.transport=o,this.options=l||{}}isSupported(){return this.transport.isSupported({useTLS:this.options.useTLS})}connect(t,n){if(!this.isSupported())return Jt(new Q,n);if(this.priority<t)return Jt(new j,n);var o=!1,l=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),d=null,f=function(){l.unbind("initialized",f),l.connect()},y=function(){d=A.createHandshake(l,function(G){o=!0,O(),n(null,G)})},T=function(G){O(),n(G)},L=function(){var G;O(),G=_e(l),n(new $(G))},O=function(){l.unbind("initialized",f),l.unbind("open",y),l.unbind("error",T),l.unbind("closed",L)};return l.bind("initialized",f),l.bind("open",y),l.bind("error",T),l.bind("closed",L),l.initialize(),{abort:()=>{o||(O(),d?d.close():l.close())},forceMinPriority:G=>{o||this.priority<G&&(d?d.close():l.close())}}}}function Jt(i,t){return U.defer(function(){t(i)}),{abort:function(){},forceMinPriority:function(){}}}const{Transports:Pn}=S;var In=function(i,t,n,o,l,d){var T,f=Pn[n];if(!f)throw new W(n);return i.enabledTransports&&-1===H(i.enabledTransports,t)||i.disabledTransports&&-1!==H(i.disabledTransports,t)?T=An:(l=Object.assign({ignoreNullOrigin:i.ignoreNullOrigin},l),T=new jn(t,o,d?d.getAssistant(f):f,l)),T},An={isSupported:function(){return!1},connect:function(i,t){var n=U.defer(function(){t(new Q)});return{abort:function(){n.ensureAborted()},forceMinPriority:function(){}}}};var Nn=i=>{if(typeof S.getAuthorizers()[i.transport]>"u")throw`'${i.transport}' is not a recognized auth transport`;return(t,n)=>{const o=((i,t)=>{var n="socket_id="+encodeURIComponent(i.socketId);for(var o in t.params)n+="&"+encodeURIComponent(o)+"="+encodeURIComponent(t.params[o]);if(null!=t.paramsProvider){let l=t.paramsProvider();for(var o in l)n+="&"+encodeURIComponent(o)+"="+encodeURIComponent(l[o])}return n})(t,i);S.getAuthorizers()[i.transport](S,o,i,b.UserAuthentication,n)}};var $n=i=>{if(typeof S.getAuthorizers()[i.transport]>"u")throw`'${i.transport}' is not a recognized auth transport`;return(t,n)=>{const o=((i,t)=>{var n="socket_id="+encodeURIComponent(i.socketId);for(var o in n+="&channel_name="+encodeURIComponent(i.channelName),t.params)n+="&"+encodeURIComponent(o)+"="+encodeURIComponent(t.params[o]);if(null!=t.paramsProvider){let l=t.paramsProvider();for(var o in l)n+="&"+encodeURIComponent(o)+"="+encodeURIComponent(l[o])}return n})(t,i);S.getAuthorizers()[i.transport](S,o,i,b.ChannelAuthorization,n)}};const Mn=(i,t,n)=>{const o={authTransport:t.transport,authEndpoint:t.endpoint,auth:{params:t.params,headers:t.headers}};return(l,d)=>{const f=i.channel(l.channelName);n(f,o).authorize(l.socketId,d)}};function Wt(i,t){let n={activityTimeout:i.activityTimeout||_.activityTimeout,cluster:i.cluster,httpPath:i.httpPath||_.httpPath,httpPort:i.httpPort||_.httpPort,httpsPort:i.httpsPort||_.httpsPort,pongTimeout:i.pongTimeout||_.pongTimeout,statsHost:i.statsHost||_.stats_host,unavailableTimeout:i.unavailableTimeout||_.unavailableTimeout,wsPath:i.wsPath||_.wsPath,wsPort:i.wsPort||_.wsPort,wssPort:i.wssPort||_.wssPort,enableStats:Xn(i),httpHost:Gn(i),useTLS:Bn(i),wsHost:Un(i),userAuthenticator:Yn(i),channelAuthorizer:qn(i,t)};return"disabledTransports"in i&&(n.disabledTransports=i.disabledTransports),"enabledTransports"in i&&(n.enabledTransports=i.enabledTransports),"ignoreNullOrigin"in i&&(n.ignoreNullOrigin=i.ignoreNullOrigin),"timelineParams"in i&&(n.timelineParams=i.timelineParams),"nacl"in i&&(n.nacl=i.nacl),n}function Gn(i){return i.httpHost?i.httpHost:i.cluster?`sockjs-${i.cluster}.pusher.com`:_.httpHost}function Un(i){return i.wsHost?i.wsHost:function Hn(i){return`ws-${i}.pusher.com`}(i.cluster)}function Bn(i){return"https:"===S.getProtocol()||!1!==i.forceTLS}function Xn(i){return"enableStats"in i?i.enableStats:"disableStats"in i&&!i.disableStats}const Kt=i=>"customHandler"in i&&null!=i.customHandler;function Yn(i){const t=Object.assign(Object.assign({},_.userAuthentication),i.userAuthentication);return Kt(t)?t.customHandler:Nn(t)}function qn(i,t){const n=function zn(i,t){let n;if("channelAuthorization"in i)n=Object.assign(Object.assign({},_.channelAuthorization),i.channelAuthorization);else if(n={transport:i.authTransport||_.authTransport,endpoint:i.authEndpoint||_.authEndpoint},"auth"in i&&("params"in i.auth&&(n.params=i.auth.params),"headers"in i.auth&&(n.headers=i.auth.headers)),"authorizer"in i)return{customHandler:Mn(t,n,i.authorizer)};return n}(i,t);return Kt(n)?n.customHandler:$n(n)}class Vn extends ee{constructor(t){super(function(n,o){N.debug(`No callbacks on watchlist events for ${n}`)}),this.pusher=t,this.bindWatchlistInternalEvent()}handleEvent(t){t.data.events.forEach(n=>{this.emit(n.name,n)})}bindWatchlistInternalEvent(){this.pusher.connection.bind("message",t=>{"pusher_internal:watchlist_events"===t.event&&this.handleEvent(t)})}}var Wn=function Jn(){let i,t;return{promise:new Promise((o,l)=>{i=o,t=l}),resolve:i,reject:t}};class Kn extends ee{constructor(t){super(function(n,o){N.debug("No callbacks on user for "+n)}),this.signin_requested=!1,this.user_data=null,this.serverToUserChannel=null,this.signinDonePromise=null,this._signinDoneResolve=null,this._onAuthorize=(n,o)=>{if(n)return N.warn(`Error during signin: ${n}`),void this._cleanup();this.pusher.send_event("pusher:signin",{auth:o.auth,user_data:o.user_data})},this.pusher=t,this.pusher.connection.bind("state_change",({previous:n,current:o})=>{"connected"!==n&&"connected"===o&&this._signin(),"connected"===n&&"connected"!==o&&(this._cleanup(),this._newSigninPromiseIfNeeded())}),this.watchlist=new Vn(t),this.pusher.connection.bind("message",n=>{"pusher:signin_success"===n.event&&this._onSigninSuccess(n.data),this.serverToUserChannel&&this.serverToUserChannel.name===n.channel&&this.serverToUserChannel.handleEvent(n)})}signin(){this.signin_requested||(this.signin_requested=!0,this._signin())}_signin(){this.signin_requested&&(this._newSigninPromiseIfNeeded(),"connected"===this.pusher.connection.state&&this.pusher.config.userAuthenticator({socketId:this.pusher.connection.socket_id},this._onAuthorize))}_onSigninSuccess(t){try{this.user_data=JSON.parse(t.user_data)}catch{return N.error(`Failed parsing user data after signin: ${t.user_data}`),void this._cleanup()}if("string"!=typeof this.user_data.id||""===this.user_data.id)return N.error(`user_data doesn't contain an id. user_data: ${this.user_data}`),void this._cleanup();this._signinDoneResolve(),this._subscribeChannels()}_subscribeChannels(){this.serverToUserChannel=new Ce(`#server-to-user-${this.user_data.id}`,this.pusher),this.serverToUserChannel.bind_global((n,o)=>{0===n.indexOf("pusher_internal:")||0===n.indexOf("pusher:")||this.emit(n,o)}),(n=>{n.subscriptionPending&&n.subscriptionCancelled?n.reinstateSubscription():!n.subscriptionPending&&"connected"===this.pusher.connection.state&&n.subscribe()})(this.serverToUserChannel)}_cleanup(){this.user_data=null,this.serverToUserChannel&&(this.serverToUserChannel.unbind_all(),this.serverToUserChannel.disconnect(),this.serverToUserChannel=null),this.signin_requested&&this._signinDoneResolve()}_newSigninPromiseIfNeeded(){if(!this.signin_requested||this.signinDonePromise&&!this.signinDonePromise.done)return;const{promise:t,resolve:n}=Wn();t.done=!1;const l=()=>{t.done=!0};t.then(l).catch(l),this.signinDonePromise=t,this._signinDoneResolve=n}}class z{static ready(){z.isReady=!0;for(var t=0,n=z.instances.length;t<n;t++)z.instances[t].connect()}static getClientFeatures(){return $e(Ue({ws:S.Transports.ws},function(t){return t.isSupported({})}))}constructor(t,n){(function Qn(i){if(null==i)throw"You must pass your app key when you instantiate Pusher."})(t),function Ln(i){if(null==i)throw"You must pass an options object";if(null==i.cluster)throw"Options object must provide a cluster";"disableStats"in i&&N.warn("The disableStats option is deprecated in favor of enableStats")}(n),this.key=t,this.options=n,this.config=Wt(this.options,this),this.channels=A.createChannels(),this.global_emitter=new ee,this.sessionID=S.randomInt(1e9),this.timeline=new En(this.key,this.sessionID,{cluster:this.config.cluster,features:z.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:Ke.INFO,version:_.VERSION}),this.config.enableStats&&(this.timelineSender=A.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+S.TimelineTransport.name})),this.connection=A.createConnectionManager(this.key,{getStrategy:l=>S.getDefaultStrategy(this.config,l,In),timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:!!this.config.useTLS}),this.connection.bind("connected",()=>{this.subscribeAll(),this.timelineSender&&this.timelineSender.send(this.connection.isUsingTLS())}),this.connection.bind("message",l=>{var f=0===l.event.indexOf("pusher_internal:");if(l.channel){var y=this.channel(l.channel);y&&y.handleEvent(l)}f||this.global_emitter.emit(l.event,l.data)}),this.connection.bind("connecting",()=>{this.channels.disconnect()}),this.connection.bind("disconnected",()=>{this.channels.disconnect()}),this.connection.bind("error",l=>{N.warn(l)}),z.instances.push(this),this.timeline.info({instances:z.instances.length}),this.user=new Kn(this),z.isReady&&this.connect()}switchCluster(t){const{appKey:n,cluster:o}=t;this.key=n,this.options=Object.assign(Object.assign({},this.options),{cluster:o}),this.config=Wt(this.options,this),this.connection.switchCluster(this.key)}channel(t){return this.channels.find(t)}allChannels(){return this.channels.all()}connect(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var t=this.connection.isUsingTLS(),n=this.timelineSender;this.timelineSenderTimer=new it(6e4,function(){n.send(t)})}}disconnect(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)}bind(t,n,o){return this.global_emitter.bind(t,n,o),this}unbind(t,n,o){return this.global_emitter.unbind(t,n,o),this}bind_global(t){return this.global_emitter.bind_global(t),this}unbind_global(t){return this.global_emitter.unbind_global(t),this}unbind_all(t){return this.global_emitter.unbind_all(),this}subscribeAll(){var t;for(t in this.channels.channels)this.channels.channels.hasOwnProperty(t)&&this.subscribe(t)}subscribe(t){var n=this.channels.add(t,this);return n.subscriptionPending&&n.subscriptionCancelled?n.reinstateSubscription():!n.subscriptionPending&&"connected"===this.connection.state&&n.subscribe(),n}unsubscribe(t){var n=this.channels.find(t);n&&n.subscriptionPending?n.cancelSubscription():(n=this.channels.remove(t))&&n.subscribed&&n.unsubscribe()}send_event(t,n,o){return this.connection.send_event(t,n,o)}shouldUseTLS(){return this.config.useTLS}signin(){this.user.signin()}}z.instances=[],z.isReady=!1,z.logToConsole=!1,z.Runtime=S,z.ScriptReceivers=S.ScriptReceivers,z.DependenciesReceivers=S.DependenciesReceivers,z.auth_callbacks=S.auth_callbacks;var Ut=k.default=z;S.setup(z)}])}}]);