"use strict";(self.webpackChunkwahtermelon_client=self.webpackChunkwahtermelon_client||[]).push([[4623],{4623:($,h,s)=>{s.r(h),s.d(h,{MedCertComponent:()=>X});var c=s(177),r=s(9417),d=s(2517),g=s(60),_=s(5383),t=s(4438),m=s(3318),x=s(41),b=s(1410),v=s(345);const y=n=>({label:"Name",value:n}),C=n=>({label:"Age",value:n}),E=n=>({label:"Sex",value:n}),F=n=>({label:"Civil Status",value:n}),M=n=>({label:"Address",value:n}),P=n=>({label:"Occupation",value:n}),j=n=>({label:"Date of Consultation",value:n}),R=n=>({label:"Diagnosis",value:n}),k=n=>({label:"Remarks",value:n}),I=(n,l,e,o,i,a,p,u,f)=>[n,l,e,o,i,a,p,u,f];function D(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",10),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.exportP())}),t.nrm(1,"fa-icon",11),t.k0s()}if(2&n){const e=t.XpG(2);t.Y8G("disabled",e.show_form),t.R7$(),t.Y8G("icon",e.faFilePdf)}}function T(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",21)(1,"label",22),t.EFF(2,"Please specify"),t.k0s(),t.j41(3,"input",23),t.mxI("ngModelChange",function(i){t.eBV(e);const a=t.XpG(3);return t.DH7(a.otherPurpose,i)||(a.otherPurpose=i),t.Njj(i)}),t.k0s()()}if(2&n){const e=t.XpG(3);t.R7$(3),t.R50("ngModel",e.otherPurpose)}}function w(n,l){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"label",12),t.EFF(2,"Select Purpose"),t.k0s(),t.j41(3,"select",13),t.mxI("ngModelChange",function(i){t.eBV(e);const a=t.XpG(2);return t.DH7(a.selectedPurpose,i)||(a.selectedPurpose=i),t.Njj(i)}),t.j41(4,"option",14),t.EFF(5,"Select..."),t.k0s(),t.j41(6,"option",15),t.EFF(7,"Work"),t.k0s(),t.j41(8,"option",16),t.EFF(9,"School"),t.k0s(),t.j41(10,"option",17),t.EFF(11,"Travel"),t.k0s(),t.j41(12,"option",18),t.EFF(13,"Others"),t.k0s()(),t.DNE(14,T,4,1,"div",19),t.j41(15,"button",20),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.goToStep(2))}),t.EFF(16," Next "),t.k0s(),t.bVm()}if(2&n){const e=t.XpG(2);t.R7$(3),t.R50("ngModel",e.selectedPurpose),t.R7$(11),t.Y8G("ngIf","others"===e.selectedPurpose),t.R7$(),t.Y8G("disabled",!e.isPurposeValid())}}function O(n,l){if(1&n&&(t.j41(0,"div",27),t.nrm(1,"fa-icon",28),t.j41(2,"span"),t.EFF(3,"Loading certificate data..."),t.k0s()()),2&n){const e=t.XpG(3);t.R7$(),t.Y8G("icon",e.faSpinner)("spin",!0)}}function G(n,l){if(1&n&&t.nrm(0,"img",47),2&n){const e=t.XpG(4);t.Y8G("src",e.logoUrl,t.B4B)}}function U(n,l){if(1&n&&(t.qex(0),t.j41(1,"div",48)(2,"div",49),t.EFF(3),t.k0s(),t.j41(4,"div",50),t.EFF(5),t.k0s()(),t.bVm()),2&n){const e=l.$implicit;t.R7$(3),t.SpI("",e.label,":"),t.R7$(2),t.JRh(e.value)}}function N(n,l){if(1&n&&(t.qex(0),t.j41(1,"div",29)(2,"div",30),t.DNE(3,G,1,1,"img",31),t.j41(4,"div",32)(5,"h4",33),t.EFF(6),t.k0s(),t.j41(7,"h4",34),t.EFF(8),t.k0s(),t.j41(9,"h4",34),t.EFF(10),t.k0s()()(),t.j41(11,"h1",35),t.EFF(12,"MEDICAL CERTIFICATE"),t.k0s(),t.j41(13,"div",36),t.EFF(14),t.k0s(),t.j41(15,"p",37)(16,"span",38),t.EFF(17,"To Whom It May Concern"),t.k0s(),t.nrm(18,"br"),t.EFF(19," This is to certify that we have on record the following data from the patient's information, to wit: "),t.k0s(),t.j41(20,"div",39),t.DNE(21,U,6,2,"ng-container",26),t.k0s(),t.j41(22,"p",40),t.EFF(23," This document is issued upon the request of the patient for "),t.j41(24,"span",41),t.EFF(25),t.nI1(26,"lowercase"),t.k0s(),t.EFF(27," purposes only and is not intended for medico-legal use. "),t.k0s(),t.j41(28,"div",42)(29,"div")(30,"p",43),t.EFF(31),t.k0s(),t.j41(32,"p",44),t.EFF(33,"Attending Physician"),t.k0s(),t.j41(34,"p",44),t.EFF(35),t.k0s()()(),t.j41(36,"div",45)(37,"span"),t.EFF(38,"*This certificate was generated using the WAHtermelon EMR"),t.k0s(),t.nrm(39,"img",46),t.k0s()(),t.bVm()),2&n){const e=l.$implicit,o=t.XpG(3);t.R7$(3),t.Y8G("ngIf",o.logoUrl),t.R7$(3),t.JRh(null==e?null:e.facility_name),t.R7$(2),t.SpI(" ","Province Of NCR, All District"===(null==e?null:e.header_name)?"National Capital Region":null==e?null:e.header_name," "),t.R7$(2),t.SpI("Municipality of ",null==e?null:e.municipality_name,""),t.R7$(4),t.SpI("Date: ",o.dateNgayon,""),t.R7$(7),t.Y8G("ngForOf",t.zJS(29,I,[t.eq3(11,y,null==e?null:e.patient_name),t.eq3(13,C,null==e?null:e.age),t.eq3(15,E,null==e?null:e.gender),t.eq3(17,F,null==e?null:e.civil_status),t.eq3(19,M,null==e?null:e.address),t.eq3(21,P,null==e?null:e.occupation),t.eq3(23,j,null==e?null:e.consult_date),t.eq3(25,R,null==e||null==e.final_diagnosis[0]||null==e.final_diagnosis[0].lib_icd10?null:e.final_diagnosis[0].lib_icd10.icd10_desc),t.eq3(27,k,o.capitalizeFirst(null==e?null:e.treatment_plan))])),t.R7$(4),t.JRh(t.bMT(26,9,o.displayPurpose)),t.R7$(6),t.SpI("",null==e?null:e.physician,", MD"),t.R7$(4),t.SpI("License No. ",null==e?null:e.physician_prc,"")}}function A(n,l){if(1&n&&(t.qex(0),t.DNE(1,O,4,2,"div",24),t.j41(2,"div",25),t.DNE(3,N,40,39,"ng-container",26),t.k0s(),t.bVm()),2&n){const e=t.XpG(2);t.R7$(),t.Y8G("ngIf",e.show_form),t.R7$(2),t.Y8G("ngForOf",e.consult)}}function S(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3",4),t.EFF(4,"Medical Certificate"),t.k0s(),t.DNE(5,D,2,2,"button",5),t.k0s(),t.j41(6,"div",6),t.DNE(7,w,17,3,"ng-container",7)(8,A,4,2,"ng-container",7),t.k0s(),t.j41(9,"div",8)(10,"button",9),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.closeModal())}),t.EFF(11," Close "),t.k0s()()()()}if(2&n){const e=t.XpG();t.R7$(5),t.Y8G("ngIf",2===e.step),t.R7$(2),t.Y8G("ngIf",1===e.step),t.R7$(),t.Y8G("ngIf",2===e.step),t.R7$(2),t.Y8G("disabled",e.is_loading)}}let X=(()=>{class n{constructor(e,o,i,a,p,u,f){this.router=e,this.http=o,this.ageService=i,this.datePipe=a,this.exportAsService=p,this.sanitizer=u,this.route=f,this.faFilePdf=_.O_q,this.faFileExcel=_.fny,this.faSpinner=_.z1G,this.isModalOpen=!0,this.exportAsPdf={type:"pdf",elementIdOrContent:"pdf-content",options:{html2canvas:{useCORS:!0,allowTaint:!0,scrollX:!1,scrollY:!1},jsPDF:{orientation:"portrait",format:"a4",putOnlyUsedFonts:!0,precision:2,margin:[0,0,0,0]}}},this.pdf_exported=!1,this.selectedPurpose="",this.otherPurpose="",this.step=1,this.consult=[],this.loading=!0,this.show_form=!0,this.user={facility:{facility_name:""},municipality:{municipality_code:""}},this.logoUrl="",this.apiBase=this.http.baseUrl.replace("/api/v1/","")}closeModal(){this.router.navigate(["../"],{relativeTo:this.route})}getAge(){if(this.patient_info&&this.patient_info.birthdate){let e=this.ageService.calcuateAge(this.patient_info.birthdate);return this.patient_age=e,e.age+" "+e.type+(e.age>1?"s old":" old")}}todaysDate(){const o=this.datePipe.transform(new Date,"MM/dd/yyyy");this.dateNgayon=o}getTrailName(){let e="";return e=this.consult[0]?.file_patient_name+"_Medical Certificate",e}exportP(e){this.pdf_exported=!0,this.pdf_exported?this.exportAsService.save(this.exportAsPdf,this.getTrailName()).subscribe(()=>{this.printCount()}):setTimeout(()=>this.exportP(e),300)}printCount(){const e=this.consultation.consult_id;console.log(e,"consult id for print"),this.http.post(`consultation/print/${e}`,{}).subscribe({next:o=>{console.log("Print count updated:",o)},error:o=>{console.error("Error incrementing print count:",o)}})}goToStep(e){this.step=e}isPurposeValid(){return this.selectedPurpose&&("others"!==this.selectedPurpose||this.otherPurpose.trim().length>0)}get displayPurpose(){return"others"===this.selectedPurpose?this.otherPurpose:this.selectedPurpose}getConsultInfo(){this.http.get("consultation/med-cert",{params:this.consultation}).subscribe({next:o=>{this.consult=o.data,console.log("consult:",this.consult),this.show_form=!1},error:o=>{this.loading=!1,this.show_form=!1}})}capitalizeFirst(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():""}fetchFacilityLogo(){this.http.get("consultation/logo",{params:{facility_code:this.facility_code}}).subscribe({next:e=>{console.log("Logo response:",e),e.path&&(this.logoUrl=this.apiBase+"/logo-image/"+e.path.replace("/storage/logos/",""),console.log("Full logo URL:",this.logoUrl))},error:e=>{console.warn("No logo found:",e),this.logoUrl=""}})}ngOnInit(){let e=this.http.getUserFromJSON().facility;this.facility_code=e.code??e.facility.code,this.consultation=this.http.getUrlParams(),this.consultation.consult_id?.includes("/")&&(this.consultation.consult_id=this.consultation.consult_id.split("/")[0]),console.log(this.consultation,"consult id"),console.log(this.facility_code,"facility code"),this.todaysDate(),this.getConsultInfo(),this.fetchFacilityLogo()}static{this.\u0275fac=function(o){return new(o||n)(t.rXU(d.Ix),t.rXU(m.k),t.rXU(x.V),t.rXU(c.vh),t.rXU(b.a),t.rXU(v.up),t.rXU(d.nX))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-med-cert"]],features:[t.Jv_([c.vh])],decls:1,vars:1,consts:[["class","fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",4,"ngIf"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black","bg-opacity-50"],[1,"bg-white","rounded-lg","shadow-lg","w-full","max-w-[750px]","max-h-[90vh]","flex","flex-col"],[1,"sticky","top-0","flex","justify-between","items-center","px-6","py-4","bg-blue-500","rounded-t"],[1,"text-white","font-bold","text-lg"],["type","button","class","text-2xl mr-5 text-white disabled:text-gray-200",3,"disabled","click",4,"ngIf"],[1,"p-4","overflow-y-auto","flex-1"],[4,"ngIf"],[1,"flex","justify-end","py-4","px-5","space-x-4","rounded-b","border-t"],["type","button",1,"btn-save","px-5","bg-red-500","text-white","rounded","hover:bg-red-600",3,"click","disabled"],["type","button",1,"text-2xl","mr-5","text-white","disabled:text-gray-200",3,"click","disabled"],[3,"icon"],["for","purpose",1,"block","mb-2","font-semibold"],["id","purpose",1,"border","px-3","py-2","rounded","w-full",3,"ngModelChange","ngModel"],["value","","disabled",""],["value","work"],["value","school"],["value","travel"],["value","others"],["class","mt-4",4,"ngIf"],[1,"mt-4","bg-blue-600","text-white","px-4","py-2","rounded","hover:bg-blue-700","disabled:bg-gray-400",3,"click","disabled"],[1,"mt-4"],["for","otherPurpose",1,"block","mb-2","font-semibold"],["id","otherPurpose","type","text","placeholder","Enter purpose",1,"border","px-3","py-2","rounded","w-full",3,"ngModelChange","ngModel"],["class","flex justify-center py-4",4,"ngIf"],["id","pdf-content",1,"flex","flex-col","items-center","w-full","space-y-5","overflow-y-auto","flex-1"],[4,"ngFor","ngForOf"],[1,"flex","justify-center","py-4"],[1,"mr-2","text-blue-600","text-xl",3,"icon","spin"],[1,"scale-[0.75]","mt-4","origin-top","w-full","bg-white","px-2","py-5"],[1,"relative","mb-6"],["class","absolute left-0 top-0 w-auto h-32 max-h-40 object-contain",3,"src",4,"ngIf"],[1,"text-center"],[1,"font-semibold","text-lg"],[1,"text-base"],[1,"text-xl","text-center","font-semibold","my-2"],[1,"text-right","mb-4"],[1,"mb-4"],[1,"font-semibold","uppercase"],[1,"flex","flex-col","space-y-4","border-b","border-gray-300","pb-6"],[1,"mt-10"],[1,"font-semibold"],[1,"flex","justify-end","mt-16","text-right"],[1,"font-semibold","text-center"],[1,"text-sm","text-gray-700","text-center"],[1,"mt-10","pt-6","flex","items-center","justify-center","space-x-3","text-sm","italic","text-gray-700"],["src","./assets/img/wah_icon.png",1,"rounded-full","w-9","h-9"],[1,"absolute","left-0","top-0","w-auto","h-32","max-h-40","object-contain",3,"src"],[1,"flex","gap-4","items-start"],[1,"w-44","font-semibold"],[1,"flex-1","whitespace-pre-line"]],template:function(o,i){1&o&&t.DNE(0,S,12,4,"div",0),2&o&&t.Y8G("ngIf",i.isModalOpen)},dependencies:[c.MD,c.Sq,c.bT,c.GH,r.YN,r.xH,r.y7,r.me,r.wz,r.BC,r.vS,g.dX,g.aY],encapsulation:2})}}return n})()}}]);