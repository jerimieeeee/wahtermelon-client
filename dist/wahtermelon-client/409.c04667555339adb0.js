"use strict";(self.webpackChunkwahtermelon_client=self.webpackChunkwahtermelon_client||[]).push([[409],{9409:(st,y,s)=>{s.r(y),s.d(y,{LabModule:()=>p});var d=s(6895),C=s(2325),r=s(2687);let h;function M(i,o,e=!1){e&&h?h.unsubscribe():h=i.subscribe(()=>o())}var t=s(1571),x=s(4691),Z=s(6198),v=s(2216),T=s(7185),c=s(433);function w(i,o){if(1&i&&(t.TgZ(0,"option",27),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.code),t.xp6(1),t.Oqu(e.desc)}}function q(i,o){if(1&i&&(t.TgZ(0,"option",27),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.code),t.xp6(1),t.Oqu(e.desc)}}function F(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",19)(1,"label",20),t._uU(2),t.qZA(),t.TgZ(3,"select",22),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw(4);return t.KtG(a.lab_form.findings_code=n)}),t.YNc(4,q,2,2,"option",23),t.qZA()()}if(2&i){const e=t.oxw().$implicit,l=t.oxw(3);t.xp6(2),t.Oqu(e.field_desc),t.xp6(1),t.Q6J("ngModel",l.lab_form.findings_code),t.xp6(1),t.Q6J("ngForOf",l.lab_findings)}}function L(i,o){if(1&i&&(t.TgZ(0,"option",27),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.code),t.xp6(1),t.Oqu(e.desc)}}function J(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",19)(1,"label",20),t._uU(2),t.qZA(),t.TgZ(3,"select",22),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw(4);return t.KtG(a.lab_form.data_collection_code=n)}),t.YNc(4,L,2,2,"option",23),t.qZA()()}if(2&i){const e=t.oxw().$implicit,l=t.oxw(3);t.xp6(2),t.Oqu(e.field_desc),t.xp6(1),t.Q6J("ngModel",l.lab_form.data_collection_code),t.xp6(1),t.Q6J("ngForOf",l.lab_sputum_collection)}}function A(i,o){if(1&i&&(t.TgZ(0,"option",27),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.code),t.xp6(1),t.Oqu(e.desc)}}function Q(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",19)(1,"label",20),t._uU(2),t.qZA(),t.TgZ(3,"select",22),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw(4);return t.KtG(a.lab_form.findings_code=n)}),t.YNc(4,A,2,2,"option",23),t.qZA()()}if(2&i){const e=t.oxw().$implicit,l=t.oxw(3);t.xp6(2),t.Oqu(e.field_desc),t.xp6(1),t.Q6J("ngModel",l.lab_form.findings_code),t.xp6(1),t.Q6J("ngForOf",l.lab_cxray_findings)}}function N(i,o){if(1&i&&(t.TgZ(0,"option",27),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.code),t.xp6(1),t.Oqu(e.desc)}}function O(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",19)(1,"label",20),t._uU(2),t.qZA(),t.TgZ(3,"select",22),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw(4);return t.KtG(a.lab_form.observation_code=n)}),t.YNc(4,N,2,2,"option",23),t.qZA()()}if(2&i){const e=t.oxw().$implicit,l=t.oxw(3);t.xp6(2),t.Oqu(e.field_desc),t.xp6(1),t.Q6J("ngModel",l.lab_form.observation_code),t.xp6(1),t.Q6J("ngForOf",l.lab_cxray_observation)}}function k(i,o){if(1&i&&(t.TgZ(0,"option",27),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.code),t.xp6(1),t.Oqu(e.desc)}}function U(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",19)(1,"label",20),t._uU(2),t.qZA(),t.TgZ(3,"select",22),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw(4);return t.KtG(a.lab_form.findings_code=n)}),t.YNc(4,k,2,2,"option",23),t.qZA()()}if(2&i){const e=t.oxw().$implicit,l=t.oxw(3);t.xp6(2),t.Oqu(e.field_desc),t.xp6(1),t.Q6J("ngModel",l.lab_form.findings_code),t.xp6(1),t.Q6J("ngForOf",l.lab_findings)}}function Y(i,o){if(1&i&&(t.TgZ(0,"option",27),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.code),t.xp6(1),t.Oqu(e.desc)}}function I(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",19)(1,"label",20),t._uU(2),t.qZA(),t.TgZ(3,"select",22),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw(4);return t.KtG(a.lab_form.findings_code=n)}),t.YNc(4,Y,2,2,"option",23),t.qZA()()}if(2&i){const e=t.oxw().$implicit,l=t.oxw(3);t.xp6(2),t.Oqu(e.field_desc),t.xp6(1),t.Q6J("ngModel",l.lab_form.findings_code),t.xp6(1),t.Q6J("ngForOf",l.lab_result_pn)}}function $(i,o){if(1&i&&(t.TgZ(0,"option",27),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.code),t.xp6(1),t.Oqu(e.desc)}}function D(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",19)(1,"label",20),t._uU(2),t.qZA(),t.TgZ(3,"select",22),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw(4);return t.KtG(a.lab_form.blood_code=n)}),t.YNc(4,$,2,2,"option",23),t.qZA()()}if(2&i){const e=t.oxw().$implicit,l=t.oxw(3);t.xp6(2),t.Oqu(e.field_desc),t.xp6(1),t.Q6J("ngModel",l.lab_form.blood_code),t.xp6(1),t.Q6J("ngForOf",l.lab_stool_blood)}}function E(i,o){if(1&i&&(t.TgZ(0,"option",27),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.code),t.xp6(1),t.Oqu(e.desc)}}function S(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",19)(1,"label",20),t._uU(2),t.qZA(),t.TgZ(3,"select",22),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw(4);return t.KtG(a.lab_form.color_code=n)}),t.YNc(4,E,2,2,"option",23),t.qZA()()}if(2&i){const e=t.oxw().$implicit,l=t.oxw(3);t.xp6(2),t.Oqu(e.field_desc),t.xp6(1),t.Q6J("ngModel",l.lab_form.color_code),t.xp6(1),t.Q6J("ngForOf",l.lab_stool_color)}}function R(i,o){if(1&i&&(t.TgZ(0,"option",27),t._uU(1),t.qZA()),2&i){const e=o.$implicit;t.Q6J("value",e.code),t.xp6(1),t.Oqu(e.desc)}}function G(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",19)(1,"label",20),t._uU(2),t.qZA(),t.TgZ(3,"select",22),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw(4);return t.KtG(a.lab_form.consistency_code=n)}),t.YNc(4,R,2,2,"option",23),t.qZA()()}if(2&i){const e=t.oxw().$implicit,l=t.oxw(3);t.xp6(2),t.Oqu(e.field_desc),t.xp6(1),t.Q6J("ngModel",l.lab_form.consistency_code),t.xp6(1),t.Q6J("ngForOf",l.lab_stool_consistency)}}function K(i,o){if(1&i&&(t.TgZ(0,"span",31),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).$implicit;t.xp6(1),t.AsE("Normal values(Min: ",e.nv_min," to Max: ",e.nv_max,")")}}function H(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",19)(1,"label",20),t._uU(2),t.qZA(),t.TgZ(3,"input",29),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw().$implicit,_=t.oxw(3);return t.KtG(_.lab_form[a.field_name]=n)}),t.qZA(),t.YNc(4,K,2,2,"span",30),t.qZA()}if(2&i){const e=t.oxw().$implicit,l=t.oxw(3);t.xp6(2),t.Oqu(e.field_desc),t.xp6(1),t.Q6J("ngModel",l.lab_form[e.field_name])("type",null!==e.nv_min?"number":"text"),t.xp6(1),t.Q6J("ngIf",null!==e.nv_min)}}function j(i,o){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,F,5,3,"div",28),t.YNc(2,J,5,3,"div",28),t.YNc(3,Q,5,3,"div",28),t.YNc(4,O,5,3,"div",28),t.YNc(5,U,5,3,"div",28),t.YNc(6,I,5,3,"div",28),t.YNc(7,D,5,3,"div",28),t.YNc(8,S,5,3,"div",28),t.YNc(9,G,5,3,"div",28),t.YNc(10,H,5,4,"div",28),t.qZA()),2&i){const e=o.$implicit,l=t.oxw(3);t.xp6(1),t.Q6J("ngIf","SPTM"===l.selected_lab.laboratory.code&&"findings_code"===e.field_name),t.xp6(1),t.Q6J("ngIf","SPTM"===l.selected_lab.laboratory.code&&"data_collection_code"===e.field_name),t.xp6(1),t.Q6J("ngIf","CXRAY"===l.selected_lab.laboratory.code&&"findings_code"===e.field_name),t.xp6(1),t.Q6J("ngIf","CXRAY"===l.selected_lab.laboratory.code&&"observation_code"===e.field_name),t.xp6(1),t.Q6J("ngIf","ECG"===l.selected_lab.laboratory.code&&"findings_code"===e.field_name),t.xp6(1),t.Q6J("ngIf",l.form_with_findings_pn.includes(l.selected_lab.laboratory.code)&&"findings_code"===e.field_name),t.xp6(1),t.Q6J("ngIf","FCAL"===l.selected_lab.laboratory.code&&"blood_code"===e.field_name),t.xp6(1),t.Q6J("ngIf","FCAL"===l.selected_lab.laboratory.code&&"color_code"===e.field_name),t.xp6(1),t.Q6J("ngIf","FCAL"===l.selected_lab.laboratory.code&&"consistency_code"===e.field_name),t.xp6(1),t.Q6J("ngIf",l.spl_val.indexOf(e.field_name)<0)}}function z(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",18)(1,"div",19)(2,"label",20),t._uU(3,"Laboratory date"),t.qZA(),t.TgZ(4,"input",21),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw(2);return t.KtG(a.lab_form.laboratory_date=n)}),t.qZA()(),t.TgZ(5,"div",19)(6,"label",20),t._uU(7,"Laboratory status"),t.qZA(),t.TgZ(8,"select",22),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw(2);return t.KtG(a.lab_form.lab_status_code=n)}),t.YNc(9,w,2,2,"option",23),t.qZA()(),t.YNc(10,j,11,10,"div",24),t.TgZ(11,"div",25)(12,"div",19)(13,"label",20),t._uU(14,"Remarks"),t.qZA(),t.TgZ(15,"input",26),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw(2);return t.KtG(a.lab_form.remarks=n)}),t.qZA()()()()}if(2&i){const e=t.oxw(2);t.xp6(4),t.Q6J("ngModel",e.lab_form.laboratory_date)("max",e.max_date),t.xp6(4),t.Q6J("ngModel",e.lab_form.lab_status_code),t.xp6(1),t.Q6J("ngForOf",e.lab_statuses),t.xp6(1),t.Q6J("ngForOf",e.fields),t.xp6(5),t.Q6J("ngModel",e.lab_form.remarks)}}const B=function(){return{standalone:!0}};function P(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",13)(1,"div",14)(2,"input",15),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.request_status_code=n)}),t.qZA(),t.TgZ(3,"label",16),t._uU(4,"Patient has refused lab service"),t.qZA()(),t.YNc(5,z,16,6,"div",17),t.qZA()}if(2&i){const e=t.oxw();t.xp6(2),t.Q6J("ngModel",e.request_status_code)("ngModelOptions",t.DdM(3,B)),t.xp6(3),t.Q6J("ngIf",!e.request_status_code)}}class g{loadForm(){this.selected_lab&&this.http.get("libraries/laboratories/"+this.selected_lab.laboratory.code).subscribe({next:o=>{this.trimForm(o.data.category)},error:o=>console.log(o)})}trimForm(o){let e=new Date(this.patient_details.birthdate),a=(new Date(this.selected_lab.request_date)-e)/864e5<=28?"NB":this.patient_details.gender,_=[];Object.entries(o).forEach(([_t,at],dt)=>{let f=at;f.range_cat?a===f.range_cat&&(_.push(f),this.lab_form[f.field_name]=null):(_.push(f),this.lab_form[f.field_name]=null)}),this.fields=_,this.request_status_code="RF"===this.selected_lab.request_status_code,this.selected_lab.result&&this.fillCodes(this.selected_lab),this.show_form=!0}fillCodes(o){switch(console.log(this.selected_lab),console.log(this.request_status_code),this.lab_form=this.selected_lab.result,o.laboratory.code){case"CXRAY":this.lab_form.findings_code=this.lab_form.findings?this.lab_form.findings.code:null,this.lab_form.observation_code=this.lab_form.observation?this.lab_form.observation.code:null;break;case"ECG":case"FOBT":case"PPD":this.lab_form.findings_code=this.lab_form.findings?this.lab_form.findings.code:null;break;case"SPTM":this.lab_form.findings_code=this.lab_form.findings?this.lab_form.findings.code:null,this.lab_form.data_collection_code=this.lab_form.data_collection?this.lab_form.data_collection.code:null;break;case"FCAL":this.lab_form.blood_code=this.lab_form.blood?this.lab_form.blood.code:null,this.lab_form.color_code=this.lab_form.color?this.lab_form.color.code:null,this.lab_form.consistency_code=this.lab_form.consistency?this.lab_form.consistency.code:null}}onSubmit(){if(console.log(this.selected_lab),this.is_saving=!0,this.request_status_code)this.updateLabReq("RF");else{let o=this.http.getURL(this.selected_lab.laboratory.code);if(o||null!==o||""!==o){let e;this.lab_form.request_id?e=this.http.update(o+"/",this.lab_form.id,this.lab_form):(this.lab_form.patient_id=this.selected_lab.patient_id,this.lab_form.request_id=this.selected_lab.id,this.selected_lab.consult_id&&(this.lab_form.consult_id=this.selected_lab.consult_id),e=this.http.post(o,this.lab_form)),e.subscribe({next:l=>{console.log(l),"RF"===this.selected_lab.request_status_code?this.updateLabReq("RQ"):(this.toastr.success("Lab result was recorded!","Laboratory Result"),this.closeModal())},error:l=>console.log(l)})}else this.is_saving=!1,this.toastr.error("Laboratory does not exist","Lab form")}}updateLabReq(o){this.http.update("laboratory/consult-laboratories/",this.selected_lab.id,{lab_code:this.selected_lab.laboratory.code,patient_id:this.selected_lab.patient_id,recommendation_code:this.selected_lab.recommendation_code,request_date:this.selected_lab.request_date,request_status_code:o}).subscribe({next:()=>{this.toastr.success("Lab record was updated!","Lab Record"),this.closeModal()},error:l=>console.log(l)})}closeModal(){this.is_saving=!1,this.toggleModal.emit("add")}cancelThisModal(){this.cancelModal.emit("add")}constructor(o,e){this.http=o,this.toastr=e,this.toggleModal=new t.vpe,this.cancelModal=new t.vpe,this.faSave=r.r6l,this.faSpinner=r.LM3,this.is_saving=!1,this.show_form=!1,this.lab_form={},this.max_date=(0,d.p6)(new Date,"yyyy-MM-dd","en"),this.spl_val=["observation_code","findings_code","data_collection_code","blood_code","color_code","consistency_code"],this.form_with_findings_pn=["FOBT","PPD"],this.form_with_finding_code=["ECG"]}ngOnInit(){}ngOnChanges(o){this.loadForm()}}g.\u0275fac=function(o){return new(o||g)(t.Y36(x.O),t.Y36(T._W))},g.\u0275cmp=t.Xpm({type:g,selectors:[["app-lab-form"]],inputs:{selected_lab:"selected_lab",patient_details:"patient_details",lab_statuses:"lab_statuses",lab_cxray_findings:"lab_cxray_findings",lab_cxray_observation:"lab_cxray_observation",lab_findings:"lab_findings",lab_sputum_collection:"lab_sputum_collection",lab_result_pn:"lab_result_pn",lab_stool_blood:"lab_stool_blood",lab_stool_color:"lab_stool_color",lab_stool_consistency:"lab_stool_consistency"},outputs:{toggleModal:"toggleModal",cancelModal:"cancelModal"},features:[t.TTD],decls:16,vars:7,consts:[["id","defaultModal","tabindex","-1","aria-modal","true","role","dialog",1,"overflow-y-auto","overflow-x-hidden","fixed","top-0","right-0","left-0","w-full","md:inset-0","h-modal","md:h-full","justify-center","items-center","flex",2,"z-index","60"],[1,"relative","p-4","w-full","max-w-4xl","h-auto","md:h-auto"],[1,"relative","bg-white","rounded-lg","shadow","dark:bg-gray-700"],[1,"flex","justify-between","items-start","py-3","px-5","rounded-t","border-b","bg-blue-500","dark:border-gray-600"],[1,"mt-2","text-sm","font-bold","text-white","dark:text-white"],[1,"h-96","overflow-y-auto"],[1,"flex","item-start","flex-wrap","pb-5"],["class","grid grid-cols-2 px-3 py-3 w-full mx-5 mt-5 rounded-lg",4,"ngIf"],[1,"flex","justify-end","pb-5","px-5","space-x-4","rounded-b","my-5"],["type","button",1,"btn-save","bg-gray-400","px-10",3,"disabled","click"],["type","button",1,"btn-save","px-10","disabled:bg-gray-300",3,"disabled","click"],[1,"mr-2",3,"icon","spin"],[1,"opacity-50","fixed","inset-0","z-50","bg-black"],[1,"grid","grid-cols-2","px-3","py-3","w-full","mx-5","mt-5","rounded-lg"],[1,"col-span-2","flex","mb-3","justify-center"],["type","checkbox","name","request_status_code",1,"w-6","h-6","input",3,"ngModel","ngModelOptions","ngModelChange"],["for","request_status_code",1,"ml-3","mt-1"],["class","col-span-2 grid grid-cols-2 gap-5",4,"ngIf"],[1,"col-span-2","grid","grid-cols-2","gap-5"],[1,"text-sm","col-span-1"],[1,"font-semibold"],["name","field","type","date","placeholder","mm/dd/yyyy",1,"input",3,"ngModel","max","ngModelChange"],["name","field",1,"input",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"col-span-2"],["name","field","type","text",1,"input",3,"ngModel","ngModelChange"],[3,"value"],["class","text-sm col-span-1",4,"ngIf"],["name","field",1,"input",3,"ngModel","type","ngModelChange"],["class","italic text-xs text-gray-500",4,"ngIf"],[1,"italic","text-xs","text-gray-500"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),t._uU(5),t.qZA()(),t.TgZ(6,"div",5)(7,"div",6),t.YNc(8,P,6,4,"div",7),t.qZA()(),t.TgZ(9,"div",8)(10,"button",9),t.NdJ("click",function(){return e.cancelThisModal()}),t._uU(11,"Cancel"),t.qZA(),t.TgZ(12,"button",10),t.NdJ("click",function(){return e.onSubmit()}),t._UZ(13,"fa-icon",11),t._uU(14),t.qZA()()()()(),t._UZ(15,"div",12)),2&o&&(t.xp6(5),t.hij(" ",e.selected_lab.laboratory.desc," "),t.xp6(3),t.Q6J("ngIf",e.show_form),t.xp6(2),t.Q6J("disabled",e.is_saving),t.xp6(2),t.Q6J("disabled",e.is_saving||!e.request_status_code&&(!e.lab_form.laboratory_date||!e.lab_form.lab_status_code)),t.xp6(1),t.Q6J("icon",e.is_saving?e.faSpinner:e.faSave)("spin",e.is_saving),t.xp6(1),t.hij(" ",e.is_saving?"Saving":"Save"," "))},dependencies:[d.sg,d.O5,v.BN,c.YN,c.Kr,c.Fj,c.Wl,c.EJ,c.JJ,c.On]});class m{onSubmit(){this.is_saving=!0,this.http.delete("url",this.selected_lab.id).subscribe({next:o=>{console.log(o),this.is_saving=!1,this.toastr.info("Lab request was deleted!","Laboratory Request"),this.closeModal()},error:o=>console.log(o)})}closeModal(){this.toggleModal.emit("delete")}constructor(o,e){this.http=o,this.toastr=e,this.toggleModal=new t.vpe,this.is_saving=!1}}function X(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"fa-icon",19),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,a=t.oxw(2);return t.KtG(a.toggleModal("add",n))}),t.qZA()}if(2&i){const e=t.oxw(3);t.Q6J("icon",e.faFlask)}}function W(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"fa-icon",20),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,a=t.oxw(2);return t.KtG(a.toggleModal("add",n))}),t.qZA()}if(2&i){const e=t.oxw(3);t.Q6J("icon",e.faFlask)}}function V(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"fa-icon",21),t.NdJ("click",function(){t.CHM(e);const n=t.oxw().$implicit,a=t.oxw(2);return t.KtG(a.toggleModal("add",n))}),t.qZA()}if(2&i){const e=t.oxw(3);t.Q6J("icon",e.faFlask)}}function tt(i,o){if(1&i&&(t.TgZ(0,"tr",12)(1,"td",13),t._uU(2),t.qZA(),t.TgZ(3,"th",14),t._uU(4),t.ALo(5,"date"),t.qZA(),t.TgZ(6,"td",15),t.YNc(7,X,1,1,"fa-icon",16),t.YNc(8,W,1,1,"fa-icon",17),t.YNc(9,V,1,1,"fa-icon",18),t.qZA()()),2&i){const e=o.$implicit;t.xp6(2),t.hij(" ",e.laboratory.desc," "),t.xp6(2),t.hij(" ",t.xi3(5,5,e.request_date,"MM/dd/yyyy")," "),t.xp6(3),t.Q6J("ngIf",e.result&&"RF"!==e.request_status_code),t.xp6(1),t.Q6J("ngIf",!e.result&&"RF"!==e.request_status_code),t.xp6(1),t.Q6J("ngIf","RF"===e.request_status_code)}}function et(i,o){if(1&i&&(t.TgZ(0,"div",4)(1,"div",5),t._uU(2," Laboratories"),t.qZA(),t.TgZ(3,"div",6)(4,"table",7)(5,"thead",8)(6,"tr")(7,"th",9),t._uU(8,"Lab type"),t.qZA(),t.TgZ(9,"th",9),t._uU(10,"Date requested"),t.qZA(),t.TgZ(11,"th",10),t._uU(12,"Action"),t.qZA()()(),t.TgZ(13,"tbody"),t.YNc(14,tt,10,8,"tr",11),t.qZA()()()()),2&i){const e=t.oxw();t.xp6(14),t.Q6J("ngForOf",e.pending_list)}}function ot(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"app-lab-form",22),t.NdJ("toggleModal",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.toggleModal(n))})("cancelModal",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.cancelModal(n))}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("selected_lab",e.selected_lab)("patient_details",e.patient_details)("lab_statuses",e.lab_statuses)("lab_cxray_observation",e.lab_cxray_observation)("lab_cxray_findings",e.lab_cxray_findings)("lab_findings",e.lab_findings)("lab_result_pn",e.lab_result_pn)("lab_sputum_collection",e.lab_sputum_collection)("lab_stool_blood",e.lab_stool_blood)("lab_stool_color",e.lab_stool_color)("lab_stool_consistency",e.lab_stool_consistency)}}function it(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"app-lab-delete",23),t.NdJ("toggleModal",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.toggleModal(n))}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("selected_lab",e.selected_lab)}}m.\u0275fac=function(o){return new(o||m)(t.Y36(x.O),t.Y36(T._W))},m.\u0275cmp=t.Xpm({type:m,selectors:[["app-lab-delete"]],inputs:{selected_lab:"selected_lab"},outputs:{toggleModal:"toggleModal"},decls:20,vars:5,consts:[["id","defaultModal","tabindex","-1","aria-modal","true","role","dialog",1,"overflow-y-auto","overflow-x-hidden","fixed","top-0","right-0","left-0","w-full","md:inset-0","h-modal","md:h-full","justify-center","items-center","flex",2,"z-index","60"],[1,"relative","p-4","w-full","max-w-xl","h-auto","md:h-auto"],[1,"relative","bg-white","rounded-lg","shadow","dark:bg-gray-700"],[1,"flex","justify-between","items-start","py-3","px-5","rounded-t","border-b","bg-rose-500","dark:border-gray-600"],[1,"mt-2","text-sm","font-bold","text-white","dark:text-white"],[1,"h-40"],[1,"flex","item-start","flex-wrap","pb-5"],[1,"grid","grid-cols-3","px-3","py-3","mt-10","mx-10","w-full","rounded-lg","text-center"],[1,"col-span-3","text-left","mb-2","pb-2","border-b","border-slate-200","font-semibold","text-lg"],[1,"col-span-3","text-left","mb-2","pb-2","text-sm"],[1,"flex","justify-end","py-2","px-5","space-x-4","rounded-b"],["type","button",1,"btn-save","bg-gray-400","px-10",3,"click"],["type","button",1,"btn-save","px-10",3,"click"],[1,"opacity-50","fixed","inset-0","z-50","bg-black"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),t._uU(5," Delete "),t.qZA()(),t.TgZ(6,"div",5)(7,"div",6)(8,"div",7)(9,"div",8),t._uU(10," Do you really want to delete this lab? "),t.qZA(),t.TgZ(11,"div",9),t._uU(12),t.ALo(13,"date"),t.qZA()()()(),t.TgZ(14,"div",10)(15,"button",11),t.NdJ("click",function(){return e.closeModal()}),t._uU(16,"Cancel"),t.qZA(),t.TgZ(17,"button",12),t.NdJ("click",function(){return e.onSubmit()}),t._uU(18," Delete "),t.qZA()()()()(),t._UZ(19,"div",13)),2&o&&(t.xp6(12),t.AsE(" ",e.selected_lab.type," : ",t.xi3(13,2,e.selected_lab.date_requested,"MM/dd/yyyy")," "))},dependencies:[d.uU]});class u{loadData(){console.log("loaded labs"),this.http.get("laboratory/consult-laboratories",{params:{patient_id:this.patient_details.id,sort:"-request_date",include:"laboratory"}}).subscribe({next:e=>{this.pending_list=e.data,console.log(this.pending_list),this.pending_list.length>=1?this.getResults():this.show_form=!0},error:e=>console.log(e)})}getResults(){console.log("labs loaded"),Object.entries(this.pending_list).forEach(([o,e],l)=>{let n=e,a=this.http.getURL(n.laboratory.code);""!==a&&this.http.get(a,{params:{request_id:n.id}}).subscribe({next:_=>{this.pending_list[o].result=_.data[0],Object.keys(this.pending_list).length-1===l&&(this.show_form=!0)},error:_=>console.log(_)}),Object.keys(this.pending_list).length-1===l&&(this.show_form=!0)})}reloadLabs(o){this.show_form=!1,this.pending_list=o,this.getResults()}cancelModal(o){this.modal[o]=!this.modal[o]}toggleModal(o,e){this.selected_lab=e,this.selected_lab?(e&&"CXRAY"===e.laboratory.code?this.lab_cxray_findings&&this.lab_cxray_observation?this.modal[o]=!this.modal[o]:this.loadCxrayLib(o):e&&"ECG"===e.laboratory.code?this.lab_findings?this.modal[o]=!this.modal[o]:this.loadLibraries("libraries/laboratory-findings","lab_findings",o):e&&"SPTM"===e.laboratory.code?this.lab_sputum_collection||this.lab_result_pn?this.modal[o]=!this.modal[o]:this.loadSputumCollection(o):e&&"FCAL"===e.laboratory.code?this.lab_stool_blood||this.lab_stool_color||this.lab_stool_consistency?this.modal[o]=!this.modal[o]:this.loadStoolBlood(o):e&&this.forms_with_finding_pn.includes(e.laboratory.code)?this.lab_result_pn?this.modal[o]=!this.modal[o]:this.loadLibraries("libraries/laboratory-results","lab_result_pn",o):this.modal[o]=!this.modal[o],!1===this.modal[o]&&this.loadData()):(this.modal[o]=!1,this.loadData())}loadSputumCollection(o){this.http.get("libraries/laboratory-sputum-collection").subscribe({next:e=>{this.lab_sputum_collection=e.data,this.loadLibraries("libraries/laboratory-findings","lab_findings",o)},error:e=>console.log(e)})}loadStoolBlood(o){this.http.get("libraries/laboratory-blood-stool").subscribe({next:e=>{console.log(e),this.lab_stool_blood=e.data,this.loadStoolColor(o)}})}loadStoolColor(o){this.http.get("libraries/laboratory-stool-color").subscribe({next:e=>{this.lab_stool_color=e.data,this.loadStoolConsistency(o)}})}loadStoolConsistency(o){this.http.get("libraries/laboratory-stool-consistency").subscribe({next:e=>{this.lab_stool_consistency=e.data,this.modal[o]=!this.modal[o]}})}loadLabStatusLib(){this.http.get("libraries/laboratory-statuses").subscribe({next:o=>this.lab_statuses=o.data,error:o=>console.log(o)})}loadCxrayLib(o){this.http.get("libraries/laboratory-chestxray-findings").subscribe({next:e=>{this.lab_cxray_findings=e.data,this.loadCxrayObs(o)},error:e=>console.log(e)})}loadCxrayObs(o){this.http.get("libraries/laboratory-chestxray-observations").subscribe({next:e=>{this.lab_cxray_observation=e.data,this.modal[o]=!this.modal[o]},error:e=>console.log(e)})}loadLibraries(o,e,l){this.http.get(o).subscribe({next:n=>{this[e]=n.data,this.modal[l]=!this.modal[l]},error:n=>console.log(n)})}constructor(o,e){this.http=o,this.patientInfo=e,this.faFlaskVial=r.YKN,this.faTrash=r.$aW,this.faEdit=r.Xcf,this.faXmark=r.g82,this.faFlask=r.jZZ,this.show_form=!1,this.modal=[],this.forms_with_finding_pn=["FOBT","PPD"],this.loadData=this.loadData.bind(this),M(e.reloadLabs,this.loadData)}ngOnInit(){this.loadLabStatusLib(),this.patient_details=this.http.getPatientInfo(),this.loadData()}ngOnDestroy(){M(this.patientInfo.reloadNCDVitals,this.loadData,!0)}}u.\u0275fac=function(o){return new(o||u)(t.Y36(x.O),t.Y36(Z.M))},u.\u0275cmp=t.Xpm({type:u,selectors:[["app-lab"]],decls:4,vars:3,consts:[[1,"block","shadow","p-4","mt-4","rounded-xl","text-gray-600","border","border-slate-100"],["class","border border-slate-200 shadow-md rounded-xl",4,"ngIf"],[3,"selected_lab","patient_details","lab_statuses","lab_cxray_observation","lab_cxray_findings","lab_findings","lab_result_pn","lab_sputum_collection","lab_stool_blood","lab_stool_color","lab_stool_consistency","toggleModal","cancelModal",4,"ngIf"],[3,"selected_lab","toggleModal",4,"ngIf"],[1,"border","border-slate-200","shadow-md","rounded-xl"],[1,"w-full","bg-blue-500","text-white","rounded-t-xl","p-3","font-semibold"],[1,"w-full","p-5"],[1,"w-full","text-sm","text-left","text-gray-500","dark:text-gray-400"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50","dark:bg-gray-700","dark:text-gray-400"],["scope","col",1,"py-3","px-6"],["scope","col",1,"py-3","px-6","text-center"],["class","bg-white border-b last:border-0",4,"ngFor","ngForOf"],[1,"bg-white","border-b","last:border-0"],[1,"w-1/3","py-4","px-6"],["scope","row",1,"w-1/3","py-4","px-6","font-medium","text-gray-900","whitespace-nowrap"],[1,"w-1/3","py-4","px-6","text-center"],["size","lg","class","mx-0 my-0 text-green-500 hover:cursor-pointer flex-none mr-2",3,"icon","click",4,"ngIf"],["size","lg","class","mx-0 my-0 text-orange-500 hover:cursor-pointer flex-none mr-2",3,"icon","click",4,"ngIf"],["size","lg","class","mx-0 my-0 text-red-700 hover:cursor-pointer flex-none mr-2",3,"icon","click",4,"ngIf"],["size","lg",1,"mx-0","my-0","text-green-500","hover:cursor-pointer","flex-none","mr-2",3,"icon","click"],["size","lg",1,"mx-0","my-0","text-orange-500","hover:cursor-pointer","flex-none","mr-2",3,"icon","click"],["size","lg",1,"mx-0","my-0","text-red-700","hover:cursor-pointer","flex-none","mr-2",3,"icon","click"],[3,"selected_lab","patient_details","lab_statuses","lab_cxray_observation","lab_cxray_findings","lab_findings","lab_result_pn","lab_sputum_collection","lab_stool_blood","lab_stool_color","lab_stool_consistency","toggleModal","cancelModal"],[3,"selected_lab","toggleModal"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0),t.YNc(1,et,15,1,"div",1),t.qZA(),t.YNc(2,ot,1,11,"app-lab-form",2),t.YNc(3,it,1,1,"app-lab-delete",3)),2&o&&(t.xp6(1),t.Q6J("ngIf",e.show_form),t.xp6(1),t.Q6J("ngIf",e.modal.add),t.xp6(1),t.Q6J("ngIf",e.modal.delete))},dependencies:[d.sg,d.O5,v.BN,g,m,d.uU]});const lt=[{path:"",component:u}];class b{}b.\u0275fac=function(o){return new(o||b)},b.\u0275mod=t.oAB({type:b}),b.\u0275inj=t.cJS({imports:[C.Bz.forChild(lt),C.Bz]});var nt=s(9366);class p{}p.\u0275fac=function(o){return new(o||p)},p.\u0275mod=t.oAB({type:p}),p.\u0275inj=t.cJS({imports:[d.ez,b,nt.q,v.uH,c.u5]})}}]);