<div class="flex" *ngIf="show_form">
  <nav class="mt-4 flex flex-row border-b border-slate-300 text-xs">
    <button (click)="switchPage(1)" class="tabs-main w-36"
      [class]="pages===1? 'tabs-main-true rounded-t-md' : 'tabs-main-false' ">
      VISIT HISTORY
    </button>
    <button (click)="switchPage(2)" class="tabs-main w-36"
      [class]="pages===2? 'tabs-main-true rounded-t-md' : 'tabs-main-false' ">
      FP VISIT
    </button>
    <button (click)="switchPage(3)" class="tabs-main w-36"
      [class]="pages===3? 'tabs-main-true rounded-t-md' : 'tabs-main-false' ">
      ECLAIMS
    </button>
  </nav>
  <div class="ml-auto">
    <button type="button" *ngIf="this.consult_details[0]?.consult_done === false" class="btn-end-visit ml-auto mt-5" (click)="toggleModal('end_visit')">
      <fa-icon class="mr-1" [icon]="faDoorClosed"></fa-icon>
      End Visit
    </button>
  </div>
</div>

<nav *ngIf="pages===2" class="mt-2 flex justify-between border-b border-slate-300 text-xs">
  <div class="flex flex-row">
    <button (click)="switchTab(1)" class="tabs-main w-28"
        [class]="module===1? 'tabs-main-true' : 'tabs-main-false' ">
        FIRST VISIT
    </button>
    <button (click)="switchTab(2)" class="tabs-main w-28" *ngIf="fp_visit_history[0]?.id"
        [class]="module===2? 'tabs-main-true' : 'tabs-main-false' ">
        FP HX
    </button>
    <!-- <button (click)="switchTab(3)" *ngIf="selected_tb_consult?.id" class="tabs-main w-28"
        [class]="module===3? 'tabs-main-true' : 'tabs-main-false' ">
        OBSTETRICAL HX
    </button> -->
    <button (click)="switchTab(4)" class="tabs-main w-28" *ngIf="fp_visit_history[0]?.id"
        [class]="module===4? 'tabs-main-true' : 'tabs-main-false' ">
        FP PE
    </button>
    <button (click)="switchTab(5)" class="tabs-main w-28" *ngIf="fp_visit_history[0]?.id"
        [class]="module===5? 'tabs-main-true' : 'tabs-main-false' ">
        PELVIC EXAM
    </button>
    <button (click)="switchTab(6)" class="tabs-main w-28" *ngIf="fp_visit_history[0]?.id"
        [class]="module===6? 'tabs-main-true' : 'tabs-main-false' ">
        METHODS
    </button>
    <button (click)="switchTab(7)" class="tabs-main w-28" *ngIf="fp_visit_history[0]?.id"
        [class]="module===7? 'tabs-main-true' : 'tabs-main-false' ">
        FP CHART
    </button>
    <button (click)="switchTab(8)" *ngIf="selected_tb_consult?.id" class="tabs-main w-28"
        [class]="module===8? 'tabs-main-true' : 'tabs-main-false' ">
        CASE RATE
    </button>
  </div>
</nav>

<div class="my-5 w-full border border-gray-200 shadow-md rounded-xl" *ngIf="pages === 1">
  <div class="flex flex-col" *ngIf="fetching_history">
    <div class="w-full flex justify-center"><fa-icon [icon]="faCircleNotch" spin="true" class="pt-10"></fa-icon></div>
    <div class="w-full flex justify-center pb-10 font-semibold">Fetching history...</div>
  </div>
  <table class="w-full text-sm text-left" *ngIf="!fetching_history">
    <thead class="text-xs text-white uppercase bg-blue-500">
      <tr>
        <th scope="col" class="py-3 px-6">Visit Date</th>
        <th scope="col" class="py-3 px-6">Current Method</th>
        <th scope="col" class="py-3 px-6">Client Type</th>
        <th scope="col" class="py-3 px-6">Action</th>
      </tr>
    </thead>
    <tbody>
      <tr class="bg-white border-b" *ngFor="let fp_history of fp_visit_history">
        <td *ngIf="!fp_visit_history" colspan="7">
          <div class="text-center">
            No records to show...
          </div>
        </td>
        <td class="py-4 px-6">
          {{ fp_history.created_at | date: 'MM/dd/yyyy'}}
        </td>
        <td class="py-4 px-6">
          {{ fp_history?.method?.method?.desc ? fp_history?.method?.method?.desc : '-' }}
        </td>
        <td class="py-4 px-6">
          {{ fp_history?.method?.client?.desc ? fp_history?.method?.client?.desc : '-' }}
        </td>
        <td class="py-4 px-6">
          <button type="button" class="rounded-md bg-blue-500 text-white py-1 px-2" (click)="openFPConsult(fp_visit_history)">
           Open
          </button>
        </td>
      </tr>

      <tr class="bg-white border-b" *ngIf="!fp_visit_history[0]">
        <td  colspan="7">
          <div class="text-center py-3 flex flex-col">
            <div class="flex justify-center">No records to show...</div>
            <div class="flex justify-center">
              <button type="button" class="mt-3 bg-blue-500 px-3 py-1 rounded-md text-white hover:opacity-75" (click)="switchPage(2)">
                create record
              </button>
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<app-firsvisit *ngIf="pages === 2 && module === 1"
  [patient_id]="patient_id"
  [fp_visit_history]="fp_visit_history"
  (loadFP)="loadFP()"
></app-firsvisit>
<app-fphx *ngIf="pages === 2 && module === 2"
  [patient_id]="patient_id"
  [fp_visit_history]="fp_visit_history"
  (loadFP)="loadFP()"
></app-fphx>
<app-fppe *ngIf="pages === 2 && module === 4"
  [patient_id]="patient_id"
  [fp_visit_history]="fp_visit_history"
  (loadFP)="loadFP()"
></app-fppe>
<app-pelvic *ngIf="pages === 2 && module === 5"
  [patient_id]="patient_id"
  [fp_visit_history]="fp_visit_history"
  (loadFP)="loadFP()"
></app-pelvic>
<app-methods *ngIf="pages === 2 && module === 6"
  [patient_id]="patient_id"
  [fp_visit_history]="fp_visit_history"
  (loadFP)="loadFP()"
></app-methods>
<app-fpchart *ngIf="pages === 2 && module === 7"
  [patient_id]="patient_id"
  [fp_visit_history]="fp_visit_history"
  (loadFP)="loadFP()"
></app-fpchart>

<app-end-visit *ngIf="modals['end_visit']"
  (toggleModal)="toggleModal($event)"
  [consult_id]="consult_id"
  [consult_date]="consult_details[0]?.consult_date"
  [patient_id]="consult_details[0]?.patient.id"
  [pt_group]="consult_details[0]?.pt_group"
></app-end-visit>

<app-methods-modal *ngIf="modals['methods-modal']"
  (toggleModal)="toggleModal($event)"
  [fp_visit_history]="fp_visit_history"
  (loadFP)="loadFP()"
></app-methods-modal>

<app-fpchart-modal *ngIf="modals['fpchart-modal']"
  [patient_id]="patient_id"
  (toggleModal)="toggleModal($event)"
  [fp_visit_history]="fp_visit_history"
  (loadFP)="loadFP()"
  (loadChart)="loadChart()"
></app-fpchart-modal>

