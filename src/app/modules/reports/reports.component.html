<div class="grid grid-cols-1 m-5">

  <form [formGroup]="reportForm" (ngSubmit)="onSubmit()" class="flex my-3 space-x-3">
    <div class="w-40">
      <label for="report_type" class="input-label" >Report</label>
      <select id="report_type" name="report_type" class="input" formControlName="report_type" (change)="changeDateOptions()">
        <option selected="true" disabled="disabled">Select report type</option>

        <optgroup label="Daily Service Report" class="text-gray-500" >
          <option *ngFor="let type of daily_service" [ngValue]="type">{{ type.desc }}</option>
        </optgroup>

        <optgroup label="FHSIS Report M1" class="text-gray-500" >
          <option [ngValue]="{id: 'fhsis2018-consolidated'}">A-H. Consolidated Report</option>
          <option *ngFor="let type of fhsis2018" [ngValue]="type">{{type.section}}. {{ type.desc }}</option>
        </optgroup>

        <optgroup label="FHSIS Report M2" class="text-gray-500" >
          <option *ngFor="let type of fhsis2018_m2" [ngValue]="type">{{type.section}}. {{ type.desc }}</option>
        </optgroup>

        <optgroup label="Household Profiling" class="text-gray-500" >
          <option *ngFor="let type of household_stats" [ngValue]="type">{{ type.desc }}</option>
        </optgroup>

        <optgroup label="Animal Bite Report" class="text-gray-500" >
          <option *ngFor="let type of ab_stats" [ngValue]="type">{{ type.desc }}</option>
        </optgroup>
        <optgroup label="ASRH Report" class="text-gray-500" >
          <option *ngFor="let type of asrh_stats" [ngValue]="type">{{ type.desc }}</option>
        </optgroup>
         <!-- <optgroup label="Others" class="text-gray-500" > -->
        <optgroup label="Others" class="text-gray-500" >
          <option *ngFor="let type of other_stats" [ngValue]="type">{{ type.desc }}</option>
          <option *ngFor="let type of dental_consolidated" [ngValue]="type">{{ type.desc }}</option>
        </optgroup>

      </select>
    </div>

    <div class="w-40" *ngIf="reportForm.value.report_type && reportForm.value.report_type.id !== 'feedback'">
      <label for="report_class" class="input-label" >Location</label>
      <select *ngIf="!reportFlag" id="report_class" name="report_class" class="input" formControlName="report_class" (change)="handleReportClass(reportForm.value.report_class)">
        <option value="all">All</option>
        <option value="muncity">Municipality</option>
        <option value="brgys">Barangays</option>
        <option value="fac">Facility</option>
      </select>

      <select *ngIf="reportFlag === '1'" id="report_class" name="report_class" class="input" formControlName="report_class" (change)="handleReportClass(reportForm.value.report_class)">
        <option value="all">All</option>
        <option value="muncity">Municipality</option>
        <option value="fac">Facility</option>
      </select>
    </div>

    <div class="w-40" *ngIf="reportForm.value.report_type && reportForm.value.report_type.id == 'masterlist'">
      <label for="report_class" class="input-label" >Program</label>
      <select id="report_class" name="report_class" class="input" formControlName="program" (change)="handleReportClass(reportForm.value.report_class); changeDateOptions()">
        <option  value="mc">Maternal Care</option>
        <option value="fp">Family Planning</option>
        <option value="bt">Blood Type</option>
        <option value="sn">Senior Citizen</option>
      </select>
    </div>

    <!-- START MUNCITY -->
    <div class="w-52" *ngIf="reportFlag && reportForm.value.report_class === 'muncity' && !this.muncity">
      <label for="brgys" class="input-label pb-1" >Municipality</label>
      <fa-icon class="text-blue-500 my-auto mx-auto" [icon]="faCircleNotch" animation="spin"></fa-icon>Fetching...
    </div>

    <div class="w-52" *ngIf="reportFlag && reportForm.value.report_class === 'muncity' && this.muncity">
      <label for="muncity" class="input-label pb-1" >Municipality</label>
      <ng-select id="muncity" name="muncity"
        class="w-full"
        [items]="muncity"
        [multiple]="true"
        [hideSelected]="true"
        bindLabel="name"
        [selectableGroup]="true"
        [closeOnSelect]="false"
        bindValue="code"
        [(ngModel)]="selectedMuncity"
        [ngModelOptions]="{standalone:true}">

        <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
          <div class="ng-value" *ngIf="items.length > 0">
            <span class="ng-value-label">Selected {{items.length}} Municipality</span>
          </div>
        </ng-template>
      </ng-select>
    </div>
    <!-- END MUNCITY -->

    <!-- START PROVINCIAL REPORT FACILITY -->
    <div class="w-52" *ngIf="reportFlag && reportForm.value.report_class === 'fac' && !this.facilities">
      <label for="brgys" class="input-label pb-1" >Facilities</label>
      <fa-icon class="text-blue-500 my-auto mx-auto" [icon]="faCircleNotch" animation="spin"></fa-icon>Fetching...
    </div>

    <div class="w-52" *ngIf="reportFlag && reportForm.value.report_class === 'fac' && this.facilities">
      <label for="facilities" class="input-label pb-1" >Facilities</label>
      <ng-select id="facilities" name="facilities"
        class="w-full"
        [items]="facilities"
        [multiple]="true"
        [hideSelected]="true"
        bindLabel="facility_name"
        [selectableGroup]="true"
        [closeOnSelect]="false"
        bindValue="code"
        [(ngModel)]="selectedFacilities"
        [ngModelOptions]="{standalone:true}">

        <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
          <div class="ng-value" *ngIf="items.length > 0">
            <span class="ng-value-label">Selected {{items.length}} Facilities</span>
          </div>
        </ng-template>
      </ng-select>
    </div>
    <!-- END PROVINCIAL REPORT FACILITY -->

    <!-- START BRGY -->
    <div class="w-52" *ngIf="!reportFlag && reportForm.value.report_class === 'brgys' && !this.brgys">
      <label for="brgys" class="input-label pb-1" >Barangays</label>
      <fa-icon class="text-blue-500 my-auto mx-auto" [icon]="faCircleNotch" animation="spin"></fa-icon>Fetching...
    </div>

    <div class="w-52" *ngIf="!reportFlag && reportForm.value.report_class === 'brgys' && this.brgys">
      <label for="brgys" class="input-label pb-1" >Barangays</label>
      <ng-select id="brgys" name="brgys"
        class="w-full"
        [items]="brgys"
        [multiple]="true"
        [hideSelected]="true"
        bindLabel="name"
        [selectableGroup]="true"
        [closeOnSelect]="false"
        bindValue="code"
        [(ngModel)]="selectedBrgy"
        [ngModelOptions]="{standalone:true}">

        <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
          <div class="ng-value" *ngIf="items.length > 0">
            <span class="ng-value-label">Selected {{items.length}} brgys</span>
          </div>
        </ng-template>
      </ng-select>
    </div>
    <!-- END BRGY -->

    <div class="w-40" *ngIf="reportForm.value.report_type && f['month'].enabled">
      <label for="start_date" class="input-label">Month</label>
      <select id="month" name="month" class="input" formControlName="month">
        <option [value]="month.value" *ngFor="let month of months"> {{ month.name }}</option>
      </select>
    </div>

    <div class="w-40" *ngIf="reportForm.value.report_type && f['quarter'].enabled">
      <label for="start_date" class="input-label">Quarter</label>
      <select id="quarter" name="quarter" class="input" formControlName="quarter">
        <option [value]="quarter.value" *ngFor="let quarter of quarters"> {{ quarter.desc }}</option>
      </select>
    </div>

    <div class="w-40" *ngIf="reportForm.value.report_type && f['year'].enabled">
      <label for="start_date" class="input-label">Year</label>
      <select id="year" name="year" class="input" formControlName="year">
        <option [value]="year" *ngFor="let year of years"> {{ year }}</option>
      </select>
    </div>

    <div class="w-40" *ngIf="reportForm.value.report_type && f['start_date'].enabled">
      <label for="start_date" class="input-label">Start date</label>
      <input type="date" name="start_date" id="start_date" class="input" placeholder="mm/dd/yyyy" formControlName="start_date">
    </div>

    <div class="w-40" *ngIf="reportForm.value.report_type && f['end_date'].enabled">
      <label for="end_date" class="input-label">End date</label>
      <input type="date" name="end_date" id="end_date" class="input" placeholder="mm/dd/yyyy" formControlName="end_date">
    </div>

    <div class="w-40">
      <button [disabled]="reportForm.invalid || (reportForm.value.report_class === 'brgys' ? !selectedBrgy : false)" type="submit" class="btn-save mt-5 disabled:bg-gray-400">
        Submit
      </button>
    </div>
  </form>

  <div class="w-auto" *ngIf="reportForm.value?.report_type?.id?.includes('fhsis2018') && report_data && !is_fetching" >
    <div class="font-semibold flex justify-between text-blue-500 py-3">
      <span >
        FHSIS Report - {{ reportForm.value.report_type.desc }}
      </span>

      <span>
        <button [disabled]="pdf_exported" type="button" class="text-2xl mr-5 text-red-600 disabled:text-gray-600" (click)="exportP(reportForm.value.report_type.desc)">
          <fa-icon [icon]="faFilePdf"></fa-icon>
        </button>
        <button  type="button" class="text-2xl" (click)="exportX(reportForm.value.report_type.desc)">
          <fa-icon [icon]="faFileExcel" class="text-green-700"></fa-icon>
        </button>
      </span>
    </div>
  </div>

  <div class="w-svh flex flex-col items-center p-3 overflow-auto" id="reportForm">
    <app-header-fhsis2018 *ngIf="reportForm.value?.report_type?.id?.includes('fhsis2018') && report_data && !is_fetching"
      [paper_width]="paper_width"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-header-fhsis2018>

    <!-- START CONSOLIDATED -->
    <app-fhsis2018-fp *ngIf="(reportForm.value?.report_type.id === 'fhsis2018-consolidated' || reportForm.value?.report_type.id === 'fhsis2018-fp') && report_data && !is_fetching"
      [paper_width]="paper_width"
      [report_data]="reportForm.value.report_type.id !== 'fhsis2018-consolidated' ? report_data : fhsis2018_data['fhsis2018-fp']"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-fp>

    <app-fhsis2018-mc *ngIf="(reportForm.value?.report_type.id === 'fhsis2018-consolidated' || reportForm.value?.report_type.id === 'fhsis2018-mc') && report_data && !is_fetching"
      [paper_width]="paper_width"
      [report_data]="reportForm.value.report_type.id !== 'fhsis2018-consolidated' ? report_data : fhsis2018_data['fhsis2018-mc']"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-mc>

    <app-fhsis2018-cc *ngIf="(reportForm.value?.report_type.id === 'fhsis2018-consolidated' || reportForm.value?.report_type.id === 'fhsis2018-cc') && report_data && !is_fetching"
      [paper_width]="paper_width"
      [report_data]="reportForm.value.report_type.id !== 'fhsis2018-consolidated' ? report_data : fhsis2018_data['fhsis2018-cc']"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-cc>

    <app-fhsis2018-dental-m1 *ngIf="(reportForm.value?.report_type.id === 'fhsis2018-consolidated' || reportForm.value?.report_type.id === 'fhsis2018-dental-m1') && report_data && !is_fetching"
      [paper_width]="paper_width"
      [report_data]="reportForm.value.report_type.id !== 'fhsis2018-consolidated' ? report_data : fhsis2018_data['fhsis2018-dental-m1']"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-dental-m1>

    <app-fhsis2018-tb *ngIf="(reportForm.value?.report_type.id === 'fhsis2018-consolidated' || reportForm.value?.report_type.id === 'fhsis2018-tb') && report_data && !is_fetching"
      [paper_width]="paper_width"
      [report_data]="reportForm.value.report_type.id !== 'fhsis2018-consolidated' ? report_data : fhsis2018_data['fhsis2018-tb']"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-tb>

    <app-fhsis2018-ncd *ngIf="(reportForm.value?.report_type.id === 'fhsis2018-consolidated' || reportForm.value?.report_type.id === 'fhsis2018-ncd') && report_data && !is_fetching"
      [paper_width]="paper_width"
      [report_data]="reportForm.value.report_type.id !== 'fhsis2018-consolidated' ? report_data : fhsis2018_data['fhsis2018-ncd']"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-ncd>

    <app-fhsis2018-environmental *ngIf="(reportForm.value?.report_type.id === 'fhsis2018-consolidated' || reportForm.value?.report_type.id === 'fhsis2018-environmental') && report_data && !is_fetching"
      [paper_width]="paper_width"
      [report_data]="reportForm.value.report_type.id !== 'fhsis2018-consolidated' ? report_data : fhsis2018_data['fhsis2018-environmental']"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-environmental>

    <app-fhsis2018-mortality *ngIf="(reportForm.value?.report_type.id === 'fhsis2018-consolidated' || reportForm.value?.report_type.id === 'fhsis2018-mortality') && report_data && !is_fetching"
      [paper_width]="paper_width"
      [report_data]="reportForm.value.report_type.id !== 'fhsis2018-consolidated' ? report_data : fhsis2018_data['fhsis2018-mortality']"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-mortality>
    <!-- END CONSOLIDATED -->

    <app-fhsis2018-morbidity *ngIf="reportForm.value?.report_type.id === 'fhsis2018-morbidity' && report_data && !is_fetching"
      [paper_width]="paper_width"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-morbidity>

    <app-fhsis2018-mortality-underlying *ngIf="reportForm.value?.report_type.id === 'fhsis2018-mortality-underlying' && report_data && !is_fetching"
      [paper_width]="paper_width"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-mortality-underlying>

    <app-patient-registered *ngIf="reportForm.value?.report_type.id === 'patient-registered' && report_data && !is_fetching"
      [report_data]="report_data"
    ></app-patient-registered>

    <app-household-profiling *ngIf="reportForm.value?.report_type.id === 'profiling-report' && report_data && !is_fetching"
      [report_data]="report_data"
    ></app-household-profiling>

    <app-daily-service *ngIf="reportForm.value?.report_type.id === 'daily-service' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys" [userInfo]="userInfo"
      [submit_flag]="submit_flag"
    ></app-daily-service>

    <app-feedback-report *ngIf="reportForm.value?.report_type.id === 'feedback' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys" [userInfo]="userInfo"
      [submit_flag]="submit_flag"
      [start_date]="reportForm.value.start_date"
      [end_date]="reportForm.value.end_date"
    ></app-feedback-report>

    <app-ab-post *ngIf="reportForm.value?.report_type.id === 'ab-post' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys" [userInfo]="userInfo"
      [submit_flag]="submit_flag"
      [start_date]="reportForm.value.start_date"
      [end_date]="reportForm.value.end_date"
    ></app-ab-post>

    <app-ab-pre *ngIf="reportForm.value?.report_type.id === 'ab-pre' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys" [userInfo]="userInfo"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-ab-pre>


    <app-dental-ohs-consolidated *ngIf="reportForm.value?.report_type.id === 'dental-ohs-consolidated' && report_data && !is_fetching"
       [report_data]="report_data"
       [reportForm]="reportForm"
       [selectedBrgy]="selectedBrgy"
       [selectedCode]="selectedCode"
       [brgys]="brgys"
       [facility]="userInfo.facility"
       [submit_flag]="submit_flag"
    ></app-dental-ohs-consolidated>

    <app-maternal-care-masterlist *ngIf="reportForm.value?.program === 'mc' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-maternal-care-masterlist>

    <app-family-planning-masterlist *ngIf="reportForm.value?.program === 'fp' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [selectedCode]="selectedCode"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-family-planning-masterlist>

    <app-blood-type-masterlist *ngIf="reportForm.value?.program === 'bt' && report_data && !is_fetching"
       [report_data]="report_data"
       [reportForm]="reportForm"
       [selectedBrgy]="selectedBrgy"
       [selectedCode]="selectedCode"
       [brgys]="brgys"
       [facility]="userInfo.facility"
       [submit_flag]="submit_flag"
    ></app-blood-type-masterlist>

    <app-senior-masterlist *ngIf="reportForm.value?.program === 'sn' && report_data && !is_fetching"
       [report_data]="report_data"
       [reportForm]="reportForm"
       [selectedBrgy]="selectedBrgy"
       [selectedCode]="selectedCode"
       [brgys]="brgys"
       [facility]="userInfo.facility"
       [submit_flag]="submit_flag"
    ></app-senior-masterlist>

    <app-asrh-masterlist *ngIf="reportForm.value?.report_type.id === 'asrh-masterlist' && report_data && !is_fetching"
       [report_data]="report_data"
       [reportForm]="reportForm"
       [selectedBrgy]="selectedBrgy"
       [selectedCode]="selectedCode"
       [brgys]="brgys"
       [facility]="userInfo.facility"
       [submit_flag]="submit_flag"
    ></app-asrh-masterlist>

      <app-asrh-consolidated *ngIf="reportForm.value?.report_type.id === 'asrh-consolidated' && report_data && !is_fetching"
       [report_data]="report_data"
       [reportForm]="reportForm"
       [selectedBrgy]="selectedBrgy"
       [selectedCode]="selectedCode"
       [brgys]="brgys"
       [facility]="userInfo.facility"
       [submit_flag]="submit_flag"
    ></app-asrh-consolidated>

<!--    <div class="flex flex-col justify-start">
      <app-pagination (pageChange)="onSubmit($event)"
        [meta_info]="meta_info"
      ></app-pagination>
    </div>-->

    <app-footer *ngIf="reportForm.value?.report_type?.id?.includes('fhsis2018') && report_data && !is_fetching"
      [paper_width]="paper_width"
    ></app-footer>

    <div class="flex flex-col justify-center" *ngIf="is_fetching">
      <fa-icon class="text-blue-500 mx-auto pt-36 text-xl" [icon]="faCircleNotch" animation="spin"></fa-icon>
      <span class="pt-4 mx-auto pb-36 select-none">Fetching Report...</span>
    </div>
  </div>
</div>
