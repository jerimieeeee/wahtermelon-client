"use strict";(self.webpackChunkwahtermelon_client=self.webpackChunkwahtermelon_client||[]).push([[8816],{8816:(U,u,c)=>{c.r(u),c.d(u,{TicketingModule:()=>J});var a=c(177),g=c(3895),m=c(5383),t=c(4438),f=c(3318),d=c(60),s=c(9417),p=c(614);const y=i=>({"ml-auto":i}),h=i=>({"text-right":i});function v(i,l){if(1&i&&(t.j41(0,"span",15),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&i){const e=t.XpG();t.R7$(),t.SpI(" | Resolved on: ",t.i5U(2,1,e.selected_ticket.end_date,"MM/dd/yyyy"),"")}}function F(i,l){if(1&i&&(t.j41(0,"div",16)(1,"div",17)(2,"div",18),t.EFF(3),t.k0s(),t.j41(4,"div",19),t.EFF(5),t.k0s(),t.j41(6,"div",20),t.EFF(7),t.nI1(8,"date"),t.k0s()()()),2&i){const e=l.$implicit,n=t.XpG();t.R7$(),t.Y8G("ngClass",t.eq3(11,y,n.user_id===e.facility_user_id)),t.R7$(),t.Y8G("ngClass",t.eq3(13,h,n.user_id===e.facility_user_id)),t.R7$(),t.SpI(" ",n.user_id===e.facility_user_id?"You":e.user?e.user.last_name+", "+e.user.first_name:e.facility_user_name," "),t.R7$(),t.HbH(n.user_id===e.facility_user_id?"bg-green-100":"bg-blue-100"),t.R7$(),t.SpI(" ",e.comment," "),t.R7$(),t.Y8G("ngClass",t.eq3(15,h,n.user_id===e.facility_user_id)),t.R7$(),t.SpI(" ",t.i5U(8,8,e.created_at,"MM/dd/yyyy HH:mm a")," ")}}function T(i,l){1&i&&(t.j41(0,"div",21),t.EFF(1,"No Comments Found..."),t.k0s())}function w(i,l){if(1&i&&t.nrm(0,"fa-icon",22),2&i){const e=t.XpG();t.Y8G("icon",e.faSave)}}function C(i,l){if(1&i&&t.nrm(0,"fa-icon",23),2&i){const e=t.XpG();t.Y8G("icon",e.faCircleNotch)}}let k=(()=>{class i{onSubmit(){this.is_saving=!0;let e={logs_id:this.selected_ticket.id,facility_user_id:this.user_id,facility_user_name:this.user_info.facility_user_name,comment:this.log_comment};console.log(e),this.http.postToMasterform("logs-facility-comment",e).subscribe({next:n=>{this.log_comment="",this.is_saving=!1,this.loadComments()},error:n=>console.log(n)})}loadComments(){this.http.getFromMasterform("logs-facility-comment",{params:{logs_id:this.selected_ticket.id}}).subscribe({next:n=>{console.log(n),this.comment_list=n.data},error:n=>console.log(n)})}constructor(e){this.http=e,this.faSave=p.hSh,this.faCircleNotch=m.s4k,this.is_saving=!1,this.log_comment="",this.comment_list=[]}ngOnInit(){const e=this.http.getUserFromJSON();this.user_info={facility_user_name:e.first_name+" "+e.last_name},this.user_id=this.http.getUserID(),this.loadComments()}static{this.\u0275fac=function(n){return new(n||i)(t.rXU(f.k))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-ticket-transactions"]],inputs:{selected_ticket:"selected_ticket",facility_id:"facility_id"},decls:31,vars:14,consts:[[1,"w-full","flex","flex-col"],[1,"flex","justify-between","border-b","border-slate-200"],["class","ml-1",4,"ngIf"],[1,"flex","flex-col","mt-5"],[1,"flex","flex-col"],["class","w-full flex flex-col mt-3",4,"ngFor","ngForOf"],["class","italic",4,"ngIf"],[1,"grid","grid-cols-1","mt-5"],[1,"grid","grid-cols-4"],[1,"col-span-4","pl-2"],["rows","3","type","text",1,"col-span-4","input",3,"ngModelChange","ngModel"],[1,"flex","justify-center","mt-3"],["type","button",1,"w-36","disabled:bg-gray-400","disabled:opacity-50","disabled:pointer-events-none","right","w-1/3","py-2","text-sm","font-semibold","text-white","transition-colors","duration-300","bg-blue-500","rounded-md","shadow","hover:bg-blue-600","focus:outline-none","focus:ring-blue-200","focus:ring-4",3,"click","disabled"],[3,"icon",4,"ngIf"],["animation","spin",3,"icon",4,"ngIf"],[1,"ml-1"],[1,"w-full","flex","flex-col","mt-3"],[1,"w-11/12","mb-2",3,"ngClass"],[1,"text-xs","mx-1",3,"ngClass"],[1,"border","border-slate-100","shadow-xs","p-1"],[1,"text-xs","italic","mx-1",3,"ngClass"],[1,"italic"],[3,"icon"],["animation","spin",3,"icon"]],template:function(n,o){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div"),t.EFF(3," Ticket #: 423 "),t.nrm(4,"br"),t.k0s(),t.j41(5,"div"),t.EFF(6),t.nI1(7,"date"),t.DNE(8,v,3,4,"span",2),t.k0s()(),t.j41(9,"div",3)(10,"div")(11,"strong"),t.EFF(12,"Title:"),t.k0s(),t.EFF(13),t.k0s(),t.j41(14,"div")(15,"strong"),t.EFF(16,"Details:"),t.k0s(),t.EFF(17),t.k0s()(),t.j41(18,"div",4),t.DNE(19,F,9,17,"div",5)(20,T,2,0,"div",6),t.k0s(),t.j41(21,"div",7)(22,"div",8)(23,"label",9),t.EFF(24,"Add a comment"),t.k0s(),t.j41(25,"textarea",10),t.mxI("ngModelChange",function(_){return t.DH7(o.log_comment,_)||(o.log_comment=_),_}),t.k0s()(),t.j41(26,"div",11)(27,"button",12),t.bIt("click",function(){return o.onSubmit()}),t.DNE(28,w,1,1,"fa-icon",13)(29,C,1,1,"fa-icon",14),t.EFF(30),t.k0s()()()()),2&n&&(t.R7$(6),t.SpI(" Created on: ",t.i5U(7,11,o.selected_ticket.start_date,"MM/dd/yyyy")," "),t.R7$(2),t.Y8G("ngIf",o.selected_ticket.end_date),t.R7$(5),t.SpI(" ",o.selected_ticket.title," "),t.R7$(4),t.SpI(" ",o.selected_ticket.details," "),t.R7$(2),t.Y8G("ngForOf",o.comment_list),t.R7$(),t.Y8G("ngIf",!o.comment_list),t.R7$(5),t.R50("ngModel",o.log_comment),t.R7$(2),t.Y8G("disabled",o.is_saving||""===o.log_comment),t.R7$(),t.Y8G("ngIf",!o.is_saving),t.R7$(),t.Y8G("ngIf",o.is_saving),t.R7$(),t.SpI(" ",o.is_saving?"Saving":"Save"," "))},dependencies:[a.MD,a.YU,a.Sq,a.bT,a.vh,d.dX,d.aY,s.X1,s.me,s.BC,s.YN,s.vS],encapsulation:2})}}return i})();var x=c(7468);function M(i,l){if(1&i&&(t.j41(0,"option",20),t.EFF(1),t.k0s()),2&i){const e=l.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(e.desc)}}function j(i,l){if(1&i&&(t.j41(0,"option",20),t.EFF(1),t.k0s()),2&i){const e=l.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(e.desc)}}let b=(()=>{class i{onSubmit(){this.is_saving=!0,this.ticketForm.patchValue({department_id:"2"===this.ticketForm.value.category_id?"3":"1"}),this.http.postToMasterform("logs-facility",this.ticketForm.value).subscribe({next:e=>{console.log(e),this.is_saving=!1,this.closeModal()},error:e=>console.log(e)})}createForm(){let e=(0,a.Yq)(new Date,"yyyy-MM-dd hh:mm:ss","en","Asia/Manila");this.ticketForm=this.formBuilder.nonNullable.group({facility_id:[this.facility_id],reporter_user_id:[this.http.getUserID()],reporter_name:[this.reporter_user_name],start_date:[e,s.k0.required],department_id:["",s.k0.required],status_id:["1",s.k0.required],category_id:["",s.k0.required],sub_category_id:["",s.k0.required],title:["",s.k0.required],details:["",s.k0.required]}),this.show_form=!0}loadLibraries(){const e=this.http.getFromMasterform("libraries/log-category"),n=this.http.getFromMasterform("libraries/log-subcategory");(0,x.p)([e,n]).subscribe({next:([o,r])=>{this.category_list=o.data,this.subcategory_list=r.data,this.createForm()},error:o=>this.http.showError(o.error.message,"Ticketing")})}closeModal(){this.toggleModal.emit("new-ticket")}constructor(e,n){this.http=e,this.formBuilder=n,this.toggleModal=new t.bkB,this.faSave=p.hSh,this.faCircleNotch=m.s4k,this.category_list=[],this.subcategory_list=[],this.show_form=!1,this.is_saving=!1,this.ticketForm=new s.gE({facility_id:new s.MJ(null),reporter_user_id:new s.MJ(null),reporter_name:new s.MJ(null),start_date:new s.MJ(null),department_id:new s.MJ(null),status_id:new s.MJ(null),category_id:new s.MJ(null),sub_category_id:new s.MJ(null),title:new s.MJ(null),details:new s.MJ(null)})}ngOnInit(){const e=this.http.getUserFromJSON();this.reporter_user_name=e.first_name+" "+e.last_name,this.loadLibraries()}static{this.\u0275fac=function(n){return new(n||i)(t.rXU(f.k),t.rXU(s.ok))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-ticketing-modal"]],inputs:{facility_id:"facility_id"},outputs:{toggleModal:"toggleModal"},decls:35,vars:4,consts:[["id","defaultModal","tabindex","-1","aria-modal","true","role","dialog",1,"overflow-y-auto","overflow-x-hidden","fixed","top-0","right-0","left-0","w-full","md:inset-0","h-modal","md:h-full","justify-center","items-center","flex",2,"z-index","60"],[1,"relative","p-4","w-full","max-w-3xl","h-full","md:h-auto"],[1,"relative","bg-white","rounded-lg","shadow","dark:bg-gray-700"],[1,"flex","justify-between","items-start","py-3","px-5","rounded-t","border-b","bg-blue-500","dark:border-gray-600"],[1,"mt-2","text-sm","font-bold","text-white","dark:text-white"],[1,"overflow-y-auto","h-96","scrollbar-thin","scrollbar-thumb-gray-400","scrollbar-track-gray-100"],[1,"overflow-x-auto","relative","shadow-md","sm:rounded-lg","m-4"],[3,"formGroup"],[1,"flex","flex-col","p-4"],[1,"flex","flex-col"],["formControlName","category_id",1,"input"],[3,"value",4,"ngFor","ngForOf"],["formControlName","sub_category_id",1,"input"],["type","text","formControlName","title",1,"input"],["type","text","rows","4","formControlName","details",1,"input"],[1,"flex","justify-end","py-4","px-5","space-x-4","rounded-b","border-t","border-gray-200","dark:border-gray-600"],["type","button",1,"btn-cancel",3,"click"],["type","button",1,"btn-save",3,"click"],[3,"icon"],[1,"opacity-50","fixed","inset-0","z-50","bg-black"],[3,"value"]],template:function(n,o){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),t.EFF(5," Create a ticket "),t.k0s()(),t.j41(6,"div",5)(7,"div",6)(8,"form",7)(9,"div",8)(10,"div",9)(11,"label"),t.EFF(12,"Category"),t.k0s(),t.j41(13,"select",10),t.DNE(14,M,2,2,"option",11),t.k0s()(),t.j41(15,"div",9)(16,"label"),t.EFF(17,"Sub-Category"),t.k0s(),t.j41(18,"select",12),t.DNE(19,j,2,2,"option",11),t.k0s()(),t.j41(20,"div",9)(21,"label"),t.EFF(22,"Ticket Title"),t.k0s(),t.nrm(23,"input",13),t.k0s(),t.j41(24,"div",9)(25,"label"),t.EFF(26,"Details"),t.k0s(),t.nrm(27,"textarea",14),t.k0s()()()()(),t.j41(28,"div",15)(29,"button",16),t.bIt("click",function(){return o.closeModal()}),t.EFF(30,"Close"),t.k0s(),t.j41(31,"button",17),t.bIt("click",function(){return o.onSubmit()}),t.nrm(32,"fa-icon",18),t.EFF(33," Save "),t.k0s()()()()(),t.nrm(34,"div",19)),2&n&&(t.R7$(8),t.Y8G("formGroup",o.ticketForm),t.R7$(6),t.Y8G("ngForOf",o.category_list),t.R7$(5),t.Y8G("ngForOf",o.subcategory_list),t.R7$(13),t.Y8G("icon",o.faSave))},dependencies:[a.MD,a.Sq,d.dX,d.aY,s.X1,s.qT,s.xH,s.y7,s.me,s.wz,s.BC,s.cb,s.j4,s.JD],encapsulation:2})}}return i})();function R(i,l){if(1&i){const e=t.RV6();t.j41(0,"button",9),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.toggleTicketContent())}),t.nrm(1,"fa-icon",10),t.k0s()}if(2&i){const e=t.XpG();t.R7$(),t.Y8G("icon",e.faArrowLeft)}}function I(i,l){if(1&i){const e=t.RV6();t.j41(0,"div")(1,"button",11),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.toggleModal("new-ticket"))}),t.nrm(2,"fa-icon",10),t.k0s()()}if(2&i){const e=t.XpG();t.R7$(2),t.Y8G("icon",e.faPlus)}}function G(i,l){if(1&i){const e=t.RV6();t.j41(0,"tr",20),t.bIt("click",function(){const o=t.eBV(e).$implicit,r=t.XpG(2);return t.Njj(r.toggleTicketContent(o))}),t.j41(1,"td",21),t.EFF(2),t.k0s(),t.j41(3,"td",21),t.EFF(4),t.k0s(),t.j41(5,"td",21),t.EFF(6),t.nI1(7,"date"),t.nI1(8,"date"),t.k0s(),t.j41(9,"td",21),t.EFF(10),t.k0s()()}if(2&i){const e=l.$implicit;t.R7$(2),t.JRh(e.status.desc),t.R7$(2),t.JRh(e.title),t.R7$(2),t.Lme(" ",t.i5U(7,5,e.start_date,"MM/dd/yyyy HH:mm a")," ",t.i5U(8,8,e.end_date,"MM/dd/yyyy HH:mm a")," "),t.R7$(4),t.JRh(e.start_date)}}function E(i,l){1&i&&(t.j41(0,"tr",22)(1,"td",23),t.EFF(2,"No tickets found"),t.k0s()())}function $(i,l){if(1&i&&(t.j41(0,"table",12)(1,"thead")(2,"tr",13)(3,"th",14),t.EFF(4,"Ticket Number & Status"),t.k0s(),t.j41(5,"th",15),t.EFF(6,"Title"),t.k0s(),t.j41(7,"th",16),t.EFF(8," Date Opened "),t.nrm(9,"br"),t.EFF(10," Date Closed "),t.k0s(),t.j41(11,"th",17),t.EFF(12,"Elapsed Time"),t.k0s()()(),t.j41(13,"tbody"),t.DNE(14,G,11,11,"tr",18)(15,E,3,0,"tr",19),t.k0s()()),2&i){const e=t.XpG();t.R7$(14),t.Y8G("ngForOf",e.ticketList),t.R7$(),t.Y8G("ngIf",0===e.ticketList.length)}}function Y(i,l){if(1&i&&(t.j41(0,"div",24),t.nrm(1,"app-ticket-transactions",25),t.k0s()),2&i){const e=t.XpG();t.R7$(),t.Y8G("facility_id",e.facility_id)("selected_ticket",e.selected_ticket)}}function S(i,l){if(1&i&&(t.j41(0,"div",26)(1,"div",27),t.nrm(2,"fa-icon",28),t.k0s(),t.j41(3,"div",29),t.EFF(4," Loading List... "),t.k0s()()),2&i){const e=t.XpG();t.R7$(2),t.Y8G("icon",e.faCircleNotch)}}function N(i,l){if(1&i){const e=t.RV6();t.j41(0,"app-ticketing-modal",30),t.bIt("toggleModal",function(o){t.eBV(e);const r=t.XpG();return t.Njj(r.toggleModal(o))}),t.k0s()}if(2&i){const e=t.XpG();t.Y8G("facility_id",e.facility_id)}}const D=[{path:"",component:(()=>{class i{toggleTicketContent(e){this.selected_ticket=e,this.show_ticket_content=!this.show_ticket_content}getList(){this.show_form=!1,this.http.getFromMasterform("logs-facility",{params:{facility_code:this.facility_code}}).subscribe({next:e=>{this.facility_id=e.facility_id,this.ticketList=e.data,this.show_form=!0},error:e=>this.http.showError(e.error.message,"Ticket List")})}toggleModal(e){this.modals[e]=!this.modals[e],this.modals[e]||this.getList()}constructor(e){this.http=e,this.faPlus=m.QLR,this.faCircleNotch=m.s4k,this.faArrowLeft=m.CeG,this.ticketList=[],this.modals=[],this.show_ticket_content=!1,this.selected_ticket=[],this.show_form=!1}ngOnInit(){this.facility_code=this.http.getUserFacility(),this.getList()}static{this.\u0275fac=function(n){return new(n||i)(t.rXU(f.k))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-ticketing"]],standalone:!1,decls:11,vars:6,consts:[[1,"rounded-xl","border","border-slate-100","shadow-md"],[1,"bg-blue-500","text-white","py-2","px-5","rounded-t-xl","font-semibold","flex","justify-between"],["type","button",3,"click",4,"ngIf"],[4,"ngIf"],[1,"w-full","flex"],["class","table-auto w-full m-5",4,"ngIf"],["class","w-full m-5",4,"ngIf"],["class","w-full flex flex-col my-20",4,"ngIf"],[3,"facility_id","toggleModal",4,"ngIf"],["type","button",3,"click"],[3,"icon"],[3,"click"],[1,"table-auto","w-full","m-5"],[1,"font-normal","text-sm","text-center"],[1,"w-3/12"],[1,"w-6/12"],[1,"w-2/12"],[1,"w-1/12"],["class","hover:bg-blue-100 hover:cursor-pointer",3,"click",4,"ngFor","ngForOf"],["class","border-b border-slate-100",4,"ngIf"],[1,"hover:bg-blue-100","hover:cursor-pointer",3,"click"],[1,"p-2"],[1,"border-b","border-slate-100"],["colspan","3",1,"text-center","italic","py-5"],[1,"w-full","m-5"],[3,"facility_id","selected_ticket"],[1,"w-full","flex","flex-col","my-20"],[1,"text-blue-500","flex","justify-center"],["animation","spin",3,"icon"],[1,"flex","justify-center"],[3,"toggleModal","facility_id"]],template:function(n,o){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div"),t.DNE(3,R,2,1,"button",2),t.EFF(4," Technical & Admin Support "),t.k0s(),t.DNE(5,I,3,1,"div",3),t.k0s(),t.j41(6,"div",4),t.DNE(7,$,16,2,"table",5)(8,Y,2,2,"div",6)(9,S,5,1,"div",7),t.k0s()(),t.DNE(10,N,1,1,"app-ticketing-modal",8)),2&n&&(t.R7$(3),t.Y8G("ngIf",o.show_ticket_content),t.R7$(2),t.Y8G("ngIf",o.show_form&&!o.show_ticket_content),t.R7$(2),t.Y8G("ngIf",o.show_form&&!o.show_ticket_content),t.R7$(),t.Y8G("ngIf",o.show_form&&o.show_ticket_content),t.R7$(),t.Y8G("ngIf",!o.show_form),t.R7$(),t.Y8G("ngIf",o.modals["new-ticket"]))},dependencies:[a.Sq,a.bT,d.aY,k,b,a.vh],styles:["th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #e7e7e7}"]})}}return i})()}];let X=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=t.$C({type:i})}static{this.\u0275inj=t.G2t({imports:[g.iI.forChild(D),g.iI]})}}return i})(),J=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=t.$C({type:i})}static{this.\u0275inj=t.G2t({imports:[a.MD,X,d.dX,k,b]})}}return i})()}}]);