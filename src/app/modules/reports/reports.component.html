<div class="grid grid-cols-1 m-5">

  <form [formGroup]="reportForm" (ngSubmit)="onSubmit()" class="flex my-3 space-x-3">
    <div class="w-40">
      <label for="report_type" class="input-label" >Report</label>
      <select id="report_type" name="report_type" class="input" formControlName="report_type" (change)="changeDateOptions()">
        <option selected="true" disabled="disabled">Select report type</option>

        <optgroup label="Daily Service Report" class="text-gray-500" >
          <option *ngFor="let type of daily_service" [ngValue]="type">{{ type.desc }}</option>
        </optgroup>

        <optgroup label="FHSIS Report" class="text-gray-500" >
          <option *ngFor="let type of fhsis2018" [ngValue]="type">{{ type.desc }}</option>
        </optgroup>

        <optgroup label="Household Profiling" class="text-gray-500" >
          <option *ngFor="let type of household_stats" [ngValue]="type">{{ type.desc }}</option>
        </optgroup>

        <optgroup label="Animal Bite Report" class="text-gray-500" >
          <option *ngFor="let type of ab_stats" [ngValue]="type">{{ type.desc }}</option>
        </optgroup>

        <optgroup label="Others" class="text-gray-500" >
          <option *ngFor="let type of other_stats" [ngValue]="type">{{ type.desc }}</option>
        </optgroup>
      </select>
    </div>

    <div class="w-40" *ngIf="reportForm.value.report_type && reportForm.value.report_type.id !== 'feedback'">
      <label for="report_class" class="input-label" >Location</label>
      <select *ngIf="!reportFlag" id="report_class" name="report_class" class="input" formControlName="report_class" (change)="handleReportClass(reportForm.value.report_class)">
        <option value="all">All</option>
        <option value="muncity">Municipality</option>
        <option value="brgys">Barangays</option>
        <option value="fac">Facility</option>
      </select>

      <select *ngIf="reportFlag === '1'" id="report_class" name="report_class" class="input" formControlName="report_class" (change)="handleReportClass(reportForm.value.report_class)">
        <option value="all">All</option>
        <option value="muncity">Municipality</option>
      </select>
    </div>

    <!-- START MUNCITY -->
    <div class="w-52" *ngIf="reportFlag && reportForm.value.report_class === 'muncity' && !this.muncity">
      <label for="brgys" class="input-label pb-1" >Municipality</label>
      <fa-icon class="text-blue-500 my-auto mx-auto" [icon]="faCircleNotch" spin="true"></fa-icon>Fetching...
    </div>

    <div class="w-52" *ngIf="reportFlag && reportForm.value.report_class === 'muncity' && this.muncity">
      <label for="muncity" class="input-label pb-1" >Municipality</label>
      <ng-select id="muncity" name="muncity"
        class="w-full"
        [items]="muncity"
        [multiple]="true"
        [hideSelected]="true"
        bindLabel="name"
        [selectableGroup]="true"
        [closeOnSelect]="false"
        bindValue="code"
        [(ngModel)]="selectedMuncity"
        [ngModelOptions]="{standalone:true}">

        <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
          <div class="ng-value" *ngIf="items.length > 0">
            <span class="ng-value-label">Selected {{items.length}} Municipality</span>
          </div>
        </ng-template>
      </ng-select>
    </div>
    <!-- END MUNCITY -->

    <!-- START BRGY -->
    <div class="w-52" *ngIf="!reportFlag && reportForm.value.report_class === 'brgys' && !this.brgys">
      <label for="brgys" class="input-label pb-1" >Barangays</label>
      <fa-icon class="text-blue-500 my-auto mx-auto" [icon]="faCircleNotch" spin="true"></fa-icon>Fetching...
    </div>

    <div class="w-52" *ngIf="!reportFlag && reportForm.value.report_class === 'brgys' && this.brgys">
      <label for="brgys" class="input-label pb-1" >Barangays</label>
      <ng-select id="brgys" name="brgys"
        class="w-full"
        [items]="brgys"
        [multiple]="true"
        [hideSelected]="true"
        bindLabel="name"
        [selectableGroup]="true"
        [closeOnSelect]="false"
        bindValue="code"
        [(ngModel)]="selectedBrgy"
        [ngModelOptions]="{standalone:true}">

        <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
          <div class="ng-value" *ngIf="items.length > 0">
            <span class="ng-value-label">Selected {{items.length}} brgys</span>
          </div>
        </ng-template>
      </ng-select>
    </div>
    <!-- END BRGY -->

    <div class="w-40" *ngIf="reportForm.value.report_type && f['month'].enabled">
      <label for="start_date" class="input-label">Month</label>
      <select id="month" name="month" class="input" formControlName="month">
        <option [value]="month.value" *ngFor="let month of months"> {{ month.name }}</option>
      </select>
    </div>

    <div class="w-40" *ngIf="reportForm.value.report_type && f['year'].enabled">
      <label for="start_date" class="input-label">Year</label>
      <select id="year" name="year" class="input" formControlName="year">
        <option [value]="year" *ngFor="let year of years"> {{ year }}</option>
      </select>
    </div>

    <div class="w-40" *ngIf="reportForm.value.report_type && f['start_date'].enabled">
      <label for="start_date" class="input-label">Start date</label>
      <input type="date" name="start_date" id="start_date" class="input" placeholder="mm/dd/yyyy" formControlName="start_date">
    </div>

    <div class="w-40" *ngIf="reportForm.value.report_type && f['end_date'].enabled">
      <label for="end_date" class="input-label">End date</label>
      <input type="date" name="end_date" id="end_date" class="input" placeholder="mm/dd/yyyy" formControlName="end_date">
    </div>

    <div class="w-40">
      <button [disabled]="reportForm.invalid || (reportForm.value.report_class === 'brgys' ? !selectedBrgy : false)" type="submit" class="btn-save mt-5 disabled:bg-gray-400">
        Submit
      </button>
    </div>
  </form>

  <div class="border border-slate-300 rounded-xl px-5">
    <app-fhsis2018-cc *ngIf="reportForm.value?.report_type.id === 'fhsis2018-cc' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-cc>

    <app-fhsis2018-mc *ngIf="reportForm.value?.report_type.id === 'fhsis2018-mc' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-mc>

    <app-fhsis2018-tb *ngIf="reportForm.value?.report_type.id === 'fhsis2018-tb' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-tb>

    <app-fhsis2018-ncd *ngIf="reportForm.value?.report_type.id === 'fhsis2018-ncd' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-ncd>

    <app-fhsis2018-fp *ngIf="reportForm.value?.report_type.id === 'fhsis2018-fp' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys"
      [userInfo]="userInfo"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-fp>

    <app-fhsis2018-morbidity *ngIf="reportForm.value?.report_type.id === 'fhsis2018-morbidity' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-morbidity>

    <app-fhsis2018-environmental *ngIf="reportForm.value?.report_type.id === 'fhsis2018-environmental' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-environmental>

    <app-fhsis2018-mortality *ngIf="reportForm.value?.report_type.id === 'fhsis2018-mortality' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-mortality>

    <app-patient-registered *ngIf="reportForm.value?.report_type.id === 'patient-registered' && report_data && !is_fetching"
      [report_data]="report_data"
    ></app-patient-registered>

    <app-household-profiling *ngIf="reportForm.value?.report_type.id === 'profiling-report' && report_data && !is_fetching"
      [report_data]="report_data"
    ></app-household-profiling>

    <app-daily-service *ngIf="reportForm.value?.report_type.id === 'daily-service' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys" [userInfo]="userInfo"
      [submit_flag]="submit_flag"
    ></app-daily-service>

    <app-feedback-report *ngIf="reportForm.value?.report_type.id === 'feedback' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys" [userInfo]="userInfo"
      [submit_flag]="submit_flag"
      [start_date]="reportForm.value.start_date"
      [end_date]="reportForm.value.end_date"
    ></app-feedback-report>

    <app-ab-post *ngIf="reportForm.value?.report_type.id === 'ab-post' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys" [userInfo]="userInfo"
      [submit_flag]="submit_flag"
      [start_date]="reportForm.value.start_date"
      [end_date]="reportForm.value.end_date"
    ></app-ab-post>

    <app-ab-pre *ngIf="reportForm.value?.report_type.id === 'ab-pre' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys" [userInfo]="userInfo"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-ab-pre>

    <app-fhsis2018-dental-m1 *ngIf="reportForm.value?.report_type.id === 'fhsis2018-dental-m1' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys"
      [facility]="userInfo.facility"
      [submit_flag]="submit_flag"
    ></app-fhsis2018-dental-m1>

    <app-fhsis2018-mortality-underlying *ngIf="reportForm.value?.report_type.id === 'fhsis2018-mortality-underlying' && report_data && !is_fetching"
      [report_data]="report_data"
      [reportForm]="reportForm"
      [selectedBrgy]="selectedBrgy"
      [brgys]="brgys" [userInfo]="userInfo"
    ></app-fhsis2018-mortality-underlying>

    <div class="flex flex-col justify-center" *ngIf="is_fetching">
      <fa-icon class="text-blue-500 mx-auto pt-36 text-xl" [icon]="faCircleNotch" spin="true"></fa-icon>
      <span class="pt-4 mx-auto pb-36 select-none">Fetching Report...</span>
    </div>
  </div>
</div>
