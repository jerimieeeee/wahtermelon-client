<fieldset class="border border-slate-200 w-full rounded-md my-2" *ngFor="let chart of tooth_chart">
  <legend class="ml-3 text-sm bg-blue-200 px-5 py-1 rounded-md uppercase">
    <button type="button" (click)="toggleChart(chart.title)">
      <fa-icon [icon]="show_chart[chart.title] ? faChevronCircleUp : faChevronCircleDown" class="mr-1 text-blue-500"></fa-icon>
    </button>
    {{ chart.title }} TOOTH CHART

    <span *ngIf="!consultCondition" class="text-red-500 text-sm lowercase">
      (from previous visit)
    </span>
  </legend>

  <div *ngIf="show_chart[chart.title]">
    <div class="flex justify-center w-full mt-3">
      <span class="text-sm mt-3">Tooth Condition</span>
      <select class="input w-32 mx-3" [(ngModel)]="condition[chart.title]" (change)="updateConditions(chart.title)">
        <option *ngFor="let item of tooth_condition_legend" [value]="item.id">{{ item.desc }}</option>
      </select>
    </div>

    <div class="flex flex-wrap justify-center my-3 first:mt-24 mx-auto" *ngFor="let item of chart.chart">
      <div class="w-14" *ngFor="let tooth_n of item">
        <span class="ml-5">{{ tooth_n.tooth_number }}</span>

        <div>
          <select class="input" [(ngModel)]="tooth_condition[tooth_n.tooth_number]">
            <option *ngFor="let item of tooth_condition_legend" [value]="item.id">
              {{ item.id === 'Y' ? '&#10003;' : item.id }}
            </option>
          </select>
        </div>

        <div *ngIf="consultCondition" class="text-xs bg-gray-100 w-full border border-gray-300 px-0.5 mt-1">
          <div *ngIf="!this.current_services[tooth_n.tooth_number]" class="flex justify-center">
            <button type="button" class="text-xs bg-blue-400 text-white w-5 m-0.5 pb-0.5 rounded-full" (click)="toggleModal('tooth_services', tooth_n, $event)">
              <fa-icon [icon]="faAdd"></fa-icon>
            </button>
          </div>

          <div *ngFor="let item of this.current_services[tooth_n.tooth_number]; let last = last">
            <div *ngIf="item">
              <button (click)="toggleModal('delete-service', item)">
                <fa-icon [icon]="faTrash" class="text-red-500"></fa-icon>
              </button>
              {{ item.service_code }}
            </div><br *ngIf="!last" />
          </div>
        </div>
      </div>
    </div>

    <div class="flex justify-center w-full mb-3">
      <button [disabled]="is_saving" class="btn-save h-9 mt-1" (click)="onSubmit(chart.title)">
        <fa-icon [icon]="is_saving ? faCircleNotch : faSave" [spin]="is_saving"></fa-icon>
        {{ is_saving ? 'Saving ' : 'Save ' }} Tooth Condition
      </button>
    </div>
  </div>
</fieldset>

<fieldset class="border border-slate-200 w-full rounded-md mb-2">
  <legend class="ml-5 font-semibold text-xs">TOOTH CONDITION LEGEND</legend>

  <div class="grid grid-cols-3 m-5 text-sm">
    <div class="flex" *ngFor="let item of tooth_condition_legend">
      <strong>{{ item.id === 'Y' ? '&#10003;' : item.id }}</strong>:
      {{ item.desc }}
    </div>
  </div>
</fieldset>

<fieldset class="border border-slate-200 w-full rounded-md">
  <legend class="ml-5 font-semibold text-xs">TOOTH SERVICE LEGEND</legend>

  <div class="grid grid-cols-3 m-5 text-sm">
    <div *ngFor="let item of tooth_service_legend"><strong>{{ item.code }}</strong>: {{ item.desc }} </div>
  </div>
</fieldset>

<div class="mt-5 border border-solid border-gray-200 rounded-lg">
  <div class="bg-blue-500 w-full text-white p-3 rounded-t-lg justify-between flex">
    <span>Tooth Services</span>
  </div>

  <div class="flex flex-col justify-center">
    <table class="table-auto w-11/12 text-center m-5 mx-auto border border-slate-300 rounded-lg shadow-md">
      <thead class="border-b">
        <tr>
          <th class="px-3">Tooth Number</th>
          <th class="px-3">Date of Service</th>
          <th class="px-3">Service Done</th>
          <th class="px-3">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of service_list" [class]="item.consult_id === selected_visit.id ? 'bg-yellow-100' : ''">
          <td *ngIf="item">
            {{ item.tooth_number }}
          </td>
          <td *ngIf="item">{{ item.consult.consult_date | date: 'MM/dd/yyyy' }}</td>
          <td *ngIf="item">{{ item.tooth_service.desc }}</td>
          <td *ngIf="item">
            <button type="button" class="text-red-500" (click)="toggleModal('delete-service', item)">
              <fa-icon [icon]="faTrash"></fa-icon>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="pt-5">
  <div class="border border-solid border-gray-200 rounded-lg">
    <div class="bg-blue-500 w-full text-white p-3 rounded-t-lg font-semibold">
      Oral Health Condition
    </div>

    <form [formGroup]="oralConditionForm" (ngSubmit)="submitCondition()" >
      <div class="col-span-1 p-3">
        <div class="grid grid-cols-3 pl-3">
          <div class="col-span-1 mb-1" *ngFor="let item of oral_health_condition">
            <input type="checkbox" attr.id="{{ item.column_name }}" class="input-checkbox" [formControlName]="item.column_name" />
            <label class="pl-2 text-sm" attr.for="{{ item.column_name }}">{{ item.desc }}</label>
          </div>
        </div>
        <div class="block m-3">
          <textarea rows="2" id="remarks" formControlName="remarks" placeholder="Remarks" class="placeholder-slate-400 w-full rounded-md border-gray-300 bg-gray-50"></textarea>
        </div>
      </div>

      <div class="text-right m-5">
        <button type="submit" class="btn-save" [disabled]="saving_oralCondition">
          <fa-icon class="mr-3" [icon]="saving_oralCondition ? faCircleNotch : faSave" [spin]="saving_oralCondition"></fa-icon>
          {{ saving_oralCondition ? 'Saving' : 'Save' }}
        </button>
      </div>
    </form>
  </div>
</div>


<app-delete-item *ngIf="modals['delete-service']"
  [url]="url"
  [delete_id]="delete_id"
  [delete_desc]="delete_desc"
  (toggleModal)="toggleModal('delete-service')"
></app-delete-item>

<!-- <app-tooth-condition *ngIf="modals['tooth_condition']"
  (toggleModal)="toggleModal($event)"
  [selected_tooth]="selected_tooth"
  [selected_visit]="selected_visit"
></app-tooth-condition> -->

<app-tooth-services *ngIf="modals['tooth_services']"
  (toggleModal)="toggleModal($event)"
  [selected_tooth]="selected_tooth"
  [selected_visit]="selected_visit"
></app-tooth-services>

<!-- <svg class="cursor-pointer opacity-50 hover:opacity-100" viewBox="0 0 965 960" style="enable-background:new 0 0 965 960"
          (click)="toggleModal('tooth_condition', tooth_n)"
          (contextmenu)="toggleModal('tooth_services', tooth_n, $event)">
      <g>
        <path fill="#FFFFFF" d="M339.5,336.5l-174-175c0,0-133,121-133,318c0,195,132,318,132,318l174-175c0,0-58-51-58-144 S339.5,336.5,339.5,336.5z"/>
        <path fill="#FFFFFF" d="M625.49,337.55l175-174c0,0-121-133-318-133c-195,0-318,132-318,132l175,174c0,0,51-58,144-58 S625.49,337.55,625.49,337.55z"/>
        <path fill="#FFFFFF" d="M625.96,623.64l174,175c0,0,133-121,133-318c0-195-132-318-132-318l-174,175c0,0,58,51,58,144 S625.96,623.64,625.96,623.64z"/>
        <path fill="#FFFFFF" d="M340.44,623.21l-175,174c0,0,121,133,318,133c195,0,318-132,318-132l-175-174c0,0-51,58-144,58 S340.44,623.21,340.44,623.21z"/>
        <circle [style]="test_case ? 'fill:#FFFFFF' : 'fill:#FFFF00'" cx="483.5" cy="480.5" r="212.63"/>
      </g>
      <g>
        <circle stroke="#090909" stroke-width="10" fill="none" cx="483.5" cy="480.5" r="212.63"/>
        <circle stroke="#090909" stroke-width="10" fill="none" cx="483.5" cy="480.5" r="440"/>
        <line stroke="#090909" stroke-width="10" x1="165" y1="162" x2="333" y2="329"/>
        <line stroke="#090909" stroke-width="10" x1="333" y1="630" x2="164" y2="797"/>
        <line stroke="#090909" stroke-width="10" x1="801" y1="162" x2="633" y2="330"/>
        <line stroke="#090909" stroke-width="10" x1="632" y1="630" x2="800.13" y2="798.72"/>
      </g>
    </svg> -->
