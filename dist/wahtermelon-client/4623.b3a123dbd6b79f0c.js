"use strict";(self.webpackChunkwahtermelon_client=self.webpackChunkwahtermelon_client||[]).push([[4623],{4623:(Y,h,l)=>{l.r(h),l.d(h,{MedCertComponent:()=>B});var a=l(177),c=l(9417),p=l(2517),g=l(60),d=l(5383),m=l(9726),t=l(4438),x=l(3318),b=l(41),v=l(1410),y=l(345);const C=n=>({label:"Name",value:n}),E=n=>({label:"Age",value:n}),F=n=>({label:"Sex",value:n}),M=n=>({label:"Civil Status",value:n}),P=n=>({label:"Address",value:n}),j=n=>({label:"Occupation",value:n}),R=n=>({label:"Date of Consultation",value:n}),I=n=>({label:"Diagnosis",value:n}),k=n=>({label:"Remarks",value:n}),D=(n,s,e,i,o,r,_,u,f)=>[n,s,e,i,o,r,_,u,f],w=(n,s)=>({width:n,height:s});function T(n,s){if(1&n){const e=t.RV6();t.j41(0,"button",12),t.bIt("click",function(){t.eBV(e);const o=t.XpG(2);return t.Njj(o.exportP())}),t.nrm(1,"fa-icon",13),t.k0s()}if(2&n){const e=t.XpG(2);t.Y8G("disabled",e.show_form),t.R7$(),t.Y8G("icon",e.faFilePdf)}}function O(n,s){if(1&n&&(t.j41(0,"button",14),t.nrm(1,"fa-icon",13),t.k0s()),2&n){const e=t.XpG(2);t.Y8G("disabled",e.show_form)("useExistingCss",!0),t.R7$(),t.Y8G("icon",e.faPrint)}}function G(n,s){if(1&n){const e=t.RV6();t.j41(0,"div",24)(1,"label",25),t.EFF(2,"Please specify"),t.k0s(),t.j41(3,"input",26),t.mxI("ngModelChange",function(o){t.eBV(e);const r=t.XpG(3);return t.DH7(r.otherPurpose,o)||(r.otherPurpose=o),t.Njj(o)}),t.k0s()()}if(2&n){const e=t.XpG(3);t.R7$(3),t.R50("ngModel",e.otherPurpose)}}function U(n,s){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"label",15),t.EFF(2,"Select Purpose"),t.k0s(),t.j41(3,"select",16),t.mxI("ngModelChange",function(o){t.eBV(e);const r=t.XpG(2);return t.DH7(r.selectedPurpose,o)||(r.selectedPurpose=o),t.Njj(o)}),t.j41(4,"option",17),t.EFF(5,"Select..."),t.k0s(),t.j41(6,"option",18),t.EFF(7,"Work"),t.k0s(),t.j41(8,"option",19),t.EFF(9,"School"),t.k0s(),t.j41(10,"option",20),t.EFF(11,"Travel"),t.k0s(),t.j41(12,"option",21),t.EFF(13,"Others"),t.k0s()(),t.DNE(14,G,4,1,"div",22),t.j41(15,"button",23),t.bIt("click",function(){t.eBV(e);const o=t.XpG(2);return t.Njj(o.goToStep(2))}),t.EFF(16," Next "),t.k0s(),t.bVm()}if(2&n){const e=t.XpG(2);t.R7$(3),t.R50("ngModel",e.selectedPurpose),t.R7$(11),t.Y8G("ngIf","others"===e.selectedPurpose),t.R7$(),t.Y8G("disabled",!e.isPurposeValid())}}function N(n,s){if(1&n&&(t.j41(0,"div",30),t.nrm(1,"fa-icon",31),t.j41(2,"span"),t.EFF(3,"Loading certificate data..."),t.k0s()()),2&n){const e=t.XpG(3);t.R7$(),t.Y8G("icon",e.faSpinner)("spin",!0)}}function S(n,s){if(1&n&&t.nrm(0,"img",51),2&n){const e=t.XpG(4);t.Y8G("src",e.logoUrl,t.B4B)("ngStyle",t.l_i(2,w,e.getFacilityLength(e.facilityName).width,e.getFacilityLength(e.facilityName).height))}}function A(n,s){if(1&n&&(t.qex(0),t.j41(1,"div",52)(2,"div",53),t.EFF(3),t.k0s(),t.j41(4,"div",54),t.EFF(5),t.k0s()(),t.bVm()),2&n){const e=s.$implicit;t.R7$(3),t.SpI("",e.label,":"),t.R7$(2),t.JRh(e.value)}}function L(n,s){if(1&n&&(t.qex(0),t.j41(1,"div",32)(2,"div",33)(3,"div",34),t.DNE(4,S,1,5,"img",35),t.k0s(),t.j41(5,"div",36)(6,"h4",37),t.EFF(7),t.k0s(),t.j41(8,"h4",38),t.EFF(9),t.k0s(),t.j41(10,"h4",38),t.EFF(11),t.k0s()()(),t.j41(12,"h1",39),t.EFF(13,"MEDICAL CERTIFICATE"),t.k0s(),t.j41(14,"div",40),t.EFF(15),t.k0s(),t.j41(16,"p",41)(17,"span",42),t.EFF(18,"To Whom It May Concern"),t.k0s(),t.nrm(19,"br"),t.EFF(20," This is to certify that we have on record the following data from the patient's information, to wit: "),t.k0s(),t.j41(21,"div",43),t.DNE(22,A,6,2,"ng-container",29),t.k0s(),t.j41(23,"p",44),t.EFF(24," This document is issued upon the request of the patient for "),t.j41(25,"span",45),t.EFF(26),t.nI1(27,"lowercase"),t.k0s(),t.EFF(28," purposes only and is not intended for medico-legal use. "),t.k0s(),t.j41(29,"div",46)(30,"div")(31,"p",47),t.EFF(32),t.k0s(),t.j41(33,"p",48),t.EFF(34,"Attending Physician"),t.k0s(),t.j41(35,"p",48),t.EFF(36),t.k0s()()(),t.j41(37,"div",49)(38,"span"),t.EFF(39,"*This certificate was generated using the WAHtermelon EMR"),t.k0s(),t.nrm(40,"img",50),t.k0s()(),t.bVm()),2&n){const e=s.$implicit,i=t.XpG(3);t.R7$(4),t.Y8G("ngIf",i.logoUrl),t.R7$(3),t.JRh(i.facilityName),t.R7$(2),t.SpI(" ","Province Of NCR, All District"===(null==e?null:e.header_name)?"National Capital Region":null==e?null:e.header_name," "),t.R7$(2),t.SpI("Municipality of ",null==e?null:e.municipality_name,""),t.R7$(4),t.SpI("Date: ",i.dateNgayon,""),t.R7$(7),t.Y8G("ngForOf",t.zJS(29,D,[t.eq3(11,C,null==e?null:e.patient_name),t.eq3(13,E,null==e?null:e.age),t.eq3(15,F,null==e?null:e.gender),t.eq3(17,M,null==e?null:e.civil_status),t.eq3(19,P,null==e?null:e.address),t.eq3(21,j,null==e?null:e.occupation),t.eq3(23,R,null==e?null:e.consult_date),t.eq3(25,I,null==e||null==e.final_diagnosis[0]||null==e.final_diagnosis[0].lib_icd10?null:e.final_diagnosis[0].lib_icd10.icd10_desc),t.eq3(27,k,i.capitalizeFirst(null==e?null:e.treatment_plan))])),t.R7$(4),t.JRh(t.bMT(27,9,i.displayPurpose)),t.R7$(6),t.SpI("",null==e?null:e.physician,", MD"),t.R7$(4),t.SpI("License No. ",null==e?null:e.physician_prc,"")}}function X(n,s){if(1&n&&(t.qex(0),t.DNE(1,N,4,2,"div",27),t.j41(2,"div",28),t.DNE(3,L,41,39,"ng-container",29),t.k0s(),t.bVm()),2&n){const e=t.XpG(2);t.R7$(),t.Y8G("ngIf",e.show_form),t.R7$(2),t.Y8G("ngForOf",e.consult)}}function $(n,s){if(1&n){const e=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3",4),t.EFF(4,"Medical Certificate"),t.k0s(),t.j41(5,"div",5),t.DNE(6,T,2,2,"button",6)(7,O,2,3,"button",7),t.k0s()(),t.j41(8,"div",8),t.DNE(9,U,17,3,"ng-container",9)(10,X,4,2,"ng-container",9),t.k0s(),t.j41(11,"div",10)(12,"button",11),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.closeModal())}),t.EFF(13," Close "),t.k0s()()()()}if(2&n){const e=t.XpG();t.R7$(6),t.Y8G("ngIf",2===e.step),t.R7$(),t.Y8G("ngIf",2===e.step),t.R7$(2),t.Y8G("ngIf",1===e.step),t.R7$(),t.Y8G("ngIf",2===e.step),t.R7$(2),t.Y8G("disabled",e.is_loading)}}let B=(()=>{class n{constructor(e,i,o,r,_,u,f){this.router=e,this.http=i,this.ageService=o,this.datePipe=r,this.exportAsService=_,this.sanitizer=u,this.route=f,this.faFilePdf=d.O_q,this.faFileExcel=d.fny,this.faSpinner=d.z1G,this.faPrint=d.JxU,this.isModalOpen=!0,this.exportAsPdf={type:"pdf",elementIdOrContent:"pdf-content",options:{html2canvas:{useCORS:!0,allowTaint:!1,scrollX:0,scrollY:0,scale:3},jsPDF:{orientation:"portrait",format:"a4",putOnlyUsedFonts:!0,precision:12,unit:"mm",compress:!1,margin:[0,0,0,0]}}},this.pdf_exported=!1,this.selectedPurpose="",this.otherPurpose="",this.step=1,this.consult=[],this.loading=!0,this.show_form=!0,this.user={facility:{facility_name:""},municipality:{municipality_code:""}},this.logoUrl="",this.apiBase=this.http.baseUrl.replace("/api/v1/","")}closeModal(){this.router.navigate(["../"],{relativeTo:this.route})}getAge(){if(this.patient_info&&this.patient_info.birthdate){let e=this.ageService.calcuateAge(this.patient_info.birthdate);return this.patient_age=e,e.age+" "+e.type+(e.age>1?"s old":" old")}}todaysDate(){const i=this.datePipe.transform(new Date,"MM/dd/yyyy");this.dateNgayon=i}getTrailName(){let e="";return e=this.consult[0]?.file_patient_name+"_Medical Certificate",e}getFacilityLength(e){return console.log(e,"facility name"),e&&e.length>40?{width:"70px",height:"70px"}:{width:"80px",height:"80px"}}exportP(e){this.pdf_exported=!0,this.pdf_exported?this.exportAsService.save(this.exportAsPdf,this.getTrailName()).subscribe(()=>{this.printCount()}):setTimeout(()=>this.exportP(e),300)}printCount(){const e=this.consultation.consult_id;console.log(e,"consult id for print"),this.http.post(`consultation/print/${e}`,{}).subscribe({next:i=>{console.log("Print count updated:",i)},error:i=>{console.error("Error incrementing print count:",i)}})}goToStep(e){this.step=e}isPurposeValid(){return this.selectedPurpose&&("others"!==this.selectedPurpose||this.otherPurpose.trim().length>0)}get displayPurpose(){return"others"===this.selectedPurpose?this.otherPurpose:this.selectedPurpose}getConsultInfo(){this.http.get("consultation/med-cert",{params:this.consultation}).subscribe({next:i=>{this.consult=i.data,console.log("consult:",this.consult),this.show_form=!1},error:i=>{this.loading=!1,this.show_form=!1}})}capitalizeFirst(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():""}fetchFacilityLogo(){this.http.get("consultation/logo",{params:{facility_code:this.facility_code}}).subscribe({next:e=>{console.log("Logo response:",e),e.path&&(this.logoUrl=this.apiBase+"/logo-image/"+e.path.replace("/storage/logos/",""),console.log("Full logo URL:",this.logoUrl))},error:e=>{console.warn("No logo found:",e),this.logoUrl=""}})}ngOnInit(){let e=this.http.getUserFromJSON().facility;this.facilityName=e.facility_name,this.getFacilityLength(this.facilityName),console.log(e,"facility"),this.facility_code=e.code??e.facility.code,this.consultation=this.http.getUrlParams(),this.consultation.consult_id?.includes("/")&&(this.consultation.consult_id=this.consultation.consult_id.split("/")[0]),console.log(this.consultation,"consult id"),console.log(this.facility_code,"facility code"),this.todaysDate(),this.getConsultInfo(),this.fetchFacilityLogo()}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(p.Ix),t.rXU(x.k),t.rXU(b.V),t.rXU(a.vh),t.rXU(v.a),t.rXU(y.up),t.rXU(p.nX))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-med-cert"]],features:[t.Jv_([a.vh])],decls:1,vars:1,consts:[["class","fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",4,"ngIf"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black","bg-opacity-50"],[1,"bg-white","rounded-lg","shadow-lg","w-full","max-w-[750px]","max-h-[90vh]","flex","flex-col"],[1,"sticky","top-0","flex","justify-between","items-center","px-6","py-4","bg-blue-500","rounded-t"],[1,"text-white","font-bold","text-lg"],[1,"flex","items-center","gap-2"],["type","button","class","text-2xl text-white disabled:text-gray-200",3,"disabled","click",4,"ngIf"],["printSectionId","pdf-content","ngxPrint","","type","button","class","text-2xl text-white disabled:text-gray-200",3,"disabled","useExistingCss",4,"ngIf"],[1,"p-4","overflow-y-auto","flex-1"],[4,"ngIf"],[1,"flex","justify-end","py-4","px-5","space-x-4","rounded-b","border-t"],["type","button",1,"px-5","py-2","bg-red-500","text-white","rounded","hover:bg-red-600",3,"click","disabled"],["type","button",1,"text-2xl","text-white","disabled:text-gray-200",3,"click","disabled"],[3,"icon"],["printSectionId","pdf-content","ngxPrint","","type","button",1,"text-2xl","text-white","disabled:text-gray-200",3,"disabled","useExistingCss"],["for","purpose",1,"block","mb-2","font-semibold"],["id","purpose",1,"border","px-3","py-2","rounded","w-full",3,"ngModelChange","ngModel"],["value","","disabled",""],["value","work"],["value","school"],["value","travel"],["value","others"],["class","mt-4",4,"ngIf"],[1,"mt-4","bg-blue-600","text-white","px-4","py-2","rounded","hover:bg-blue-700","disabled:bg-gray-400",3,"click","disabled"],[1,"mt-4"],["for","otherPurpose",1,"block","mb-2","font-semibold"],["id","otherPurpose","type","text","placeholder","Enter purpose",1,"border","px-3","py-2","rounded","w-full",3,"ngModelChange","ngModel"],["class","flex justify-center items-center py-4",4,"ngIf"],["id","pdf-content",1,"flex","flex-col","items-center","w-full","space-y-5","overflow-y-auto","flex-1"],[4,"ngFor","ngForOf"],[1,"flex","justify-center","items-center","py-4"],[1,"mr-2","text-blue-600","text-xl",3,"icon","spin"],[1,"scale-[0.75]","mt-4","origin-top","w-full","bg-white","px-2","py-5"],[1,"grid","grid-cols-[auto_1fr]","items-center","w-full","mx-auto","my-2"],[1,"flex","justify-center","items-start"],["class","rounded-full object-cover",3,"src","ngStyle",4,"ngIf"],[1,"text-center","mr-6"],[1,"font-semibold","text-lg"],[1,"text-base"],[1,"text-xl","text-center","font-semibold","ml-10","my-2"],[1,"text-right","mb-4"],[1,"mb-4"],[1,"font-semibold","uppercase"],[1,"flex","flex-col","space-y-4","border-b","border-gray-300","pb-6"],[1,"mt-10"],[1,"font-semibold"],[1,"flex","justify-end","mt-16","text-right"],[1,"font-semibold","text-center"],[1,"text-sm","text-gray-700","text-center"],[1,"mt-10","pt-6","flex","items-center","justify-center","space-x-3","text-sm","italic","text-gray-700"],["src","./assets/img/wah_icon.png",1,"rounded-full","w-9","h-9"],[1,"rounded-full","object-cover",3,"src","ngStyle"],[1,"flex","gap-4","items-start"],[1,"w-44","font-semibold"],[1,"flex-1","whitespace-pre-line"]],template:function(i,o){1&i&&t.DNE(0,$,14,5,"div",0),2&i&&t.Y8G("ngIf",o.isModalOpen)},dependencies:[a.MD,a.Sq,a.bT,a.B3,a.GH,c.YN,c.xH,c.y7,c.me,c.wz,c.BC,c.vS,g.dX,g.aY,m.jN,m.GV],encapsulation:2})}}return n})()}}]);