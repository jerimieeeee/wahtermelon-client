<div class="flex mb-3">
  <h4 class="font-bold text-gray-600 text-sm">FIRST VISIT</h4>
</div>

<form [formGroup]="visitForm" (submit)="onSubmit()">
  <div class="card mb-6">
    <div class="card-header bg-blue-500">
      <h4 class="font-semibold text-white text-sm uppercase">Admission Information</h4>
    </div>

    <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-10 py-2 mt-2">
      <label>Admission Date & Time</label>

      <div class="relative">
        <div class="flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time text-blue-500" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4"></path>
            <circle cx="18" cy="18" r="4"></circle>
            <path d="M15 3v4"></path>
            <path d="M7 3v4"></path>
            <path d="M3 11h16"></path>
            <path d="M18 16.496v1.504l1 1"></path>
          </svg>
        </div>
        <input type="datetime-local" placeholder="Select Date and Time" class="mt-1 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 datepicker-input" placeholder="Select date" formControlName="admission_date" required>
      </div>

      <div *ngIf="form_saving && f.admission_date.errors" class="invalid-alert mt-1">
        <div *ngIf="f.admission_date.errors?.['required']">
          {{ required_message }}
        </div>
      </div>
    </div>


    <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-10 py-2 mt-2">
      <label>Discharge Date & Time</label>

      <div class="relative">
        <div class="flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time text-blue-500" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4"></path>
            <circle cx="18" cy="18" r="4"></circle>
            <path d="M15 3v4"></path>
            <path d="M7 3v4"></path>
            <path d="M3 11h16"></path>
            <path d="M18 16.496v1.504l1 1"></path>
          </svg>
        </div>
        <input type="datetime-local" placeholder="Select Date and Time"  class="mt-1 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 datepicker-input" placeholder="Select date" formControlName="discharge_date" required>
      </div>

      <div *ngIf="form_saving && f.discharge_date.errors" class="invalid-alert mt-1">
        <div *ngIf="f.discharge_date.errors?.['required']">
          {{ required_message }}
        </div>
      </div>
    </div>

    <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-10 py-2">
      <label>Weight at Birth (kg)</label>

      <div class="relative">
        <div class="flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-scale-outline text-blue-500" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <rect x="3" y="3" width="18" height="18" rx="4"></rect>
            <path d="M12 7c1.956 0 3.724 .802 4.994 2.095l-2.956 2.904a3 3 0 0 0 -2.038 -.799a3 3 0 0 0 -2.038 .798l-2.956 -2.903a6.979 6.979 0 0 1 4.994 -2.095z"></path>
          </svg>
        </div>
        <input type="number" class="mt-1 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 datepicker-input" placeholder="Input weight" [ngClass]="{'invalid-input': form_saving && f.birth_weight.errors}" formControlName="birth_weight" required>
      </div>

      <div *ngIf="form_saving && f.birth_weight.errors" class="invalid-alert mt-1">
        <div *ngIf="f.birth_weight.errors?.['required']">
          {{ required_message }}
        </div>
        <div *ngIf="f.birth_weight.errors?.['minlength']">
          Minimum of 2 character.
        </div>
      </div>
    </div>

    <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-10 py-2">
      <label>Mother's Name</label>

      <ng-select class="search-custom mt-1" placeholder="Search Mother"
        [items]="patients$ | async"
        [minTermLength]="minLengthTerm"
        [loading]="patientLoading"
        typeToSearchText="Search Mother's Name"
        [typeahead]="searchInput$"
        [clearable]="true"
        bindValue="id"
        (change)="hideItemName()"
        formControlName="mothers_id">

        <ng-template ng-label-tmp let-item="item" class="">
          <div class="flex">
            <div *ngIf="!hideName"><p class="" >{{patient_info2?.first_name}} {{patient_info2?.middle_name}} {{patient_info2?.last_name}}</p></div>
            <div ><p class="">{{item?.first_name}} {{item?.middle_name}} {{item?.last_name}}</p></div>
          </div>
        </ng-template>

        <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
          <div class="grid grid-flow-col auto-cols-max">
            <div class="my-auto mr-3">
              <div class="inline-flex overflow-hidden relative justify-center items-center w-14 h-14 bg-gray-100 rounded-full dark:bg-gray-600">
                <span class="font-medium text-gray-600 dark:text-gray-300">{{ getInitials(item.last_name+' '+item.first_name) }}</span>
              </div>
            </div>
            <div>
              <h5 class="text-blue-400" [ngOptionHighlight]="search">{{ item.last_name }}, {{ item.first_name }}</h5>
              <h6 class="text-muted">{{ item.birthdate }}</h6>
              <h6 class="text-muted">{{ item.brgy }}, {{ item.muncity }}</h6>
            </div>
          </div>
        </ng-template>

        <ng-template ng-footer-tmp>
          <a class="text-blue-600" routerLink="/registration"> Create a new record</a>
        </ng-template>
      </ng-select>
    </div>

    <div *ngIf="patient_info?.status !== null" class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-10 py-2 mt-2 select-none">
      <div class="relative ">
        <p class="bg-green-50 mt-1 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 font-semibold">{{cpab}}</p>
      </div>
    </div>

    <div class="flex w-full flex-col px-5 pt-3">
      <button type="button" class="btn-add ml-auto mr-5" (click)="onSubmit()" *ngIf="!patient_info">
        <fa-icon *ngIf="is_saving" class="mr-1" [icon]="is_saving ? faSpinner : faSave" [spin]="is_saving"></fa-icon>
        {{ is_saving ? 'Saving' : 'Save' }}
      </button>
      <button type="button" class="btn-add ml-auto mr-5" (click)="onSubmit()" *ngIf="patient_info">
        <fa-icon *ngIf="is_saving" class="mr-1" [icon]="is_saving ? faSpinner : faSave" [spin]="is_saving"></fa-icon>
        {{ is_saving ? 'Updating' : 'Update' }}
      </button>
    </div>
  </div>
</form>
