<div class="grid grid-cols-11 mt-4 gap-4">
  <div class="mb-16 col-span-8">
    <div class="block shadow p-4 mt-4 rounded-xl text-gray-600 border border-slate-100">
      <span class="text-sky-500 font-bold flex justify-between py-2">
        <span class="flex">
          <span class="mt-2"> Prescription and Dispensing</span>
        </span>
      </span>

      <div class="border border-slate-200 shadow-md rounded-xl">
        <div class="flex justify-between w-full bg-orange-500 text-white rounded-t-xl p-3 font-semibold">
          <span class="mt-3">Prescriptions</span>
          <div class="flex w-5/12 justify-end">
            <label for="dispensing_date" class="mr-2 mt-3">Dispense date</label>
            <input type="date" name="dispensing_date" [(ngModel)]="dispensing_date" placeholder="mm/dd/yyyy" class="input w-1/2 text-gray-700 font-normal" />
          </div>
        </div>

        <div class="w-full p-5">
          <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
              <tr>
                <th scope="col" class="text-center py-3 px-3 w-3/12 ">Medicine</th>
                <th scope="col" class="text-center py-3 px-3 w-3/12">Intake</th>
                <th scope="col" class="text-center py-3 px-3 w-1/12">Prescription Date</th>
                <th scope="col" class="text-center py-3 px-3 w-1/12">Quantity</th>
                <th scope="col" class="text-center py-3 px-3 w-1/12">Unit of Measurement</th>
                <th scope="col" class="text-center py-3 px-3 w-1/12">Dispense Quantity</th>
                <th scope="col" class="text-center py-3 px-3 w-2/12">Remarks</th>
              </tr>
            </thead>
            <tbody *ngIf="show_form">
              <tr *ngFor="let pres of prescriptions; trackBy:identify" class="bg-white border-b last:border-0">
                <td class="py-4 px-3">
                  {{ pres.konsulta_medicine.desc ?? pres.added_medicine}}
                </td>
                <td scope="row" class="py-4 px-3 font-medium text-gray-900">
                  {{ pres.dosage_quantity }} {{ pres.unit_of_measurement.desc }} {{ pres.regimen.desc }}
                  {{ pres.duration_intake }} {{ pres.frequency.desc }}
                </td>
                <td scope="row" class="py-4 px-3 font-medium text-gray-900">
                  {{ pres.prescription_date | date : 'MM/dd/yyyy'}}
                </td>
                <td scope="row" class="py-4 px-3 font-medium text-gray-900">
                  {{ pres.quantity }}
                </td>
                <td scope="row" class="py-4 px-3 font-medium text-gray-900">
                  {{ pres.preparation.desc }}
                </td>
                <td scope="row" class="py-4 px-3">
                  <input type="number" class="w-16 h-7 border border-slate-400 rounded" [(ngModel)]="pres.dispense_quantity"/>
                </td>
                <td scope="row" class="py-4 px-3">
                  <textarea [disabled]="!pres.dispense_quantity || pres.dispense_quantity === 0" class="w-full border border-slate-400 rounded text-sm disabled:bg-gray-200" [(ngModel)]="pres.remarks"></textarea>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="flex justify-end w-full">
          <button [disabled]="!dispensing_date" type="button" class="btn-save px-10 mr-5 mb-5 disabled:bg-gray-300" (click)="onSubmit()">
            Dispense
          </button>
        </div>
      </div>

      <div class="border border-slate-200 shadow-md rounded-xl mt-5">
        <div class="w-full bg-green-500 text-white rounded-t-xl p-3 font-semibold">
          Dispensed Drugs
        </div>

        <div class="w-full p-5">
          <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
              <tr>
                <th scope="col" class="text-center py-3 px-3 w-3/12 ">Medicine</th>
                <th scope="col" class="text-center py-3 px-3 w-3/12">Intake</th>
                <th scope="col" class="text-center py-3 px-3 w-1/12">Prescription Date</th>
                <th scope="col" class="text-center py-3 px-3 w-1/12">Quantity</th>
                <th scope="col" class="text-center py-3 px-3 w-1/12">Unit of Measurement</th>
                <th scope="col" class="text-center py-3 px-3 w-1/12">Dispense Quantity</th>
                <th scope="col" class="text-center py-3 px-3 w-2/12">Remarks</th>
              </tr>
            </thead>
            <tbody *ngIf="show_form">
              <tr *ngFor="let dis of dispensed_list; trackBy:identify" class="bg-white border-b last:border-0">
                <td class="py-4 px-3">
                  {{ dis.prescription.konsulta_medicine.desc ?? dis.prescription.added_medicine}}
                </td>
                <td scope="row" class="py-4 px-3 font-medium text-gray-900">
                  {{ dis.prescription.dosage_quantity }} {{ dis.prescription.unit_of_measurement.desc }} {{ dis.prescription.regimen.desc }}
                  {{ dis.prescription.duration_intake }} {{ dis.prescription.frequency.desc }}
                </td>
                <td scope="row" class="py-4 px-3 font-medium text-gray-900">
                  {{ dis.prescription.prescription_date | date : 'MM/dd/yyyy'}}
                </td>
                <td scope="row" class="py-4 px-3 font-medium text-gray-900">
                  {{ dis.prescription.quantity }}
                </td>
                <td scope="row" class="py-4 px-3 font-medium text-gray-900">
                  {{ dis.prescription.preparation.desc }}
                </td>
                <td scope="row" class="py-4 px-3">
                  {{ dis.dispense_quantity }}
                </td>
                <td scope="row" class="py-4 px-3">
                  {{ dis.remarks }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>


  <div class="col-span-3">
    <app-patient-info (patientInfo)="patientInfo($event)"></app-patient-info>
  </div>
</div>

<app-lab-form *ngIf="modal['add']" [selected_lab]="selected_lab" (toggleModal)="toggleModal($event)"></app-lab-form>
<app-lab-delete *ngIf="modal['delete']" [selected_lab]="selected_lab" (toggleModal)="toggleModal($event)"></app-lab-delete>
