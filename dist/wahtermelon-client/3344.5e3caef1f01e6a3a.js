"use strict";(self.webpackChunkwahtermelon_client=self.webpackChunkwahtermelon_client||[]).push([[3344],{3344:(ot,u,l)=>{l.r(u),l.d(u,{FacilityConfigModule:()=>nt});var d=l(177),b=l(2517),_=l(5383),t=l(4438),g=l(3318),m=l(5794),r=l(9417),h=l(60),p=l(614);function C(n,c){if(1&n&&(t.j41(0,"option",14),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.Y8G("value",e),t.R7$(),t.JRh(e)}}function F(n,c){if(1&n){const e=t.RV6();t.j41(0,"tr",22)(1,"td",23)(2,"span",24),t.EFF(3),t.k0s(),t.nrm(4,"br"),t.j41(5,"span",25),t.EFF(6),t.k0s()(),t.j41(7,"td",26),t.EFF(8),t.k0s(),t.j41(9,"td")(10,"input",27),t.mxI("ngModelChange",function(a){const s=t.eBV(e).index,i=t.XpG(3);return t.DH7(i.catchment_barangays[i.selected_year].data[s].population,a)||(i.catchment_barangays[i.selected_year].data[s].population=a),t.Njj(a)}),t.k0s()(),t.j41(11,"td")(12,"input",27),t.mxI("ngModelChange",function(a){const s=t.eBV(e).index,i=t.XpG(3);return t.DH7(i.catchment_barangays[i.selected_year].data[s].population_opt,a)||(i.catchment_barangays[i.selected_year].data[s].population_opt=a),t.Njj(a)}),t.k0s()(),t.j41(13,"td")(14,"input",27),t.mxI("ngModelChange",function(a){const s=t.eBV(e).index,i=t.XpG(3);return t.DH7(i.catchment_barangays[i.selected_year].data[s].population_wra,a)||(i.catchment_barangays[i.selected_year].data[s].population_wra=a),t.Njj(a)}),t.k0s()(),t.j41(15,"td")(16,"input",27),t.mxI("ngModelChange",function(a){const s=t.eBV(e).index,i=t.XpG(3);return t.DH7(i.catchment_barangays[i.selected_year].data[s].household,a)||(i.catchment_barangays[i.selected_year].data[s].household=a),t.Njj(a)}),t.k0s()(),t.j41(17,"td",28)(18,"input",29),t.mxI("ngModelChange",function(a){const s=t.eBV(e).index,i=t.XpG(3);return t.DH7(i.catchment_barangays[i.selected_year].data[s].zod,a)||(i.catchment_barangays[i.selected_year].data[s].zod=a),t.Njj(a)}),t.k0s()()()}if(2&n){const e=c.$implicit,o=c.index,a=t.XpG(3);t.R7$(3),t.JRh(e.barangay.name),t.R7$(3),t.SpI("(",e.barangay.code,")"),t.R7$(2),t.JRh(e.year),t.R7$(2),t.R50("ngModel",a.catchment_barangays[a.selected_year].data[o].population),t.R7$(2),t.R50("ngModel",a.catchment_barangays[a.selected_year].data[o].population_opt),t.R7$(2),t.R50("ngModel",a.catchment_barangays[a.selected_year].data[o].population_wra),t.R7$(2),t.R50("ngModel",a.catchment_barangays[a.selected_year].data[o].household),t.R7$(2),t.R50("ngModel",a.catchment_barangays[a.selected_year].data[o].zod)}}function x(n,c){1&n&&(t.j41(0,"tr")(1,"td",30),t.EFF(2,"No records to show"),t.k0s()())}function v(n,c){if(1&n&&(t.j41(0,"tbody"),t.DNE(1,F,19,8,"tr",21)(2,x,3,0,"tr",20),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.Y8G("ngForOf",e.catchment_barangays[e.selected_year].data),t.R7$(),t.Y8G("ngIf",0===e.catchment_barangays[e.selected_year].data.length)}}function j(n,c){if(1&n&&(t.j41(0,"table",15)(1,"thead")(2,"tr",16)(3,"th",17),t.EFF(4,"BRGY NAME "),t.nrm(5,"br"),t.EFF(6,"(CODE)"),t.k0s(),t.j41(7,"th",18),t.EFF(8,"YEAR"),t.k0s(),t.j41(9,"th",19),t.EFF(10,"POPULATION"),t.k0s(),t.j41(11,"th",19),t.EFF(12,"OPT"),t.k0s(),t.j41(13,"th",19),t.EFF(14,"WRA"),t.k0s(),t.j41(15,"th",19),t.EFF(16,"HOUSEHOLD"),t.k0s(),t.j41(17,"th",19),t.EFF(18,"ZOD"),t.k0s()()(),t.DNE(19,v,3,2,"tbody",20),t.k0s()),2&n){const e=t.XpG();t.R7$(19),t.Y8G("ngIf",e.catchment_barangays[e.selected_year])}}function k(n,c){if(1&n&&(t.j41(0,"div",31)(1,"div",32),t.nrm(2,"fa-icon",33),t.k0s(),t.j41(3,"div",34),t.EFF(4," Loading... "),t.k0s()()),2&n){const e=t.XpG();t.R7$(2),t.Y8G("icon",e.faCircleNotch)}}function R(n,c){if(1&n&&t.nrm(0,"fa-icon",39),2&n){const e=t.XpG(2);t.Y8G("icon",e.faSave)}}function G(n,c){if(1&n&&t.nrm(0,"fa-icon",40),2&n){const e=t.XpG(2);t.Y8G("icon",e.faCircleNotch)}}function E(n,c){if(1&n){const e=t.RV6();t.j41(0,"div",35)(1,"button",36),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.onSubmit())}),t.DNE(2,R,1,1,"fa-icon",37)(3,G,1,1,"fa-icon",38),t.EFF(4),t.k0s()()}if(2&n){const e=t.XpG();t.R7$(),t.Y8G("disabled",e.is_saving||!e.show_form),t.R7$(),t.Y8G("ngIf",!e.is_saving),t.R7$(),t.Y8G("ngIf",e.is_saving),t.R7$(),t.SpI(" ",e.is_saving?"Updating":"Update"," ")}}function I(n,c){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const e=c.$implicit,o=c.last;t.R7$(),t.Lme(" ",e.barangay.name,"",o?"":", "," ")}}function w(n,c){if(1&n){const e=t.RV6();t.j41(0,"fa-icon",47),t.bIt("click",function(){t.eBV(e);const a=t.XpG().$implicit,s=t.XpG(2);return t.Njj(s.editPop(a.key))}),t.k0s()}if(2&n){const e=t.XpG(3);t.Y8G("icon",e.faEdit)}}function T(n,c){if(1&n&&(t.j41(0,"tr",22)(1,"td",23)(2,"span",24),t.EFF(3),t.k0s(),t.nrm(4,"br"),t.k0s(),t.j41(5,"td",26),t.EFF(6),t.k0s(),t.j41(7,"td",26),t.EFF(8),t.k0s(),t.j41(9,"td",26),t.EFF(10),t.k0s(),t.j41(11,"td",26),t.EFF(12),t.k0s(),t.j41(13,"td"),t.DNE(14,I,2,2,"span",45),t.k0s(),t.j41(15,"td",26),t.DNE(16,w,1,1,"fa-icon",46),t.k0s()()),2&n){const e=c.$implicit,o=t.XpG(2);t.R7$(3),t.JRh(e.key),t.R7$(3),t.JRh(e.value.total_population),t.R7$(2),t.JRh(e.value.total_population_opt),t.R7$(2),t.JRh(e.value.total_population_wra),t.R7$(2),t.JRh(e.value.total_household),t.R7$(2),t.Y8G("ngForOf",e.value.data),t.R7$(2),t.Y8G("ngIf",o.selected_year!==e.key)}}function B(n,c){if(1&n&&(t.j41(0,"table",15)(1,"thead")(2,"tr",41)(3,"th",42),t.EFF(4,"YEAR"),t.k0s(),t.j41(5,"th",42),t.EFF(6,"POPULATION"),t.k0s(),t.j41(7,"th",42),t.EFF(8,"OPT"),t.k0s(),t.j41(9,"th",42),t.EFF(10,"WRA"),t.k0s(),t.j41(11,"th",42),t.EFF(12,"HOUSEHOLD"),t.k0s(),t.j41(13,"th",43),t.EFF(14,"BARANGAY LIST"),t.k0s(),t.j41(15,"th",44),t.EFF(16,"ACTION"),t.k0s()()(),t.j41(17,"tbody"),t.DNE(18,T,17,7,"tr",21),t.nI1(19,"keyvalue"),t.k0s()()),2&n){const e=t.XpG();t.R7$(18),t.Y8G("ngForOf",t.bMT(19,1,e.catchment_population))}}function $(n,c){if(1&n&&(t.j41(0,"div",48)(1,"div",49),t.nrm(2,"fa-icon",33),t.k0s(),t.j41(3,"div",34),t.EFF(4," Loading... "),t.k0s()()),2&n){const e=t.XpG();t.R7$(2),t.Y8G("icon",e.faCircleNotch)}}let M=(()=>{class n{onSubmit(){this.is_saving=!0,this.http.post("settings/catchment-barangay",{year:this.selected_year,barangay:this.catchment_barangays[this.selected_year].data}).subscribe({next:o=>{this.toastr.success("Successfully recorded","Population"),this.is_saving=!1,this.updateData()},error:o=>console.log(o)})}editPop(e){this.selected_year!==e&&(this.selected_year=e,this.reloadData())}updateData(){this.show_pop=!1,this.getPopulations()}reloadData(){this.show_form=!1,this.getCatchmentBarangay.emit(this.selected_year)}getPopulations(){this.show_pop=!1,this.http.get("settings/catchment-barangay").subscribe({next:e=>{this.catchment_population=e,this.show_pop=!0},error:e=>console.log(e)})}constructor(e,o){this.http=e,this.toastr=o,this.getCatchmentBarangay=new t.bkB,this.faSave=p.hSh,this.faCircleNotch=_.s4k,this.faEdit=p.MT7,this.years=[],this.barangay_pop=[],this.is_saving=!1,this.show_form=!1,this.show_pop=!1}ngOnChanges(e){this.catchment_barangays&&(this.show_form=!0)}ngOnInit(){this.selected_year=this.current_year,this.getPopulations();for(let e=Number(this.current_year);e>2017;e--)this.years.push(e)}static{this.\u0275fac=function(o){return new(o||n)(t.rXU(g.k),t.rXU(m.tw))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-catchment-population"]],inputs:{catchment_barangays:"catchment_barangays",current_year:"current_year"},outputs:{getCatchmentBarangay:"getCatchmentBarangay"},standalone:!1,features:[t.OA$],decls:18,vars:7,consts:[[1,"grid","grid-cols-1","mt-5"],[1,"mb-5","border","border-slate-200","shadow-md","rounded-xl"],[1,"bg-blue-500","rounded-t-xl","p-3","text-white","font-semibold","flex","justify-between"],[1,"pt-1"],["name","selected_year","id","selected_year",1,"border","border-slate","rounded-md","text-sm","py-1","text-gray-800","w-28",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"h-[400px]","overflow-y-auto","overflow-x-auto"],["class","table-fixed w-full",4,"ngIf"],["class","grid grid-cols-1 mt-20",4,"ngIf"],["class","rounded-b-xl p-3 text-end border-t border-slate-300",4,"ngIf"],[1,"border","border-slate-200","shadow-md","rounded-xl"],[1,"bg-blue-500","rounded-t-xl","p-3","text-white","font-semibold"],[1,"overflow-y-auto","overflow-x-auto"],["class","grid grid-cols-1 my-20",4,"ngIf"],[3,"value"],[1,"table-fixed","w-full"],[1,"border-b","border-slate-200","bg-gray-100","text-xs","sticky","top-0"],[1,"w-36","h-12"],[1,"w-24"],[1,"w-36"],[4,"ngIf"],["class","mb-2 border-b border-slate-100",4,"ngFor","ngForOf"],[1,"mb-2","border-b","border-slate-100"],[1,"px-3","text-center"],[1,"font-semibold"],[1,"italic"],[1,"text-center"],["type","number",1,"input",3,"ngModelChange","ngModel"],[1,"flex","justify-center","pt-3"],["type","checkbox",1,"input-checkbox",3,"ngModelChange","ngModel"],["colspan","6",1,"text-center","italic","py-5"],[1,"grid","grid-cols-1","mt-20"],[1,"flex","justify-center","text-blue-500","text-xl"],["animation","spin",3,"icon"],[1,"flex","justify-center"],[1,"rounded-b-xl","p-3","text-end","border-t","border-slate-300"],["type","button",1,"btn-save",3,"click","disabled"],["class","pr-2",3,"icon",4,"ngIf"],["animation","spin","class","pr-2",3,"icon",4,"ngIf"],[1,"pr-2",3,"icon"],["animation","spin",1,"pr-2",3,"icon"],[1,"border-b","border-slate-200","bg-gray-100","text-xs"],[1,"w-20"],[1,"w-44"],[1,"w-12"],[4,"ngFor","ngForOf"],["class","text-orange-500 hover:cursor-pointer",3,"icon","click",4,"ngIf"],[1,"text-orange-500","hover:cursor-pointer",3,"click","icon"],[1,"grid","grid-cols-1","my-20"],[1,"flex","justify-center","text-blue-500"]],template:function(o,a){1&o&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t.EFF(4,"Update Population"),t.k0s(),t.j41(5,"div")(6,"select",4),t.mxI("ngModelChange",function(i){return t.DH7(a.selected_year,i)||(a.selected_year=i),i}),t.bIt("change",function(){return a.reloadData()}),t.DNE(7,C,2,2,"option",5),t.k0s()()(),t.j41(8,"div",6),t.DNE(9,j,20,1,"table",7)(10,k,5,1,"div",8),t.k0s(),t.DNE(11,E,5,4,"div",9),t.k0s(),t.j41(12,"div",10)(13,"div",11),t.EFF(14," Catchment Population "),t.k0s(),t.j41(15,"div",12),t.DNE(16,B,20,3,"table",7)(17,$,5,1,"div",13),t.k0s()()()),2&o&&(t.R7$(6),t.R50("ngModel",a.selected_year),t.R7$(),t.Y8G("ngForOf",a.years),t.R7$(2),t.Y8G("ngIf",a.show_form),t.R7$(),t.Y8G("ngIf",!a.show_form),t.R7$(),t.Y8G("ngIf",a.catchment_barangays[a.selected_year]&&a.catchment_barangays[a.selected_year].data.length>0),t.R7$(5),t.Y8G("ngIf",a.show_pop),t.R7$(),t.Y8G("ngIf",!a.show_pop))},dependencies:[d.Sq,d.bT,r.xH,r.y7,r.me,r.Q0,r.Zm,r.wz,r.BC,r.vS,h.aY,d.lG],encapsulation:2})}}return n})();var N=l(7468);function Y(n,c){if(1&n&&(t.j41(0,"option",26),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.Y8G("value",e.id),t.R7$(),t.Lme("",e.last_name,", ",e.first_name,"")}}function D(n,c){if(1&n&&(t.j41(0,"option",26),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.Y8G("value",e.barangay.code),t.R7$(),t.JRh(e.barangay.name)}}function S(n,c){if(1&n){const e=t.RV6();t.j41(0,"div",27)(1,"input",28),t.mxI("ngModelChange",function(a){const s=t.eBV(e).$implicit,i=t.XpG();return t.DH7(i.selected_barangays[s.id],a)||(i.selected_barangays[s.id]=a),t.Njj(a)}),t.k0s(),t.j41(2,"label",29),t.EFF(3),t.k0s()()}if(2&n){const e=c.$implicit,o=t.XpG();t.R7$(),t.x72("id","selected_barangays",e.id,""),t.R50("ngModel",o.selected_barangays[e.id]),t.R7$(),t.x72("for","selected_barangays",e.id,""),t.R7$(),t.JRh(e.barangay.name)}}function O(n,c){if(1&n&&t.nrm(0,"fa-icon",30),2&n){const e=t.XpG();t.Y8G("icon",e.faSave)}}function P(n,c){if(1&n&&t.nrm(0,"fa-icon",31),2&n){const e=t.XpG();t.Y8G("icon",e.faCircleNotch)}}function X(n,c){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.R7$(),t.SpI("",e.barangay.name,", ")}}function H(n,c){if(1&n){const e=t.RV6();t.j41(0,"tr",32)(1,"td",33),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.DNE(8,X,2,1,"span",34),t.k0s(),t.j41(9,"td",35)(10,"fa-icon",36),t.bIt("click",function(){const a=t.eBV(e).$implicit,s=t.XpG();return t.Njj(s.editBhs(a))}),t.k0s()()()}if(2&n){const e=c.$implicit,o=t.XpG();t.R7$(2),t.SpI(" ",e.bhs_name," "),t.R7$(2),t.Lme(" ",e.assigned_user.last_name,", ",e.assigned_user.first_name," "),t.R7$(2),t.SpI(" ",e.barangay.name," "),t.R7$(2),t.Y8G("ngForOf",e.bhs_barangay),t.R7$(2),t.Y8G("icon",o.faEdit)}}let V=(()=>{class n{editBhs(e){this.bhs=e,this.bhs.assigned_user_id=e.assigned_user.id,this.bhs.barangay_code=e.barangay.code,Object.entries(e.bhs_barangay).forEach(([o,a],s)=>{this.selected_barangays[a.id]=!0})}onSubmit(){this.is_loading=!0;let e=[];if(Object.entries(this.selected_barangays).forEach(([o,a],s)=>{a&&e.push({settings_catchment_barangay_id:o})}),e.length>0){let o;this.bhs.barangay=e,o=this.bhs.id?this.http.update("settings/bhs/",this.bhs.id,this.bhs):this.http.post("settings/bhs",this.bhs),o.subscribe({next:()=>{this.toastr.success("Successfully recorded","BHS"),this.loadData()},error:a=>console.log(a)})}else this.is_loading=!1}loadData(){const e=this.http.get("settings/bhs"),o=this.http.get("users",{params:{per_page:"all"}});(0,N.p)([e,o]).subscribe({next:([a,s])=>{this.facility_bhs=a.data,this.rhu_staffs=s.data,this.is_loading=!1},error:a=>console.log(a)})}getStaff(){this.http.get("users",{params:{per_page:"all"}}).subscribe({next:e=>{this.rhu_staffs=e.data},error:e=>console.log(e)})}constructor(e,o){this.http=e,this.toastr=o,this.faSave=p.hSh,this.faCircleNotch=_.s4k,this.faEdit=p.MT7,this.faTrashCan=_.sjs,this.living_arrangements=[],this.is_loading=!1,this.bhs={id:null,assigned_user_id:null,bhs_name:null,barangay_code:null,barangay:[]},this.selected_barangays=[],this.rhu_staffs=[],this.facility_bhs=[]}ngOnInit(){this.loadData()}static{this.\u0275fac=function(o){return new(o||n)(t.rXU(g.k),t.rXU(m.tw))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-catchment-bhs"]],inputs:{catchment_barangays:"catchment_barangays",facility_code:"facility_code",selected_year:"selected_year"},standalone:!1,decls:44,vars:11,consts:[[1,"grid","grid-cols-6","gap-5","mt-5"],[1,"col-span-2","grid","grid-cols-1","border","border-slate-200","shadow-md","rounded-lg","p-5"],["for","bhs_name",1,"font-semibold"],["type","text","name","bhs_name","id","bhs_name",1,"input",3,"ngModelChange","ngModel"],[1,"mt-5"],["for","selected_staff",1,"font-semibold"],["name","selected_staff","id","selected_staff",1,"input",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["for","brgy_location",1,"font-semibold"],["name","brgy_location","id","brgy_location",1,"input",3,"ngModelChange","ngModel"],[1,"my-5"],[1,"font-semibold"],["class","ml-5",4,"ngFor","ngForOf"],[1,"text-end","border-t","border-slate-300","p-3","-mx-5","-mb-5"],["type","button",1,"btn-save",3,"click","disabled"],["class","pr-2",3,"icon",4,"ngIf"],["class","pr-2","animation","spin",3,"icon",4,"ngIf"],[1,"col-span-4","border","border-slate-200","shadow-md","rounded-lg"],[1,"p-3","text-white","rounded-t-lg","bg-blue-500"],[1,"overflow-y-auto","overflow-x-auto","h-[500px]"],[1,"table-fixed","w-full"],[1,"border-b","border-slate-200","bg-gray-100","text-xs","sticky","top-0"],[1,"w-36","h-12"],[1,"w-24"],[1,"w-36"],["class","mb-2 border-b border-slate-100",4,"ngFor","ngForOf"],[3,"value"],[1,"ml-5"],["type","checkbox",1,"input-checkbox","mr-3",3,"ngModelChange","ngModel"],[1,"select-none"],[1,"pr-2",3,"icon"],["animation","spin",1,"pr-2",3,"icon"],[1,"mb-2","border-b","border-slate-100"],[1,"pl-2","align-top"],[4,"ngFor","ngForOf"],[1,"text-center"],[1,"text-orange-500","pr-5","hover:cursor-pointer",3,"click","icon"]],template:function(o,a){1&o&&(t.j41(0,"div",0)(1,"div",1)(2,"div")(3,"label",2),t.EFF(4,"BHS Name"),t.k0s(),t.j41(5,"input",3),t.mxI("ngModelChange",function(i){return t.DH7(a.bhs.bhs_name,i)||(a.bhs.bhs_name=i),i}),t.k0s()(),t.j41(6,"div",4)(7,"label",5),t.EFF(8,"Assigned Midwife/Staff"),t.k0s(),t.j41(9,"select",6),t.mxI("ngModelChange",function(i){return t.DH7(a.bhs.assigned_user_id,i)||(a.bhs.assigned_user_id=i),i}),t.DNE(10,Y,2,3,"option",7),t.k0s()(),t.j41(11,"div",4)(12,"label",8),t.EFF(13,"BHS Location"),t.k0s(),t.j41(14,"select",9),t.mxI("ngModelChange",function(i){return t.DH7(a.bhs.barangay_code,i)||(a.bhs.barangay_code=i),i}),t.DNE(15,D,2,2,"option",7),t.k0s()(),t.j41(16,"div",10)(17,"div",11),t.EFF(18,"Catchment Barangay"),t.k0s(),t.DNE(19,S,4,6,"div",12),t.k0s(),t.j41(20,"div",13)(21,"button",14),t.bIt("click",function(){return a.onSubmit()}),t.DNE(22,O,1,1,"fa-icon",15)(23,P,1,1,"fa-icon",16),t.EFF(24),t.k0s()()(),t.j41(25,"div",17)(26,"div",18),t.EFF(27," Barangay Health Stations "),t.k0s(),t.j41(28,"div",19)(29,"table",20)(30,"thead")(31,"tr",21)(32,"th",22),t.EFF(33,"BHS NAME"),t.k0s(),t.j41(34,"th",23),t.EFF(35,"ASSIGNED STAFF"),t.k0s(),t.j41(36,"th",24),t.EFF(37,"BHS LOCATION"),t.k0s(),t.j41(38,"th",24),t.EFF(39,"CATCHMENT BARANGAY"),t.k0s(),t.j41(40,"th",24),t.EFF(41,"ACTION"),t.k0s()()(),t.j41(42,"tbody"),t.DNE(43,H,11,6,"tr",25),t.k0s()()()()()),2&o&&(t.R7$(5),t.R50("ngModel",a.bhs.bhs_name),t.R7$(4),t.R50("ngModel",a.bhs.assigned_user_id),t.R7$(),t.Y8G("ngForOf",a.rhu_staffs),t.R7$(4),t.R50("ngModel",a.bhs.barangay_code),t.R7$(),t.Y8G("ngForOf",a.catchment_barangays[a.selected_year].data),t.R7$(4),t.Y8G("ngForOf",a.catchment_barangays[a.selected_year].data),t.R7$(2),t.Y8G("disabled",a.is_loading),t.R7$(),t.Y8G("ngIf",!a.is_loading),t.R7$(),t.Y8G("ngIf",a.is_loading),t.R7$(),t.SpI(" ",a.is_loading?a.bhs.id?"Updating":"Saving":a.bhs.id?"Update":"Save"," "),t.R7$(19),t.Y8G("ngForOf",a.facility_bhs))},dependencies:[d.Sq,d.bT,r.xH,r.y7,r.me,r.Zm,r.wz,r.BC,r.vS,h.aY],encapsulation:2})}}return n})();function U(n,c){if(1&n&&(t.j41(0,"option",16),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.Y8G("value",e),t.R7$(),t.JRh(e)}}function A(n,c){1&n&&t.nrm(0,"span",28)}function L(n,c){if(1&n&&t.nrm(0,"img",29),2&n){const e=t.XpG(3);t.Y8G("src",e.imageData,t.B4B)}}function J(n,c){if(1&n&&(t.j41(0,"span",30),t.nrm(1,"fa-icon",31),t.k0s()),2&n){const e=t.XpG(3);t.R7$(),t.Y8G("icon",e.faImage)}}function z(n,c){if(1&n){const e=t.RV6();t.j41(0,"div")(1,"input",32),t.mxI("ngModelChange",function(a){const s=t.eBV(e).$implicit,i=t.XpG(3);return t.DH7(i.selected_catchment[s.code],a)||(i.selected_catchment[s.code]=a),t.Njj(a)}),t.k0s(),t.j41(2,"label",33),t.EFF(3),t.k0s()()}if(2&n){const e=c.$implicit,o=t.XpG(3);t.R7$(),t.x72("id","selected_catchment",e.code,""),t.R50("ngModel",o.selected_catchment[e.code]),t.R7$(),t.x72("for","selected_catchment",e.code,""),t.R7$(),t.JRh(e.name)}}function Z(n,c){if(1&n){const e=t.RV6();t.j41(0,"div",17)(1,"div",18)(2,"div")(3,"div",19),t.bIt("click",function(){t.eBV(e);const a=t.sdS(8);return t.Njj(a.click())}),t.DNE(4,A,1,0,"span",20)(5,L,1,1,"img",21)(6,J,2,1,"span",22),t.k0s(),t.j41(7,"input",23,0),t.bIt("change",function(a){t.eBV(e);const s=t.XpG(2);return t.Njj(s.onFileSelected(a))}),t.k0s(),t.j41(9,"div",24)(10,"h1",25),t.EFF(11," Upload Logo Here"),t.k0s()()(),t.j41(12,"div",26),t.DNE(13,z,4,6,"div",27),t.k0s()()()}if(2&n){const e=t.XpG(2);t.R7$(4),t.Y8G("ngIf",!e.imageData),t.R7$(),t.Y8G("ngIf",e.imageData),t.R7$(),t.Y8G("ngIf",!e.imageData),t.R7$(7),t.Y8G("ngForOf",e.barangays)}}function W(n,c){if(1&n){const e=t.RV6();t.j41(0,"div",34)(1,"button",35),t.bIt("click",function(){t.eBV(e);const a=t.XpG(2);return t.Njj(a.onSubmit())}),t.nrm(2,"fa-icon",36),t.EFF(3," Save "),t.k0s()()}if(2&n){const e=t.XpG(2);t.R7$(2),t.Y8G("icon",e.faSave)}}function K(n,c){if(1&n&&(t.j41(0,"div",37)(1,"div",38),t.nrm(2,"fa-icon",39),t.k0s(),t.j41(3,"div",40),t.EFF(4),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(2),t.Y8G("icon",e.faCircleNotch),t.R7$(2),t.SpI(" Loading ",e.loading_text,"... ")}}function Q(n,c){if(1&n){const e=t.RV6();t.j41(0,"div",7)(1,"div",8)(2,"div",9)(3,"div",10),t.EFF(4,"Catchment Barangay"),t.k0s(),t.j41(5,"div")(6,"select",11),t.mxI("ngModelChange",function(a){t.eBV(e);const s=t.XpG();return t.DH7(s.selected_year,a)||(s.selected_year=a),t.Njj(a)}),t.bIt("change",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.getCatchmentBarangay(a.selected_year))}),t.DNE(7,U,2,2,"option",12),t.k0s()()(),t.DNE(8,Z,14,4,"div",13)(9,W,4,1,"div",14)(10,K,5,2,"div",15),t.k0s()()}if(2&n){const e=t.XpG();t.R7$(6),t.R50("ngModel",e.selected_year),t.R7$(),t.Y8G("ngForOf",e.years),t.R7$(),t.Y8G("ngIf",e.show_form),t.R7$(),t.Y8G("ngIf",e.show_form),t.R7$(),t.Y8G("ngIf",!e.show_form)}}function q(n,c){if(1&n){const e=t.RV6();t.j41(0,"app-catchment-population",41),t.bIt("getCatchmentBarangay",function(a){t.eBV(e);const s=t.XpG();return t.Njj(s.getCatchmentBarangay(a))}),t.k0s()}if(2&n){const e=t.XpG();t.Y8G("catchment_barangays",e.catchment_barangays)("current_year",e.current_year)("selected_year",e.selected_year)}}function tt(n,c){if(1&n&&t.nrm(0,"app-catchment-bhs",42),2&n){const e=t.XpG();t.Y8G("catchment_barangays",e.catchment_barangays)("facility_code",e.facility_code)("selected_year",e.selected_year)}}const et=[{path:"",component:(()=>{class n{switchPage(e){this.pages=e}switchTab(e){this.module=e}onSubmit(){let e=[];Object.entries(this.selected_catchment).forEach(([a,s],i)=>{s&&e.push({barangay_code:a})}),this.http.post("settings/catchment-barangay",{year:this.current_year,barangay:e}).subscribe({next:a=>{this.toastr.success("Successfully recorded","Catchment Barangay"),this.getCatchmentBarangay(this.selected_year)},error:a=>console.log(a)})}getCatchmentBarangay(e){this.loading_text="catchment barangays",this.show_form=!1,this.http.get("settings/catchment-barangay",{params:{"filter[year]":e??this.current_year}}).subscribe({next:o=>{this.catchment_barangays=o,this.catchment_barangays[this.selected_year]&&Object.keys(this.catchment_barangays[this.selected_year].data).length>0?this.loadCatchment(this.catchment_barangays[this.selected_year].data):(this.selected_catchment=[],this.show_form=!0)},error:o=>console.log(o)})}loadCatchment(e){Object.entries(e).forEach(([o,a],s)=>{this.selected_catchment[a.barangay.code]=!0}),this.show_form=!0}loadBarangays(){this.loading_text="barangays",this.http.get("libraries/municipalities/"+this.municipality_code,{params:{include:"barangays"}}).subscribe({next:e=>{this.barangays=e.data.barangays,this.getCatchmentBarangay()},error:e=>console.log(e)})}onFileSelected(e){const o=e.target.files[0];if(!o)return;if(!["image/png","image/jpeg","image/jpg"].includes(o.type))return void this.toastr.error("Only JPG and PNG images are allowed.","Upload Error");if(o.size>2097152)return void this.toastr.error("File is too large. Maximum size is 2MB.","Upload Error");const i=new FormData;i.append("logo",o),i.append("facility_code",this.facility_code),this.http.post("consultation/upload-logo",i).subscribe({next:f=>{const y=this.apiBase+f.path;console.log("Logo uploaded:",y),this.imageData=y,this.toastr.success("Logo successfully uploaded","Success")},error:f=>{console.error("Upload failed.",f),this.toastr.error("Logo upload failed!","Server Error")}})}loadLogo(){this.http.get("consultation/logo",{params:{facility_code:this.facility_code}}).subscribe({next:e=>{e.path?(console.log("Logo response:",e),this.imageData=this.apiBase+e.path,console.log("Full logo URL:",this.imageData)):(this.imageData=null,console.warn("No logo found."))},error:()=>{console.warn("No logo found or failed to load."),this.imageData=""}})}constructor(e,o){this.http=e,this.toastr=o,this.current_year=(0,d.Yq)(new Date,"yyyy","en","Asia/Manila"),this.faSave=_.hSh,this.faCircleNotch=_.s4k,this.faDoorClosed=_.K_I,this.faImage=_.Cyq,this.pages=1,this.module=1,this.show_form=!1,this.barangays=[],this.catchment_barangays=[],this.selected_catchment=[],this.modals=[],this.years=[],this.imageData=null,this.apiBase=this.http.baseUrl.replace("/api/v1/",""),this.fileError=null}ngOnInit(){let e=this.http.getUserFromJSON().facility;this.municipality_code=e.municipality_code??e.municipality.code,this.facility_code=e.code??e.facility.code,this.loadBarangays(),this.selected_year=this.current_year;for(let o=Number(this.current_year);o>2017;o--)this.years.push(o);this.loadLogo()}static{this.\u0275fac=function(o){return new(o||n)(t.rXU(g.k),t.rXU(m.tw))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-facility-config"]],standalone:!1,decls:11,vars:9,consts:[["fileInput",""],[1,"flex"],[1,"mt-4","flex","flex-row","border-b","border-slate-300","text-xs"],[1,"tabs-main","px-4","uppercase",3,"click"],["class","my-5 w-full border border-gray-200 shadow-md rounded-xl",4,"ngIf"],[3,"catchment_barangays","current_year","selected_year","getCatchmentBarangay",4,"ngIf"],[3,"catchment_barangays","facility_code","selected_year",4,"ngIf"],[1,"my-5","w-full","border","border-gray-200","shadow-md","rounded-xl"],[1,"grid","grid-cols-4","border","border-slate-200","rounded-xl","w-full","shadow-md"],[1,"col-span-4","bg-blue-500","rounded-t-xl","p-3","text-white","font-semibold","flex","justify-between"],[1,"pt-1"],["name","selected_year","id","selected_year",1,"border","border-slate","rounded-md","text-sm","py-1","text-gray-800","w-28",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],["class","p-5 max-h-[600px] col-span-4 overflow-y-auto",4,"ngIf"],["class","col-span-4 rounded-b-xl border-t border-slate-200 text-end",4,"ngIf"],["class","col-span-4 grid grid-cols-1 my-32",4,"ngIf"],[3,"value"],[1,"p-5","max-h-[600px]","col-span-4","overflow-y-auto"],[1,"grid","grid-cols-4","gap-2","w-full"],[1,"cursor-pointer","relative","mx-auto","flex","justify-center","items-center","mt-10","w-48","h-48","bg-gray-500","rounded-full","overflow-hidden","hover:bg-gray-700","hover:opacity-50",3,"click"],["class","font-medium text-gray-700",4,"ngIf"],["alt","Profile Image","class","w-full h-full object-cover",3,"src",4,"ngIf"],["class","absolute text-white",4,"ngIf"],["type","file","accept","image/*",1,"hidden",3,"change"],[1,"my-4","text-center","justify-center"],[1,"italic","text-gray-800"],[1,"col-span-3","grid","grid-cols-3","gap-4"],[4,"ngFor","ngForOf"],[1,"font-medium","text-gray-700"],["alt","Profile Image",1,"w-full","h-full","object-cover",3,"src"],[1,"absolute","text-white"],["size","xl",3,"icon"],["type","checkbox",1,"input-checkbox",3,"ngModelChange","ngModel"],[1,"pl-2","select-none"],[1,"col-span-4","rounded-b-xl","border-t","border-slate-200","text-end"],[1,"btn-save","m-5","select-none",3,"click"],[1,"pr-2",3,"icon"],[1,"col-span-4","grid","grid-cols-1","my-32"],[1,"flex","justify-center","text-blue-500"],["animation","spin",3,"icon"],[1,"flex","justify-center"],[3,"getCatchmentBarangay","catchment_barangays","current_year","selected_year"],[3,"catchment_barangays","facility_code","selected_year"]],template:function(o,a){1&o&&(t.j41(0,"div",1)(1,"nav",2)(2,"button",3),t.bIt("click",function(){return a.switchPage(1)}),t.EFF(3," Catchment Barangays "),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){return a.switchPage(2)}),t.EFF(5," Catchment Population "),t.k0s(),t.j41(6,"button",3),t.bIt("click",function(){return a.switchPage(3)}),t.EFF(7," Setup BHS "),t.k0s()()(),t.DNE(8,Q,11,5,"div",4)(9,q,1,3,"app-catchment-population",5)(10,tt,1,3,"app-catchment-bhs",6)),2&o&&(t.R7$(2),t.HbH(1===a.pages?"tabs-main-true rounded-t-md":"tabs-main-false"),t.R7$(2),t.HbH(2===a.pages?"tabs-main-true rounded-t-md":"tabs-main-false"),t.R7$(2),t.HbH(3===a.pages?"tabs-main-true rounded-t-md":"tabs-main-false"),t.R7$(2),t.Y8G("ngIf",1===a.pages),t.R7$(),t.Y8G("ngIf",2===a.pages),t.R7$(),t.Y8G("ngIf",3===a.pages))},dependencies:[d.Sq,d.bT,r.xH,r.y7,r.Zm,r.wz,r.BC,r.vS,h.aY,M,V],encapsulation:2})}}return n})()}];let at=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[b.iI.forChild(et),b.iI]})}}return n})(),nt=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[d.MD,at,r.YN,h.dX]})}}return n})()}}]);