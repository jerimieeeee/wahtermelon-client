<!--<form [formGroup]="icd10forms" (ngSubmit)="onSubmit()">-->
  <div id="defaultModal" tabindex="-1" class="overflow-x-auto fixed top-0 right-0 left-0 md:inset-0 h-modal md:h-full justify-center items-center flex mx-auto" aria-modal="true" role="dialog" style="z-index:60">
    <div class="relative p-4 w-full">
      <!-- Modal content -->
      <div class="relative bg-white rounded-lg shadow">
        <!-- Modal header -->
        <div class="flex justify-between items-start py-3 px-5 rounded-t border-b bg-blue-500">
          <h3 class="mt-2 text-lg text-white">
            Consult ID: {{ this.consult_id }}
          </h3>
          <div class="flex justify-end">
            <div class="border border-gray-400 rounded-md bg-white">
  <!--            <input type="text" [(ngModel)]="search_patient" class="form-input border-0 text-sm p-1 m-1 border-r border-gray-400" (keyup.enter)="getList()" placeholder="Search Patient"/>-->
  <!--            <button type="button" class="text-blue-500 w-9 h-9" (click)="getList()">-->
  <!--              <fa-icon class="-ml-1" [icon]="faSearch"></fa-icon>-->
  <!--            </button>-->
            </div>

            <button type="button" class="text-white w-9 h-9" (click)="closeModal()">
              <fa-icon class="-mr-4" [icon]="faCircleXmark"></fa-icon>
            </button>
          </div>
        </div>
        <!-- Modal body -->
        <div class="h-[600px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-100" >
  <!--        <div class="flex flex-col justify-center loading" *ngIf="is_fetching">-->
  <!--          <fa-icon class="text-blue-500 mx-auto pt-36 text-xl" [icon]="faCircleNotch" animation="spin"></fa-icon>-->
  <!--          <span class="pt-4 mx-auto pb-36 select-none">Fetching Patient Info...</span>-->
  <!--        </div>-->
          <div class="relative shadow-md sm:rounded-lg m-4">
            <div class="w-full text-sm text-left text-gray-500">
              <fieldset class="flex justify-center text-base text-black pb-2 px-5 rounded-t border-black border-t border-b border-r border-l">
                <legend class="px-2">Patient Information</legend>
                <div class="text-left w-full">
                  <label>Name: {{ this.data.patient.first_name }} {{ this.data.patient.middle_name }} {{ this.data.patient.last_name }} </label><br />
                  <label>Birthdate: {{ this.data.patient.birthdate | date: 'MM/dd/yyyy' }} | {{ getAge() }} years old</label><br />
                  <label>Address: {{ this.data.patient.household_folder.address }}, {{ this.data.patient.household_folder.barangay.name }} </label>
                </div>
                <div class="flex text-right w-full">
                  <label>Consult Date: {{ this.consult_date }}</label>
                </div>
              </fieldset>
              <div class="flex justify-between items-start mt-2 py-2 px-5 rounded-t border-b bg-red-500">
                <h3 class="text-lg text-white">
                  Final Diagnosis
                </h3>
              </div>
              <div class="flex">
                <div class="border rounded-md px-5 w-full py-1">
                  <div class="chips-container">
                    <ng-select class="select-chips" placeholder="search final diagnosis"
                               [items]="fdx$ | async"
                               [multiple]="true"
                               [loading]="fdxLoading"
                               typeToSearchText="search..."
                               [typeahead]="searchInput$"
                               [(ngModel)]="selectedFdx"
                               bindValue="icd10_code"
                               bindLabel="icd10_desc"
                               notFoundText="No records found">

                      <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
                        <div class="whitespace-normal">
                          <h5 class="text-gray-700" [ngOptionHighlight]="search"><strong>{{ item.icd10_code }}:</strong> {{ item.icd10_desc }}</h5>
                        </div>
                      </ng-template>
                    </ng-select>

                  </div>
                  <input type="text" class="shadow-md form-input text-sm p-2 px-2 my-5 w-full rounded border-0 -outline-offset-8" placeholder="Final Diagnosis Remarks" [(ngModel)]="fdxremarks2"/>
                  <div class="flex justify-end py-4 px-5 space-x-4 rounded-b border-t border-gray-200 items-center">
                    <button type="button" class="text-white bg-blue-500 hover:ring-2 focus:outline-none hover:ring-red-300 rounded text-sm font-medium px-6 py-2.5 transition duration-150 ease-in-out transform hover:scale-110" (click)="onSubmit()">
                      Save
                    </button>
                  </div>

                  <div class="shadow-md -outline-offset-8">
                    <div class="border-b rounded-t bg-blue-500 mt-2 py-2 px-5">
                      <h3 class="mt-2 text-kg text-white font-bold">
                        Previous Diagnosis
                      </h3>
                    </div>
                    <table class="w-full table-auto text-sm text-black">
                      <thead class="text-s text-black bg-white -webkit-sticky border-b"
                            style="z-index: 20; position: sticky; top: 0;">
                      <tr class="w-full">
                        <th class="px-5 py-2 w-1/2 text-center">
                          ICD 10 Code | Description
                        </th>
                        <th class="w-1/2 text-center">
                          Date
                        </th>
                      </tr>
                      </thead>
                        <tbody *ngFor="let consult of previous">
                        @if(consult.final_diagnosis?.finaldx.length >= 1) {
                            <td class="px-5 py-2" colspan="1">
                              @for(icd10 of consult.final_diagnosis.finaldx; track icd10.icd10_code) {
                                <span class="text-black bg-white -webkit-sticky font-bold">
                                  {{ icd10.icd10_code + ' | ' + icd10.lib_icd10.icd10_desc }} <br />
                                </span>
                              }
                            </td>
                            <td class="w-1/2 text-center">
                              <span class="text-black bg-white -webkit-sticky font-bold">
                                  {{ this.consult.prev_date | date:'MM/dd/yyyy' }} <br />
                              </span>
                            </td>
                        }
                        </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="grid grid-cols-2 justify-between">
                <div class="grid col-span-1 mt-5 py-2 px-5 rounded-t border-b bg-gray-50">
                  <h3 class="mt-2 text-lg text-gray-500 font-bold">
                    Vitals Signs
                  </h3>
                  <div class="shadow-md grid border w-full border-1 -outline-offset-8">
                    <div class="flex text-gray-700 md:block leading-tight align-top my-1 w-full p-1 rounded-md">
                      <fieldset class="text-base text-black py-3 px-5 rounded-t">
                        <label>
                          <span class="font-bold">
                            Weight:
                          </span>
                          {{ this.data?.vitals_latest?.patient_weight ?? '-' }}
                        </label>
                        <span> kg</span>
                        <br />
                        <label>
                          <span class="font-bold">
                            Height:
                          </span>
                          {{ this.data?.vitals_latest?.patient_height ?? '-' }}
                        </label>
                        <span> cm</span>
                        <br />
                        <label>
                          <span class="font-bold">
                            BMI:
                          </span>
                          {{ this.data?.vitals_latest?.patient_bmi ?? '-' }}
                          ({{ this.data?.vitals_latest?.patient_bmi_class ?? '-' }})
                        </label>
                        <br />
                        <label>
                          <span class="font-bold">
                            Blood Pressure:
                          </span>
                          {{ this.data.vitals_latest?.bp_systolic ?? '-' }}/{{ this.data.vitals_latest?.bp_diastolic ?? '-' }}
                        </label>
                        <br />
                        <label>
                            <span class="font-bold ">
                              Blood Oxygen (SPO2):
                            </span>
                          {{ data?.vitals_latest?.patient_spo2 ?? '-' }}
                        </label>
                        <br />
                        <label [ngClass]="{'text-red-500': (data?.vitals_latest?.patient_temp >= 38)}">
                            <span class="font-bold">
                              Temperature:
                            </span>
                          {{ data?.vitals_latest?.patient_temp ?? '-' }}
                        </label>
                        <span> â„ƒ</span>
                        <br />
                        <label>
                          <span class="font-bold">
                            Heart Rate:
                          </span>
                          {{ this.data?.vitals_latest?.patient_heart_rate ?? '-' }}
                        </label>
                        <br />
                        <label>
                          <span class="font-bold">
                            Respiratory Rate:
                          </span>
                          {{ this.data?.vitals_latest?.patient_respiratory_rate ?? '-' }}
                        </label>
                        <br />
                        <label>
                          <span class="font-bold">
                            Pulse Rate:
                          </span>
                          {{ this.data?.vitals_latest?.patient_pulse_rate ?? '-' }}
                        </label>
                        <br />
                        <label>
                          <span class="font-bold">
                            Visual Acuity (Right):
                          </span>
                          {{ this.data?.vitals_latest?.patient_right_vision_acuity ?? '-' }}
                        </label>
                        <br />
                        <label>
                          <span class="font-bold">
                            Visual Acuity (Left):
                          </span>
                          {{ this.data?.vitals_latest?.patient_left_vision_acuity ?? '-' }}
                        </label>
                        <br />
                        <label>
                          <span class="font-bold">
                            Waist:
                          </span>
                          {{ this.data?.vitals_latest?.patient_waist ?? '-' }}
                        </label>
                        <br />
                        <label>
                          <span class="font-bold">
                            Hip:
                          </span>
                          {{ this.data?.vitals_latest?.patient_hip ?? '-' }}
                        </label>
                        <br />
                      </fieldset>
                    </div>
                  </div>
                </div>
                <div class="flex flex-col mt-5 py-2 px-5 rounded-t border-b bg-gray-50">
                  <span class="mt-2 text-lg text-gray-500 font-bold">
                    Chief Complaint
                  </span>
                  <div class="shadow-md flex flex-col border w-full border-1">
                    <div *ngFor="let item of this.data?.consult_notes.complaints ?? '-'" class="pl-2 flex font-bold text-base text-gray-700 md:block leading-tight align-top my-1 w-full p-1 rounded-md">
<!--                        <fieldset class="text-base text-black pt-3 px-5 rounded-t">-->
                          {{ item.lib_complaints.complaint_desc ?? '-'}}
<!--                        </fieldset>-->
                    </div>
                    <h3 class="text-base text-black py-3 px-5 rounded-t">
                      Remarks: {{ this.data?.consult_notes.complaint ?? '-' }}
                    </h3>
                  </div>
                </div>
              </div>
              <div class="flex flex-col mt-5 py-2 px-5 rounded-t border-b bg-gray-50">
                <div class="border-b rounded-t bg-purple-600 mt-2 py-2 px-5">
                  <h3 class="mt-2 text-lg text-white font-bold">
                    History of Current Illness
                  </h3>
                </div>
                <div>
                  <tr class="w-full">
                    <th class="px-5 py-2 w-1/2 text-left text-black">
                      {{ this.data?.consult_notes.history ?? '-' }}
                    </th>
                  </tr>
                </div>
              </div>
              <div class="grid grid-cols-2 justify-between">
                <div class="grid col-span-1 mt-5 py-2 px-5 rounded-t border-b bg-gray-50">
                  <h3 class="mt-2 text-lg text-gray-500 font-bold">
                    Physical Exam
                  </h3>
                  <div class="shadow-md grid border w-full border-1 -outline-offset-8">
                    <div class="flex text-gray-700 md:block leading-tight align-top my-1 w-full p-1 rounded-md">
                      <fieldset class="text-base text-black py-3 px-5 rounded-t">
                        <div *ngFor="let item of peCatArray">
                          <span class="font-semibold mr-2">{{ item.category_id }}:</span>
                          <span *ngFor="let pe of pe_array[item.category_id]; let last = last">{{ pe }}{{ !last ? ', ' : '' }}</span> <br />
                          <span>Remarks: {{ data.consult_notes.physical_exam_remarks[item.remarks_var] }}</span><br />
                        </div>
                      </fieldset>
                    </div>
                  </div>
                </div>
                <div class="flex flex-col mt-5 py-2 px-5 rounded-t border-b bg-gray-50">
                  <span class="mt-2 text-lg text-gray-500 font-bold">
                    Initial Diagnosis
                  </span>
                  <div class="shadow-md flex flex-col border w-full border-1">
                    <div *ngFor="let item of this.data?.consult_notes.initialdx ?? '-'" class="pl-2 flex text-gray-700 md:block leading-tight align-top my-1 w-full p-1 rounded-md">
                    <h3 class="text-base text-black py-3 px-3 rounded-t">
                      <span class="font-bold"> Diagnosis: </span>
                      <span> {{ item.diagnosis.class_name ?? '-'}} </span>
                    </h3>
                    </div>
                    <h3 class="text-base text-black py-3 px-3 rounded-t">
                      <span class="font-bold"> Remarks: </span> {{ this.data?.consult_notes.idx_remarks ?? '-' }}
                    </h3>
                  </div>
                  <span class="mt-2 text-lg text-gray-500 font-bold">
                    Surgical History
                  </span>
                  <div class="shadow-md flex flex-col border w-full border-1">
                    <div *ngFor="let procedure of this.data?.surgical_history ?? '-'" class="pl-2 flex text-gray-700 md:block leading-tight align-top my-1 w-full p-1 rounded-md">
                      <h3 class="text-base text-black py-3 px-3 rounded-t">
                        <span class="font-bold"> Procedure: </span>
                        <span> {{ procedure.operation ?? '-'}} </span>
                        <br />
                        <span class="font-bold"> Operation Date: </span>
                        <span> {{ procedure.operation_date | date:'MM/dd/yyyy' ?? '-'}} </span>
                      </h3>
                    </div>
                  </div>
                </div>
              </div>
              <div class="flex flex-col mt-5 py-2 px-5 rounded-t border-b bg-gray-50">
                <div class="border-b rounded-t bg-orange-600 mt-2 py-2 px-5">
                  <h3 class="mt-2 text-lg text-white font-bold">
                    Drugs Prescribed
                  </h3>
                </div>
                <div class="text-black py-2 px-5" *ngFor="let item of data?.prescription">
                  <span class="font-bold text-sm">{{ item.konsulta_medicine?.desc ?? item.medicine?.gen_name ?? item.added_medicine ?? ''}} </span> <br />
                  {{ item.medicine?.form_desc ?? ' '}} {{ item.medicine?.stre_desc ?? ' '}}<br />
                  <span class="font-bold">
                    Dose Regimen:
                  </span>
                    {{ item.dose_regimen?.desc ?? ' ' }} <br />
                  <span class="font-bold">
                    Duration Intake:
                  </span>
                  {{ item.duration_intake }} {{ item.duration_frequency?.desc }} (s) <br />
                  <span class="font-bold">
                    Prescribed Quantity:
                  </span>
                  {{ item.quantity ?? ' '}} {{ item.medicine?.form_desc ?? ' ' }} <br />
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Modal footer -->
        <div class="flex justify-between py-4 px-5 space-x-4 rounded-b border-t border-gray-200 items-center">
          <button type="button" class="text-white bg-red-500 hover:ring-2 focus:outline-none hover:ring-red-300 rounded text-sm font-medium px-6 py-2.5 transition duration-150 ease-in-out transform hover:scale-110" (click)="closeModal()">Close</button>
          <div class="flex items-center space-x-4">
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="opacity-50 fixed inset-0 z-50 bg-black"></div>
<!--</form>-->
