<div class="flex">
  <nav class="mt-4 flex flex-row border-b border-slate-300 text-xs">
    <button (click)="switchPage(1)" class="tabs-main w-36"
      [class]="pages===1? 'tabs-main-true rounded-t-md' : 'tabs-main-false' ">
      DENTAL ARCHIVE
    </button>
    <button *ngIf="!selected_dental_consult || (selected_dental_consult?.facility_code === user_facility)" (click)="switchPage(2)" class="tabs-main w-36"
      [class]="pages===2? 'tabs-main-true rounded-t-md' : 'tabs-main-false' ">
      VISIT DETAILS
    </button>
  </nav>
  <div class="ml-auto">
    <button *ngIf="!consult_details?.consult_done" type="button" class="btn-end-visit ml-auto mt-5" (click)="toggleModal('end_visit')">
      <fa-icon class="mr-1" [icon]="faDoorClosed"></fa-icon>
      End Visit
    </button>
  </div>
</div>

<nav *ngIf="pages===2" class="mt-2 flex justify-between border-b border-slate-300 text-xs">
  <div class="flex flex-row">
    <button (click)="switchTab(1)" class="tabs-main w-28"
        [class]="module===1? 'tabs-main-true' : 'tabs-main-false' ">
        TOOTH HISTORY & CONDITION
    </button>
    <button (click)="switchTab(2)" class="tabs-main w-28"
        [class]="module===3? 'tabs-main-true' : 'tabs-main-false' ">
        DIAGNOSIS
    </button>
    <button (click)="switchTab(3)" class="tabs-main w-28"
        [class]="module===3? 'tabs-main-true' : 'tabs-main-false' ">
        TREATMENT
    </button>
  </div>
</nav>

<div class="my-5 w-full border border-gray-200 shadow-md rounded-xl" *ngIf="pages === 1">
  <div *ngIf="selected_dental_consult && (selected_dental_consult?.facility_code !== user_facility)" class="text-orange-800 border border-orange-400 bg-orange-100 rounded-md p-3 mb-2 w-full">
    There is an ongoing TB treatment for this patient on another facility.
    You are not allowed to create a new treatment or view previous treatment from other facilities.
  </div>
  <div class="flex flex-col" *ngIf="fetching_history">
    <div class="w-full flex justify-center"><fa-icon [icon]="faCircleNotch" spin="true" class="pt-10"></fa-icon></div>
    <div class="w-full flex justify-center pb-10 font-semibold">Fetching history...</div>
  </div>
  <table class="w-full text-sm text-left" *ngIf="!fetching_history && patient_dental_history">
    <thead class="text-xs text-white uppercase bg-blue-500">
      <tr>
        <th scope="col" class="py-3 px-6">Case Finding Date</th>
        <th scope="col" class="py-3 px-6">Enrollment Date</th>
        <th scope="col" class="py-3 px-6">Case number</th>
        <th scope="col" class="py-3 px-6">Enrolled as</th>
        <th scope="col" class="py-3 px-6">Treatment outcome</th>
        <th scope="col" class="py-3 px-6">Treatment status</th>
        <th scope="col" class="py-3 px-6">Action</th>
      </tr>
    </thead>
    <tbody>
      <tr class="bg-white border-b" *ngFor="let tb_history of patient_dental_history">
        <td *ngIf="!patient_dental_history" colspan="7">
          <div class="text-center">
            No records to show...
          </div>
        </td>
        <td class="py-4 px-6">
          {{ tb_history.case_finding.consult_date | date: 'MM/dd/yyyy':'Asia/Manila'}}
        </td>
        <td class="py-4 px-6">
          {{ tb_history.case_holding ? (tb_history.case_holding?.registration_date | date: 'MM/dd/yyyy':'Asia/Manila') : '-' }}
        </td>
        <td class="py-4 px-6">
          {{ tb_history.case_holding ? tb_history.case_holding?.case_number : '-' }}
        </td>
        <td class="py-4 px-6">
          {{ tb_history.case_holding ? tb_history.case_holding?.enroll_as.desc : '-' }}
        </td>
        <td class="py-4 px-6">
          {{ tb_history.tb_treatment_outcome ? tb_history.tb_treatment_outcome.desc : '-' }}
        </td>
        <td class="py-4 px-6">
          {{ tb_history.treatment_done === 0 ? 'Open' : 'Closed' }}
        </td>
        <td class="py-4 px-6">
          <button *ngIf="user_facility === tb_history.facility_code" type="button" class="rounded-md bg-blue-500 text-white py-1 px-2" (click)="openTbConsult(tb_history)">
            {{ tb_history.treatment_done === 0 ? 'Open' : 'View' }}
          </button>
        </td>
      </tr>

      <tr class="bg-white border-b" *ngIf="!patient_dental_history[0]">
        <td  colspan="7">
          <div class="text-center py-3 flex flex-col">
            <div class="flex justify-center">No records to show...</div>
            <div class="flex justify-center">
              <button type="button" class="mt-3 bg-blue-500 px-3 py-1 rounded-md text-white hover:opacity-75" (click)="switchPage(2)">
                create record
              </button>
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div *ngIf="pages === 2 && module === 1">
  <app-history></app-history>

  <app-condition></app-condition>

  <app-services></app-services>
</div>
<!-- <app-casefindings *ngIf="pages === 2 && module === 1"
  [patient_id]="patient_id"
  [selected_dental_consult]="selected_dental_consult"
  [max_date]="max_date"
  (getPatientTbHistory)="getPatientTbHistory()"
></app-casefindings>

<app-case-holding *ngIf="pages === 2 && module === 3"
  [patient_id]="patient_id"
  [selected_dental_consult]="selected_dental_consult"
  [max_date]="max_date"
  (getPatientTbHistory)="getPatientTbHistory()"
></app-case-holding>

<app-dots-chart *ngIf="pages === 2 && module === 4"
  [patient_id]="patient_id"
  [selected_dental_consult]="selected_dental_consult"
  (getPatientTbHistory)="getPatientTbHistory()"
></app-dots-chart>

<app-end-visit *ngIf="modals['end_visit']"
  (toggleModal)="toggleModal($event)"
  [consult_id]="consult_details?.id"
  [consult_date]="consult_details?.consult_date"
  [patient_id]="consult_details?.patient.id"
  [pt_group]="'tb'"
></app-end-visit>

<app-treatment-outcome *ngIf="modals['treatment_outcome']"
  [selected_dental_consult]="selected_dental_consult"
  [max_date]="max_date"
  (toggleModal)="toggleModal($event)"
  (switchPage)="switchPage($event)"
  (getPatientTbHistory)="getPatientTbHistory()"
></app-treatment-outcome>

<app-caserate *ngIf="pages === 2 && module === 8"
  (switchPage)="switchPage($event)"
  [patient_id]="selected_dental_consult.patient_id"
  [program_id]="selected_dental_consult.id"
  [program_name]="'tb'"
  [max_date]="max_date"
></app-caserate>

<app-eclaims *ngIf="pages === 3"
  (switchPage)="switchPage($event)"
  [program_id]="selected_dental_consult.id"
  [program_name]="'tb'"
  [max_date]="max_date"
  [selected_case]="selected_dental_consult"
></app-eclaims> -->

<!-- <div class="flex-wrap w-full h-full shadow-md px-4 py-4 ml-5 mr-4 border-gray-100 border-t-2 rounded-lg text-gray-600">
  <nav class="flex flex-col sm:flex-row text-sm">
    <button (click)="switchTab(1)" class="text-gray-600 border-b-2 border-gray-200 block hover:text-blue-500 hover:border-blue-500 mr-6 pb-2"
    [class]="module===1? 'text-blue-500 border-b-2 border-blue-500 font-bold' : 'hover:-translate-y-1 hover:scale-110 transition ease-in-out delay-400 duration-300' ">
        History
    </button>
    <button (click)="switchTab(2)" class="text-gray-600 border-b-2 border-gray-200 block hover:text-blue-500 hover:border-blue-500 mr-6 pb-2"
    [class]="module===2? 'text-blue-500 border-b-2 border-blue-500 font-bold' : 'hover:-translate-y-1 hover:scale-110 transition ease-in-out delay-400 duration-300' ">
        Condition
    </button>
    <button (click)="switchTab(3)" class="text-gray-600 border-b-2 border-gray-200 block hover:text-blue-500 hover:border-blue-500 mr-6 pb-2"
    [class]="module===3? 'text-blue-500 border-b-2 border-blue-500 font-bold' : 'hover:-translate-y-1 hover:scale-110 transition ease-in-out delay-400 duration-300' ">
        Services
    </button>
    <button (click)="switchTab(4)" class="text-gray-600 border-b-2 border-gray-200 block hover:text-blue-500 hover:border-blue-500 mr-6 pb-2"
    [class]="module===4? 'text-blue-500 border-b-2 border-blue-500 font-bold' : 'hover:-translate-y-1 hover:scale-110 transition ease-in-out delay-400 duration-300' ">
        Initial Dx
    </button>
    <button (click)="switchTab(5)" class="text-gray-600 border-b-2 border-gray-200 block hover:text-blue-500 hover:border-blue-500 mr-6 pb-2"
    [class]="module===5? 'text-blue-500 border-b-2 border-blue-500 font-bold' : 'hover:-translate-y-1 hover:scale-110 transition ease-in-out delay-400 duration-300' ">
        Final Dx
    </button>
    <button (click)="switchTab(6)" class="text-gray-600 border-b-2 border-gray-200 block hover:text-blue-500 hover:border-blue-500 mr-6 pb-2"
    [class]="module===6? 'text-blue-500 border-b-2 border-blue-500 font-bold' : 'hover:-translate-y-1 hover:scale-110 transition ease-in-out delay-400 duration-300' ">
        Treatment
    </button>
  </nav>

  <div class="grid grid-col-8" *ngIf="module===1">
    <app-history></app-history>
  </div>

  <div class="grid grid-col-8" *ngIf="module===2">
    <app-condition></app-condition>
  </div>

    <div class="grid grid-col-8" *ngIf="module===3">
    <app-services></app-services>
  </div>

</div>
 -->
