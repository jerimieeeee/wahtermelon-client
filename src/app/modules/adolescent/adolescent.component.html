<div class="flex">
  <nav class="mt-4 flex flex-row border-b border-slate-300 text-xs">
    <button (click)="switchPage(1)" class="tabs-main w-36"
      [class]="pages===1? 'tabs-main-true rounded-t-md' : 'tabs-main-false' ">
      VISIT HISTORY
    </button>
    <button (click)="switchPage(2)" class="tabs-main w-36"
      [class]="pages===2? 'tabs-main-true rounded-t-md' : 'tabs-main-false' ">
      {{ !selected_asrh_consult ? 'ADOLESCENT HEALTH' : 'DETAILS' }}
    </button>
    <button (click)="switchPage(3)" class="tabs-main w-36"
      [class]="pages===3? 'tabs-main-true rounded-t-md' : 'tabs-main-false' ">
      ECLAIMS
    </button>
  </nav>
  <div class="ml-auto">
    <button type="button" class="btn-end-visit ml-auto mt-5"  *ngIf="!consult_details?.consult_done && (consult_details?.facility.code === user_facility)" (click)="toggleModal('end_visit')">
      End Visit
    </button>
  </div>
</div>

<nav *ngIf="pages===2" class="mt-2 flex justify-between border-b border-slate-300 text-xs">
  <div class="flex flex-row">
    <button (click)="switchTab(1)" class="tabs-main w-40"
        [class]="module===1? 'tabs-main-true w-40' : 'tabs-main-false w-40' ">
        RAPID HEEADSSSS
    </button>
    <button (click)="switchTab(2)" class="tabs-main w-44" *ngIf="selected_asrh_consult?.answers.length === 12"
        [class]="module===2? 'tabs-main-true w-44' : 'tabs-main-false w-44' ">
        ASSESSMENT SUMMARY
    </button>
    <button (click)="switchTab(3)" class="tabs-main w-44" *ngIf="selected_asrh_consult?.refer_to_user_id === user_info.id && user_info.aja_flag === true"
        [class]="module===3? 'tabs-main-true w-44' : 'tabs-main-false w-44' ">
        COMPREHENSIVE HEEADSSSS
    </button>
  </div>
  <div class="flex flex-row">
    <button type="button" (click)="toggleModal('referral')" *ngIf="selected_asrh_consult" class="bg-blue-500 px-3 py-2  rounded text-white hover:opacity-75">
      Referral
    </button>
  </div>
</nav>

<!-- <div *ngIf="pages===2 && module===3" class="col-span-12 col-start-1 grid gap-x-4 mb-5">
  <div class="mt-5">
    <input type="checkbox" class="input-checkbox" id="consent_flag" formControlName="consent_flag" />
    <label for="consent_flag" class="text-sm" >
      The patient has read, fully understood, and signed the patient consent form.
    </label>
  </div>
</div> -->
<div *ngIf="pages===2 && module===3">
<nav  class="mt-2 flex justify-between border-b border-slate-300 text-xs">
  <div class="flex flex-row ml-1">
    <button (click)="switchTabCompre(1)" class="tabs-main w-24"
        [class]="module_compre===1? 'tabs-main-true w-24' : 'tabs-main-false w-24' ">
        HOME
    </button>
    <button (click)="switchTabCompre(2)" class="tabs-main w-44" *ngIf="selected_asrh_consult?.comprehensive !== null"
        [class]="module_compre===2? 'tabs-main-true w-44' : 'tabs-main-false w-44' ">
        EDUCATION & EMPLOYMENT
    </button>
    <button (click)="switchTabCompre(3)" class="tabs-main w-24" *ngIf="selected_asrh_consult?.comprehensive !== null"
        [class]="module_compre===3? 'tabs-main-true w-24' : 'tabs-main-false w-24' ">
        EATING
    </button>
    <button (click)="switchTabCompre(4)" class="tabs-main w-24" *ngIf="selected_asrh_consult?.comprehensive !== null"
        [class]="module_compre===4? 'tabs-main-true w-24' : 'tabs-main-false w-24' ">
        ACTIVITIES
    </button>
    <button (click)="switchTabCompre(5)" class="tabs-main w-24" *ngIf="selected_asrh_consult?.comprehensive !== null"
        [class]="module_compre===5? 'tabs-main-true w-24' : 'tabs-main-false w-24' ">
        DRUGS
    </button>
    <button (click)="switchTabCompre(6)" class="tabs-main w-24" *ngIf="selected_asrh_consult?.comprehensive !== null"
        [class]="module_compre===6? 'tabs-main-true w-24' : 'tabs-main-false w-24' ">
        SEXUALITY
    </button>
    <button (click)="switchTabCompre(7)" class="tabs-main w-32" *ngIf="selected_asrh_consult?.comprehensive !== null"
        [class]="module_compre===7? 'tabs-main-true w-36' : 'tabs-main-false w-36' ">
        SUICIDE & DEPRESSION
    </button>
    <button (click)="switchTabCompre(8)" class="tabs-main w-24" *ngIf="selected_asrh_consult?.comprehensive !== null"
        [class]="module_compre===8? 'tabs-main-true w-24' : 'tabs-main-false w-24' ">
        SAFETY
    </button>
    <button (click)="switchTabCompre(9)" class="tabs-main w-24" *ngIf="selected_asrh_consult?.comprehensive !== null"
        [class]="module_compre===9? 'tabs-main-true w-24' : 'tabs-main-false w-24' ">
        SPIRITUALITY
    </button>
  </div>
</nav>

<!-- <div class="col-span-12 col-start-1 grid gap-x-4 mb-5">
  <div class="mt-5 px-8">
    <input type="checkbox" class="input-checkbox" id="consent_flag" formControlName="consent_flag" />
    <label for="consent_flag" class="text-sm" >
      The patient has read, fully understood, and signed the patient consent form.
    </label>
  </div>
</div> -->

</div>

<div class="my-5 w-full border border-gray-200 shadow-md rounded-xl" *ngIf="pages === 1">
  <div class="flex flex-col" *ngIf="!fetching_history">
    <div class="w-full flex justify-center"><fa-icon animation="spin" class="pt-10"></fa-icon></div>
    <div class="w-full flex justify-center pb-10 font-semibold">Fetching history...</div>
  </div>
  <table class="w-full text-sm text-left" *ngIf="fetching_history">
    <thead class="text-xs text-white uppercase bg-blue-500">
      <tr>
        <th scope="col" class="py-3 px-6">RAPID Assessment Date</th>
        <th scope="col" class="py-3 px-6">Status</th>
        <th scope="col" class="py-3 px-6">COMPREHENSIVE Assessment Date</th>
        <th scope="col" class="py-3 px-6">Status</th>
        <th scope="col" class="py-3 px-6">Action</th>
      </tr>
    </thead>
    <tbody>
      <tr class="bg-white border-b" *ngFor="let asrh_history of patient_asrh_history">
        <td *ngIf="!patient_asrh_history" colspan="7">
          <div class="text-center">
            No records to show...
          </div>
        </td>
        <td class="py-4 px-6">
          {{ asrh_history?.assessment_date | date: 'MM/dd/yyyy'}}
        </td>
        <td class="py-4 px-6">
          {{ asrh_history?.done_flag === 1 ? 'Done' : 'Ongoing' }}
        </td>
        <td class="py-4 px-6">
          {{ asrh_history?.comprehensive?.assessment_date | date: 'MM/dd/yyyy'}}
        </td>
        <td class="py-4 px-6">
          {{ asrh_history?.comprehensive?.done_flag === true ? 'Done' : 'Ongoing' }}
         </td>
        <td class="py-4 px-6">
          <button type="button" class="rounded-md bg-blue-500 text-white py-1 px-2" (click)="openASRHConsult(asrh_history)">
           Open
          </button>
        </td>
      </tr>

      <tr class="bg-white border-b" *ngIf="patient_asrh_history?.length === 0">
        <td  colspan="7">
          <div class="text-center py-3 flex flex-col">
            <div class="flex justify-center">No records to show...</div>
            <div class="flex justify-center">
              <button type="button" class="mt-3 bg-blue-500 px-3 py-1 rounded-md text-white hover:opacity-75" (click)="switchPage(2)">
                create record
              </button>
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<app-rapid-heeadsss *ngIf="pages === 2 && module === 1"
  [patient_id]="patient_id"
  [client_types]="client_types"
  [asrh_visit_history]="asrh_visit_history"
  [patient_asrh_history]="patient_asrh_history"
  [selected_asrh_consult]="selected_asrh_consult"
  (updateSelectedASRH)="updateSelectedASRH($event)"
  (updateSelectedASRH2)="updateSelectedASRH2($event)"
  (loadASRH)="loadASRH()"
  (loadASRH2)="loadASRH2()"
></app-rapid-heeadsss>

<app-assessment-summary *ngIf="pages === 2 && module === 2"
  [patient_id]="patient_id"
  (loadASRH)="loadASRH()"
  [asrh_visit_history]="asrh_visit_history"
  [selected_asrh_consult]="selected_asrh_consult"
  (updateSelectedASRH)="updateSelectedASRH($event)"
></app-assessment-summary>

<app-home *ngIf="pages === 2 && module === 3 && module_compre === 1"
  [patient_id]="patient_id"
  (loadASRH)="loadASRH()"
  [compre_questions]="compre_questions"
  [asrh_visit_history]="asrh_visit_history"
  [selected_asrh_consult]="selected_asrh_consult"
  (updateSelectedASRH)="updateSelectedASRH($event)"
></app-home>

<app-education *ngIf="pages === 2 && module === 3 && module_compre === 2"
  [patient_id]="patient_id"
  (loadASRH)="loadASRH()"
  [compre_questions]="compre_questions"
  [asrh_visit_history]="asrh_visit_history"
  [selected_asrh_consult]="selected_asrh_consult"
  (updateSelectedASRH)="updateSelectedASRH($event)"
></app-education>

<app-eating *ngIf="pages === 2 && module === 3 && module_compre === 3"
  [patient_id]="patient_id"
  (loadASRH)="loadASRH()"
  [compre_questions]="compre_questions"
  [asrh_visit_history]="asrh_visit_history"
  [selected_asrh_consult]="selected_asrh_consult"
  (updateSelectedASRH)="updateSelectedASRH($event)"
></app-eating>

<app-activities *ngIf="pages === 2 && module === 3 && module_compre === 4"
  [patient_id]="patient_id"
  (loadASRH)="loadASRH()"
  [compre_questions]="compre_questions"
  [asrh_visit_history]="asrh_visit_history"
  [selected_asrh_consult]="selected_asrh_consult"
  (updateSelectedASRH)="updateSelectedASRH($event)"
></app-activities>

<app-drugs *ngIf="pages === 2 && module === 3 && module_compre === 5"
  [patient_id]="patient_id"
  (loadASRH)="loadASRH()"
  [compre_questions]="compre_questions"
  [asrh_visit_history]="asrh_visit_history"
  [selected_asrh_consult]="selected_asrh_consult"
  (updateSelectedASRH)="updateSelectedASRH($event)"
></app-drugs>

<app-sexuality *ngIf="pages === 2 && module === 3 && module_compre === 6"
  [patient_id]="patient_id"
  (loadASRH)="loadASRH()"
  [compre_questions]="compre_questions"
  [asrh_visit_history]="asrh_visit_history"
  [selected_asrh_consult]="selected_asrh_consult"
  (updateSelectedASRH)="updateSelectedASRH($event)"
></app-sexuality>

<app-suicide-depression *ngIf="pages === 2 && module === 3 && module_compre === 7"
  [patient_id]="patient_id"
  (loadASRH)="loadASRH()"
  [compre_questions]="compre_questions"
  [asrh_visit_history]="asrh_visit_history"
  [selected_asrh_consult]="selected_asrh_consult"
  (updateSelectedASRH)="updateSelectedASRH($event)"
  (updateSelectedASRH2)="updateSelectedASRH2($event)"
></app-suicide-depression>

<app-safety *ngIf="pages === 2 && module === 3 && module_compre === 8"
  [patient_id]="patient_id"
  (loadASRH)="loadASRH()"
  [compre_questions]="compre_questions"
  [asrh_visit_history]="asrh_visit_history"
  [selected_asrh_consult]="selected_asrh_consult"
  (updateSelectedASRH)="updateSelectedASRH($event)"
></app-safety>

<app-spirituality *ngIf="pages === 2 && module === 3 && module_compre === 9"
  [patient_id]="patient_id"
  (loadASRH)="loadASRH()"
  [compre_questions]="compre_questions"
  [asrh_visit_history]="asrh_visit_history"
  [selected_asrh_consult]="selected_asrh_consult"
  (updateSelectedASRH)="updateSelectedASRH($event)"
></app-spirituality>

<app-end-visit *ngIf="modals['end_visit']"
  (toggleModal)="toggleModal($event)"
  [consult_id]="consult_id"
  [consult_date]="consult_details?.consult_date"
  [patient_id]="consult_details?.patient.id"
  [pt_group]="consult_details?.pt_group"
></app-end-visit>

<app-referral-modal *ngIf="modals['referral']"
  (toggleModal)="toggleModal($event)"
  [client_types]="client_types"
></app-referral-modal>

