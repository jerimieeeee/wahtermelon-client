"use strict";(self.webpackChunkwahtermelon_client=self.webpackChunkwahtermelon_client||[]).push([[752],{2752:(k,h,r)=>{r.r(h),r.d(h,{DrugDispensingModule:()=>c});var u=r(6895),m=r(2325),_=r(2687),e=r(1571),y=r(4691),f=r(7185),d=r(433);function x(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"tr",22)(1,"td",23),e._uU(2),e.qZA(),e.TgZ(3,"td",24),e._uU(4),e._UZ(5,"br")(6,"br"),e._uU(7),e.qZA(),e.TgZ(8,"td",24),e._uU(9),e.ALo(10,"date"),e.qZA(),e.TgZ(11,"td",24),e._uU(12),e.qZA(),e.TgZ(13,"td",24),e._uU(14),e.qZA(),e.TgZ(15,"td",25)(16,"input",26),e.NdJ("ngModelChange",function(o){const p=e.CHM(t).$implicit;return e.KtG(p.dispense_quantity=o)})("keyup",function(){const a=e.CHM(t).$implicit,p=e.oxw(2);return e.KtG(p.checkValid(a))}),e.qZA()(),e.TgZ(17,"td",25)(18,"textarea",27),e.NdJ("ngModelChange",function(o){const p=e.CHM(t).$implicit;return e.KtG(p.remarks=o)}),e.qZA()()()}if(2&i){const t=n.$implicit;e.xp6(2),e.hij(" ",t.konsulta_medicine?t.konsulta_medicine.desc:t.added_medicine," "),e.xp6(2),e.xDo(" ",t.dosage_quantity," ",t.unit_of_measurement.desc," ",t.regimen.desc," ",t.duration_intake," ",t.frequency.desc," "),e.xp6(3),e.hij(" Instruction Qty: ",t.instruction_quantity," "),e.xp6(2),e.hij(" ",e.xi3(10,14,t.prescription_date,"MM/dd/yyyy")," "),e.xp6(3),e.hij(" ",t.quantity," "),e.xp6(2),e.hij(" ",t.preparation.desc," "),e.xp6(2),e.Q6J("max",t.quantity)("ngModel",t.dispense_quantity),e.xp6(2),e.Q6J("disabled",!t.dispense_quantity||0===t.dispense_quantity)("ngModel",t.remarks)}}function b(i,n){if(1&i&&(e.TgZ(0,"tbody"),e.YNc(1,x,19,17,"tr",21),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.prescriptions)("ngForTrackBy",t.identify)}}function Z(i,n){1&i&&(e.TgZ(0,"tbody")(1,"tr")(2,"td",28),e._uU(3,"No records found"),e.qZA()()())}function q(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",29)(1,"button",30),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onSubmit())}),e._uU(2," Dispense "),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("disabled",!t.dispensing_date)}}function D(i,n){if(1&i&&(e.TgZ(0,"tr",22)(1,"td",31),e._uU(2),e.qZA(),e.TgZ(3,"td",24),e._uU(4),e._UZ(5,"br")(6,"br"),e._uU(7),e.qZA(),e.TgZ(8,"td",24),e._uU(9),e.ALo(10,"date"),e.qZA(),e.TgZ(11,"td",24),e._uU(12),e.qZA(),e.TgZ(13,"td",24),e._uU(14),e.qZA(),e.TgZ(15,"td",32),e._uU(16),e.qZA(),e.TgZ(17,"td",33),e._uU(18),e.qZA()()),2&i){const t=n.$implicit;e.xp6(2),e.hij(" ",t.prescription.konsulta_medicine?t.prescription.konsulta_medicine.desc:t.prescription.added_medicine," "),e.xp6(2),e.xDo(" ",t.prescription.dosage_quantity," ",t.prescription.unit_of_measurement.desc," ",t.prescription.regimen.desc," ",t.prescription.duration_intake," ",t.prescription.frequency.desc," "),e.xp6(3),e.hij(" Instruction Qty: ",t.prescription.instruction_quantity," "),e.xp6(2),e.hij(" ",e.xi3(10,12,t.prescription.prescription_date,"MM/dd/yyyy")," "),e.xp6(3),e.hij(" ",t.prescription.quantity," "),e.xp6(2),e.hij(" ",t.prescription.preparation.desc," "),e.xp6(2),e.hij(" ",t.dispense_quantity," "),e.xp6(2),e.hij(" ","NA"===t.remarks?"-":t.remarks," ")}}function T(i,n){if(1&i&&(e.TgZ(0,"tbody"),e.YNc(1,D,19,15,"tr",21),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.dispensed_list)("ngForTrackBy",t.identify)}}function A(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"app-lab-form",34),e.NdJ("toggleModal",function(o){e.CHM(t);const a=e.oxw();return e.KtG(a.toggleModal(o))}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("selected_lab",t.selected_lab)}}function M(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"app-lab-delete",34),e.NdJ("toggleModal",function(o){e.CHM(t);const a=e.oxw();return e.KtG(a.toggleModal(o))}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("selected_lab",t.selected_lab)}}class g{identify(n,t){return t.id}onSubmit(){console.log(this.prescriptions),Object.entries(this.prescriptions).forEach(([n,t],s)=>{if(t.dispense_quantity>0){let a={patient_id:t.patient_id,dispensing_date:this.dispensing_date,prescription_id:t.id,dispense_quantity:t.dispense_quantity,remarks:t.remarks?t.remarks:"NA",unit_price:0,total_amount:0};console.log(a),this.http.post("medicine/dispensing",a).subscribe({next:p=>{console.log(p),Object.keys(this.prescriptions).length-1===s&&(this.getPresciptions(this.route.snapshot.paramMap.get("id")),this.toastr.success("Successfully recorded!","Dispensing"))},error:p=>console.log(p)})}else Object.keys(this.prescriptions).length-1===s&&(this.getPresciptions(this.route.snapshot.paramMap.get("id")),this.toastr.success("Successfully recorded!","Dispensing"))})}qtyDisp(n){if(console.log(n),n.dispensing){let t=0;Object.entries(n.dispensing).forEach(([s,o],a)=>{t+=o.dispense_quantity}),console.log("dispensed_qty",n.quantity,t),n.quantity=n.quantity-t}return n.quantity}getQtyDisp(n){n>=1&&(1===n?this.qtyDisp(this.prescriptions[0]):Object.entries(this.prescriptions).forEach(([t,s],o)=>{this.qtyDisp(s)}))}getDispense(n){this.http.get("medicine/dispensing",{params:{patient_id:n}}).subscribe({next:s=>{this.dispensed_list=s.data,this.show_form=!0},error:s=>console.log(s)})}getPresciptions(n){console.log("get prescription"),this.http.get("medicine/prescriptions",{params:{patient_id:n,status:"dispensing"}}).subscribe({next:s=>{console.log(s.data),this.prescriptions=s.data,this.pres_length=Object.keys(this.prescriptions).length,this.pres_length>0&&this.getQtyDisp(Object.keys(this.prescriptions).length),this.getDispense(this.route.snapshot.paramMap.get("id"))},error:s=>console.log(s)})}patientInfo(n){this.patient_details=n}checkValid(n){console.log(n),n.dispense_quantity>n.quantity&&(n.dispense_quantity=n.quantity)}toggleModal(n,t){this.selected_lab=t,this.modal[n]=!this.modal[n],!1===this.modal[n]&&(this.selected_lab=null)}constructor(n,t,s){this.route=n,this.http=t,this.toastr=s,this.faFlaskVial=_.YKN,this.faTrash=_.$aW,this.faEdit=_.Xcf,this.faXmark=_.g82,this.libraries={dosage_uom:{var_name:"dosage_desc",location:"unit-of-measurements",value:""},dose_regimen:{var_name:"regimen_desc",location:"dose-regimens",value:""},medicine_purpose:{var_name:"purpose_desc",location:"purposes",value:""},duration_frequency:{var_name:"frequency_desc",location:"duration-frequencies",value:""},quantity_preparation:{var_name:"preparation_desc",location:"preparations",value:""},konsulta_medicine_code:{var_name:"medicine_desc",location:"konsulta-medicines",value:""}},this.show_form=!1,this.dispensed_list=[],this.pres_length=0,this.modal=[]}ngOnInit(){this.getPresciptions(this.route.snapshot.paramMap.get("id"))}}g.\u0275fac=function(n){return new(n||g)(e.Y36(m.gz),e.Y36(y.O),e.Y36(f._W))},g.\u0275cmp=e.Xpm({type:g,selectors:[["app-drug-dispensing"]],decls:58,vars:7,consts:[[1,"block","shadow","p-4","mt-4","rounded-xl","text-gray-600","border","border-slate-100"],[1,"text-sky-500","font-bold","flex","justify-between","py-2"],[1,"flex"],[1,"mt-2"],[1,"border","border-slate-200","shadow-md","rounded-xl"],[1,"flex","justify-between","w-full","bg-orange-500","text-white","rounded-t-xl","p-3","font-semibold"],[1,"mt-3"],[1,"flex","w-5/12","justify-end"],["for","dispensing_date",1,"mr-2","mt-3"],["type","date","name","dispensing_date","placeholder","mm/dd/yyyy",1,"input","w-1/2","text-gray-700","font-normal",3,"ngModel","ngModelChange"],[1,"w-full","p-5"],[1,"w-full","text-sm","text-left","text-gray-500","dark:text-gray-400"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50","dark:bg-gray-700","dark:text-gray-400"],["scope","col",1,"text-center","py-3","px-3","w-3/12"],["scope","col",1,"text-center","py-3","px-3","w-1/12"],["scope","col",1,"text-center","py-3","px-3","w-2/12"],[4,"ngIf"],["class","flex justify-end w-full",4,"ngIf"],[1,"border","border-slate-200","shadow-md","rounded-xl","mt-5"],[1,"w-full","bg-green-500","text-white","rounded-t-xl","p-3","font-semibold"],[3,"selected_lab","toggleModal",4,"ngIf"],["class","bg-white border-b last:border-0",4,"ngFor","ngForOf","ngForTrackBy"],[1,"bg-white","border-b","last:border-0"],[1,"py-4","px-3","font-medium"],["scope","row",1,"py-4","px-3","text-gray-900"],["scope","row",1,"py-4","px-3"],["type","number",1,"w-16","h-7","border","border-slate-400","rounded",3,"max","ngModel","ngModelChange","keyup"],[1,"w-full","border","border-slate-400","rounded","text-sm","disabled:bg-gray-200",3,"disabled","ngModel","ngModelChange"],["colspan","7",1,"text-center","italic"],[1,"flex","justify-end","w-full"],["type","button",1,"btn-save","px-10","mr-5","mb-5","disabled:bg-gray-300",3,"disabled","click"],[1,"py-4","px-3"],["scope","row",1,"py-4","px-3","font-semibold","text-center"],["scope","row",1,"py-4","px-3","font-semibold"],[3,"selected_lab","toggleModal"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"span",1)(2,"span",2)(3,"span",3),e._uU(4," Prescription and Dispensing"),e.qZA()()(),e.TgZ(5,"div",4)(6,"div",5)(7,"span",6),e._uU(8,"Prescriptions"),e.qZA(),e.TgZ(9,"div",7)(10,"label",8),e._uU(11,"Dispense date"),e.qZA(),e.TgZ(12,"input",9),e.NdJ("ngModelChange",function(o){return t.dispensing_date=o}),e.qZA()()(),e.TgZ(13,"div",10)(14,"table",11)(15,"thead",12)(16,"tr")(17,"th",13),e._uU(18,"Medicine"),e.qZA(),e.TgZ(19,"th",13),e._uU(20,"Intake"),e.qZA(),e.TgZ(21,"th",14),e._uU(22,"Prescription Date"),e.qZA(),e.TgZ(23,"th",14),e._uU(24,"Quantity"),e.qZA(),e.TgZ(25,"th",14),e._uU(26,"Unit of Measurement"),e.qZA(),e.TgZ(27,"th",14),e._uU(28,"Dispense Quantity"),e.qZA(),e.TgZ(29,"th",15),e._uU(30,"Remarks"),e.qZA()()(),e.YNc(31,b,2,2,"tbody",16),e.YNc(32,Z,4,0,"tbody",16),e.qZA()(),e.YNc(33,q,3,1,"div",17),e.qZA(),e.TgZ(34,"div",18)(35,"div",19),e._uU(36," Dispensed Drugs "),e.qZA(),e.TgZ(37,"div",10)(38,"table",11)(39,"thead",12)(40,"tr")(41,"th",13),e._uU(42,"Medicine"),e.qZA(),e.TgZ(43,"th",13),e._uU(44,"Intake"),e.qZA(),e.TgZ(45,"th",14),e._uU(46,"Prescription Date"),e.qZA(),e.TgZ(47,"th",14),e._uU(48,"Quantity"),e.qZA(),e.TgZ(49,"th",14),e._uU(50,"Unit of Measurement"),e.qZA(),e.TgZ(51,"th",14),e._uU(52,"Dispense Quantity"),e.qZA(),e.TgZ(53,"th",15),e._uU(54,"Remarks"),e.qZA()()(),e.YNc(55,T,2,2,"tbody",16),e.qZA()()()(),e.YNc(56,A,1,1,"app-lab-form",20),e.YNc(57,M,1,1,"app-lab-delete",20)),2&n&&(e.xp6(12),e.Q6J("ngModel",t.dispensing_date),e.xp6(19),e.Q6J("ngIf",t.pres_length>0),e.xp6(1),e.Q6J("ngIf",0===t.pres_length),e.xp6(1),e.Q6J("ngIf",t.pres_length>0),e.xp6(22),e.Q6J("ngIf",t.show_form),e.xp6(1),e.Q6J("ngIf",t.modal.add),e.xp6(1),e.Q6J("ngIf",t.modal.delete))},dependencies:[u.sg,u.O5,d.Fj,d.wV,d.JJ,d.Fd,d.On,u.uU]});const C=[{path:"",component:g}];class l{}l.\u0275fac=function(n){return new(n||l)},l.\u0275mod=e.oAB({type:l}),l.\u0275inj=e.cJS({imports:[m.Bz.forChild(C),m.Bz]});var v=r(2216),U=r(9366);class c{}c.\u0275fac=function(n){return new(n||c)},c.\u0275mod=e.oAB({type:c}),c.\u0275inj=e.cJS({imports:[u.ez,l,v.uH,d.u5,U.q]})}}]);