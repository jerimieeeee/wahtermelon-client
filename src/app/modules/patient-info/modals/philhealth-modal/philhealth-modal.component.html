<div id="defaultModal" tabindex="-1" class="overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 w-full md:inset-0 h-modal md:h-full justify-center items-center flex" aria-modal="true" role="dialog" style="z-index:60">
  <div class="relative p-4 w-full max-w-3xl h-auto md:h-auto">
    <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
      <div class="flex justify-between items-start py-3 px-5 rounded-t border-b bg-blue-500 dark:border-gray-600">
        <h3 class="mt-2 text-sm font-bold text-white dark:text-white">
            Philhealth Information
        </h3>
      </div>
      <div class="overflow-y-auto h-96 scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-100">
        <form [formGroup]="philhealthForm" class="w-full max-w-3xl text-left text-gray-500 dark:text-gray-400">

          <div class="flex item-start flex-wrap pb-5 px-5">
            <div class="flex justify-between w-full -px-5 mt-3">
              <h4 class="font-bold text-blue-500 text-sm mt-2">Enlistment Details</h4>
            </div>

            <div class="relative w-full text-sm md:w-1/3 lg:w-1/3 pl-5 py-2 mt-1">
              <label class="font-semibold" for="enlistment_date" [ngClass]="{'text-red-500': is_saving && f.enlistment_date.errors}">Enlistment Date</label>
              <input name="enlistment_date" id="enlistment_date" (change)="updateEffectivity()" formControlName="enlistment_date" [ngClass]="{'invalid-input': is_saving && f.enlistment_date.errors}" type="date" max="{{ date | date: 'yyyy-MM-dd'}}" class="input">

              <div *ngIf="is_saving && f.enlistment_date.errors" class="invalid-alert">
                <div *ngIf="f.enlistment_date.errors?.['required']">
                  {{ required_message }}
                </div>
              </div>
            </div>

            <div class="relative w-full text-sm md:w-1/3 lg:w-1/3 px-5 py-2 mt-1">
              <label  for="enlistment_status_id" class="font-semibold" [ngClass]="{'text-red-500': is_saving && f.enlistment_status_id.errors}">Enlistment status</label>
              <select name="enlistment_status_id" id="enlistment_status_id" formControlName="enlistment_status_id" [ngClass]="{'invalid-input': is_saving && f.enlistment_status_id.errors}" class="input">
                <option [value]="status.id" *ngFor="let status of enlistment_status">{{ status.desc}}</option>
              </select>
              <div *ngIf="is_saving && f.enlistment_status_id.errors" class="invalid-alert">
                <div *ngIf="f.enlistment_status_id.errors?.['required']">
                  {{ required_message }}
                </div>
              </div>
            </div>

            <div class="relative w-full text-sm md:w-1/3 lg:w-1/3 pr-5 py-2 mt-1">
              <label  for="package_type_id" class="font-semibold" [ngClass]="{'text-red-500': is_saving && f.package_type_id.errors}">Enlistment type</label>
              <select name="package_type_id" id="package_type_id" formControlName="package_type_id" (change)="isATCrequired()" [ngClass]="{'invalid-input': is_saving && f.package_type_id.errors}" class="input">
                <option [value]="type.id" *ngFor="let type of package_types">{{ type.desc}}</option>
              </select>
              <div *ngIf="is_saving && f.package_type_id.errors" class="invalid-alert">
                <div *ngIf="f.package_type_id.errors?.['required']">
                  {{ required_message }}
                </div>
              </div>
            </div>


          </div>
          <div class="text-gray-600 border border-slate-100 mx-5"></div>

          <!-- START PATIENT DETAILS -->
          <div class="flex item-start flex-wrap pb-5 px-5">
            <div class="flex justify-between w-full -px-5 mt-3 rounded-tl rounded-tr">
              <h4 class="font-bold text-blue-500 text-sm mt-2">Patient Details</h4>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label class="font-semibold" for="philhealth_id" [ngClass]="{'text-red-500': is_saving && f.philhealth_id.errors}">Philhealth ID</label>
              <input name="philhealth_id" id="philhealth_id" formControlName="philhealth_id" mask="99-999999999-9" [showMaskTyped]="true"  type="text" class="input" [ngClass]="{'invalid-input': is_saving && f.philhealth_id.errors}">

              <div *ngIf="is_saving && f.philhealth_id.errors" class="invalid-alert">
                <div *ngIf="f.philhealth_id.errors?.['required']">
                  {{ required_message }}
                </div>

                <div *ngIf="is_saving && f.philhealth_id.errors?.['minLength']">
                  Philhealth ID must be 12 characters
                </div>
              </div>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label class="font-semibold" for="philhealth_id_confirmation" [ngClass]="{'text-red-500': is_saving && f.philhealth_id_confirmation.errors}">Confirm Philhealth ID</label>
              <input name="philhealth_id_confirmation" id="philhealth_id_confirmation" formControlName="philhealth_id_confirmation" mask="99-999999999-9" [showMaskTyped]="true" [ngClass]="{'invalid-input': is_saving && f.philhealth_id_confirmation.errors}" type="text" class="input">

              <div *ngIf="philhealthMatchError" class="invalid-alert">
                <div>
                  Philhealth number does not match
                </div>
              </div>

              <div *ngIf="is_saving && f.philhealth_id_confirmation.errors" class="invalid-alert">
                <div *ngIf="f.philhealth_id_confirmation.errors?.['required']">
                  {{ required_message }}
                </div>

                <div *ngIf="f.philhealth_id_confirmation.errors?.['minLength']">
                  Philhealth ID must be 12 characters
                </div>
              </div>
            </div>

            <div *ngIf="philhealthForm.controls.authorization_transaction_code.enabled" class="border border-slate-200 rounded-md mx-5 shadow-md w-full">
              <div class="flex justify-start w-full ml-5 my-3">
                <input [disabled]="is_checking_atc" type="checkbox" class="border border-gray-400 rounded-md h-5 w-5 mr-2 disabled:bg-gray-300" (change)="isATCrequired()" formControlName="walkedin_status" />Check if patient is Walk-in
              </div>

              <div *ngIf="!philhealthForm.value.walkedin_status" class="flex justify-start w-full ml-5 mb-3">
                <label for="authorization_transaction_code"  class="input-label pr-5 inline-block align-middle pt-3 w-1/4">Konsulta ATC</label><br />
                <input type="authorization_transaction_code" name="authorization_transaction_code" id="authorization_transaction_code" class="input w-52" placeholder="Patient ATC" formControlName="authorization_transaction_code">
                <input type="date" name="pATC_date" id="pATC_date" class="input w-52" placeholder="mm/dd/yyyy" max="{{ date | date:'yyyy-MM-dd HH:mm:ss'}}" [ngModelOptions]="{standalone: true}" [(ngModel)]="pATC_date">

                <button (click)="isATCValid()" [disabled]="!philhealthForm.value.authorization_transaction_code || !pATC_date || is_loading || is_checking_atc || !philhealthForm.value.philhealth_id" type="button" class="h-9 mt-1 text-sm rounded-md text-white bg-blue-500 disabled:bg-gray-300" (click)="isATCValid()">
                  <fa-icon [icon]="is_checking_atc ? faSpinner : faCheck" class="py-1 px-2" [spin]="is_checking_atc"></fa-icon>
                </button>
              </div>

              <div *ngIf="is_atc_valid !== undefined" class="flex mx-16 my-3 p-2 rounded-md bg-green-100 text-green-900 shadow-sm"
                [ngClass]="{'bg-red-100 text-red-900': !is_atc_valid}">
                <fa-icon class="flex-none my-0 m-2" [icon]="faCircleInfo" size="lg"></fa-icon>
                {{ is_atc_valid ? 'ATC is valid' : 'ATC is not valid' }}
              </div>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label  for="membership_type_id" class="font-semibold" [ngClass]="{'text-red-500': is_saving && f.membership_type_id.errors}">Membership type</label>
              <select name="membership_type_id" id="membership_type_id" formControlName="membership_type_id" [ngClass]="{'invalid-input': is_saving && f.membership_type_id.errors}" (change)="showMember()" class="input">
                <option [value]="type.id" *ngFor="let type of membership_types">{{ type.desc}}</option>
              </select>
              <div *ngIf="is_saving && f.membership_type_id.errors" class="invalid-alert">
                <div *ngIf="f.membership_type_id.errors?.['required']">
                  {{ required_message }}
                </div>
              </div>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label  for="membership_category_id" class="font-semibold" [ngClass]="{'text-red-500': is_saving && f.membership_category_id.errors}">Membership category</label>
              <select name="membership_category_id" id="membership_category_id" formControlName="membership_category_id" [ngClass]="{'invalid-input': is_saving && f.membership_category_id.errors}" class="input">
                <option [value]="cat.id" *ngFor="let cat of membership_categories">{{ cat.desc}}</option>
              </select>
              <div *ngIf="is_saving && f.membership_category_id.errors" class="invalid-alert">
                <div *ngIf="f.membership_category_id.errors?.['required']">
                  {{ required_message }}
                </div>
              </div>
            </div>

            <div *ngIf="(philhealthForm.controls.authorization_transaction_code.enabled && philhealthForm.value.philhealth_id && philhealthForm.value.philhealth_id_confirmation && philhealthForm.value.membership_type_id) && !philhealthMatchError" class="relative w-full flex text-sm px-5 mt-2">
              <div class="w-full text-sm md:w-1/2 lg:w-1/2">
                <button class="px-5 py-2 bg-green-600 text-white rounded-md hover:bg-green-500 hover:text-gray-50" (click)="isMemberDependentRegistered()">
                  <fa-icon *ngIf="is_checking_status" [icon]="faSpinner" spin="true"></fa-icon>
                  {{ is_checking_status ? 'checking' : 'check registration' }}
                </button>
              </div>
            </div>

            <div class="w-full flex justify-center">
              <div *ngIf="is_registered !== undefined" class="flex mx-16 my-3 p-2 rounded-md bg-green-100 text-green-900 shadow-sm"
                  [ngClass]="{'bg-red-100 text-red-900': !is_registered}">
                  <fa-icon class="flex-none my-0 m-2" [icon]="faCircleInfo" size="lg"></fa-icon>
                  {{ is_registered ? 'Member/Dependent is registered' : 'Member/Dependent not registered' }}
              </div>
            </div>
          </div>
          <div class="text-gray-600 border border-slate-100 mx-5"></div>
          <!-- END PATIENT DETAILS -->
          <!-- START EMPLOYER DETAILS -->
          <div class="flex item-start flex-wrap pb-5 px-5">
            <div class="flex justify-between w-full -px-5 mt-3 rounded-tl rounded-tr">
              <h4 class="font-bold text-blue-500 text-sm mt-2">Employer Details</h4>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label for="employer_pin" class="font-semibold" [ngClass]="{'text-red-500': is_saving && f.employer_pin.errors}">Employer PEN</label>
              <input name="employer_pin" id="employer_pin" formControlName="employer_pin" type="text" [ngClass]="{'invalid-input': is_saving && f.employer_pin.errors}" class="input">

              <div *ngIf="is_saving && f.employer_pin.errors" class="invalid-alert">
                <div *ngIf="f.employer_pin.errors?.['required']">
                  {{ required_message }}
                </div>
              </div>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label for="employer_name" class="font-semibold" [ngClass]="{'text-red-500': is_saving && f.employer_name.errors}">Employer name</label>
              <input name="employer_name" id="employer_name" formControlName="employer_name" type="text" [ngClass]="{'invalid-input': is_saving && f.employer_name.errors}" class="input">

              <div *ngIf="is_saving && f.employer_name.errors" class="invalid-alert">
                <div *ngIf="f.employer_name.errors?.['required']">
                  {{ required_message }}
                </div>
              </div>
            </div>

            <div class="relative w-full text-sm px-5 py-2 mt-2">
              <label for="employer_address" class="font-semibold" [ngClass]="{'text-red-500': is_saving && f.employer_address.errors}">Employer address</label>
              <input name="employer_address" id="employer_address" formControlName="employer_address" type="text" [ngClass]="{'invalid-input': is_saving && f.employer_address.errors}" class="input">

              <div *ngIf="is_saving && f.employer_address.errors" class="invalid-alert">
                <div *ngIf="f.employer_address.errors?.['required']">
                  {{ required_message }}
                </div>
              </div>
            </div>
          </div>
          <div class="text-gray-600 border border-slate-100 mx-5"></div>
          <!-- END EMPLOYER DETAILS -->
          <!-- START MEMBER DETAILS -->
          <div *ngIf="show_member_form" class="flex item-start flex-wrap pb-5 px-5">
            <div class="flex justify-between w-full -px-5 mt-3 rounded-tl rounded-tr">
              <h4 class="font-bold text-blue-500 text-sm mt-2">Member Details</h4>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label class="font-semibold" for="member_pin" [ngClass]="{'text-red-500': is_saving && f.member_pin.errors}">Member philhealth number</label>
              <input name="member_pin" id="member_pin" formControlName="member_pin" mask="99-999999999-9" [showMaskTyped]="true" type="text" [ngClass]="{'invalid-input': is_saving && f.member_pin.errors}" class="input">

              <div *ngIf="is_saving && f.member_pin.errors" class="invalid-alert">
                <div *ngIf="f.member_pin.errors?.['required']">
                  {{ required_message }}
                </div>

                <div *ngIf="is_saving && f.member_pin.errors?.['minLength']">
                  Philhealth ID must be 12 characters
                </div>
              </div>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label class="font-semibold" for="member_pin_confirmation" [ngClass]="{'text-red-500': is_saving && f.member_pin_confirmation.errors}">Confirm Philhealth ID</label>
              <input name="member_pin_confirmation" id="member_pin_confirmation" formControlName="member_pin_confirmation" mask="99-999999999-9" [showMaskTyped]="true" [ngClass]="{'invalid-input': is_saving && f.member_pin_confirmation.errors}" type="text" class="input">

              <div *ngIf="philhealthMemberMatchError" class="invalid-alert">
                <div>
                  Philhealth number does not match
                </div>
              </div>

              <div *ngIf="is_saving && f.member_pin_confirmation.errors" class="invalid-alert">
                <div *ngIf="f.member_pin_confirmation.errors?.['required']">
                  {{ required_message }}
                </div>

                <div *ngIf="f.member_pin_confirmation.errors?.['minLength']">
                  Philhealth ID must be 12 characters
                </div>
              </div>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label  for="member_relation_id" class="font-semibold" [ngClass]="{'text-red-500': is_saving && f.member_relation_id.errors}">Member relation</label>
              <select name="member_relation_id" id="member_relation_id" formControlName="member_relation_id" class="input" [ngClass]="{'invalid-input': is_saving && f.member_relation_id.errors}" >
                <option [value]="relation.id" *ngFor="let relation of member_relationships">{{ relation.desc}}</option>
              </select>
              <div *ngIf="is_saving && f.member_relation_id.errors" class="invalid-alert">
                <div *ngIf="f.member_relation_id.errors?.['required']">
                  {{ required_message }}
                </div>
              </div>
            </div>
            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2"></div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label for="member_last_name" class="font-semibold" [ngClass]="{'text-red-500': is_saving && f.member_last_name.errors}">Member last name</label>
              <input name="member_last_name" id="member_last_name" formControlName="member_last_name" [ngClass]="{'invalid-input': is_saving && f.member_last_name.errors}" type="text" class="input">

              <div *ngIf="is_saving && f.member_last_name.errors" class="invalid-alert">
                <div *ngIf="f.member_last_name.errors?.['required']">
                  {{ required_message }}
                </div>

                <div *ngIf="is_saving && f.member_last_name.errors?.['minLength']">
                  field must have at least 2 characters
                </div>
              </div>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label for="member_first_name" class="font-semibold" [ngClass]="{'text-red-500': is_saving && f.member_first_name.errors}">Member first name</label>
              <input name="member_first_name" id="member_first_name" formControlName="member_first_name" [ngClass]="{'invalid-input': is_saving && f.member_first_name.errors}" type="text" class="input">

              <div *ngIf="is_saving && f.member_first_name.errors" class="invalid-alert">
                <div *ngIf="f.member_first_name.errors?.['required']">
                  {{ required_message }}
                </div>

                <div *ngIf="is_saving && f.member_first_name.errors?.['minLength']">
                  field must have at least 2 characters
                </div>
              </div>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label for="member_middle_name" class="font-semibold" [ngClass]="{'text-red-500': is_saving && f.member_middle_name.errors}">Member middle name</label>
              <input name="member_middle_name" id="member_middle_name" formControlName="member_middle_name" [ngClass]="{'invalid-input': is_saving && f.member_middle_name.errors}" type="text" class="input">

              <div *ngIf="is_saving && f.member_middle_name.errors" class="invalid-alert">
                <div *ngIf="f.member_middle_name.errors?.['required']">
                  {{ required_message }}
                </div>

                <div *ngIf="is_saving && f.member_middle_name.errors?.['minLength']">
                  field must have at least 2 characters
                </div>
              </div>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label  for="member_suffix_name" class="font-semibold" [ngClass]="{'text-red-500': is_saving && f.member_suffix_name.errors}">Member suffix name</label>
              <select name="member_suffix_name" id="member_suffix_name" formControlName="member_suffix_name" [ngClass]="{'invalid-input': is_saving && f.member_suffix_name.errors}" class="input">
                <option [value]="suffix.code" *ngFor="let suffix of suffix_names">{{ suffix.suffix_desc}}</option>
              </select>
              <div *ngIf="is_saving && f.member_suffix_name.errors" class="invalid-alert">
                <div *ngIf="f.member_suffix_name.errors?.['required']">
                  {{ required_message }}
                </div>
              </div>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label class="font-semibold" for="member_birthdate" [ngClass]="{'text-red-500': is_saving && f.member_birthdate.errors}">Member birthdate</label>
              <input name="member_birthdate" id="member_birthdate" formControlName="member_birthdate" [ngClass]="{'invalid-input': is_saving && f.member_birthdate.errors}" type="date" max="{{ date | date: 'yyyy-MM-dd'}}" class="input">

              <div *ngIf="is_saving && f.member_birthdate.errors" class="invalid-alert">
                <div *ngIf="f.member_birthdate.errors?.['required']">
                  {{ required_message }}
                </div>
              </div>
            </div>

            <div class="relative w-full text-sm md:w-1/2 lg:w-1/2 px-5 py-2 mt-2">
              <label  for="member_gender" class="font-semibold" [ngClass]="{'text-red-500': is_saving && f.member_gender.errors}">Member gender</label>
              <select name="member_gender" id="member_gender" formControlName="member_gender" [ngClass]="{'invalid-input': is_saving && f.member_gender.errors}" class="input">
                <option [value]="sex.id" *ngFor="let sex of sex_cat">{{ sex.desc}}</option>
              </select>
              <div *ngIf="is_saving && f.member_gender.errors" class="invalid-alert">
                <div *ngIf="f.member_gender.errors?.['required']">
                  {{ required_message }}
                </div>
              </div>
            </div>
          </div>
          <div class="text-gray-600 border border-slate-100 mx-5"></div>
          <!-- END MEMBER DETAILS -->
          <div *ngIf="submit_errors" id="show_errors" class="relative mx-10 col-span-8 bg-red-200 rounded border border-red-300 text-red-900 text-sm mb-5">
            <div class="block p-3 pl-10" >
              <ul class="list-disc" >
                <li *ngFor="let error of submit_errors | keyvalue">{{ error.value }}</li>
              </ul>
            </div>
          </div>
        </form>


      </div>
      <div class="flex justify-end py-4 px-5 space-x-4 rounded-b border-t border-gray-200 dark:border-gray-600">
        <div [@openCloseTrigger] *ngIf="showAlert" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 my-1 rounded h-11 relative w-64 justify-start" role="alert">
          <span class="block sm:inline">Record was updated.</span>
        </div>

        <button  type="button" class="text-white bg-gray-500 hover:ring-2 focus:outline-none hover:ring-gray-300 rounded text-sm font-medium my-2 px-6 py-2.5 transition duration-150 ease-in-out" (click)="closeModal()">Close</button>
        <button [disabled]="philhealthForm.invalid" type="button" class="text-white bg-blue-500 enabled:hover:ring-2 enabled:focus:outline-none enabled:hover:ring-blue-300 disabled:bg-gray-300 font-medium rounded text-sm my-2 px-6 py-2.5 text-center transition duration-150 ease-in-out" (click)="onSubmit()" >Save</button>
      </div>
    </div>
  </div>
</div>

<div class="opacity-50 fixed inset-0 z-50 bg-black"></div>

<!-- [disabled]="philhealthForm.invalid" -->
