<div id="defaultModal" tabindex="-1" class="overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 w-full md:inset-0 h-modal md:h-full justify-center items-center flex" aria-hidden="true" role="dialog" style="z-index:60">
  <div class="relative p-4 max-w-4xl h-full md:h-auto">
    <!-- Modal content -->
    <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
      <!-- Modal header -->
      <div class="flex justify-between items-start py-3 px-5 rounded-t border-b bg-blue-500 dark:border-gray-600">
        <h3 class="mt-2 text-sm font-bold text-white dark:text-white">
            electronic Prescription Slip (ePresS)
        </h3><!-- (click)="printForm('philhealth_form')" -->
        <button type="button" printSectionId="philhealth_form" ngxPrint [useExistingCss]="true" class="bg-white text-blue-500 hover:bg-gray-100 hover:text-blue-400 px-2 py-1 rounded-md">
          <fa-icon [icon]="faPrint"></fa-icon>
        </button>
      </div>
      <!-- Modal body -->
      <div class="overflow-y-auto scrollbar-thin h-96 scrollbar-thumb-gray-400 scrollbar-track-gray-100" *ngIf="show_form">
        <div class="w-[210mm] h-[297mm] flex justify-center align-middle bg-white">
          <div class="w-[195mm] h-[272mm] mt-[12.5mm]" id="philhealth_form">
            <!-- FORM START -->
            <!-- <div class="border border-black w-full p-1 font-semibold">
              ANNEX G: Electronic Prescription Slip (ePresS)
            </div>

            <div class="text-xs my-5">
              Electronic Prescription Slip (ePresS) - proof of availment of medicines by the eligible beneficiary. This will be
              generated by the PhilHealth Konsulta facility for every patient encounter and to be submitted to PhilHealth.
            </div> -->

            <div class="border-2 border-gray-400">
              <div class="flex justify-center h-16 p-1">
                <img src="./assets/img/philhealth_logo_with_name.png" class="h-16" />
                <span class="font-semibold mt-4 ml-5 text-xl">ELECTRONIC PRESCRIPTION SLIP (EPRESS)</span>
              </div>

              <div class="m-1 font-semibold mt-3">
                To be filled-out by the facility (Pupunuan ng Pasilidad)
              </div>

              <table class="table-auto border border-gray-400 p-1 w-full mb-5">
                <tbody>
                  <tr>
                    <td colspan="6" class="text-xs border border-gray-400">
                      <span class="font-semibold">HCI NAME:</span><br />
                      {{ facility?.konsulta_credential.facility_name }}
                    </td>
                    <td colspan="2" class="text-xs border border-gray-400">
                      <span class="font-semibold">Case No:</span><br />
                      {{ patient_info?.case_number }}
                    </td>
                    <td colspan="2" class="text-xs border border-gray-400">
                      <span class="font-semibold text-xs">HCI Accreditation No.:</span><br />
                      {{ facility?.konsulta_credential.accreditation_number }}
                    </td>
                    <td colspan="2" class="text-xs border border-gray-400">
                      <span class="font-semibold text-sm">Transaction No.:</span><br />
                      {{ 'S'+consult_details?.transaction_number }}
                    </td>
                  </tr>

                  <tr>
                    <td colspan="4" class="text-xs border border-gray-400">
                      <span class="font-semibold">PIN (PhilHealth Identification No.):</span><br />
                      {{ patient_philhealth?.philhealth_id }}
                    </td>
                    <td colspan="4" class="text-xs border border-gray-400">
                      <span class="font-semibold">Membership Category:</span><br />
                      &nbsp;
                    </td>
                    <td colspan="4" class="text-xs border border-gray-400">
                      <span class="font-semibold">Membership Type:</span><br />
                      <div class="flex justify-end">
                        <div>
                          <input type="checkbox" disabled class="input-checkbox disabled:bg-gray-400 checked:bg-gray-400" [checked]="patient_philhealth?.membership_type_id === 'MM'">
                          <label>Member</label>
                        </div>
                        <div class="ml-3">
                          <input type="checkbox" disabled class="input-checkbox disabled:bg-gray-400 checked:bg-gray-400" [checked]="patient_philhealth?.membership_type_id === 'DD'">
                          <label>Dependent</label>
                        </div>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td colspan="6" class="text-xs border border-gray-400">
                      <span class="font-semibold">Patient Name (Pangalan ng Pasyente):</span><br />
                      {{ patient_info?.last_name }}, {{ patient_info?.first_name }} {{ patient_info?.middle_name }} {{ patient_info?.suffix_name === 'NA' ? '' : patient_info?.suffix_name }}
                    </td>
                    <td colspan="3" class="text-xs border border-gray-400">
                      <span class="font-semibold">Age (Edad):</span><br />
                      {{ patient_age }}
                    </td>
                    <td colspan="3" class="text-xs border border-gray-400">
                      <span class="font-semibold">Contact No. (Numero ng Telepono):</span><br />
                      {{ patient_info?.mobile_number }}
                    </td>
                  </tr>

                </tbody>
              </table>

              <div class="h-fit border border-gray-400 flex flex flex-col w-full">
                <div class="flex-none grid grid-cols-3">
                  <div class="ml-4 mt-2 text-2xl"><fa-icon [icon]="faPrescription"></fa-icon></div>
                  <div class="flex text-center text-xl font-bold">USE GENERIC NAME</div>
                  <div></div>
                </div>

                <div class="grow text-sm grid grid-cols-1 h-96">
                  <div>
                    <span *ngFor="let pres of prescriptions" class="flex justify-center">
                      <div class="flex flex-col text-center">
                        <span class="font-semibold" *ngIf="pres.konsulta_medicine">{{ pres.konsulta_medicine.desc }}</span>
                        <span class="font-semibold" *ngIf="!pres.konsulta_medicine">{{ pres.added_medicine }} {{ pres.dosage_quantity }} {{ pres.unit_of_measurement.code }}</span>

                        <span>{{ pres.quantity }} {{ pres.preparation.desc + (pres.quantity > 1 ? 's' : '') }}</span> <br />
                      </div>
                    </span>
                  </div>
                </div>

                <div class="flex-none grid grid-cols-2">
                  <div class="relative text-xs">
                    <div class="absolute inset-x-0 bottom-0">
                      Next Dispensing Date: ___________________ <br />
                      (Petsa ng susunod na bigay ng gamot)
                    </div>
                  </div>
                  <div class="flex justify-end text-xs">
                    <div class="flex flex-col">
                      <div>Physician: <span class="underline"> {{ prescriptions[0].prescriber.first_name }} {{ prescriptions[0].prescriber.middle_name !== 'N/A' ? prescriptions[0].prescriber.middle_name : '' }} {{ prescriptions[0].prescriber.last_name }}</span></div>
                      <div>PRC LIC No.: ______________________________</div>
                      <div>PTR No.: __________________________________</div>
                      <div>S2 No.: ___________________________________</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- <div class="w-full text-xs">
                <table class="border border-slate-600 border-collapse mx-2">
                  <thead>
                    <tr>
                      <th class="w-2/12 border border-slate-700 text-[.8em]">
                        Category <br />
                        (Kategorya)
                      </th>
                      <th class="w-1/12 border border-slate-700 text-[.8em]">
                        Medicine Strength/ Form/ Volume <br />
                        (Gamot/ Anyo/ Dami)
                      </th>
                      <th class="w-1/12 border border-slate-700 text-[.8em]">
                        Quantity<br />
                        (Bilang)
                      </th>
                      <th class="w-3/12 border border-slate-700 text-[.8em]">
                        Name of the Prescribing Physician <br />
                        (Pangalan ng nagresetang doktor)
                      </th>
                      <th class="w-1/12 border border-slate-700 text-[.8em]">
                        <span class="underline">&#10004;</span> Dispensed <br />
                        (Naibigay) <br />
                        <span class="underline">X</span> Not dispensed <br />
                        (Hindi naibigay)
                      </th>
                      <th class="w-1/12 border border-slate-700 text-[.8em]">
                        Date dispensed (Petsa kung kelan naibigay)
                      </th>
                      <th class="w-3/12 border border-slate-700 text-[.8em]">
                        Name of the Dispensing Personnel <br />
                        (Pangalan ng nagbigay)
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let pres of prescriptions; first as isFirst">
                      <td class="border border-slate-700 text-[.8em]">
                        <span class="uppercase" *ngIf="pres.konsulta_medicine">
                          {{pres.konsulta_medicine.category}}
                        </span>
                        <span class="uppercase" *ngIf="pres.added_medicine">
                          {{pres.purpose.desc}}
                        </span>

                      </td>

                      <td class="border border-slate-700 text-[.8em]">
                        <span *ngIf="pres.konsulta_medicine">{{ pres.konsulta_medicine.desc }}</span>
                        <span *ngIf="!pres.konsulta_medicine">{{ pres.added_medicine }} {{ pres.dosage_quantity }} {{ pres.unit_of_measurement.code }}</span>
                      </td>

                      <td class="border border-slate-700 text-center text-[.8em]">
                        {{ pres.quantity }}
                      </td>


                      <td class="border border-slate-700 text-[0.65rem] font-normal align-bottom" [rowSpan]="prescription_length" *ngIf="isFirst">
                        <div >
                          <br /><br /><br />
                          <strong>{{ pres.prescriber.first_name }} {{ pres.prescriber.middle_name }} {{ pres.prescriber.last_name }}</strong><br />
                          Signature over printed name <br />
                          License #: ________________
                        </div>
                      </td>

                      <td class="border border-slate-700 text-center text-[.8em]">
                        <span *ngIf="pres.dispensing">
                          &#10004;
                        </span>
                        <span *ngIf="!pres.dispensing">
                          X
                        </span>
                      </td>

                      <td class="border border-slate-700 text-[.8em]">
                        <span *ngIf="pres.dispensing">
                          {{ pres.dispensing[0].dispensing_date }}
                        </span>
                      </td>

                      <td class="border border-slate-700 text-[0.65rem] font-normal align-bottom" [rowSpan]="prescription_length" *ngIf="isFirst">
                        <br /><br /><br />
                        <strong>{{ dispensed_personnel?.first_name }} {{ dispensed_personnel?.middle_name }} {{ dispensed_personnel?.last_name }}</strong><br />
                        Signature over printed name <br />
                        Name of Dispensing Facility: <br />{{ facility?.konsulta_credential.facility_name }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div> -->

              <div class="text-[.6em] border-b-2 border-dashed border-gray-400 w-full p-2">
                Note: <br />
                &nbsp;
              </div>

              <div class="flex p-2 border-b-2 border-dotted border-gray-400 w-full">
                <div class="w-7/12 text-[.65em]">
                  Did you received the above-mentioned medicines?<br />
                  (Natanggap mo ba ang mga gamot na nabanggit?)
                </div>
                <div class="text-[.65em] mt-3 ml-5">
                  __Yes (Oo) __No (Hindi)
                </div>
              </div>

              <div class="flex p-2 border-b-2 border-dotted border-gray-400 w-full">
                <div class="w-7/12 text-[.65em]">
                  Are you satisfied with the medicines you received?<br />
                  (Nasiyahan ka ba sa mga gamot na natanggap mo?)
                </div>
                <div class="text-[.65em] ml-5 flex text-center">
                  <input type="checkbox" class="input-checkbox mt-3 ">
                  <div class="ml-2">
                    <fa-icon [icon]="faFaceSmile" class="text-xl"></fa-icon><br />
                    HAPPY
                  </div>
                </div>

                <div class="text-[.65em] ml-5 flex text-center">
                  <input type="checkbox" class="input-checkbox mt-3 ">
                  <div class="ml-2">
                    <fa-icon [icon]="faFaceMeh" class="text-xl"></fa-icon><br />
                    NEUTRAL
                  </div>
                </div>

                <div class="text-[.65em] ml-5 flex text-center">
                  <input type="checkbox" class="input-checkbox mt-3 ">
                  <div class="ml-2">
                    <fa-icon [icon]="faFaceFrown" class="text-xl"></fa-icon><br />
                    SAD
                  </div>
                </div>
              </div>

              <div class="flex p-2 border-b-2 border-gray-400 w-full">
                <div class="w-7/12 text-[.65em]">
                  For your comment, suggestion or complaint:<br />
                  (Para sa iyong komento, mungkahi o reklamo):
                </div>
              </div>
              <div class="flex p-2 border-b-2 border-gray-400 w-full">

              </div>

              <div class="flex p-1 w-full">
                <div class="w-7/12 text-[.65em]">
                  Note:<br />
                  Accomplished form shall be submitted to Konsulta Provider<br />
                  (Ang kumpletong form ay dapay Isumite sa tagapagbigay ng Konsulta)
                </div>

                <div class="relative text-[.65em] w-5/12">
                  <div class="absolute bottom-0 right-0">
                    Philhealth Identification Number of Patient: <span class="underline">{{ patient_philhealth?.philhealth_id }}</span>

                  </div>
                </div>

                <!-- <div class="text-[.65em] mt-3 ml-5 align-bottom justify-end flex mt-5">
                  Philhealth Identification Number of Patient: <span class="underline">{{ patient_philhealth?.philhealth_id }}</span>
                </div> -->
              </div>
            </div>
            <!-- FORM END -->
          </div>
        </div>
      </div>


      <div class="h-96 flex justify-center align-middle w-full" *ngIf="!show_form">
        <fa-icon [icon]="faCircleNotch" spin="true" size="2xl" class="mt-20 text-blue-500"></fa-icon>
      </div>
      <!-- Modal footer -->
      <div class="flex justify-end py-4 px-5 space-x-4 rounded-b border-t border-gray-200 dark:border-gray-600">
        <button  type="button" class="text-white bg-orange-500 hover:ring-2 focus:outline-none hover:ring-orange-300 rounded text-sm font-medium px-6 py-2.5 transition duration-150 ease-in-out transform hover:scale-110 " (click)="closeModal()">Close</button>
        <!-- <button  type="button" class="text-white bg-blue-500 hover:ring-2 focus:outline-none hover:ring-blue-300 font-medium rounded text-sm px-6 py-2.5 text-center transition duration-150 ease-in-out transform hover:scale-110" (click)="onSubmit()" >Save</button> -->
      </div>
    </div>
  </div>
</div>

<div class="opacity-50 fixed inset-0 z-50 bg-black"></div>
